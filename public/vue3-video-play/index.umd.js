var br=Object.defineProperty,Fr=Object.defineProperties;var Br=Object.getOwnPropertyDescriptors;var qe=Object.getOwnPropertySymbols;var Ur=Object.prototype.hasOwnProperty,Nr=Object.prototype.propertyIsEnumerable;var et=(ne,b,le)=>b in ne?br(ne,b,{enumerable:!0,configurable:!0,writable:!0,value:le}):ne[b]=le,we=(ne,b)=>{for(var le in b||(b={}))Ur.call(b,le)&&et(ne,le,b[le]);if(qe)for(var le of qe(b))Nr.call(b,le)&&et(ne,le,b[le]);return ne},Ke=(ne,b)=>Fr(ne,Br(b));(function(ne,b){typeof exports=="object"&&typeof module!="undefined"?b(exports,require("vue")):typeof define=="function"&&define.amd?define(["exports","vue"],b):(ne=typeof globalThis!="undefined"?globalThis:ne||self,b(ne.index={},ne.Vue))})(this,function(ne,b){"use strict";function le(V,j,K,P){var p,M=!1,O=0;function A(){p&&clearTimeout(p)}function F(){A(),M=!0}typeof j!="boolean"&&(P=K,K=j,j=void 0);function D(){for(var R=arguments.length,L=new Array(R),g=0;g<R;g++)L[g]=arguments[g];var S=this,T=Date.now()-O;if(M)return;function x(){O=Date.now(),K.apply(S,L)}function m(){p=void 0}P&&!p&&x(),A(),P===void 0&&T>V?x():j!==!0&&(p=setTimeout(P?m:x,P===void 0?V-T:V))}return D.cancel=F,D}function Xe(V,j,K){return K===void 0?le(V,j,!1):le(V,K,j!==!1)}var tt=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{};function rt(V){return V&&V.__esModule&&Object.prototype.hasOwnProperty.call(V,"default")?V.default:V}var ze={exports:{}};(function(V,j){typeof window!="undefined"&&function(P,p){V.exports=p()}(tt,function(){return function(K){var P={};function p(M){if(P[M])return P[M].exports;var O=P[M]={i:M,l:!1,exports:{}};return K[M].call(O.exports,O,O.exports,p),O.l=!0,O.exports}return p.m=K,p.c=P,p.d=function(M,O,A){p.o(M,O)||Object.defineProperty(M,O,{enumerable:!0,get:A})},p.r=function(M){typeof Symbol!="undefined"&&Symbol.toStringTag&&Object.defineProperty(M,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(M,"__esModule",{value:!0})},p.t=function(M,O){if(O&1&&(M=p(M)),O&8||O&4&&typeof M=="object"&&M&&M.__esModule)return M;var A=Object.create(null);if(p.r(A),Object.defineProperty(A,"default",{enumerable:!0,value:M}),O&2&&typeof M!="string")for(var F in M)p.d(A,F,function(D){return M[D]}.bind(null,F));return A},p.n=function(M){var O=M&&M.__esModule?function(){return M.default}:function(){return M};return p.d(O,"a",O),O},p.o=function(M,O){return Object.prototype.hasOwnProperty.call(M,O)},p.p="/dist/",p(p.s="./src/hls.ts")}({"./node_modules/eventemitter3/index.js":function(K,P,p){var M=Object.prototype.hasOwnProperty,O="~";function A(){}Object.create&&(A.prototype=Object.create(null),new A().__proto__||(O=!1));function F(g,S,T){this.fn=g,this.context=S,this.once=T||!1}function D(g,S,T,x,m){if(typeof T!="function")throw new TypeError("The listener must be a function");var h=new F(T,x||g,m),i=O?O+S:S;return g._events[i]?g._events[i].fn?g._events[i]=[g._events[i],h]:g._events[i].push(h):(g._events[i]=h,g._eventsCount++),g}function R(g,S){--g._eventsCount==0?g._events=new A:delete g._events[S]}function L(){this._events=new A,this._eventsCount=0}L.prototype.eventNames=function(){var S=[],T,x;if(this._eventsCount===0)return S;for(x in T=this._events)M.call(T,x)&&S.push(O?x.slice(1):x);return Object.getOwnPropertySymbols?S.concat(Object.getOwnPropertySymbols(T)):S},L.prototype.listeners=function(S){var T=O?O+S:S,x=this._events[T];if(!x)return[];if(x.fn)return[x.fn];for(var m=0,h=x.length,i=new Array(h);m<h;m++)i[m]=x[m].fn;return i},L.prototype.listenerCount=function(S){var T=O?O+S:S,x=this._events[T];return x?x.fn?1:x.length:0},L.prototype.emit=function(S,T,x,m,h,i){var e=O?O+S:S;if(!this._events[e])return!1;var r=this._events[e],t=arguments.length,f,s;if(r.fn){switch(r.once&&this.removeListener(S,r.fn,void 0,!0),t){case 1:return r.fn.call(r.context),!0;case 2:return r.fn.call(r.context,T),!0;case 3:return r.fn.call(r.context,T,x),!0;case 4:return r.fn.call(r.context,T,x,m),!0;case 5:return r.fn.call(r.context,T,x,m,h),!0;case 6:return r.fn.call(r.context,T,x,m,h,i),!0}for(s=1,f=new Array(t-1);s<t;s++)f[s-1]=arguments[s];r.fn.apply(r.context,f)}else{var n=r.length,o;for(s=0;s<n;s++)switch(r[s].once&&this.removeListener(S,r[s].fn,void 0,!0),t){case 1:r[s].fn.call(r[s].context);break;case 2:r[s].fn.call(r[s].context,T);break;case 3:r[s].fn.call(r[s].context,T,x);break;case 4:r[s].fn.call(r[s].context,T,x,m);break;default:if(!f)for(o=1,f=new Array(t-1);o<t;o++)f[o-1]=arguments[o];r[s].fn.apply(r[s].context,f)}}return!0},L.prototype.on=function(S,T,x){return D(this,S,T,x,!1)},L.prototype.once=function(S,T,x){return D(this,S,T,x,!0)},L.prototype.removeListener=function(S,T,x,m){var h=O?O+S:S;if(!this._events[h])return this;if(!T)return R(this,h),this;var i=this._events[h];if(i.fn)i.fn===T&&(!m||i.once)&&(!x||i.context===x)&&R(this,h);else{for(var e=0,r=[],t=i.length;e<t;e++)(i[e].fn!==T||m&&!i[e].once||x&&i[e].context!==x)&&r.push(i[e]);r.length?this._events[h]=r.length===1?r[0]:r:R(this,h)}return this},L.prototype.removeAllListeners=function(S){var T;return S?(T=O?O+S:S,this._events[T]&&R(this,T)):(this._events=new A,this._eventsCount=0),this},L.prototype.off=L.prototype.removeListener,L.prototype.addListener=L.prototype.on,L.prefixed=O,L.EventEmitter=L,K.exports=L},"./node_modules/url-toolkit/src/url-toolkit.js":function(K,P,p){(function(M){var O=/^((?:[a-zA-Z0-9+\-.]+:)?)(\/\/[^\/?#]*)?((?:[^\/?#]*\/)*[^;?#]*)?(;[^?#]*)?(\?[^#]*)?(#[^]*)?$/,A=/^([^\/?#]*)([^]*)$/,F=/(?:\/|^)\.(?=\/)/g,D=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,R={buildAbsoluteURL:function(L,g,S){if(S=S||{},L=L.trim(),g=g.trim(),!g){if(!S.alwaysNormalize)return L;var T=R.parseURL(L);if(!T)throw new Error("Error trying to parse base URL.");return T.path=R.normalizePath(T.path),R.buildURLFromParts(T)}var x=R.parseURL(g);if(!x)throw new Error("Error trying to parse relative URL.");if(x.scheme)return S.alwaysNormalize?(x.path=R.normalizePath(x.path),R.buildURLFromParts(x)):g;var m=R.parseURL(L);if(!m)throw new Error("Error trying to parse base URL.");if(!m.netLoc&&m.path&&m.path[0]!=="/"){var h=A.exec(m.path);m.netLoc=h[1],m.path=h[2]}m.netLoc&&!m.path&&(m.path="/");var i={scheme:m.scheme,netLoc:x.netLoc,path:null,params:x.params,query:x.query,fragment:x.fragment};if(!x.netLoc&&(i.netLoc=m.netLoc,x.path[0]!=="/"))if(!x.path)i.path=m.path,x.params||(i.params=m.params,x.query||(i.query=m.query));else{var e=m.path,r=e.substring(0,e.lastIndexOf("/")+1)+x.path;i.path=R.normalizePath(r)}return i.path===null&&(i.path=S.alwaysNormalize?R.normalizePath(x.path):x.path),R.buildURLFromParts(i)},parseURL:function(L){var g=O.exec(L);return g?{scheme:g[1]||"",netLoc:g[2]||"",path:g[3]||"",params:g[4]||"",query:g[5]||"",fragment:g[6]||""}:null},normalizePath:function(L){for(L=L.split("").reverse().join("").replace(F,"");L.length!==(L=L.replace(D,"")).length;);return L.split("").reverse().join("")},buildURLFromParts:function(L){return L.scheme+L.netLoc+L.path+L.params+L.query+L.fragment}};K.exports=R})()},"./node_modules/webworkify-webpack/index.js":function(K,P,p){function M(S){var T={};function x(h){if(T[h])return T[h].exports;var i=T[h]={i:h,l:!1,exports:{}};return S[h].call(i.exports,i,i.exports,x),i.l=!0,i.exports}x.m=S,x.c=T,x.i=function(h){return h},x.d=function(h,i,e){x.o(h,i)||Object.defineProperty(h,i,{configurable:!1,enumerable:!0,get:e})},x.r=function(h){Object.defineProperty(h,"__esModule",{value:!0})},x.n=function(h){var i=h&&h.__esModule?function(){return h.default}:function(){return h};return x.d(i,"a",i),i},x.o=function(h,i){return Object.prototype.hasOwnProperty.call(h,i)},x.p="/",x.oe=function(h){throw console.error(h),h};var m=x(x.s=ENTRY_MODULE);return m.default||m}var O="[\\.|\\-|\\+|\\w|/|@]+",A="\\(\\s*(/\\*.*?\\*/)?\\s*.*?("+O+").*?\\)";function F(S){return(S+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function D(S){return!isNaN(1*S)}function R(S,T,x){var m={};m[x]=[];var h=T.toString(),i=h.match(/^function\s?\w*\(\w+,\s*\w+,\s*(\w+)\)/);if(!i)return m;for(var e=i[1],r=new RegExp("(\\\\n|\\W)"+F(e)+A,"g"),t;t=r.exec(h);)t[3]!=="dll-reference"&&m[x].push(t[3]);for(r=new RegExp("\\("+F(e)+'\\("(dll-reference\\s('+O+'))"\\)\\)'+A,"g");t=r.exec(h);)S[t[2]]||(m[x].push(t[1]),S[t[2]]=p(t[1]).m),m[t[2]]=m[t[2]]||[],m[t[2]].push(t[4]);for(var f=Object.keys(m),s=0;s<f.length;s++)for(var n=0;n<m[f[s]].length;n++)D(m[f[s]][n])&&(m[f[s]][n]=1*m[f[s]][n]);return m}function L(S){var T=Object.keys(S);return T.reduce(function(x,m){return x||S[m].length>0},!1)}function g(S,T){for(var x={main:[T]},m={main:[]},h={main:{}};L(x);)for(var i=Object.keys(x),e=0;e<i.length;e++){var r=i[e],t=x[r],f=t.pop();if(h[r]=h[r]||{},!(h[r][f]||!S[r][f])){h[r][f]=!0,m[r]=m[r]||[],m[r].push(f);for(var s=R(S,S[r][f],r),n=Object.keys(s),o=0;o<n.length;o++)x[n[o]]=x[n[o]]||[],x[n[o]]=x[n[o]].concat(s[n[o]])}}return m}K.exports=function(S,T){T=T||{};var x={main:p.m},m=T.all?{main:Object.keys(x.main)}:g(x,S),h="";Object.keys(m).filter(function(f){return f!=="main"}).forEach(function(f){for(var s=0;m[f][s];)s++;m[f].push(s),x[f][s]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",h=h+"var "+f+" = ("+M.toString().replace("ENTRY_MODULE",JSON.stringify(s))+")({"+m[f].map(function(n){return""+JSON.stringify(n)+": "+x[f][n].toString()}).join(",")+`});
`}),h=h+"new (("+M.toString().replace("ENTRY_MODULE",JSON.stringify(S))+")({"+m.main.map(function(f){return""+JSON.stringify(f)+": "+x.main[f].toString()}).join(",")+"}))(self);";var i=new window.Blob([h],{type:"text/javascript"});if(T.bare)return i;var e=window.URL||window.webkitURL||window.mozURL||window.msURL,r=e.createObjectURL(i),t=new window.Worker(r);return t.objectURL=r,t}},"./src/config.ts":function(K,P,p){p.r(P),p.d(P,"hlsDefaultConfig",function(){return o}),p.d(P,"mergeConfig",function(){return v}),p.d(P,"enableStreamingMode",function(){return u});var M=p("./src/controller/abr-controller.ts"),O=p("./src/controller/audio-stream-controller.ts"),A=p("./src/controller/audio-track-controller.ts"),F=p("./src/controller/subtitle-stream-controller.ts"),D=p("./src/controller/subtitle-track-controller.ts"),R=p("./src/controller/buffer-controller.ts"),L=p("./src/controller/timeline-controller.ts"),g=p("./src/controller/cap-level-controller.ts"),S=p("./src/controller/fps-controller.ts"),T=p("./src/controller/eme-controller.ts"),x=p("./src/controller/cmcd-controller.ts"),m=p("./src/utils/xhr-loader.ts"),h=p("./src/utils/fetch-loader.ts"),i=p("./src/utils/cues.ts"),e=p("./src/utils/mediakeys-helper.ts"),r=p("./src/utils/logger.ts");function t(){return t=Object.assign||function(a){for(var l=1;l<arguments.length;l++){var d=arguments[l];for(var E in d)Object.prototype.hasOwnProperty.call(d,E)&&(a[E]=d[E])}return a},t.apply(this,arguments)}function f(a,l){var d=Object.keys(a);if(Object.getOwnPropertySymbols){var E=Object.getOwnPropertySymbols(a);l&&(E=E.filter(function(y){return Object.getOwnPropertyDescriptor(a,y).enumerable})),d.push.apply(d,E)}return d}function s(a){for(var l=1;l<arguments.length;l++){var d=arguments[l]!=null?arguments[l]:{};l%2?f(Object(d),!0).forEach(function(E){n(a,E,d[E])}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(d)):f(Object(d)).forEach(function(E){Object.defineProperty(a,E,Object.getOwnPropertyDescriptor(d,E))})}return a}function n(a,l,d){return l in a?Object.defineProperty(a,l,{value:d,enumerable:!0,configurable:!0,writable:!0}):a[l]=d,a}var o=s(s({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,maxBufferSize:60*1e3*1e3,maxBufferHole:.1,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,enableSoftwareAES:!0,manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,startLevel:void 0,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:m.default,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:M.default,bufferController:R.default,capLevelController:g.default,fpsController:S.default,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystemOptions:{},requestMediaKeySystemAccessFunc:e.requestMediaKeySystemAccess,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0},c()),{},{subtitleStreamController:F.SubtitleStreamController,subtitleTrackController:D.default,timelineController:L.TimelineController,audioStreamController:O.default,audioTrackController:A.default,emeController:T.default,cmcdController:x.default});function c(){return{cueHandler:i.default,enableCEA708Captions:!0,enableWebVTT:!0,enableIMSC1:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}}function v(a,l){if((l.liveSyncDurationCount||l.liveMaxLatencyDurationCount)&&(l.liveSyncDuration||l.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(l.liveMaxLatencyDurationCount!==void 0&&(l.liveSyncDurationCount===void 0||l.liveMaxLatencyDurationCount<=l.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(l.liveMaxLatencyDuration!==void 0&&(l.liveSyncDuration===void 0||l.liveMaxLatencyDuration<=l.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');return t({},a,l)}function u(a){var l=a.loader;if(l!==h.default&&l!==m.default)r.logger.log("[config]: Custom loader detected, cannot enable progressive streaming"),a.progressive=!1;else{var d=Object(h.fetchSupported)();d&&(a.loader=h.default,a.progressive=!0,a.enableSoftwareAES=!0,r.logger.log("[config]: Progressive streaming enabled, using FetchLoader"))}}},"./src/controller/abr-controller.ts":function(K,P,p){p.r(P);var M=p("./src/polyfills/number.ts"),O=p("./src/utils/ewma-bandwidth-estimator.ts"),A=p("./src/events.ts"),F=p("./src/utils/buffer-helper.ts"),D=p("./src/errors.ts"),R=p("./src/types/loader.ts"),L=p("./src/utils/logger.ts");function g(x,m){for(var h=0;h<m.length;h++){var i=m[h];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(x,i.key,i)}}function S(x,m,h){return m&&g(x.prototype,m),h&&g(x,h),x}var T=function(){function x(h){this.hls=void 0,this.lastLoadedFragLevel=0,this._nextAutoLevel=-1,this.timer=void 0,this.onCheck=this._abandonRulesCheck.bind(this),this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.bwEstimator=void 0,this.hls=h;var i=h.config;this.bwEstimator=new O.default(i.abrEwmaSlowVoD,i.abrEwmaFastVoD,i.abrEwmaDefaultEstimate),this.registerListeners()}var m=x.prototype;return m.registerListeners=function(){var i=this.hls;i.on(A.Events.FRAG_LOADING,this.onFragLoading,this),i.on(A.Events.FRAG_LOADED,this.onFragLoaded,this),i.on(A.Events.FRAG_BUFFERED,this.onFragBuffered,this),i.on(A.Events.LEVEL_LOADED,this.onLevelLoaded,this),i.on(A.Events.ERROR,this.onError,this)},m.unregisterListeners=function(){var i=this.hls;i.off(A.Events.FRAG_LOADING,this.onFragLoading,this),i.off(A.Events.FRAG_LOADED,this.onFragLoaded,this),i.off(A.Events.FRAG_BUFFERED,this.onFragBuffered,this),i.off(A.Events.LEVEL_LOADED,this.onLevelLoaded,this),i.off(A.Events.ERROR,this.onError,this)},m.destroy=function(){this.unregisterListeners(),this.clearTimer(),this.hls=this.onCheck=null,this.fragCurrent=this.partCurrent=null},m.onFragLoading=function(i,e){var r=e.frag;if(r.type===R.PlaylistLevelType.MAIN&&!this.timer){var t;this.fragCurrent=r,this.partCurrent=(t=e.part)!=null?t:null,this.timer=self.setInterval(this.onCheck,100)}},m.onLevelLoaded=function(i,e){var r=this.hls.config;e.details.live?this.bwEstimator.update(r.abrEwmaSlowLive,r.abrEwmaFastLive):this.bwEstimator.update(r.abrEwmaSlowVoD,r.abrEwmaFastVoD)},m._abandonRulesCheck=function(){var i=this.fragCurrent,e=this.partCurrent,r=this.hls,t=r.autoLevelEnabled,f=r.config,s=r.media;if(!(!i||!s)){var n=e?e.stats:i.stats,o=e?e.duration:i.duration;if(n.aborted){L.logger.warn("frag loader destroy or aborted, disarm abandonRules"),this.clearTimer(),this._nextAutoLevel=-1;return}if(!(!t||s.paused||!s.playbackRate||!s.readyState)){var c=performance.now()-n.loading.start,v=Math.abs(s.playbackRate);if(!(c<=500*o/v)){var u=r.levels,a=r.minAutoLevel,l=u[i.level],d=n.total||Math.max(n.loaded,Math.round(o*l.maxBitrate/8)),E=Math.max(1,n.bwEstimate?n.bwEstimate/8:n.loaded*1e3/c),y=(d-n.loaded)/E,I=s.currentTime,C=(F.BufferHelper.bufferInfo(s,I,f.maxBufferHole).end-I)/v;if(!(C>=2*o/v||y<=C)){var _=Number.POSITIVE_INFINITY,B;for(B=i.level-1;B>a;B--){var U=u[B].maxBitrate;if(_=o*U/(8*.8*E),_<C)break}if(!(_>=y)){var N=this.bwEstimator.getEstimate();L.logger.warn("Fragment "+i.sn+(e?" part "+e.index:"")+" of level "+i.level+" is loading too slowly and will cause an underbuffer; aborting and switching to level "+B+`
      Current BW estimate: `+(Object(M.isFiniteNumber)(N)?(N/1024).toFixed(3):"Unknown")+` Kb/s
      Estimated load time for current fragment: `+y.toFixed(3)+` s
      Estimated load time for the next fragment: `+_.toFixed(3)+` s
      Time to underbuffer: `+C.toFixed(3)+" s"),r.nextLoadLevel=B,this.bwEstimator.sample(c,n.loaded),this.clearTimer(),i.loader&&(this.fragCurrent=this.partCurrent=null,i.loader.abort()),r.trigger(A.Events.FRAG_LOAD_EMERGENCY_ABORTED,{frag:i,part:e,stats:n})}}}}}},m.onFragLoaded=function(i,e){var r=e.frag,t=e.part;if(r.type===R.PlaylistLevelType.MAIN&&Object(M.isFiniteNumber)(r.sn)){var f=t?t.stats:r.stats,s=t?t.duration:r.duration;if(this.clearTimer(),this.lastLoadedFragLevel=r.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate){var n=this.hls.levels[r.level],o=(n.loaded?n.loaded.bytes:0)+f.loaded,c=(n.loaded?n.loaded.duration:0)+s;n.loaded={bytes:o,duration:c},n.realBitrate=Math.round(8*o/c)}if(r.bitrateTest){var v={stats:f,frag:r,part:t,id:r.type};this.onFragBuffered(A.Events.FRAG_BUFFERED,v),r.bitrateTest=!1}}},m.onFragBuffered=function(i,e){var r=e.frag,t=e.part,f=t?t.stats:r.stats;if(!f.aborted&&!(r.type!==R.PlaylistLevelType.MAIN||r.sn==="initSegment")){var s=f.parsing.end-f.loading.start;this.bwEstimator.sample(s,f.loaded),f.bwEstimate=this.bwEstimator.getEstimate(),r.bitrateTest?this.bitrateTestDelay=s/1e3:this.bitrateTestDelay=0}},m.onError=function(i,e){switch(e.details){case D.ErrorDetails.FRAG_LOAD_ERROR:case D.ErrorDetails.FRAG_LOAD_TIMEOUT:this.clearTimer();break}},m.clearTimer=function(){self.clearInterval(this.timer),this.timer=void 0},m.getNextABRAutoLevel=function(){var i=this.fragCurrent,e=this.partCurrent,r=this.hls,t=r.maxAutoLevel,f=r.config,s=r.minAutoLevel,n=r.media,o=e?e.duration:i?i.duration:0,c=n?n.currentTime:0,v=n&&n.playbackRate!==0?Math.abs(n.playbackRate):1,u=this.bwEstimator?this.bwEstimator.getEstimate():f.abrEwmaDefaultEstimate,a=(F.BufferHelper.bufferInfo(n,c,f.maxBufferHole).end-c)/v,l=this.findBestLevel(u,s,t,a,f.abrBandWidthFactor,f.abrBandWidthUpFactor);if(l>=0)return l;L.logger.trace((a?"rebuffering expected":"buffer is empty")+", finding optimal quality level");var d=o?Math.min(o,f.maxStarvationDelay):f.maxStarvationDelay,E=f.abrBandWidthFactor,y=f.abrBandWidthUpFactor;if(!a){var I=this.bitrateTestDelay;if(I){var C=o?Math.min(o,f.maxLoadingDelay):f.maxLoadingDelay;d=C-I,L.logger.trace("bitrate test took "+Math.round(1e3*I)+"ms, set first fragment max fetchDuration to "+Math.round(1e3*d)+" ms"),E=y=1}}return l=this.findBestLevel(u,s,t,a+d,E,y),Math.max(l,0)},m.findBestLevel=function(i,e,r,t,f,s){for(var n,o=this.fragCurrent,c=this.partCurrent,v=this.lastLoadedFragLevel,u=this.hls.levels,a=u[v],l=!!(a!=null&&(n=a.details)!==null&&n!==void 0&&n.live),d=a==null?void 0:a.codecSet,E=c?c.duration:o?o.duration:0,y=r;y>=e;y--){var I=u[y];if(!(!I||d&&I.codecSet!==d)){var C=I.details,_=(c?C==null?void 0:C.partTarget:C==null?void 0:C.averagetargetduration)||E,B=void 0;y<=v?B=f*i:B=s*i;var U=u[y].maxBitrate,N=U*_/B;if(L.logger.trace("level/adjustedbw/bitrate/avgDuration/maxFetchDuration/fetchDuration: "+y+"/"+Math.round(B)+"/"+U+"/"+_+"/"+t+"/"+N),B>U&&(!N||l&&!this.bitrateTestDelay||N<t))return y}}return-1},S(x,[{key:"nextAutoLevel",get:function(){var i=this._nextAutoLevel,e=this.bwEstimator;if(i!==-1&&(!e||!e.canEstimate()))return i;var r=this.getNextABRAutoLevel();return i!==-1&&(r=Math.min(i,r)),r},set:function(i){this._nextAutoLevel=i}}]),x}();P.default=T},"./src/controller/audio-stream-controller.ts":function(K,P,p){p.r(P);var M=p("./src/polyfills/number.ts"),O=p("./src/controller/base-stream-controller.ts"),A=p("./src/events.ts"),F=p("./src/utils/buffer-helper.ts"),D=p("./src/controller/fragment-tracker.ts"),R=p("./src/types/level.ts"),L=p("./src/types/loader.ts"),g=p("./src/loader/fragment.ts"),S=p("./src/demux/chunk-cache.ts"),T=p("./src/demux/transmuxer-interface.ts"),x=p("./src/types/transmuxer.ts"),m=p("./src/controller/fragment-finders.ts"),h=p("./src/utils/discontinuities.ts"),i=p("./src/errors.ts"),e=p("./src/utils/logger.ts");function r(){return r=Object.assign||function(o){for(var c=1;c<arguments.length;c++){var v=arguments[c];for(var u in v)Object.prototype.hasOwnProperty.call(v,u)&&(o[u]=v[u])}return o},r.apply(this,arguments)}function t(o,c){o.prototype=Object.create(c.prototype),o.prototype.constructor=o,f(o,c)}function f(o,c){return f=Object.setPrototypeOf||function(u,a){return u.__proto__=a,u},f(o,c)}var s=100,n=function(o){t(c,o);function c(u,a){var l;return l=o.call(this,u,a,"[audio-stream-controller]")||this,l.videoBuffer=null,l.videoTrackCC=-1,l.waitingVideoCC=-1,l.audioSwitch=!1,l.trackId=-1,l.waitingData=null,l.mainDetails=null,l.bufferFlushed=!1,l._registerListeners(),l}var v=c.prototype;return v.onHandlerDestroying=function(){this._unregisterListeners(),this.mainDetails=null},v._registerListeners=function(){var a=this.hls;a.on(A.Events.MEDIA_ATTACHED,this.onMediaAttached,this),a.on(A.Events.MEDIA_DETACHING,this.onMediaDetaching,this),a.on(A.Events.MANIFEST_LOADING,this.onManifestLoading,this),a.on(A.Events.LEVEL_LOADED,this.onLevelLoaded,this),a.on(A.Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),a.on(A.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),a.on(A.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),a.on(A.Events.ERROR,this.onError,this),a.on(A.Events.BUFFER_RESET,this.onBufferReset,this),a.on(A.Events.BUFFER_CREATED,this.onBufferCreated,this),a.on(A.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),a.on(A.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),a.on(A.Events.FRAG_BUFFERED,this.onFragBuffered,this)},v._unregisterListeners=function(){var a=this.hls;a.off(A.Events.MEDIA_ATTACHED,this.onMediaAttached,this),a.off(A.Events.MEDIA_DETACHING,this.onMediaDetaching,this),a.off(A.Events.MANIFEST_LOADING,this.onManifestLoading,this),a.off(A.Events.LEVEL_LOADED,this.onLevelLoaded,this),a.off(A.Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),a.off(A.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),a.off(A.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),a.off(A.Events.ERROR,this.onError,this),a.off(A.Events.BUFFER_RESET,this.onBufferReset,this),a.off(A.Events.BUFFER_CREATED,this.onBufferCreated,this),a.off(A.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),a.off(A.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),a.off(A.Events.FRAG_BUFFERED,this.onFragBuffered,this)},v.onInitPtsFound=function(a,l){var d=l.frag,E=l.id,y=l.initPTS;if(E==="main"){var I=d.cc;this.initPTS[d.cc]=y,this.log("InitPTS for cc: "+I+" found from main: "+y),this.videoTrackCC=I,this.state===O.State.WAITING_INIT_PTS&&this.tick()}},v.startLoad=function(a){if(!this.levels){this.startPosition=a,this.state=O.State.STOPPED;return}var l=this.lastCurrentTime;this.stopLoad(),this.setInterval(s),this.fragLoadError=0,l>0&&a===-1?(this.log("Override startPosition with lastCurrentTime @"+l.toFixed(3)),this.state=O.State.IDLE):(this.loadedmetadata=!1,this.state=O.State.WAITING_TRACK),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=a,this.tick()},v.doTick=function(){switch(this.state){case O.State.IDLE:this.doTickIdle();break;case O.State.WAITING_TRACK:{var a,l=this.levels,d=this.trackId,E=l==null||(a=l[d])===null||a===void 0?void 0:a.details;if(E){if(this.waitForCdnTuneIn(E))break;this.state=O.State.WAITING_INIT_PTS}break}case O.State.FRAG_LOADING_WAITING_RETRY:{var y,I=performance.now(),C=this.retryDate;(!C||I>=C||(y=this.media)!==null&&y!==void 0&&y.seeking)&&(this.log("RetryDate reached, switch back to IDLE state"),this.state=O.State.IDLE);break}case O.State.WAITING_INIT_PTS:{var _=this.waitingData;if(_){var B=_.frag,U=_.part,N=_.cache,k=_.complete;if(this.initPTS[B.cc]!==void 0){this.waitingData=null,this.waitingVideoCC=-1,this.state=O.State.FRAG_LOADING;var w=N.flush(),G={frag:B,part:U,payload:w,networkDetails:null};this._handleFragmentLoadProgress(G),k&&o.prototype._handleFragmentLoadComplete.call(this,G)}else if(this.videoTrackCC!==this.waitingVideoCC)e.logger.log("Waiting fragment cc ("+B.cc+") cancelled because video is at cc "+this.videoTrackCC),this.clearWaitingFragment();else{var W=this.getLoadPosition(),Y=F.BufferHelper.bufferInfo(this.mediaBuffer,W,this.config.maxBufferHole),H=Object(m.fragmentWithinToleranceTest)(Y.end,this.config.maxFragLookUpTolerance,B);H<0&&(e.logger.log("Waiting fragment cc ("+B.cc+") @ "+B.start+" cancelled because another fragment at "+Y.end+" is needed"),this.clearWaitingFragment())}}else this.state=O.State.IDLE}}this.onTickEnd()},v.clearWaitingFragment=function(){var a=this.waitingData;a&&(this.fragmentTracker.removeFragment(a.frag),this.waitingData=null,this.waitingVideoCC=-1,this.state=O.State.IDLE)},v.onTickEnd=function(){var a=this.media;if(!(!a||!a.readyState)){var l=this.mediaBuffer?this.mediaBuffer:a,d=l.buffered;!this.loadedmetadata&&d.length&&(this.loadedmetadata=!0),this.lastCurrentTime=a.currentTime}},v.doTickIdle=function(){var a,l,d=this.hls,E=this.levels,y=this.media,I=this.trackId,C=d.config;if(!(!E||!E[I])&&!(!y&&(this.startFragRequested||!C.startFragPrefetch))){var _=E[I],B=_.details;if(!B||B.live&&this.levelLastLoaded!==I||this.waitForCdnTuneIn(B)){this.state=O.State.WAITING_TRACK;return}this.bufferFlushed&&(this.bufferFlushed=!1,this.afterBufferFlushed(this.mediaBuffer?this.mediaBuffer:this.media,g.ElementaryStreamTypes.AUDIO,L.PlaylistLevelType.AUDIO));var U=this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:this.media,L.PlaylistLevelType.AUDIO);if(U!==null){var N=U.len,k=this.getMaxBufferLength(),w=this.audioSwitch;if(!(N>=k&&!w)){if(!w&&this._streamEnded(U,B)){d.trigger(A.Events.BUFFER_EOS,{type:"audio"}),this.state=O.State.ENDED;return}var G=B.fragments,W=G[0].start,Y=U.end;if(w){var H=this.getLoadPosition();Y=H,B.PTSKnown&&H<W&&(U.end>W||U.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),y.currentTime=W+.05)}var z=this.getNextFragment(Y,B);if(!z){this.bufferFlushed=!0;return}((a=z.decryptdata)===null||a===void 0?void 0:a.keyFormat)==="identity"&&!((l=z.decryptdata)!==null&&l!==void 0&&l.key)?this.loadKey(z,B):this.loadFragment(z,B,Y)}}}},v.getMaxBufferLength=function(){var a=o.prototype.getMaxBufferLength.call(this),l=this.getFwdBufferInfo(this.videoBuffer?this.videoBuffer:this.media,L.PlaylistLevelType.MAIN);return l===null?a:Math.max(a,l.len)},v.onMediaDetaching=function(){this.videoBuffer=null,o.prototype.onMediaDetaching.call(this)},v.onAudioTracksUpdated=function(a,l){var d=l.audioTracks;this.resetTransmuxer(),this.levels=d.map(function(E){return new R.Level(E)})},v.onAudioTrackSwitching=function(a,l){var d=!!l.url;this.trackId=l.id;var E=this.fragCurrent;E!=null&&E.loader&&E.loader.abort(),this.fragCurrent=null,this.clearWaitingFragment(),d?this.setInterval(s):this.resetTransmuxer(),d?(this.audioSwitch=!0,this.state=O.State.IDLE):this.state=O.State.STOPPED,this.tick()},v.onManifestLoading=function(){this.mainDetails=null,this.fragmentTracker.removeAllFragments(),this.startPosition=this.lastCurrentTime=0,this.bufferFlushed=!1},v.onLevelLoaded=function(a,l){this.mainDetails=l.details},v.onAudioTrackLoaded=function(a,l){var d,E=this.levels,y=l.details,I=l.id;if(!E){this.warn("Audio tracks were reset while loading level "+I);return}this.log("Track "+I+" loaded ["+y.startSN+","+y.endSN+"],duration:"+y.totalduration);var C=E[I],_=0;if(y.live||(d=C.details)!==null&&d!==void 0&&d.live){var B=this.mainDetails;if(y.fragments[0]||(y.deltaUpdateFailed=!0),y.deltaUpdateFailed||!B)return;!C.details&&y.hasProgramDateTime&&B.hasProgramDateTime?(Object(h.alignMediaPlaylistByPDT)(y,B),_=y.fragments[0].start):_=this.alignPlaylists(y,C.details)}C.details=y,this.levelLastLoaded=I,!this.startFragRequested&&(this.mainDetails||!y.live)&&this.setStartPosition(C.details,_),this.state===O.State.WAITING_TRACK&&!this.waitForCdnTuneIn(y)&&(this.state=O.State.IDLE),this.tick()},v._handleFragmentLoadProgress=function(a){var l,d=a.frag,E=a.part,y=a.payload,I=this.config,C=this.trackId,_=this.levels;if(!_){this.warn("Audio tracks were reset while fragment load was in progress. Fragment "+d.sn+" of level "+d.level+" will not be buffered");return}var B=_[C];console.assert(B,"Audio track is defined on fragment load progress");var U=B.details;console.assert(U,"Audio track details are defined on fragment load progress");var N=I.defaultAudioCodec||B.audioCodec||"mp4a.40.2",k=this.transmuxer;k||(k=this.transmuxer=new T.default(this.hls,L.PlaylistLevelType.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));var w=this.initPTS[d.cc],G=(l=d.initSegment)===null||l===void 0?void 0:l.data;if(w!==void 0){var W=!1,Y=E?E.index:-1,H=Y!==-1,z=new x.ChunkMetadata(d.level,d.sn,d.stats.chunkCount,y.byteLength,Y,H);k.push(y,G,N,"",d,E,U.totalduration,W,z,w)}else{e.logger.log("Unknown video PTS for cc "+d.cc+", waiting for video PTS before demuxing audio frag "+d.sn+" of ["+U.startSN+" ,"+U.endSN+"],track "+C);var Q=this.waitingData=this.waitingData||{frag:d,part:E,cache:new S.default,complete:!1},$=Q.cache;$.push(new Uint8Array(y)),this.waitingVideoCC=this.videoTrackCC,this.state=O.State.WAITING_INIT_PTS}},v._handleFragmentLoadComplete=function(a){if(this.waitingData){this.waitingData.complete=!0;return}o.prototype._handleFragmentLoadComplete.call(this,a)},v.onBufferReset=function(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1},v.onBufferCreated=function(a,l){var d=l.tracks.audio;d&&(this.mediaBuffer=d.buffer),l.tracks.video&&(this.videoBuffer=l.tracks.video.buffer)},v.onFragBuffered=function(a,l){var d=l.frag,E=l.part;if(d.type===L.PlaylistLevelType.AUDIO){if(this.fragContextChanged(d)){this.warn("Fragment "+d.sn+(E?" p: "+E.index:"")+" of level "+d.level+" finished buffering, but was aborted. state: "+this.state+", audioSwitch: "+this.audioSwitch);return}d.sn!=="initSegment"&&(this.fragPrevious=d,this.audioSwitch&&(this.audioSwitch=!1,this.hls.trigger(A.Events.AUDIO_TRACK_SWITCHED,{id:this.trackId}))),this.fragBufferedComplete(d,E)}},v.onError=function(a,l){switch(l.details){case i.ErrorDetails.FRAG_LOAD_ERROR:case i.ErrorDetails.FRAG_LOAD_TIMEOUT:case i.ErrorDetails.KEY_LOAD_ERROR:case i.ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(L.PlaylistLevelType.AUDIO,l);break;case i.ErrorDetails.AUDIO_TRACK_LOAD_ERROR:case i.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:this.state!==O.State.ERROR&&this.state!==O.State.STOPPED&&(this.state=l.fatal?O.State.ERROR:O.State.IDLE,this.warn(l.details+" while loading frag, switching to "+this.state+" state"));break;case i.ErrorDetails.BUFFER_FULL_ERROR:if(l.parent==="audio"&&(this.state===O.State.PARSING||this.state===O.State.PARSED)){var d=!0,E=this.getFwdBufferInfo(this.mediaBuffer,L.PlaylistLevelType.AUDIO);E&&E.len>.5&&(d=!this.reduceMaxBufferLength(E.len)),d&&(this.warn("Buffer full error also media.currentTime is not buffered, flush audio buffer"),this.fragCurrent=null,o.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio")),this.resetLoadingState()}break}},v.onBufferFlushed=function(a,l){var d=l.type;d===g.ElementaryStreamTypes.AUDIO&&(this.bufferFlushed=!0)},v._handleTransmuxComplete=function(a){var l,d="audio",E=this.hls,y=a.remuxResult,I=a.chunkMeta,C=this.getCurrentContext(I);if(!C){this.warn("The loading context changed while buffering fragment "+I.sn+" of level "+I.level+". This chunk will not be buffered."),this.resetLiveStartWhenNotLoaded(I.level);return}var _=C.frag,B=C.part,U=y.audio,N=y.text,k=y.id3,w=y.initSegment;if(!this.fragContextChanged(_)){if(this.state=O.State.PARSING,this.audioSwitch&&U&&this.completeAudioSwitch(),w!=null&&w.tracks&&(this._bufferInitSegment(w.tracks,_,I),E.trigger(A.Events.FRAG_PARSING_INIT_SEGMENT,{frag:_,id:d,tracks:w.tracks})),U){var G=U.startPTS,W=U.endPTS,Y=U.startDTS,H=U.endDTS;B&&(B.elementaryStreams[g.ElementaryStreamTypes.AUDIO]={startPTS:G,endPTS:W,startDTS:Y,endDTS:H}),_.setElementaryStreamInfo(g.ElementaryStreamTypes.AUDIO,G,W,Y,H),this.bufferFragmentData(U,_,B,I)}if(k!=null&&(l=k.samples)!==null&&l!==void 0&&l.length){var z=r({frag:_,id:d},k);E.trigger(A.Events.FRAG_PARSING_METADATA,z)}if(N){var Q=r({frag:_,id:d},N);E.trigger(A.Events.FRAG_PARSING_USERDATA,Q)}}},v._bufferInitSegment=function(a,l,d){if(this.state===O.State.PARSING){a.video&&delete a.video;var E=a.audio;if(!!E){E.levelCodec=E.codec,E.id="audio",this.log("Init audio buffer, container:"+E.container+", codecs[parsed]=["+E.codec+"]"),this.hls.trigger(A.Events.BUFFER_CODECS,a);var y=E.initSegment;if(y!=null&&y.byteLength){var I={type:"audio",frag:l,part:null,chunkMeta:d,parent:l.type,data:y};this.hls.trigger(A.Events.BUFFER_APPENDING,I)}this.tick()}}},v.loadFragment=function(a,l,d){var E=this.fragmentTracker.getState(a);this.fragCurrent=a,(this.audioSwitch||E===D.FragmentState.NOT_LOADED||E===D.FragmentState.PARTIAL)&&(a.sn==="initSegment"?this._loadInitSegment(a):l.live&&!Object(M.isFiniteNumber)(this.initPTS[a.cc])?(this.log("Waiting for video PTS in continuity counter "+a.cc+" of live stream before loading audio fragment "+a.sn+" of level "+this.trackId),this.state=O.State.WAITING_INIT_PTS):(this.startFragRequested=!0,o.prototype.loadFragment.call(this,a,l,d)))},v.completeAudioSwitch=function(){var a=this.hls,l=this.media,d=this.trackId;l&&(this.log("Switching audio track : flushing all audio"),o.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio")),this.audioSwitch=!1,a.trigger(A.Events.AUDIO_TRACK_SWITCHED,{id:d})},c}(O.default);P.default=n},"./src/controller/audio-track-controller.ts":function(K,P,p){p.r(P);var M=p("./src/events.ts"),O=p("./src/errors.ts"),A=p("./src/controller/base-playlist-controller.ts"),F=p("./src/types/loader.ts");function D(T,x){for(var m=0;m<x.length;m++){var h=x[m];h.enumerable=h.enumerable||!1,h.configurable=!0,"value"in h&&(h.writable=!0),Object.defineProperty(T,h.key,h)}}function R(T,x,m){return x&&D(T.prototype,x),m&&D(T,m),T}function L(T,x){T.prototype=Object.create(x.prototype),T.prototype.constructor=T,g(T,x)}function g(T,x){return g=Object.setPrototypeOf||function(h,i){return h.__proto__=i,h},g(T,x)}var S=function(T){L(x,T);function x(h){var i;return i=T.call(this,h,"[audio-track-controller]")||this,i.tracks=[],i.groupId=null,i.tracksInGroup=[],i.trackId=-1,i.trackName="",i.selectDefaultTrack=!0,i.registerListeners(),i}var m=x.prototype;return m.registerListeners=function(){var i=this.hls;i.on(M.Events.MANIFEST_LOADING,this.onManifestLoading,this),i.on(M.Events.MANIFEST_PARSED,this.onManifestParsed,this),i.on(M.Events.LEVEL_LOADING,this.onLevelLoading,this),i.on(M.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),i.on(M.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),i.on(M.Events.ERROR,this.onError,this)},m.unregisterListeners=function(){var i=this.hls;i.off(M.Events.MANIFEST_LOADING,this.onManifestLoading,this),i.off(M.Events.MANIFEST_PARSED,this.onManifestParsed,this),i.off(M.Events.LEVEL_LOADING,this.onLevelLoading,this),i.off(M.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),i.off(M.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),i.off(M.Events.ERROR,this.onError,this)},m.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,T.prototype.destroy.call(this)},m.onManifestLoading=function(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.trackName="",this.selectDefaultTrack=!0},m.onManifestParsed=function(i,e){this.tracks=e.audioTracks||[]},m.onAudioTrackLoaded=function(i,e){var r=e.id,t=e.details,f=this.tracksInGroup[r];if(!f){this.warn("Invalid audio track id "+r);return}var s=f.details;f.details=e.details,this.log("audioTrack "+r+" loaded ["+t.startSN+"-"+t.endSN+"]"),r===this.trackId&&(this.retryCount=0,this.playlistLoaded(r,e,s))},m.onLevelLoading=function(i,e){this.switchLevel(e.level)},m.onLevelSwitching=function(i,e){this.switchLevel(e.level)},m.switchLevel=function(i){var e=this.hls.levels[i];if(!!(e!=null&&e.audioGroupIds)){var r=e.audioGroupIds[e.urlId];if(this.groupId!==r){this.groupId=r;var t=this.tracks.filter(function(s){return!r||s.groupId===r});this.selectDefaultTrack&&!t.some(function(s){return s.default})&&(this.selectDefaultTrack=!1),this.tracksInGroup=t;var f={audioTracks:t};this.log("Updating audio tracks, "+t.length+' track(s) found in "'+r+'" group-id'),this.hls.trigger(M.Events.AUDIO_TRACKS_UPDATED,f),this.selectInitialTrack()}}},m.onError=function(i,e){T.prototype.onError.call(this,i,e),!(e.fatal||!e.context)&&e.context.type===F.PlaylistContextType.AUDIO_TRACK&&e.context.id===this.trackId&&e.context.groupId===this.groupId&&this.retryLoadingOrFail(e)},m.setAudioTrack=function(i){var e=this.tracksInGroup;if(i<0||i>=e.length){this.warn("Invalid id passed to audio-track controller");return}this.clearTimer();var r=e[this.trackId];this.log("Now switching to audio-track index "+i);var t=e[i],f=t.id,s=t.groupId,n=s===void 0?"":s,o=t.name,c=t.type,v=t.url;if(this.trackId=i,this.trackName=o,this.selectDefaultTrack=!1,this.hls.trigger(M.Events.AUDIO_TRACK_SWITCHING,{id:f,groupId:n,name:o,type:c,url:v}),!(t.details&&!t.details.live)){var u=this.switchParams(t.url,r==null?void 0:r.details);this.loadPlaylist(u)}},m.selectInitialTrack=function(){var i=this.tracksInGroup;console.assert(i.length,"Initial audio track should be selected when tracks are known");var e=this.trackName,r=this.findTrackId(e)||this.findTrackId();r!==-1?this.setAudioTrack(r):(this.warn("No track found for running audio group-ID: "+this.groupId),this.hls.trigger(M.Events.ERROR,{type:O.ErrorTypes.MEDIA_ERROR,details:O.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,fatal:!0}))},m.findTrackId=function(i){for(var e=this.tracksInGroup,r=0;r<e.length;r++){var t=e[r];if((!this.selectDefaultTrack||t.default)&&(!i||i===t.name))return t.id}return-1},m.loadPlaylist=function(i){var e=this.tracksInGroup[this.trackId];if(this.shouldLoadTrack(e)){var r=e.id,t=e.groupId,f=e.url;if(i)try{f=i.addDirectives(f)}catch(s){this.warn("Could not construct new URL with HLS Delivery Directives: "+s)}this.log("loading audio-track playlist for id: "+r),this.clearTimer(),this.hls.trigger(M.Events.AUDIO_TRACK_LOADING,{url:f,id:r,groupId:t,deliveryDirectives:i||null})}},R(x,[{key:"audioTracks",get:function(){return this.tracksInGroup}},{key:"audioTrack",get:function(){return this.trackId},set:function(i){this.selectDefaultTrack=!1,this.setAudioTrack(i)}}]),x}(A.default);P.default=S},"./src/controller/base-playlist-controller.ts":function(K,P,p){p.r(P),p.d(P,"default",function(){return R});var M=p("./src/polyfills/number.ts"),O=p("./src/types/level.ts"),A=p("./src/controller/level-helper.ts"),F=p("./src/utils/logger.ts"),D=p("./src/errors.ts"),R=function(){function L(S,T){this.hls=void 0,this.timer=-1,this.canLoad=!1,this.retryCount=0,this.log=void 0,this.warn=void 0,this.log=F.logger.log.bind(F.logger,T+":"),this.warn=F.logger.warn.bind(F.logger,T+":"),this.hls=S}var g=L.prototype;return g.destroy=function(){this.clearTimer(),this.hls=this.log=this.warn=null},g.onError=function(T,x){x.fatal&&x.type===D.ErrorTypes.NETWORK_ERROR&&this.clearTimer()},g.clearTimer=function(){clearTimeout(this.timer),this.timer=-1},g.startLoad=function(){this.canLoad=!0,this.retryCount=0,this.loadPlaylist()},g.stopLoad=function(){this.canLoad=!1,this.clearTimer()},g.switchParams=function(T,x){var m=x==null?void 0:x.renditionReports;if(m)for(var h=0;h<m.length;h++){var i=m[h],e=""+i.URI;if(e===T.substr(-e.length)){var r=parseInt(i["LAST-MSN"]),t=parseInt(i["LAST-PART"]);if(x&&this.hls.config.lowLatencyMode){var f=Math.min(x.age-x.partTarget,x.targetduration);t!==void 0&&f>x.partTarget&&(t+=1)}if(Object(M.isFiniteNumber)(r))return new O.HlsUrlParameters(r,Object(M.isFiniteNumber)(t)?t:void 0,O.HlsSkip.No)}}},g.loadPlaylist=function(T){},g.shouldLoadTrack=function(T){return this.canLoad&&T&&!!T.url&&(!T.details||T.details.live)},g.playlistLoaded=function(T,x,m){var h=this,i=x.details,e=x.stats,r=e.loading.end?Math.max(0,self.performance.now()-e.loading.end):0;if(i.advancedDateTime=Date.now()-r,i.live||m!=null&&m.live){if(i.reloaded(m),m&&this.log("live playlist "+T+" "+(i.advanced?"REFRESHED "+i.lastPartSn+"-"+i.lastPartIndex:"MISSED")),m&&i.fragments.length>0&&Object(A.mergeDetails)(m,i),!this.canLoad||!i.live)return;var t,f=void 0,s=void 0;if(i.canBlockReload&&i.endSN&&i.advanced){var n=this.hls.config.lowLatencyMode,o=i.lastPartSn,c=i.endSN,v=i.lastPartIndex,u=v!==-1,a=o===c,l=n?0:v;u?(f=a?c+1:o,s=a?l:v+1):f=c+1;var d=i.age,E=d+i.ageHeader,y=Math.min(E-i.partTarget,i.targetduration*1.5);if(y>0){if(m&&y>m.tuneInGoal)this.warn("CDN Tune-in goal increased from: "+m.tuneInGoal+" to: "+y+" with playlist age: "+i.age),y=0;else{var I=Math.floor(y/i.targetduration);if(f+=I,s!==void 0){var C=Math.round(y%i.targetduration/i.partTarget);s+=C}this.log("CDN Tune-in age: "+i.ageHeader+"s last advanced "+d.toFixed(2)+"s goal: "+y+" skip sn "+I+" to part "+s)}i.tuneInGoal=y}if(t=this.getDeliveryDirectives(i,x.deliveryDirectives,f,s),n||!a){this.loadPlaylist(t);return}}else t=this.getDeliveryDirectives(i,x.deliveryDirectives,f,s);var _=Object(A.computeReloadInterval)(i,e);f!==void 0&&i.canBlockReload&&(_-=i.partTarget||1),this.log("reload live playlist "+T+" in "+Math.round(_)+" ms"),this.timer=self.setTimeout(function(){return h.loadPlaylist(t)},_)}else this.clearTimer()},g.getDeliveryDirectives=function(T,x,m,h){var i=Object(O.getSkipValue)(T,m);return x!=null&&x.skip&&T.deltaUpdateFailed&&(m=x.msn,h=x.part,i=O.HlsSkip.No),new O.HlsUrlParameters(m,h,i)},g.retryLoadingOrFail=function(T){var x=this,m=this.hls.config,h=this.retryCount<m.levelLoadingMaxRetry;if(h){var i;if(this.retryCount++,T.details.indexOf("LoadTimeOut")>-1&&(i=T.context)!==null&&i!==void 0&&i.deliveryDirectives)this.warn("retry playlist loading #"+this.retryCount+' after "'+T.details+'"'),this.loadPlaylist();else{var e=Math.min(Math.pow(2,this.retryCount)*m.levelLoadingRetryDelay,m.levelLoadingMaxRetryTimeout);this.timer=self.setTimeout(function(){return x.loadPlaylist()},e),this.warn("retry playlist loading #"+this.retryCount+" in "+e+' ms after "'+T.details+'"')}}else this.warn('cannot recover from error "'+T.details+'"'),this.clearTimer(),T.fatal=!0;return h},L}()},"./src/controller/base-stream-controller.ts":function(K,P,p){p.r(P),p.d(P,"State",function(){return c}),p.d(P,"default",function(){return v});var M=p("./src/polyfills/number.ts"),O=p("./src/task-loop.ts"),A=p("./src/controller/fragment-tracker.ts"),F=p("./src/utils/buffer-helper.ts"),D=p("./src/utils/logger.ts"),R=p("./src/events.ts"),L=p("./src/errors.ts"),g=p("./src/types/transmuxer.ts"),S=p("./src/utils/mp4-tools.ts"),T=p("./src/utils/discontinuities.ts"),x=p("./src/controller/fragment-finders.ts"),m=p("./src/controller/level-helper.ts"),h=p("./src/loader/fragment-loader.ts"),i=p("./src/crypt/decrypter.ts"),e=p("./src/utils/time-ranges.ts"),r=p("./src/types/loader.ts");function t(u,a){for(var l=0;l<a.length;l++){var d=a[l];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(u,d.key,d)}}function f(u,a,l){return a&&t(u.prototype,a),l&&t(u,l),u}function s(u){if(u===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return u}function n(u,a){u.prototype=Object.create(a.prototype),u.prototype.constructor=u,o(u,a)}function o(u,a){return o=Object.setPrototypeOf||function(d,E){return d.__proto__=E,d},o(u,a)}var c={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",BACKTRACKING:"BACKTRACKING",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"},v=function(u){n(a,u);function a(d,E,y){var I;return I=u.call(this)||this,I.hls=void 0,I.fragPrevious=null,I.fragCurrent=null,I.fragmentTracker=void 0,I.transmuxer=null,I._state=c.STOPPED,I.media=void 0,I.mediaBuffer=void 0,I.config=void 0,I.bitrateTest=!1,I.lastCurrentTime=0,I.nextLoadPosition=0,I.startPosition=0,I.loadedmetadata=!1,I.fragLoadError=0,I.retryDate=0,I.levels=null,I.fragmentLoader=void 0,I.levelLastLoaded=null,I.startFragRequested=!1,I.decrypter=void 0,I.initPTS=[],I.onvseeking=null,I.onvended=null,I.logPrefix="",I.log=void 0,I.warn=void 0,I.logPrefix=y,I.log=D.logger.log.bind(D.logger,y+":"),I.warn=D.logger.warn.bind(D.logger,y+":"),I.hls=d,I.fragmentLoader=new h.default(d.config),I.fragmentTracker=E,I.config=d.config,I.decrypter=new i.default(d,d.config),d.on(R.Events.KEY_LOADED,I.onKeyLoaded,s(I)),I}var l=a.prototype;return l.doTick=function(){this.onTickEnd()},l.onTickEnd=function(){},l.startLoad=function(E){},l.stopLoad=function(){this.fragmentLoader.abort();var E=this.fragCurrent;E&&this.fragmentTracker.removeFragment(E),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=c.STOPPED},l._streamEnded=function(E,y){var I=this.fragCurrent,C=this.fragmentTracker;if(!y.live&&I&&I.sn===y.endSN&&!E.nextStart){var _=C.getState(I);return _===A.FragmentState.PARTIAL||_===A.FragmentState.OK}return!1},l.onMediaAttached=function(E,y){var I=this.media=this.mediaBuffer=y.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),I.addEventListener("seeking",this.onvseeking),I.addEventListener("ended",this.onvended);var C=this.config;this.levels&&C.autoStartLoad&&this.state===c.STOPPED&&this.startLoad(C.startPosition)},l.onMediaDetaching=function(){var E=this.media;E!=null&&E.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),E&&(E.removeEventListener("seeking",this.onvseeking),E.removeEventListener("ended",this.onvended),this.onvseeking=this.onvended=null),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()},l.onMediaSeeking=function(){var E=this.config,y=this.fragCurrent,I=this.media,C=this.mediaBuffer,_=this.state,B=I?I.currentTime:0,U=F.BufferHelper.bufferInfo(C||I,B,E.maxBufferHole);if(this.log("media seeking to "+(Object(M.isFiniteNumber)(B)?B.toFixed(3):B)+", state: "+_),_===c.ENDED)this.resetLoadingState();else if(y&&!U.len){var N=E.maxFragLookUpTolerance,k=y.start-N,w=y.start+y.duration+N,G=B>w;(B<k||G)&&(G&&y.loader&&(this.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),y.loader.abort()),this.resetLoadingState())}I&&(this.lastCurrentTime=B),!this.loadedmetadata&&!U.len&&(this.nextLoadPosition=this.startPosition=B),this.tickImmediate()},l.onMediaEnded=function(){this.startPosition=this.lastCurrentTime=0},l.onKeyLoaded=function(E,y){if(!(this.state!==c.KEY_LOADING||y.frag!==this.fragCurrent||!this.levels)){this.state=c.IDLE;var I=this.levels[y.frag.level].details;I&&this.loadFragment(y.frag,I,y.frag.start)}},l.onHandlerDestroying=function(){this.stopLoad(),u.prototype.onHandlerDestroying.call(this)},l.onHandlerDestroyed=function(){this.state=c.STOPPED,this.hls.off(R.Events.KEY_LOADED,this.onKeyLoaded,this),this.fragmentLoader&&this.fragmentLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.fragmentLoader=this.fragmentTracker=null,u.prototype.onHandlerDestroyed.call(this)},l.loadKey=function(E,y){this.log("Loading key for "+E.sn+" of ["+y.startSN+"-"+y.endSN+"], "+(this.logPrefix==="[stream-controller]"?"level":"track")+" "+E.level),this.state=c.KEY_LOADING,this.fragCurrent=E,this.hls.trigger(R.Events.KEY_LOADING,{frag:E})},l.loadFragment=function(E,y,I){this._loadFragForPlayback(E,y,I)},l._loadFragForPlayback=function(E,y,I){var C=this,_=function(U){if(C.fragContextChanged(E)){C.warn("Fragment "+E.sn+(U.part?" p: "+U.part.index:"")+" of level "+E.level+" was dropped during download."),C.fragmentTracker.removeFragment(E);return}E.stats.chunkCount++,C._handleFragmentLoadProgress(U)};this._doFragLoad(E,y,I,_).then(function(B){if(!!B){C.fragLoadError=0;var U=C.state;if(C.fragContextChanged(E)){(U===c.FRAG_LOADING||U===c.BACKTRACKING||!C.fragCurrent&&U===c.PARSING)&&(C.fragmentTracker.removeFragment(E),C.state=c.IDLE);return}if("payload"in B&&(C.log("Loaded fragment "+E.sn+" of level "+E.level),C.hls.trigger(R.Events.FRAG_LOADED,B),C.state===c.BACKTRACKING)){C.fragmentTracker.backtrack(E,B),C.resetFragmentLoading(E);return}C._handleFragmentLoadComplete(B)}}).catch(function(B){C.warn(B),C.resetFragmentLoading(E)})},l.flushMainBuffer=function(E,y,I){if(I===void 0&&(I=null),!!(E-y)){var C={startOffset:E,endOffset:y,type:I};this.fragLoadError=0,this.hls.trigger(R.Events.BUFFER_FLUSHING,C)}},l._loadInitSegment=function(E){var y=this;this._doFragLoad(E).then(function(I){if(!I||y.fragContextChanged(E)||!y.levels)throw new Error("init load aborted");return I}).then(function(I){var C=y.hls,_=I.payload,B=E.decryptdata;if(_&&_.byteLength>0&&B&&B.key&&B.iv&&B.method==="AES-128"){var U=self.performance.now();return y.decrypter.webCryptoDecrypt(new Uint8Array(_),B.key.buffer,B.iv.buffer).then(function(N){var k=self.performance.now();return C.trigger(R.Events.FRAG_DECRYPTED,{frag:E,payload:N,stats:{tstart:U,tdecrypt:k}}),I.payload=N,I})}return I}).then(function(I){var C=y.fragCurrent,_=y.hls,B=y.levels;if(!B)throw new Error("init load aborted, missing levels");var U=B[E.level].details;console.assert(U,"Level details are defined when init segment is loaded");var N=E.stats;y.state=c.IDLE,y.fragLoadError=0,E.data=new Uint8Array(I.payload),N.parsing.start=N.buffering.start=self.performance.now(),N.parsing.end=N.buffering.end=self.performance.now(),I.frag===C&&_.trigger(R.Events.FRAG_BUFFERED,{stats:N,frag:C,part:null,id:E.type}),y.tick()}).catch(function(I){y.warn(I),y.resetFragmentLoading(E)})},l.fragContextChanged=function(E){var y=this.fragCurrent;return!E||!y||E.level!==y.level||E.sn!==y.sn||E.urlId!==y.urlId},l.fragBufferedComplete=function(E,y){var I=this.mediaBuffer?this.mediaBuffer:this.media;this.log("Buffered "+E.type+" sn: "+E.sn+(y?" part: "+y.index:"")+" of "+(this.logPrefix==="[stream-controller]"?"level":"track")+" "+E.level+" "+e.default.toString(F.BufferHelper.getBuffered(I))),this.state=c.IDLE,this.tick()},l._handleFragmentLoadComplete=function(E){var y=this.transmuxer;if(!!y){var I=E.frag,C=E.part,_=E.partsLoaded,B=!_||_.length===0||_.some(function(N){return!N}),U=new g.ChunkMetadata(I.level,I.sn,I.stats.chunkCount+1,0,C?C.index:-1,!B);y.flush(U)}},l._handleFragmentLoadProgress=function(E){},l._doFragLoad=function(E,y,I,C){var _=this;if(I===void 0&&(I=null),!this.levels)throw new Error("frag load aborted, missing levels");if(I=Math.max(E.start,I||0),this.config.lowLatencyMode&&y){var B=y.partList;if(B&&C){I>E.end&&y.fragmentHint&&(E=y.fragmentHint);var U=this.getNextPart(B,E,I);if(U>-1){var N=B[U];return this.log("Loading part sn: "+E.sn+" p: "+N.index+" cc: "+E.cc+" of playlist ["+y.startSN+"-"+y.endSN+"] parts [0-"+U+"-"+(B.length-1)+"] "+(this.logPrefix==="[stream-controller]"?"level":"track")+": "+E.level+", target: "+parseFloat(I.toFixed(3))),this.nextLoadPosition=N.start+N.duration,this.state=c.FRAG_LOADING,this.hls.trigger(R.Events.FRAG_LOADING,{frag:E,part:B[U],targetBufferTime:I}),this.doFragPartsLoad(E,B,U,C).catch(function(k){return _.handleFragLoadError(k)})}else if(!E.url||this.loadedEndOfParts(B,I))return Promise.resolve(null)}}return this.log("Loading fragment "+E.sn+" cc: "+E.cc+" "+(y?"of ["+y.startSN+"-"+y.endSN+"] ":"")+(this.logPrefix==="[stream-controller]"?"level":"track")+": "+E.level+", target: "+parseFloat(I.toFixed(3))),Object(M.isFiniteNumber)(E.sn)&&!this.bitrateTest&&(this.nextLoadPosition=E.start+E.duration),this.state=c.FRAG_LOADING,this.hls.trigger(R.Events.FRAG_LOADING,{frag:E,targetBufferTime:I}),this.fragmentLoader.load(E,C).catch(function(k){return _.handleFragLoadError(k)})},l.doFragPartsLoad=function(E,y,I,C){var _=this;return new Promise(function(B,U){var N=[],k=function w(G){var W=y[G];_.fragmentLoader.loadPart(E,W,C).then(function(Y){N[W.index]=Y;var H=Y.part;_.hls.trigger(R.Events.FRAG_LOADED,Y);var z=y[G+1];if(z&&z.fragment===E)w(G+1);else return B({frag:E,part:H,partsLoaded:N})}).catch(U)};k(I)})},l.handleFragLoadError=function(E){var y=E.data;return y&&y.details===L.ErrorDetails.INTERNAL_ABORTED?this.handleFragLoadAborted(y.frag,y.part):this.hls.trigger(R.Events.ERROR,y),null},l._handleTransmuxerFlush=function(E){var y=this.getCurrentContext(E);if(!y||this.state!==c.PARSING){this.fragCurrent||(this.state=c.IDLE);return}var I=y.frag,C=y.part,_=y.level,B=self.performance.now();I.stats.parsing.end=B,C&&(C.stats.parsing.end=B),this.updateLevelTiming(I,C,_,E.partial)},l.getCurrentContext=function(E){var y=this.levels,I=E.level,C=E.sn,_=E.part;if(!y||!y[I])return this.warn("Levels object was unset while buffering fragment "+C+" of level "+I+". The current chunk will not be buffered."),null;var B=y[I],U=_>-1?Object(m.getPartWith)(B,C,_):null,N=U?U.fragment:Object(m.getFragmentWithSN)(B,C,this.fragCurrent);return N?{frag:N,part:U,level:B}:null},l.bufferFragmentData=function(E,y,I,C){if(!(!E||this.state!==c.PARSING)){var _=E.data1,B=E.data2,U=_;if(_&&B&&(U=Object(S.appendUint8Array)(_,B)),!(!U||!U.length)){var N={type:E.type,frag:y,part:I,chunkMeta:C,parent:y.type,data:U};this.hls.trigger(R.Events.BUFFER_APPENDING,N),E.dropped&&E.independent&&!I&&this.flushBufferGap(y)}}},l.flushBufferGap=function(E){var y=this.media;if(!!y){if(!F.BufferHelper.isBuffered(y,y.currentTime)){this.flushMainBuffer(0,E.start);return}var I=y.currentTime,C=F.BufferHelper.bufferInfo(y,I,0),_=E.duration,B=Math.min(this.config.maxFragLookUpTolerance*2,_*.25),U=Math.max(Math.min(E.start-B,C.end-B),I+B);E.start-U>B&&this.flushMainBuffer(U,E.start)}},l.getFwdBufferInfo=function(E,y){var I=this.config,C=this.getLoadPosition();if(!Object(M.isFiniteNumber)(C))return null;var _=F.BufferHelper.bufferInfo(E,C,I.maxBufferHole);if(_.len===0&&_.nextStart!==void 0){var B=this.fragmentTracker.getBufferedFrag(C,y);if(B&&_.nextStart<B.end)return F.BufferHelper.bufferInfo(E,C,Math.max(_.nextStart,I.maxBufferHole))}return _},l.getMaxBufferLength=function(E){var y=this.config,I;return E?I=Math.max(8*y.maxBufferSize/E,y.maxBufferLength):I=y.maxBufferLength,Math.min(I,y.maxMaxBufferLength)},l.reduceMaxBufferLength=function(E){var y=this.config,I=E||y.maxBufferLength;return y.maxMaxBufferLength>=I?(y.maxMaxBufferLength/=2,this.warn("Reduce max buffer length to "+y.maxMaxBufferLength+"s"),!0):!1},l.getNextFragment=function(E,y){var I,C,_=y.fragments,B=_.length;if(!B)return null;var U=this.config,N=_[0].start,k;if(y.live){var w=U.initialLiveManifestSize;if(B<w)return this.warn("Not enough fragments to start playback (have: "+B+", need: "+w+")"),null;!y.PTSKnown&&!this.startFragRequested&&this.startPosition===-1&&(k=this.getInitialLiveFragment(y,_),this.startPosition=k?this.hls.liveSyncPosition||k.start:E)}else E<=N&&(k=_[0]);if(!k){var G=U.lowLatencyMode?y.partEnd:y.fragmentEnd;k=this.getFragmentAtPosition(E,G,y)}return(I=k)!==null&&I!==void 0&&I.initSegment&&!((C=k)!==null&&C!==void 0&&C.initSegment.data)&&!this.bitrateTest&&(k=k.initSegment),k},l.getNextPart=function(E,y,I){for(var C=-1,_=!1,B=!0,U=0,N=E.length;U<N;U++){var k=E[U];if(B=B&&!k.independent,C>-1&&I<k.start)break;var w=k.loaded;!w&&(_||k.independent||B)&&k.fragment===y&&(C=U),_=w}return C},l.loadedEndOfParts=function(E,y){var I=E[E.length-1];return I&&y>I.start&&I.loaded},l.getInitialLiveFragment=function(E,y){var I=this.fragPrevious,C=null;if(I){if(E.hasProgramDateTime&&(this.log("Live playlist, switching playlist, load frag with same PDT: "+I.programDateTime),C=Object(x.findFragmentByPDT)(y,I.endProgramDateTime,this.config.maxFragLookUpTolerance)),!C){var _=I.sn+1;if(_>=E.startSN&&_<=E.endSN){var B=y[_-E.startSN];I.cc===B.cc&&(C=B,this.log("Live playlist, switching playlist, load frag with next SN: "+C.sn))}C||(C=Object(x.findFragWithCC)(y,I.cc),C&&this.log("Live playlist, switching playlist, load frag with same CC: "+C.sn))}}else{var U=this.hls.liveSyncPosition;U!==null&&(C=this.getFragmentAtPosition(U,this.bitrateTest?E.fragmentEnd:E.edge,E))}return C},l.getFragmentAtPosition=function(E,y,I){var C=this.config,_=this.fragPrevious,B=I.fragments,U=I.endSN,N=I.fragmentHint,k=C.maxFragLookUpTolerance,w=!!(C.lowLatencyMode&&I.partList&&N);w&&N&&!this.bitrateTest&&(B=B.concat(N),U=N.sn);var G;if(E<y){var W=E>y-k?0:k;G=Object(x.findFragmentByPTS)(_,B,E,W)}else G=B[B.length-1];if(G){var Y=G.sn-I.startSN,H=_&&G.level===_.level,z=B[Y+1],Q=this.fragmentTracker.getState(G);if(Q===A.FragmentState.BACKTRACKED){G=null;for(var $=Y;B[$]&&this.fragmentTracker.getState(B[$])===A.FragmentState.BACKTRACKED;)_?G=B[$--]:G=B[--$];G||(G=z)}else _&&G.sn===_.sn&&!w&&H&&(G.sn<U&&this.fragmentTracker.getState(z)!==A.FragmentState.OK?(this.log("SN "+G.sn+" just loaded, load next one: "+z.sn),G=z):G=null)}return G},l.synchronizeToLiveEdge=function(E){var y=this.config,I=this.media;if(!!I){var C=this.hls.liveSyncPosition,_=I.currentTime,B=E.fragments[0].start,U=E.edge,N=_>=B-y.maxFragLookUpTolerance&&_<=U;if(C!==null&&I.duration>C&&(_<C||!N)){var k=y.liveMaxLatencyDuration!==void 0?y.liveMaxLatencyDuration:y.liveMaxLatencyDurationCount*E.targetduration;(!N&&I.readyState<4||_<U-k)&&(this.loadedmetadata||(this.nextLoadPosition=C),I.readyState&&(this.warn("Playback: "+_.toFixed(3)+" is located too far from the end of live sliding playlist: "+U+", reset currentTime to : "+C.toFixed(3)),I.currentTime=C))}}},l.alignPlaylists=function(E,y){var I=this.levels,C=this.levelLastLoaded,_=this.fragPrevious,B=C!==null?I[C]:null,U=E.fragments.length;if(!U)return this.warn("No fragments in live playlist"),0;var N=E.fragments[0].start,k=!y,w=E.alignedSliding&&Object(M.isFiniteNumber)(N);if(k||!w&&!N){Object(T.alignStream)(_,B,E);var G=E.fragments[0].start;return this.log("Live playlist sliding: "+G.toFixed(2)+" start-sn: "+(y?y.startSN:"na")+"->"+E.startSN+" prev-sn: "+(_?_.sn:"na")+" fragments: "+U),G}return N},l.waitForCdnTuneIn=function(E){var y=3;return E.live&&E.canBlockReload&&E.tuneInGoal>Math.max(E.partHoldBack,E.partTarget*y)},l.setStartPosition=function(E,y){var I=this.startPosition;if(I<y&&(I=-1),I===-1||this.lastCurrentTime===-1){var C=E.startTimeOffset;Object(M.isFiniteNumber)(C)?(I=y+C,C<0&&(I+=E.totalduration),I=Math.min(Math.max(y,I),y+E.totalduration),this.log("Start time offset "+C+" found in playlist, adjust startPosition to "+I),this.startPosition=I):E.live?I=this.hls.liveSyncPosition||y:this.startPosition=I=0,this.lastCurrentTime=I}this.nextLoadPosition=I},l.getLoadPosition=function(){var E=this.media,y=0;return this.loadedmetadata&&E?y=E.currentTime:this.nextLoadPosition&&(y=this.nextLoadPosition),y},l.handleFragLoadAborted=function(E,y){this.transmuxer&&E.sn!=="initSegment"&&E.stats.aborted&&(this.warn("Fragment "+E.sn+(y?" part"+y.index:"")+" of level "+E.level+" was aborted"),this.resetFragmentLoading(E))},l.resetFragmentLoading=function(E){(!this.fragCurrent||!this.fragContextChanged(E))&&(this.state=c.IDLE)},l.onFragmentOrKeyLoadError=function(E,y){if(!y.fatal){var I=y.frag;if(!(!I||I.type!==E)){var C=this.fragCurrent;console.assert(C&&I.sn===C.sn&&I.level===C.level&&I.urlId===C.urlId,"Frag load error must match current frag to retry");var _=this.config;if(this.fragLoadError+1<=_.fragLoadingMaxRetry){if(this.resetLiveStartWhenNotLoaded(I.level))return;var B=Math.min(Math.pow(2,this.fragLoadError)*_.fragLoadingRetryDelay,_.fragLoadingMaxRetryTimeout);this.warn("Fragment "+I.sn+" of "+E+" "+I.level+" failed to load, retrying in "+B+"ms"),this.retryDate=self.performance.now()+B,this.fragLoadError++,this.state=c.FRAG_LOADING_WAITING_RETRY}else y.levelRetry?(E===r.PlaylistLevelType.AUDIO&&(this.fragCurrent=null),this.fragLoadError=0,this.state=c.IDLE):(D.logger.error(y.details+" reaches max retry, redispatch as fatal ..."),y.fatal=!0,this.hls.stopLoad(),this.state=c.ERROR)}}},l.afterBufferFlushed=function(E,y,I){if(!!E){var C=F.BufferHelper.getBuffered(E);this.fragmentTracker.detectEvictedFragments(y,C,I),this.state===c.ENDED&&this.resetLoadingState()}},l.resetLoadingState=function(){this.fragCurrent=null,this.fragPrevious=null,this.state=c.IDLE},l.resetLiveStartWhenNotLoaded=function(E){if(!this.loadedmetadata){this.startFragRequested=!1;var y=this.levels?this.levels[E].details:null;if(y!=null&&y.live)return this.startPosition=-1,this.setStartPosition(y,0),this.resetLoadingState(),!0;this.nextLoadPosition=this.startPosition}return!1},l.updateLevelTiming=function(E,y,I,C){var _=this,B=I.details;console.assert(!!B,"level.details must be defined");var U=Object.keys(E.elementaryStreams).reduce(function(N,k){var w=E.elementaryStreams[k];if(w){var G=w.endPTS-w.startPTS;if(G<=0)return _.warn("Could not parse fragment "+E.sn+" "+k+" duration reliably ("+G+") resetting transmuxer to fallback to playlist timing"),_.resetTransmuxer(),N||!1;var W=C?0:Object(m.updateFragPTSDTS)(B,E,w.startPTS,w.endPTS,w.startDTS,w.endDTS);return _.hls.trigger(R.Events.LEVEL_PTS_UPDATED,{details:B,level:I,drift:W,type:k,frag:E,start:w.startPTS,end:w.endPTS}),!0}return N},!1);U?(this.state=c.PARSED,this.hls.trigger(R.Events.FRAG_PARSED,{frag:E,part:y})):this.resetLoadingState()},l.resetTransmuxer=function(){this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null)},f(a,[{key:"state",get:function(){return this._state},set:function(E){var y=this._state;y!==E&&(this._state=E,this.log(y+"->"+E))}}]),a}(O.default)},"./src/controller/buffer-controller.ts":function(K,P,p){p.r(P),p.d(P,"default",function(){return x});var M=p("./src/polyfills/number.ts"),O=p("./src/events.ts"),A=p("./src/utils/logger.ts"),F=p("./src/errors.ts"),D=p("./src/utils/buffer-helper.ts"),R=p("./src/utils/mediasource-helper.ts"),L=p("./src/loader/fragment.ts"),g=p("./src/controller/buffer-operation-queue.ts"),S=Object(R.getMediaSource)(),T=/([ha]vc.)(?:\.[^.,]+)+/,x=function(){function m(i){var e=this;this.details=null,this._objectUrl=null,this.operationQueue=void 0,this.listeners=void 0,this.hls=void 0,this.bufferCodecEventsExpected=0,this._bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.appendError=0,this.tracks={},this.pendingTracks={},this.sourceBuffer=void 0,this._onMediaSourceOpen=function(){var r=e.hls,t=e.media,f=e.mediaSource;A.logger.log("[buffer-controller]: Media source opened"),t&&(e.updateMediaElementDuration(),r.trigger(O.Events.MEDIA_ATTACHED,{media:t})),f&&f.removeEventListener("sourceopen",e._onMediaSourceOpen),e.checkPendingTracks()},this._onMediaSourceClose=function(){A.logger.log("[buffer-controller]: Media source closed")},this._onMediaSourceEnded=function(){A.logger.log("[buffer-controller]: Media source ended")},this.hls=i,this._initSourceBuffer(),this.registerListeners()}var h=m.prototype;return h.hasSourceTypes=function(){return this.getSourceBufferTypes().length>0||Object.keys(this.pendingTracks).length>0},h.destroy=function(){this.unregisterListeners(),this.details=null},h.registerListeners=function(){var e=this.hls;e.on(O.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(O.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(O.Events.MANIFEST_PARSED,this.onManifestParsed,this),e.on(O.Events.BUFFER_RESET,this.onBufferReset,this),e.on(O.Events.BUFFER_APPENDING,this.onBufferAppending,this),e.on(O.Events.BUFFER_CODECS,this.onBufferCodecs,this),e.on(O.Events.BUFFER_EOS,this.onBufferEos,this),e.on(O.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(O.Events.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(O.Events.FRAG_PARSED,this.onFragParsed,this),e.on(O.Events.FRAG_CHANGED,this.onFragChanged,this)},h.unregisterListeners=function(){var e=this.hls;e.off(O.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(O.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(O.Events.MANIFEST_PARSED,this.onManifestParsed,this),e.off(O.Events.BUFFER_RESET,this.onBufferReset,this),e.off(O.Events.BUFFER_APPENDING,this.onBufferAppending,this),e.off(O.Events.BUFFER_CODECS,this.onBufferCodecs,this),e.off(O.Events.BUFFER_EOS,this.onBufferEos,this),e.off(O.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(O.Events.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(O.Events.FRAG_PARSED,this.onFragParsed,this),e.off(O.Events.FRAG_CHANGED,this.onFragChanged,this)},h._initSourceBuffer=function(){this.sourceBuffer={},this.operationQueue=new g.default(this.sourceBuffer),this.listeners={audio:[],video:[],audiovideo:[]}},h.onManifestParsed=function(e,r){var t=2;(r.audio&&!r.video||!r.altAudio)&&(t=1),this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=t,this.details=null,A.logger.log(this.bufferCodecEventsExpected+" bufferCodec event(s) expected")},h.onMediaAttaching=function(e,r){var t=this.media=r.media;if(t&&S){var f=this.mediaSource=new S;f.addEventListener("sourceopen",this._onMediaSourceOpen),f.addEventListener("sourceended",this._onMediaSourceEnded),f.addEventListener("sourceclose",this._onMediaSourceClose),t.src=self.URL.createObjectURL(f),this._objectUrl=t.src}},h.onMediaDetaching=function(){var e=this.media,r=this.mediaSource,t=this._objectUrl;if(r){if(A.logger.log("[buffer-controller]: media source detaching"),r.readyState==="open")try{r.endOfStream()}catch(f){A.logger.warn("[buffer-controller]: onMediaDetaching: "+f.message+" while calling endOfStream")}this.onBufferReset(),r.removeEventListener("sourceopen",this._onMediaSourceOpen),r.removeEventListener("sourceended",this._onMediaSourceEnded),r.removeEventListener("sourceclose",this._onMediaSourceClose),e&&(t&&self.URL.revokeObjectURL(t),e.src===t?(e.removeAttribute("src"),e.load()):A.logger.warn("[buffer-controller]: media.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.bufferCodecEventsExpected=this._bufferCodecEventsTotal,this.pendingTracks={},this.tracks={}}this.hls.trigger(O.Events.MEDIA_DETACHED,void 0)},h.onBufferReset=function(){var e=this;this.getSourceBufferTypes().forEach(function(r){var t=e.sourceBuffer[r];try{t&&(e.removeBufferListeners(r),e.mediaSource&&e.mediaSource.removeSourceBuffer(t),e.sourceBuffer[r]=void 0)}catch(f){A.logger.warn("[buffer-controller]: Failed to reset the "+r+" buffer",f)}}),this._initSourceBuffer()},h.onBufferCodecs=function(e,r){var t=this,f=this.getSourceBufferTypes().length;Object.keys(r).forEach(function(s){if(f){var n=t.tracks[s];if(n&&typeof n.buffer.changeType=="function"){var o=r[s],c=o.codec,v=o.levelCodec,u=o.container,a=(n.levelCodec||n.codec).replace(T,"$1"),l=(v||c).replace(T,"$1");if(a!==l){var d=u+";codecs="+(v||c);t.appendChangeType(s,d)}}}else t.pendingTracks[s]=r[s]}),!f&&(this.bufferCodecEventsExpected=Math.max(this.bufferCodecEventsExpected-1,0),this.mediaSource&&this.mediaSource.readyState==="open"&&this.checkPendingTracks())},h.appendChangeType=function(e,r){var t=this,f=this.operationQueue,s={execute:function(){var o=t.sourceBuffer[e];o&&(A.logger.log("[buffer-controller]: changing "+e+" sourceBuffer type to "+r),o.changeType(r)),f.shiftAndExecuteNext(e)},onStart:function(){},onComplete:function(){},onError:function(o){A.logger.warn("[buffer-controller]: Failed to change "+e+" SourceBuffer type",o)}};f.append(s,e)},h.onBufferAppending=function(e,r){var t=this,f=this.hls,s=this.operationQueue,n=this.tracks,o=r.data,c=r.type,v=r.frag,u=r.part,a=r.chunkMeta,l=a.buffering[c],d=self.performance.now();l.start=d;var E=v.stats.buffering,y=u?u.stats.buffering:null;E.start===0&&(E.start=d),y&&y.start===0&&(y.start=d);var I=n.audio,C=c==="audio"&&a.id===1&&(I==null?void 0:I.container)==="audio/mpeg",_={execute:function(){if(l.executeStart=self.performance.now(),C){var U=t.sourceBuffer[c];if(U){var N=v.start-U.timestampOffset;Math.abs(N)>=.1&&(A.logger.log("[buffer-controller]: Updating audio SourceBuffer timestampOffset to "+v.start+" (delta: "+N+") sn: "+v.sn+")"),U.timestampOffset=v.start)}}t.appendExecutor(o,c)},onStart:function(){},onComplete:function(){var U=self.performance.now();l.executeEnd=l.end=U,E.first===0&&(E.first=U),y&&y.first===0&&(y.first=U);var N=t.sourceBuffer,k={};for(var w in N)k[w]=D.BufferHelper.getBuffered(N[w]);t.appendError=0,t.hls.trigger(O.Events.BUFFER_APPENDED,{type:c,frag:v,part:u,chunkMeta:a,parent:v.type,timeRanges:k})},onError:function(U){A.logger.error("[buffer-controller]: Error encountered while trying to append to the "+c+" SourceBuffer",U);var N={type:F.ErrorTypes.MEDIA_ERROR,parent:v.type,details:F.ErrorDetails.BUFFER_APPEND_ERROR,err:U,fatal:!1};U.code===DOMException.QUOTA_EXCEEDED_ERR?N.details=F.ErrorDetails.BUFFER_FULL_ERROR:(t.appendError++,N.details=F.ErrorDetails.BUFFER_APPEND_ERROR,t.appendError>f.config.appendErrorMaxRetry&&(A.logger.error("[buffer-controller]: Failed "+f.config.appendErrorMaxRetry+" times to append segment in sourceBuffer"),N.fatal=!0)),f.trigger(O.Events.ERROR,N)}};s.append(_,c)},h.onBufferFlushing=function(e,r){var t=this,f=this.operationQueue,s=function(o){return{execute:t.removeExecutor.bind(t,o,r.startOffset,r.endOffset),onStart:function(){},onComplete:function(){t.hls.trigger(O.Events.BUFFER_FLUSHED,{type:o})},onError:function(v){A.logger.warn("[buffer-controller]: Failed to remove from "+o+" SourceBuffer",v)}}};r.type?f.append(s(r.type),r.type):this.getSourceBufferTypes().forEach(function(n){f.append(s(n),n)})},h.onFragParsed=function(e,r){var t=this,f=r.frag,s=r.part,n=[],o=s?s.elementaryStreams:f.elementaryStreams;o[L.ElementaryStreamTypes.AUDIOVIDEO]?n.push("audiovideo"):(o[L.ElementaryStreamTypes.AUDIO]&&n.push("audio"),o[L.ElementaryStreamTypes.VIDEO]&&n.push("video"));var c=function(){var u=self.performance.now();f.stats.buffering.end=u,s&&(s.stats.buffering.end=u);var a=s?s.stats:f.stats;t.hls.trigger(O.Events.FRAG_BUFFERED,{frag:f,part:s,stats:a,id:f.type})};n.length===0&&A.logger.warn("Fragments must have at least one ElementaryStreamType set. type: "+f.type+" level: "+f.level+" sn: "+f.sn),this.blockBuffers(c,n)},h.onFragChanged=function(e,r){this.flushBackBuffer()},h.onBufferEos=function(e,r){var t=this,f=this.getSourceBufferTypes().reduce(function(s,n){var o=t.sourceBuffer[n];return(!r.type||r.type===n)&&o&&!o.ended&&(o.ended=!0,A.logger.log("[buffer-controller]: "+n+" sourceBuffer now EOS")),s&&!!(!o||o.ended)},!0);f&&this.blockBuffers(function(){var s=t.mediaSource;!s||s.readyState!=="open"||s.endOfStream()})},h.onLevelUpdated=function(e,r){var t=r.details;!t.fragments.length||(this.details=t,this.getSourceBufferTypes().length?this.blockBuffers(this.updateMediaElementDuration.bind(this)):this.updateMediaElementDuration())},h.flushBackBuffer=function(){var e=this.hls,r=this.details,t=this.media,f=this.sourceBuffer;if(!(!t||r===null)){var s=this.getSourceBufferTypes();if(!!s.length){var n=r.live&&e.config.liveBackBufferLength!==null?e.config.liveBackBufferLength:e.config.backBufferLength;if(!(!Object(M.isFiniteNumber)(n)||n<0)){var o=t.currentTime,c=r.levelTargetDuration,v=Math.max(n,c),u=Math.floor(o/c)*c-v;s.forEach(function(a){var l=f[a];if(l){var d=D.BufferHelper.getBuffered(l);d.length>0&&u>d.start(0)&&(e.trigger(O.Events.BACK_BUFFER_REACHED,{bufferEnd:u}),r.live&&e.trigger(O.Events.LIVE_BACK_BUFFER_REACHED,{bufferEnd:u}),e.trigger(O.Events.BUFFER_FLUSHING,{startOffset:0,endOffset:u,type:a}))}})}}}},h.updateMediaElementDuration=function(){if(!(!this.details||!this.media||!this.mediaSource||this.mediaSource.readyState!=="open")){var e=this.details,r=this.hls,t=this.media,f=this.mediaSource,s=e.fragments[0].start+e.totalduration,n=t.duration,o=Object(M.isFiniteNumber)(f.duration)?f.duration:0;e.live&&r.config.liveDurationInfinity?(A.logger.log("[buffer-controller]: Media Source duration is set to Infinity"),f.duration=1/0,this.updateSeekableRange(e)):(s>o&&s>n||!Object(M.isFiniteNumber)(n))&&(A.logger.log("[buffer-controller]: Updating Media Source duration to "+s.toFixed(3)),f.duration=s)}},h.updateSeekableRange=function(e){var r=this.mediaSource,t=e.fragments,f=t.length;if(f&&e.live&&r!==null&&r!==void 0&&r.setLiveSeekableRange){var s=Math.max(0,t[0].start),n=Math.max(s,s+e.totalduration);r.setLiveSeekableRange(s,n)}},h.checkPendingTracks=function(){var e=this.bufferCodecEventsExpected,r=this.operationQueue,t=this.pendingTracks,f=Object.keys(t).length;if(f&&!e||f===2){this.createSourceBuffers(t),this.pendingTracks={};var s=this.getSourceBufferTypes();if(s.length===0){this.hls.trigger(O.Events.ERROR,{type:F.ErrorTypes.MEDIA_ERROR,details:F.ErrorDetails.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,reason:"could not create source buffer for media codec(s)"});return}s.forEach(function(n){r.executeNext(n)})}},h.createSourceBuffers=function(e){var r=this.sourceBuffer,t=this.mediaSource;if(!t)throw Error("createSourceBuffers called when mediaSource was null");var f=0;for(var s in e)if(!r[s]){var n=e[s];if(!n)throw Error("source buffer exists for track "+s+", however track does not");var o=n.levelCodec||n.codec,c=n.container+";codecs="+o;A.logger.log("[buffer-controller]: creating sourceBuffer("+c+")");try{var v=r[s]=t.addSourceBuffer(c),u=s;this.addBufferListener(u,"updatestart",this._onSBUpdateStart),this.addBufferListener(u,"updateend",this._onSBUpdateEnd),this.addBufferListener(u,"error",this._onSBUpdateError),this.tracks[s]={buffer:v,codec:o,container:n.container,levelCodec:n.levelCodec,id:n.id},f++}catch(a){A.logger.error("[buffer-controller]: error while trying to add sourceBuffer: "+a.message),this.hls.trigger(O.Events.ERROR,{type:F.ErrorTypes.MEDIA_ERROR,details:F.ErrorDetails.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:a,mimeType:c})}}f&&this.hls.trigger(O.Events.BUFFER_CREATED,{tracks:this.tracks})},h._onSBUpdateStart=function(e){var r=this.operationQueue,t=r.current(e);t.onStart()},h._onSBUpdateEnd=function(e){var r=this.operationQueue,t=r.current(e);t.onComplete(),r.shiftAndExecuteNext(e)},h._onSBUpdateError=function(e,r){A.logger.error("[buffer-controller]: "+e+" SourceBuffer error",r),this.hls.trigger(O.Events.ERROR,{type:F.ErrorTypes.MEDIA_ERROR,details:F.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:!1});var t=this.operationQueue.current(e);t&&t.onError(r)},h.removeExecutor=function(e,r,t){var f=this.media,s=this.mediaSource,n=this.operationQueue,o=this.sourceBuffer,c=o[e];if(!f||!s||!c){A.logger.warn("[buffer-controller]: Attempting to remove from the "+e+" SourceBuffer, but it does not exist"),n.shiftAndExecuteNext(e);return}var v=Object(M.isFiniteNumber)(f.duration)?f.duration:1/0,u=Object(M.isFiniteNumber)(s.duration)?s.duration:1/0,a=Math.max(0,r),l=Math.min(t,v,u);l>a?(A.logger.log("[buffer-controller]: Removing ["+a+","+l+"] from the "+e+" SourceBuffer"),console.assert(!c.updating,e+" sourceBuffer must not be updating"),c.remove(a,l)):n.shiftAndExecuteNext(e)},h.appendExecutor=function(e,r){var t=this.operationQueue,f=this.sourceBuffer,s=f[r];if(!s){A.logger.warn("[buffer-controller]: Attempting to append to the "+r+" SourceBuffer, but it does not exist"),t.shiftAndExecuteNext(r);return}s.ended=!1,console.assert(!s.updating,r+" sourceBuffer must not be updating"),s.appendBuffer(e)},h.blockBuffers=function(e,r){var t=this;if(r===void 0&&(r=this.getSourceBufferTypes()),!r.length){A.logger.log("[buffer-controller]: Blocking operation requested, but no SourceBuffers exist"),Promise.resolve(e);return}var f=this.operationQueue,s=r.map(function(n){return f.appendBlocker(n)});Promise.all(s).then(function(){e(),r.forEach(function(n){var o=t.sourceBuffer[n];(!o||!o.updating)&&f.shiftAndExecuteNext(n)})})},h.getSourceBufferTypes=function(){return Object.keys(this.sourceBuffer)},h.addBufferListener=function(e,r,t){var f=this.sourceBuffer[e];if(!!f){var s=t.bind(this,e);this.listeners[e].push({event:r,listener:s}),f.addEventListener(r,s)}},h.removeBufferListeners=function(e){var r=this.sourceBuffer[e];!r||this.listeners[e].forEach(function(t){r.removeEventListener(t.event,t.listener)})},m}()},"./src/controller/buffer-operation-queue.ts":function(K,P,p){p.r(P),p.d(P,"default",function(){return O});var M=p("./src/utils/logger.ts"),O=function(){function A(D){this.buffers=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.buffers=D}var F=A.prototype;return F.append=function(R,L){var g=this.queues[L];g.push(R),g.length===1&&this.buffers[L]&&this.executeNext(L)},F.insertAbort=function(R,L){var g=this.queues[L];g.unshift(R),this.executeNext(L)},F.appendBlocker=function(R){var L,g=new Promise(function(T){L=T}),S={execute:L,onStart:function(){},onComplete:function(){},onError:function(){}};return this.append(S,R),g},F.executeNext=function(R){var L=this.buffers,g=this.queues,S=L[R],T=g[R];if(T.length){var x=T[0];try{x.execute()}catch(m){M.logger.warn("[buffer-operation-queue]: Unhandled exception executing the current operation"),x.onError(m),(!S||!S.updating)&&(T.shift(),this.executeNext(R))}}},F.shiftAndExecuteNext=function(R){this.queues[R].shift(),this.executeNext(R)},F.current=function(R){return this.queues[R][0]},A}()},"./src/controller/cap-level-controller.ts":function(K,P,p){p.r(P);var M=p("./src/events.ts");function O(D,R){for(var L=0;L<R.length;L++){var g=R[L];g.enumerable=g.enumerable||!1,g.configurable=!0,"value"in g&&(g.writable=!0),Object.defineProperty(D,g.key,g)}}function A(D,R,L){return R&&O(D.prototype,R),L&&O(D,L),D}var F=function(){function D(L){this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.hls=void 0,this.streamController=void 0,this.clientRect=void 0,this.hls=L,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}var R=D.prototype;return R.setStreamController=function(g){this.streamController=g},R.destroy=function(){this.unregisterListener(),this.hls.config.capLevelToPlayerSize&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null},R.registerListeners=function(){var g=this.hls;g.on(M.Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),g.on(M.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),g.on(M.Events.MANIFEST_PARSED,this.onManifestParsed,this),g.on(M.Events.BUFFER_CODECS,this.onBufferCodecs,this),g.on(M.Events.MEDIA_DETACHING,this.onMediaDetaching,this)},R.unregisterListener=function(){var g=this.hls;g.off(M.Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),g.off(M.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),g.off(M.Events.MANIFEST_PARSED,this.onManifestParsed,this),g.off(M.Events.BUFFER_CODECS,this.onBufferCodecs,this),g.off(M.Events.MEDIA_DETACHING,this.onMediaDetaching,this)},R.onFpsDropLevelCapping=function(g,S){D.isLevelAllowed(S.droppedLevel,this.restrictedLevels)&&this.restrictedLevels.push(S.droppedLevel)},R.onMediaAttaching=function(g,S){this.media=S.media instanceof HTMLVideoElement?S.media:null},R.onManifestParsed=function(g,S){var T=this.hls;this.restrictedLevels=[],this.firstLevel=S.firstLevel,T.config.capLevelToPlayerSize&&S.video&&this.startCapping()},R.onBufferCodecs=function(g,S){var T=this.hls;T.config.capLevelToPlayerSize&&S.video&&this.startCapping()},R.onMediaDetaching=function(){this.stopCapping()},R.detectPlayerSize=function(){if(this.media&&this.mediaHeight>0&&this.mediaWidth>0){var g=this.hls.levels;if(g.length){var S=this.hls;S.autoLevelCapping=this.getMaxLevel(g.length-1),S.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=S.autoLevelCapping}}},R.getMaxLevel=function(g){var S=this,T=this.hls.levels;if(!T.length)return-1;var x=T.filter(function(m,h){return D.isLevelAllowed(h,S.restrictedLevels)&&h<=g});return this.clientRect=null,D.getMaxLevelByMediaSize(x,this.mediaWidth,this.mediaHeight)},R.startCapping=function(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.hls.firstLevel=this.getMaxLevel(this.firstLevel),self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())},R.stopCapping=function(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)},R.getDimensions=function(){if(this.clientRect)return this.clientRect;var g=this.media,S={width:0,height:0};if(g){var T=g.getBoundingClientRect();S.width=T.width,S.height=T.height,!S.width&&!S.height&&(S.width=T.right-T.left||g.width||0,S.height=T.bottom-T.top||g.height||0)}return this.clientRect=S,S},D.isLevelAllowed=function(g,S){return S===void 0&&(S=[]),S.indexOf(g)===-1},D.getMaxLevelByMediaSize=function(g,S,T){if(!g||!g.length)return-1;for(var x=function(r,t){return t?r.width!==t.width||r.height!==t.height:!0},m=g.length-1,h=0;h<g.length;h+=1){var i=g[h];if((i.width>=S||i.height>=T)&&x(i,g[h+1])){m=h;break}}return m},A(D,[{key:"mediaWidth",get:function(){return this.getDimensions().width*D.contentScaleFactor}},{key:"mediaHeight",get:function(){return this.getDimensions().height*D.contentScaleFactor}}],[{key:"contentScaleFactor",get:function(){var g=1;try{g=self.devicePixelRatio}catch{}return g}}]),D}();P.default=F},"./src/controller/cmcd-controller.ts":function(K,P,p){p.r(P),p.d(P,"default",function(){return x});var M=p("./src/events.ts"),O=p("./src/types/cmcd.ts"),A=p("./src/utils/buffer-helper.ts"),F=p("./src/utils/logger.ts");function D(m,h){for(var i=0;i<h.length;i++){var e=h[i];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(m,e.key,e)}}function R(m,h,i){return h&&D(m.prototype,h),i&&D(m,i),m}function L(m,h){var i=typeof Symbol!="undefined"&&m[Symbol.iterator]||m["@@iterator"];if(i)return(i=i.call(m)).next.bind(i);if(Array.isArray(m)||(i=g(m))||h&&m&&typeof m.length=="number"){i&&(m=i);var e=0;return function(){return e>=m.length?{done:!0}:{done:!1,value:m[e++]}}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function g(m,h){if(!!m){if(typeof m=="string")return S(m,h);var i=Object.prototype.toString.call(m).slice(8,-1);if(i==="Object"&&m.constructor&&(i=m.constructor.name),i==="Map"||i==="Set")return Array.from(m);if(i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return S(m,h)}}function S(m,h){(h==null||h>m.length)&&(h=m.length);for(var i=0,e=new Array(h);i<h;i++)e[i]=m[i];return e}function T(){return T=Object.assign||function(m){for(var h=1;h<arguments.length;h++){var i=arguments[h];for(var e in i)Object.prototype.hasOwnProperty.call(i,e)&&(m[e]=i[e])}return m},T.apply(this,arguments)}var x=function(){function m(i){var e=this;this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=function(){e.initialized&&(e.starved=!0),e.buffering=!0},this.onPlaying=function(){e.initialized||(e.initialized=!0),e.buffering=!1},this.applyPlaylistData=function(f){try{e.apply(f,{ot:O.CMCDObjectType.MANIFEST,su:!e.initialized})}catch(s){F.logger.warn("Could not generate manifest CMCD data.",s)}},this.applyFragmentData=function(f){try{var s=f.frag,n=e.hls.levels[s.level],o=e.getObjectType(s),c={d:s.duration*1e3,ot:o};(o===O.CMCDObjectType.VIDEO||o===O.CMCDObjectType.AUDIO||o==O.CMCDObjectType.MUXED)&&(c.br=n.bitrate/1e3,c.tb=e.getTopBandwidth(o),c.bl=e.getBufferLength(o)),e.apply(f,c)}catch(v){F.logger.warn("Could not generate segment CMCD data.",v)}},this.hls=i;var r=this.config=i.config,t=r.cmcd;t!=null&&(r.pLoader=this.createPlaylistLoader(),r.fLoader=this.createFragmentLoader(),this.sid=t.sessionId||m.uuid(),this.cid=t.contentId,this.useHeaders=t.useHeaders===!0,this.registerListeners())}var h=m.prototype;return h.registerListeners=function(){var e=this.hls;e.on(M.Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(M.Events.MEDIA_DETACHED,this.onMediaDetached,this),e.on(M.Events.BUFFER_CREATED,this.onBufferCreated,this)},h.unregisterListeners=function(){var e=this.hls;e.off(M.Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(M.Events.MEDIA_DETACHED,this.onMediaDetached,this),e.off(M.Events.BUFFER_CREATED,this.onBufferCreated,this),this.onMediaDetached()},h.destroy=function(){this.unregisterListeners(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null},h.onMediaAttached=function(e,r){this.media=r.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)},h.onMediaDetached=function(){!this.media||(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)},h.onBufferCreated=function(e,r){var t,f;this.audioBuffer=(t=r.tracks.audio)===null||t===void 0?void 0:t.buffer,this.videoBuffer=(f=r.tracks.video)===null||f===void 0?void 0:f.buffer},h.createData=function(){var e;return{v:O.CMCDVersion,sf:O.CMCDStreamingFormat.HLS,sid:this.sid,cid:this.cid,pr:(e=this.media)===null||e===void 0?void 0:e.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}},h.apply=function(e,r){r===void 0&&(r={}),T(r,this.createData());var t=r.ot===O.CMCDObjectType.INIT||r.ot===O.CMCDObjectType.VIDEO||r.ot===O.CMCDObjectType.MUXED;if(this.starved&&t&&(r.bs=!0,r.su=!0,this.starved=!1),r.su==null&&(r.su=this.buffering),this.useHeaders){var f=m.toHeaders(r);if(!Object.keys(f).length)return;e.headers||(e.headers={}),T(e.headers,f)}else{var s=m.toQuery(r);if(!s)return;e.url=m.appendQueryToUri(e.url,s)}},h.getObjectType=function(e){var r=e.type;if(r==="subtitle")return O.CMCDObjectType.TIMED_TEXT;if(e.sn==="initSegment")return O.CMCDObjectType.INIT;if(r==="audio")return O.CMCDObjectType.AUDIO;if(r==="main")return this.hls.audioTracks.length?O.CMCDObjectType.VIDEO:O.CMCDObjectType.MUXED},h.getTopBandwidth=function(e){for(var r=0,t=e===O.CMCDObjectType.AUDIO?this.hls.audioTracks:this.hls.levels,f=L(t),s;!(s=f()).done;){var n=s.value;n.bitrate>r&&(r=n.bitrate)}return r>0?r:NaN},h.getBufferLength=function(e){var r=this.hls.media,t=e===O.CMCDObjectType.AUDIO?this.audioBuffer:this.videoBuffer;if(!t||!r)return NaN;var f=A.BufferHelper.bufferInfo(t,r.currentTime,this.config.maxBufferHole);return f.len*1e3},h.createPlaylistLoader=function(){var e=this.config.pLoader,r=this.applyPlaylistData,t=e||this.config.loader;return function(){function f(n){this.loader=void 0,this.loader=new t(n)}var s=f.prototype;return s.destroy=function(){this.loader.destroy()},s.abort=function(){this.loader.abort()},s.load=function(o,c,v){r(o),this.loader.load(o,c,v)},R(f,[{key:"stats",get:function(){return this.loader.stats}},{key:"context",get:function(){return this.loader.context}}]),f}()},h.createFragmentLoader=function(){var e=this.config.fLoader,r=this.applyFragmentData,t=e||this.config.loader;return function(){function f(n){this.loader=void 0,this.loader=new t(n)}var s=f.prototype;return s.destroy=function(){this.loader.destroy()},s.abort=function(){this.loader.abort()},s.load=function(o,c,v){r(o),this.loader.load(o,c,v)},R(f,[{key:"stats",get:function(){return this.loader.stats}},{key:"context",get:function(){return this.loader.context}}]),f}()},m.uuid=function(){var e=URL.createObjectURL(new Blob),r=e.toString();return URL.revokeObjectURL(e),r.substr(r.lastIndexOf("/")+1)},m.serialize=function(e){for(var r=[],t=function(C){return!Number.isNaN(C)&&C!=null&&C!==""&&C!==!1},f=function(C){return Math.round(C)},s=function(C){return f(C/100)*100},n=function(C){return encodeURIComponent(C)},o={br:f,d:f,bl:s,dl:s,mtp:s,nor:n,rtp:s,tb:f},c=Object.keys(e||{}).sort(),v=L(c),u;!(u=v()).done;){var a=u.value,l=e[a];if(!!t(l)&&!(a==="v"&&l===1)&&!(a=="pr"&&l===1)){var d=o[a];d&&(l=d(l));var E=typeof l,y=void 0;a==="ot"||a==="sf"||a==="st"?y=a+"="+l:E==="boolean"?y=a:E==="number"?y=a+"="+l:y=a+"="+JSON.stringify(l),r.push(y)}}return r.join(",")},m.toHeaders=function(e){for(var r=Object.keys(e),t={},f=["Object","Request","Session","Status"],s=[{},{},{},{}],n={br:0,d:0,ot:0,tb:0,bl:1,dl:1,mtp:1,nor:1,nrr:1,su:1,cid:2,pr:2,sf:2,sid:2,st:2,v:2,bs:3,rtp:3},o=0,c=r;o<c.length;o++){var v=c[o],u=n[v]!=null?n[v]:1;s[u][v]=e[v]}for(var a=0;a<s.length;a++){var l=m.serialize(s[a]);l&&(t["CMCD-"+f[a]]=l)}return t},m.toQuery=function(e){return"CMCD="+encodeURIComponent(m.serialize(e))},m.appendQueryToUri=function(e,r){if(!r)return e;var t=e.includes("?")?"&":"?";return""+e+t+r},m}()},"./src/controller/eme-controller.ts":function(K,P,p){p.r(P);var M=p("./src/events.ts"),O=p("./src/errors.ts"),A=p("./src/utils/logger.ts"),F=p("./src/utils/mediakeys-helper.ts");function D(x,m){for(var h=0;h<m.length;h++){var i=m[h];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(x,i.key,i)}}function R(x,m,h){return m&&D(x.prototype,m),h&&D(x,h),x}var L=3,g=function(m,h,i){var e={audioCapabilities:[],videoCapabilities:[]};return m.forEach(function(r){e.audioCapabilities.push({contentType:'audio/mp4; codecs="'+r+'"',robustness:i.audioRobustness||""})}),h.forEach(function(r){e.videoCapabilities.push({contentType:'video/mp4; codecs="'+r+'"',robustness:i.videoRobustness||""})}),[e]},S=function(m,h,i,e){switch(m){case F.KeySystems.WIDEVINE:return g(h,i,e);default:throw new Error("Unknown key-system: "+m)}},T=function(){function x(h){this.hls=void 0,this._widevineLicenseUrl=void 0,this._licenseXhrSetup=void 0,this._licenseResponseCallback=void 0,this._emeEnabled=void 0,this._requestMediaKeySystemAccess=void 0,this._drmSystemOptions=void 0,this._config=void 0,this._mediaKeysList=[],this._media=null,this._hasSetMediaKeys=!1,this._requestLicenseFailureCount=0,this.mediaKeysPromise=null,this._onMediaEncrypted=this.onMediaEncrypted.bind(this),this.hls=h,this._config=h.config,this._widevineLicenseUrl=this._config.widevineLicenseUrl,this._licenseXhrSetup=this._config.licenseXhrSetup,this._licenseResponseCallback=this._config.licenseResponseCallback,this._emeEnabled=this._config.emeEnabled,this._requestMediaKeySystemAccess=this._config.requestMediaKeySystemAccessFunc,this._drmSystemOptions=this._config.drmSystemOptions,this._registerListeners()}var m=x.prototype;return m.destroy=function(){this._unregisterListeners(),this.hls=this._onMediaEncrypted=null,this._requestMediaKeySystemAccess=null},m._registerListeners=function(){this.hls.on(M.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(M.Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(M.Events.MANIFEST_PARSED,this.onManifestParsed,this)},m._unregisterListeners=function(){this.hls.off(M.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(M.Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(M.Events.MANIFEST_PARSED,this.onManifestParsed,this)},m.getLicenseServerUrl=function(i){switch(i){case F.KeySystems.WIDEVINE:if(!this._widevineLicenseUrl)break;return this._widevineLicenseUrl}throw new Error('no license server URL configured for key-system "'+i+'"')},m._attemptKeySystemAccess=function(i,e,r){var t=this,f=S(i,e,r,this._drmSystemOptions);A.logger.log("Requesting encrypted media key-system access");var s=this.requestMediaKeySystemAccess(i,f);this.mediaKeysPromise=s.then(function(n){return t._onMediaKeySystemAccessObtained(i,n)}),s.catch(function(n){A.logger.error('Failed to obtain key-system "'+i+'" access:',n)})},m._onMediaKeySystemAccessObtained=function(i,e){var r=this;A.logger.log('Access for key-system "'+i+'" obtained');var t={mediaKeysSessionInitialized:!1,mediaKeySystemAccess:e,mediaKeySystemDomain:i};this._mediaKeysList.push(t);var f=Promise.resolve().then(function(){return e.createMediaKeys()}).then(function(s){return t.mediaKeys=s,A.logger.log('Media-keys created for key-system "'+i+'"'),r._onMediaKeysCreated(),s});return f.catch(function(s){A.logger.error("Failed to create media-keys:",s)}),f},m._onMediaKeysCreated=function(){var i=this;this._mediaKeysList.forEach(function(e){e.mediaKeysSession||(e.mediaKeysSession=e.mediaKeys.createSession(),i._onNewMediaKeySession(e.mediaKeysSession))})},m._onNewMediaKeySession=function(i){var e=this;A.logger.log("New key-system session "+i.sessionId),i.addEventListener("message",function(r){e._onKeySessionMessage(i,r.message)},!1)},m._onKeySessionMessage=function(i,e){A.logger.log("Got EME message event, creating license request"),this._requestLicense(e,function(r){A.logger.log("Received license data (length: "+(r&&r.byteLength)+"), updating key-session"),i.update(r)})},m.onMediaEncrypted=function(i){var e=this;if(A.logger.log('Media is encrypted using "'+i.initDataType+'" init data type'),!this.mediaKeysPromise){A.logger.error("Fatal: Media is encrypted but no CDM access or no keys have been requested"),this.hls.trigger(M.Events.ERROR,{type:O.ErrorTypes.KEY_SYSTEM_ERROR,details:O.ErrorDetails.KEY_SYSTEM_NO_KEYS,fatal:!0});return}var r=function(f){!e._media||(e._attemptSetMediaKeys(f),e._generateRequestWithPreferredKeySession(i.initDataType,i.initData))};this.mediaKeysPromise.then(r).catch(r)},m._attemptSetMediaKeys=function(i){if(!this._media)throw new Error("Attempted to set mediaKeys without first attaching a media element");if(!this._hasSetMediaKeys){var e=this._mediaKeysList[0];if(!e||!e.mediaKeys){A.logger.error("Fatal: Media is encrypted but no CDM access or no keys have been obtained yet"),this.hls.trigger(M.Events.ERROR,{type:O.ErrorTypes.KEY_SYSTEM_ERROR,details:O.ErrorDetails.KEY_SYSTEM_NO_KEYS,fatal:!0});return}A.logger.log("Setting keys for encrypted media"),this._media.setMediaKeys(e.mediaKeys),this._hasSetMediaKeys=!0}},m._generateRequestWithPreferredKeySession=function(i,e){var r=this,t=this._mediaKeysList[0];if(!t){A.logger.error("Fatal: Media is encrypted but not any key-system access has been obtained yet"),this.hls.trigger(M.Events.ERROR,{type:O.ErrorTypes.KEY_SYSTEM_ERROR,details:O.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0});return}if(t.mediaKeysSessionInitialized){A.logger.warn("Key-Session already initialized but requested again");return}var f=t.mediaKeysSession;if(!f){A.logger.error("Fatal: Media is encrypted but no key-session existing"),this.hls.trigger(M.Events.ERROR,{type:O.ErrorTypes.KEY_SYSTEM_ERROR,details:O.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!0});return}if(!e){A.logger.warn("Fatal: initData required for generating a key session is null"),this.hls.trigger(M.Events.ERROR,{type:O.ErrorTypes.KEY_SYSTEM_ERROR,details:O.ErrorDetails.KEY_SYSTEM_NO_INIT_DATA,fatal:!0});return}A.logger.log('Generating key-session request for "'+i+'" init data type'),t.mediaKeysSessionInitialized=!0,f.generateRequest(i,e).then(function(){A.logger.debug("Key-session generation succeeded")}).catch(function(s){A.logger.error("Error generating key-session request:",s),r.hls.trigger(M.Events.ERROR,{type:O.ErrorTypes.KEY_SYSTEM_ERROR,details:O.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!1})})},m._createLicenseXhr=function(i,e,r){var t=new XMLHttpRequest;t.responseType="arraybuffer",t.onreadystatechange=this._onLicenseRequestReadyStageChange.bind(this,t,i,e,r);var f=this._licenseXhrSetup;if(f)try{f.call(this.hls,t,i),f=void 0}catch(s){A.logger.error(s)}try{t.readyState||t.open("POST",i,!0),f&&f.call(this.hls,t,i)}catch(s){throw new Error("issue setting up KeySystem license XHR "+s)}return t},m._onLicenseRequestReadyStageChange=function(i,e,r,t){switch(i.readyState){case 4:if(i.status===200){this._requestLicenseFailureCount=0,A.logger.log("License request succeeded");var f=i.response,s=this._licenseResponseCallback;if(s)try{f=s.call(this.hls,i,e)}catch(o){A.logger.error(o)}t(f)}else{if(A.logger.error("License Request XHR failed ("+e+"). Status: "+i.status+" ("+i.statusText+")"),this._requestLicenseFailureCount++,this._requestLicenseFailureCount>L){this.hls.trigger(M.Events.ERROR,{type:O.ErrorTypes.KEY_SYSTEM_ERROR,details:O.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0});return}var n=L-this._requestLicenseFailureCount+1;A.logger.warn("Retrying license request, "+n+" attempts left"),this._requestLicense(r,t)}break}},m._generateLicenseRequestChallenge=function(i,e){switch(i.mediaKeySystemDomain){case F.KeySystems.WIDEVINE:return e}throw new Error("unsupported key-system: "+i.mediaKeySystemDomain)},m._requestLicense=function(i,e){A.logger.log("Requesting content license for key-system");var r=this._mediaKeysList[0];if(!r){A.logger.error("Fatal error: Media is encrypted but no key-system access has been obtained yet"),this.hls.trigger(M.Events.ERROR,{type:O.ErrorTypes.KEY_SYSTEM_ERROR,details:O.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0});return}try{var t=this.getLicenseServerUrl(r.mediaKeySystemDomain),f=this._createLicenseXhr(t,i,e);A.logger.log("Sending license request to URL: "+t);var s=this._generateLicenseRequestChallenge(r,i);f.send(s)}catch(n){A.logger.error("Failure requesting DRM license: "+n),this.hls.trigger(M.Events.ERROR,{type:O.ErrorTypes.KEY_SYSTEM_ERROR,details:O.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0})}},m.onMediaAttached=function(i,e){if(!!this._emeEnabled){var r=e.media;this._media=r,r.addEventListener("encrypted",this._onMediaEncrypted)}},m.onMediaDetached=function(){var i=this._media,e=this._mediaKeysList;!i||(i.removeEventListener("encrypted",this._onMediaEncrypted),this._media=null,this._mediaKeysList=[],Promise.all(e.map(function(r){if(r.mediaKeysSession)return r.mediaKeysSession.close().catch(function(){})})).then(function(){return i.setMediaKeys(null)}).catch(function(){}))},m.onManifestParsed=function(i,e){if(!!this._emeEnabled){var r=e.levels.map(function(f){return f.audioCodec}).filter(function(f){return!!f}),t=e.levels.map(function(f){return f.videoCodec}).filter(function(f){return!!f});this._attemptKeySystemAccess(F.KeySystems.WIDEVINE,r,t)}},R(x,[{key:"requestMediaKeySystemAccess",get:function(){if(!this._requestMediaKeySystemAccess)throw new Error("No requestMediaKeySystemAccess function configured");return this._requestMediaKeySystemAccess}}]),x}();P.default=T},"./src/controller/fps-controller.ts":function(K,P,p){p.r(P);var M=p("./src/events.ts"),O=p("./src/utils/logger.ts"),A=function(){function F(R){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=R,this.registerListeners()}var D=F.prototype;return D.setStreamController=function(L){this.streamController=L},D.registerListeners=function(){this.hls.on(M.Events.MEDIA_ATTACHING,this.onMediaAttaching,this)},D.unregisterListeners=function(){this.hls.off(M.Events.MEDIA_ATTACHING,this.onMediaAttaching)},D.destroy=function(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null},D.onMediaAttaching=function(L,g){var S=this.hls.config;if(S.capLevelOnFPSDrop){var T=g.media instanceof self.HTMLVideoElement?g.media:null;this.media=T,T&&typeof T.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),S.fpsDroppedMonitoringPeriod)}},D.checkFPS=function(L,g,S){var T=performance.now();if(g){if(this.lastTime){var x=T-this.lastTime,m=S-this.lastDroppedFrames,h=g-this.lastDecodedFrames,i=1e3*m/x,e=this.hls;if(e.trigger(M.Events.FPS_DROP,{currentDropped:m,currentDecoded:h,totalDroppedFrames:S}),i>0&&m>e.config.fpsDroppedMonitoringThreshold*h){var r=e.currentLevel;O.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+r),r>0&&(e.autoLevelCapping===-1||e.autoLevelCapping>=r)&&(r=r-1,e.trigger(M.Events.FPS_DROP_LEVEL_CAPPING,{level:r,droppedLevel:e.currentLevel}),e.autoLevelCapping=r,this.streamController.nextLevelSwitch())}}this.lastTime=T,this.lastDroppedFrames=S,this.lastDecodedFrames=g}},D.checkFPSInterval=function(){var L=this.media;if(L)if(this.isVideoPlaybackQualityAvailable){var g=L.getVideoPlaybackQuality();this.checkFPS(L,g.totalVideoFrames,g.droppedVideoFrames)}else this.checkFPS(L,L.webkitDecodedFrameCount,L.webkitDroppedFrameCount)},F}();P.default=A},"./src/controller/fragment-finders.ts":function(K,P,p){p.r(P),p.d(P,"findFragmentByPDT",function(){return A}),p.d(P,"findFragmentByPTS",function(){return F}),p.d(P,"fragmentWithinToleranceTest",function(){return D}),p.d(P,"pdtWithinToleranceTest",function(){return R}),p.d(P,"findFragWithCC",function(){return L});var M=p("./src/polyfills/number.ts"),O=p("./src/utils/binary-search.ts");function A(g,S,T){if(S===null||!Array.isArray(g)||!g.length||!Object(M.isFiniteNumber)(S))return null;var x=g[0].programDateTime;if(S<(x||0))return null;var m=g[g.length-1].endProgramDateTime;if(S>=(m||0))return null;T=T||0;for(var h=0;h<g.length;++h){var i=g[h];if(R(S,T,i))return i}return null}function F(g,S,T,x){T===void 0&&(T=0),x===void 0&&(x=0);var m=null;if(g?m=S[g.sn-S[0].sn+1]||null:T===0&&S[0].start===0&&(m=S[0]),m&&D(T,x,m)===0)return m;var h=O.default.search(S,D.bind(null,T,x));return h||m}function D(g,S,T){g===void 0&&(g=0),S===void 0&&(S=0);var x=Math.min(S,T.duration+(T.deltaPTS?T.deltaPTS:0));return T.start+T.duration-x<=g?1:T.start-x>g&&T.start?-1:0}function R(g,S,T){var x=Math.min(S,T.duration+(T.deltaPTS?T.deltaPTS:0))*1e3,m=T.endProgramDateTime||0;return m-x>g}function L(g,S){return O.default.search(g,function(T){return T.cc<S?1:T.cc>S?-1:0})}},"./src/controller/fragment-tracker.ts":function(K,P,p){p.r(P),p.d(P,"FragmentState",function(){return A}),p.d(P,"FragmentTracker",function(){return F});var M=p("./src/events.ts"),O=p("./src/types/loader.ts"),A;(function(L){L.NOT_LOADED="NOT_LOADED",L.BACKTRACKED="BACKTRACKED",L.APPENDING="APPENDING",L.PARTIAL="PARTIAL",L.OK="OK"})(A||(A={}));var F=function(){function L(S){this.activeFragment=null,this.activeParts=null,this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hls=S,this._registerListeners()}var g=L.prototype;return g._registerListeners=function(){var T=this.hls;T.on(M.Events.BUFFER_APPENDED,this.onBufferAppended,this),T.on(M.Events.FRAG_BUFFERED,this.onFragBuffered,this),T.on(M.Events.FRAG_LOADED,this.onFragLoaded,this)},g._unregisterListeners=function(){var T=this.hls;T.off(M.Events.BUFFER_APPENDED,this.onBufferAppended,this),T.off(M.Events.FRAG_BUFFERED,this.onFragBuffered,this),T.off(M.Events.FRAG_LOADED,this.onFragLoaded,this)},g.destroy=function(){this._unregisterListeners(),this.fragments=this.timeRanges=null},g.getAppendedFrag=function(T,x){if(x===O.PlaylistLevelType.MAIN){var m=this.activeFragment,h=this.activeParts;if(!m)return null;if(h)for(var i=h.length;i--;){var e=h[i],r=e?e.end:m.appendedPTS;if(e.start<=T&&r!==void 0&&T<=r)return i>9&&(this.activeParts=h.slice(i-9)),e}else if(m.start<=T&&m.appendedPTS!==void 0&&T<=m.appendedPTS)return m}return this.getBufferedFrag(T,x)},g.getBufferedFrag=function(T,x){for(var m=this.fragments,h=Object.keys(m),i=h.length;i--;){var e=m[h[i]];if((e==null?void 0:e.body.type)===x&&e.buffered){var r=e.body;if(r.start<=T&&T<=r.end)return r}}return null},g.detectEvictedFragments=function(T,x,m){var h=this;Object.keys(this.fragments).forEach(function(i){var e=h.fragments[i];if(!!e){if(!e.buffered){e.body.type===m&&h.removeFragment(e.body);return}var r=e.range[T];!r||r.time.some(function(t){var f=!h.isTimeBuffered(t.startPTS,t.endPTS,x);return f&&h.removeFragment(e.body),f})}})},g.detectPartialFragments=function(T){var x=this,m=this.timeRanges,h=T.frag,i=T.part;if(!(!m||h.sn==="initSegment")){var e=R(h),r=this.fragments[e];!r||(Object.keys(m).forEach(function(t){var f=h.elementaryStreams[t];if(!!f){var s=m[t],n=i!==null||f.partial===!0;r.range[t]=x.getBufferedTimes(h,i,n,s)}}),r.backtrack=r.loaded=null,Object.keys(r.range).length?r.buffered=!0:this.removeFragment(r.body))}},g.fragBuffered=function(T){var x=R(T),m=this.fragments[x];m&&(m.backtrack=m.loaded=null,m.buffered=!0)},g.getBufferedTimes=function(T,x,m,h){for(var i={time:[],partial:m},e=x?x.start:T.start,r=x?x.end:T.end,t=T.minEndPTS||r,f=T.maxStartPTS||e,s=0;s<h.length;s++){var n=h.start(s)-this.bufferPadding,o=h.end(s)+this.bufferPadding;if(f>=n&&t<=o){i.time.push({startPTS:Math.max(e,h.start(s)),endPTS:Math.min(r,h.end(s))});break}else if(e<o&&r>n)i.partial=!0,i.time.push({startPTS:Math.max(e,h.start(s)),endPTS:Math.min(r,h.end(s))});else if(r<=n)break}return i},g.getPartialFragment=function(T){var x=null,m,h,i,e=0,r=this.bufferPadding,t=this.fragments;return Object.keys(t).forEach(function(f){var s=t[f];!s||D(s)&&(h=s.body.start-r,i=s.body.end+r,T>=h&&T<=i&&(m=Math.min(T-h,i-T),e<=m&&(x=s.body,e=m)))}),x},g.getState=function(T){var x=R(T),m=this.fragments[x];return m?m.buffered?D(m)?A.PARTIAL:A.OK:m.backtrack?A.BACKTRACKED:A.APPENDING:A.NOT_LOADED},g.backtrack=function(T,x){var m=R(T),h=this.fragments[m];if(!h||h.backtrack)return null;var i=h.backtrack=x||h.loaded;return h.loaded=null,i},g.getBacktrackData=function(T){var x=R(T),m=this.fragments[x];if(m){var h,i=m.backtrack;if(i!=null&&(h=i.payload)!==null&&h!==void 0&&h.byteLength)return i;this.removeFragment(T)}return null},g.isTimeBuffered=function(T,x,m){for(var h,i,e=0;e<m.length;e++){if(h=m.start(e)-this.bufferPadding,i=m.end(e)+this.bufferPadding,T>=h&&x<=i)return!0;if(x<=h)return!1}return!1},g.onFragLoaded=function(T,x){var m=x.frag,h=x.part;if(!(m.sn==="initSegment"||m.bitrateTest||h)){var i=R(m);this.fragments[i]={body:m,loaded:x,backtrack:null,buffered:!1,range:Object.create(null)}}},g.onBufferAppended=function(T,x){var m=this,h=x.frag,i=x.part,e=x.timeRanges;if(h.type===O.PlaylistLevelType.MAIN)if(this.activeFragment=h,i){var r=this.activeParts;r||(this.activeParts=r=[]),r.push(i)}else this.activeParts=null;this.timeRanges=e,Object.keys(e).forEach(function(t){var f=e[t];if(m.detectEvictedFragments(t,f),!i)for(var s=0;s<f.length;s++)h.appendedPTS=Math.max(f.end(s),h.appendedPTS||0)})},g.onFragBuffered=function(T,x){this.detectPartialFragments(x)},g.hasFragment=function(T){var x=R(T);return!!this.fragments[x]},g.removeFragmentsInRange=function(T,x,m){var h=this;Object.keys(this.fragments).forEach(function(i){var e=h.fragments[i];if(!!e&&e.buffered){var r=e.body;r.type===m&&r.start<x&&r.end>T&&h.removeFragment(r)}})},g.removeFragment=function(T){var x=R(T);T.stats.loaded=0,T.clearElementaryStreamInfo(),delete this.fragments[x]},g.removeAllFragments=function(){this.fragments=Object.create(null),this.activeFragment=null,this.activeParts=null},L}();function D(L){var g,S;return L.buffered&&(((g=L.range.video)===null||g===void 0?void 0:g.partial)||((S=L.range.audio)===null||S===void 0?void 0:S.partial))}function R(L){return L.type+"_"+L.level+"_"+L.urlId+"_"+L.sn}},"./src/controller/gap-controller.ts":function(K,P,p){p.r(P),p.d(P,"STALL_MINIMUM_DURATION_MS",function(){return D}),p.d(P,"MAX_START_GAP_JUMP",function(){return R}),p.d(P,"SKIP_BUFFER_HOLE_STEP_SECONDS",function(){return L}),p.d(P,"SKIP_BUFFER_RANGE_START",function(){return g}),p.d(P,"default",function(){return S});var M=p("./src/utils/buffer-helper.ts"),O=p("./src/errors.ts"),A=p("./src/events.ts"),F=p("./src/utils/logger.ts"),D=250,R=2,L=.1,g=.05,S=function(){function T(m,h,i,e){this.config=void 0,this.media=void 0,this.fragmentTracker=void 0,this.hls=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.config=m,this.media=h,this.fragmentTracker=i,this.hls=e}var x=T.prototype;return x.destroy=function(){this.hls=this.fragmentTracker=this.media=null},x.poll=function(h){var i=this.config,e=this.media,r=this.stalled,t=e.currentTime,f=e.seeking,s=this.seeking&&!f,n=!this.seeking&&f;if(this.seeking=f,t!==h){if(this.moved=!0,r!==null){if(this.stallReported){var o=self.performance.now()-r;F.logger.warn("playback not stuck anymore @"+t+", after "+Math.round(o)+"ms"),this.stallReported=!1}this.stalled=null,this.nudgeRetry=0}return}if((n||s)&&(this.stalled=null),!(e.paused||e.ended||e.playbackRate===0||!M.BufferHelper.getBuffered(e).length)){var c=M.BufferHelper.bufferInfo(e,t,0),v=c.len>0,u=c.nextStart||0;if(!(!v&&!u)){if(f){var a=c.len>R,l=!u||u-t>R&&!this.fragmentTracker.getPartialFragment(t);if(a||l)return;this.moved=!1}if(!this.moved&&this.stalled!==null){var d,E=Math.max(u,c.start||0)-t,y=this.hls.levels?this.hls.levels[this.hls.currentLevel]:null,I=y==null||(d=y.details)===null||d===void 0?void 0:d.live,C=I?y.details.targetduration*2:R;if(E>0&&E<=C){this._trySkipBufferHole(null);return}}var _=self.performance.now();if(r===null){this.stalled=_;return}var B=_-r;!f&&B>=D&&this._reportStall(c.len);var U=M.BufferHelper.bufferInfo(e,t,i.maxBufferHole);this._tryFixBufferStall(U,B)}}},x._tryFixBufferStall=function(h,i){var e=this.config,r=this.fragmentTracker,t=this.media,f=t.currentTime,s=r.getPartialFragment(f);if(s){var n=this._trySkipBufferHole(s);if(n)return}h.len>e.maxBufferHole&&i>e.highBufferWatchdogPeriod*1e3&&(F.logger.warn("Trying to nudge playhead over buffer-hole"),this.stalled=null,this._tryNudgeBuffer())},x._reportStall=function(h){var i=this.hls,e=this.media,r=this.stallReported;r||(this.stallReported=!0,F.logger.warn("Playback stalling at @"+e.currentTime+" due to low buffer (buffer="+h+")"),i.trigger(A.Events.ERROR,{type:O.ErrorTypes.MEDIA_ERROR,details:O.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!1,buffer:h}))},x._trySkipBufferHole=function(h){for(var i=this.config,e=this.hls,r=this.media,t=r.currentTime,f=0,s=M.BufferHelper.getBuffered(r),n=0;n<s.length;n++){var o=s.start(n);if(t+i.maxBufferHole>=f&&t<o){var c=Math.max(o+g,r.currentTime+L);return F.logger.warn("skipping hole, adjusting currentTime from "+t+" to "+c),this.moved=!0,this.stalled=null,r.currentTime=c,h&&e.trigger(A.Events.ERROR,{type:O.ErrorTypes.MEDIA_ERROR,details:O.ErrorDetails.BUFFER_SEEK_OVER_HOLE,fatal:!1,reason:"fragment loaded with buffer holes, seeking from "+t+" to "+c,frag:h}),c}f=s.end(n)}return 0},x._tryNudgeBuffer=function(){var h=this.config,i=this.hls,e=this.media,r=e.currentTime,t=(this.nudgeRetry||0)+1;if(this.nudgeRetry=t,t<h.nudgeMaxRetry){var f=r+t*h.nudgeOffset;F.logger.warn("Nudging 'currentTime' from "+r+" to "+f),e.currentTime=f,i.trigger(A.Events.ERROR,{type:O.ErrorTypes.MEDIA_ERROR,details:O.ErrorDetails.BUFFER_NUDGE_ON_STALL,fatal:!1})}else F.logger.error("Playhead still not moving while enough data buffered @"+r+" after "+h.nudgeMaxRetry+" nudges"),i.trigger(A.Events.ERROR,{type:O.ErrorTypes.MEDIA_ERROR,details:O.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!0})},T}()},"./src/controller/id3-track-controller.ts":function(K,P,p){p.r(P);var M=p("./src/events.ts"),O=p("./src/utils/texttrack-utils.ts"),A=p("./src/demux/id3.ts"),F=.25,D=function(){function R(g){this.hls=void 0,this.id3Track=null,this.media=null,this.hls=g,this._registerListeners()}var L=R.prototype;return L.destroy=function(){this._unregisterListeners()},L._registerListeners=function(){var S=this.hls;S.on(M.Events.MEDIA_ATTACHED,this.onMediaAttached,this),S.on(M.Events.MEDIA_DETACHING,this.onMediaDetaching,this),S.on(M.Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),S.on(M.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},L._unregisterListeners=function(){var S=this.hls;S.off(M.Events.MEDIA_ATTACHED,this.onMediaAttached,this),S.off(M.Events.MEDIA_DETACHING,this.onMediaDetaching,this),S.off(M.Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),S.off(M.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},L.onMediaAttached=function(S,T){this.media=T.media},L.onMediaDetaching=function(){!this.id3Track||(Object(O.clearCurrentCues)(this.id3Track),this.id3Track=null,this.media=null)},L.getID3Track=function(S){if(!!this.media){for(var T=0;T<S.length;T++){var x=S[T];if(x.kind==="metadata"&&x.label==="id3")return Object(O.sendAddTrackEvent)(x,this.media),x}return this.media.addTextTrack("metadata","id3")}},L.onFragParsingMetadata=function(S,T){if(!!this.media){var x=T.frag,m=T.samples;this.id3Track||(this.id3Track=this.getID3Track(this.media.textTracks),this.id3Track.mode="hidden");for(var h=self.WebKitDataCue||self.VTTCue||self.TextTrackCue,i=0;i<m.length;i++){var e=A.getID3Frames(m[i].data);if(e){var r=m[i].pts,t=i<m.length-1?m[i+1].pts:x.end,f=t-r;f<=0&&(t=r+F);for(var s=0;s<e.length;s++){var n=e[s];if(!A.isTimeStampFrame(n)){var o=new h(r,t,"");o.value=n,this.id3Track.addCue(o)}}}}}},L.onBufferFlushing=function(S,T){var x=T.startOffset,m=T.endOffset,h=T.type;if(!h||h==="audio"){var i=this.id3Track;i&&Object(O.removeCuesInRange)(i,x,m)}},R}();P.default=D},"./src/controller/latency-controller.ts":function(K,P,p){p.r(P),p.d(P,"default",function(){return R});var M=p("./src/errors.ts"),O=p("./src/events.ts"),A=p("./src/utils/logger.ts");function F(L,g){for(var S=0;S<g.length;S++){var T=g[S];T.enumerable=T.enumerable||!1,T.configurable=!0,"value"in T&&(T.writable=!0),Object.defineProperty(L,T.key,T)}}function D(L,g,S){return g&&F(L.prototype,g),S&&F(L,S),L}var R=function(){function L(S){var T=this;this.hls=void 0,this.config=void 0,this.media=null,this.levelDetails=null,this.currentTime=0,this.stallCount=0,this._latency=null,this.timeupdateHandler=function(){return T.timeupdate()},this.hls=S,this.config=S.config,this.registerListeners()}var g=L.prototype;return g.destroy=function(){this.unregisterListeners(),this.onMediaDetaching(),this.levelDetails=null,this.hls=this.timeupdateHandler=null},g.registerListeners=function(){this.hls.on(O.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(O.Events.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.on(O.Events.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(O.Events.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.on(O.Events.ERROR,this.onError,this)},g.unregisterListeners=function(){this.hls.off(O.Events.MEDIA_ATTACHED,this.onMediaAttached),this.hls.off(O.Events.MEDIA_DETACHING,this.onMediaDetaching),this.hls.off(O.Events.MANIFEST_LOADING,this.onManifestLoading),this.hls.off(O.Events.LEVEL_UPDATED,this.onLevelUpdated),this.hls.off(O.Events.ERROR,this.onError)},g.onMediaAttached=function(T,x){this.media=x.media,this.media.addEventListener("timeupdate",this.timeupdateHandler)},g.onMediaDetaching=function(){this.media&&(this.media.removeEventListener("timeupdate",this.timeupdateHandler),this.media=null)},g.onManifestLoading=function(){this.levelDetails=null,this._latency=null,this.stallCount=0},g.onLevelUpdated=function(T,x){var m=x.details;this.levelDetails=m,m.advanced&&this.timeupdate(),!m.live&&this.media&&this.media.removeEventListener("timeupdate",this.timeupdateHandler)},g.onError=function(T,x){x.details===M.ErrorDetails.BUFFER_STALLED_ERROR&&(this.stallCount++,A.logger.warn("[playback-rate-controller]: Stall detected, adjusting target latency"))},g.timeupdate=function(){var T=this.media,x=this.levelDetails;if(!(!T||!x)){this.currentTime=T.currentTime;var m=this.computeLatency();if(m!==null){this._latency=m;var h=this.config,i=h.lowLatencyMode,e=h.maxLiveSyncPlaybackRate;if(!(!i||e===1)){var r=this.targetLatency;if(r!==null){var t=m-r,f=Math.min(this.maxLatency,r+x.targetduration),s=t<f;if(x.live&&s&&t>.05&&this.forwardBufferLength>1){var n=Math.min(2,Math.max(1,e)),o=Math.round(2/(1+Math.exp(-.75*t-this.edgeStalled))*20)/20;T.playbackRate=Math.min(n,Math.max(1,o))}else T.playbackRate!==1&&T.playbackRate!==0&&(T.playbackRate=1)}}}}},g.estimateLiveEdge=function(){var T=this.levelDetails;return T===null?null:T.edge+T.age},g.computeLatency=function(){var T=this.estimateLiveEdge();return T===null?null:T-this.currentTime},D(L,[{key:"latency",get:function(){return this._latency||0}},{key:"maxLatency",get:function(){var T=this.config,x=this.levelDetails;return T.liveMaxLatencyDuration!==void 0?T.liveMaxLatencyDuration:x?T.liveMaxLatencyDurationCount*x.targetduration:0}},{key:"targetLatency",get:function(){var T=this.levelDetails;if(T===null)return null;var x=T.holdBack,m=T.partHoldBack,h=T.targetduration,i=this.config,e=i.liveSyncDuration,r=i.liveSyncDurationCount,t=i.lowLatencyMode,f=this.hls.userConfig,s=t&&m||x;(f.liveSyncDuration||f.liveSyncDurationCount||s===0)&&(s=e!==void 0?e:r*h);var n=h,o=1;return s+Math.min(this.stallCount*o,n)}},{key:"liveSyncPosition",get:function(){var T=this.estimateLiveEdge(),x=this.targetLatency,m=this.levelDetails;if(T===null||x===null||m===null)return null;var h=m.edge,i=T-x-this.edgeStalled,e=h-m.totalduration,r=h-(this.config.lowLatencyMode&&m.partTarget||m.targetduration);return Math.min(Math.max(e,i),r)}},{key:"drift",get:function(){var T=this.levelDetails;return T===null?1:T.drift}},{key:"edgeStalled",get:function(){var T=this.levelDetails;if(T===null)return 0;var x=(this.config.lowLatencyMode&&T.partTarget||T.targetduration)*3;return Math.max(T.age-x,0)}},{key:"forwardBufferLength",get:function(){var T=this.media,x=this.levelDetails;if(!T||!x)return 0;var m=T.buffered.length;return m?T.buffered.end(m-1):x.edge-this.currentTime}}]),L}()},"./src/controller/level-controller.ts":function(K,P,p){p.r(P),p.d(P,"default",function(){return i});var M=p("./src/types/level.ts"),O=p("./src/events.ts"),A=p("./src/errors.ts"),F=p("./src/utils/codecs.ts"),D=p("./src/controller/level-helper.ts"),R=p("./src/controller/base-playlist-controller.ts"),L=p("./src/types/loader.ts");function g(){return g=Object.assign||function(e){for(var r=1;r<arguments.length;r++){var t=arguments[r];for(var f in t)Object.prototype.hasOwnProperty.call(t,f)&&(e[f]=t[f])}return e},g.apply(this,arguments)}function S(e,r){for(var t=0;t<r.length;t++){var f=r[t];f.enumerable=f.enumerable||!1,f.configurable=!0,"value"in f&&(f.writable=!0),Object.defineProperty(e,f.key,f)}}function T(e,r,t){return r&&S(e.prototype,r),t&&S(e,t),e}function x(e,r){e.prototype=Object.create(r.prototype),e.prototype.constructor=e,m(e,r)}function m(e,r){return m=Object.setPrototypeOf||function(f,s){return f.__proto__=s,f},m(e,r)}var h=/chrome|firefox/.test(navigator.userAgent.toLowerCase()),i=function(e){x(r,e);function r(f){var s;return s=e.call(this,f,"[level-controller]")||this,s._levels=[],s._firstLevel=-1,s._startLevel=void 0,s.currentLevelIndex=-1,s.manualLevelIndex=-1,s.onParsedComplete=void 0,s._registerListeners(),s}var t=r.prototype;return t._registerListeners=function(){var s=this.hls;s.on(O.Events.MANIFEST_LOADED,this.onManifestLoaded,this),s.on(O.Events.LEVEL_LOADED,this.onLevelLoaded,this),s.on(O.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),s.on(O.Events.FRAG_LOADED,this.onFragLoaded,this),s.on(O.Events.ERROR,this.onError,this)},t._unregisterListeners=function(){var s=this.hls;s.off(O.Events.MANIFEST_LOADED,this.onManifestLoaded,this),s.off(O.Events.LEVEL_LOADED,this.onLevelLoaded,this),s.off(O.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),s.off(O.Events.FRAG_LOADED,this.onFragLoaded,this),s.off(O.Events.ERROR,this.onError,this)},t.destroy=function(){this._unregisterListeners(),this.manualLevelIndex=-1,this._levels.length=0,e.prototype.destroy.call(this)},t.startLoad=function(){var s=this._levels;s.forEach(function(n){n.loadError=0}),e.prototype.startLoad.call(this)},t.onManifestLoaded=function(s,n){var o=[],c=[],v=[],u,a={},l,d=!1,E=!1,y=!1;if(n.levels.forEach(function(B){var U=B.attrs;d=d||!!(B.width&&B.height),E=E||!!B.videoCodec,y=y||!!B.audioCodec,h&&B.audioCodec&&B.audioCodec.indexOf("mp4a.40.34")!==-1&&(B.audioCodec=void 0);var N=B.bitrate+"-"+B.attrs.RESOLUTION+"-"+B.attrs.CODECS;l=a[N],l?l.url.push(B.url):(l=new M.Level(B),a[N]=l,o.push(l)),U&&(U.AUDIO&&Object(D.addGroupId)(l,"audio",U.AUDIO),U.SUBTITLES&&Object(D.addGroupId)(l,"text",U.SUBTITLES))}),(d||E)&&y&&(o=o.filter(function(B){var U=B.videoCodec,N=B.width,k=B.height;return!!U||!!(N&&k)})),o=o.filter(function(B){var U=B.audioCodec,N=B.videoCodec;return(!U||Object(F.isCodecSupportedInMp4)(U,"audio"))&&(!N||Object(F.isCodecSupportedInMp4)(N,"video"))}),n.audioTracks&&(c=n.audioTracks.filter(function(B){return!B.audioCodec||Object(F.isCodecSupportedInMp4)(B.audioCodec,"audio")}),Object(D.assignTrackIdsByGroup)(c)),n.subtitles&&(v=n.subtitles,Object(D.assignTrackIdsByGroup)(v)),o.length>0){u=o[0].bitrate,o.sort(function(B,U){return B.bitrate-U.bitrate}),this._levels=o;for(var I=0;I<o.length;I++)if(o[I].bitrate===u){this._firstLevel=I,this.log("manifest loaded, "+o.length+" level(s) found, first bitrate: "+u);break}var C=y&&!E,_={levels:o,audioTracks:c,subtitleTracks:v,firstLevel:this._firstLevel,stats:n.stats,audio:y,video:E,altAudio:!C&&c.some(function(B){return!!B.url})};this.hls.trigger(O.Events.MANIFEST_PARSED,_),(this.hls.config.autoStartLoad||this.hls.forceStartLoad)&&this.hls.startLoad(this.hls.config.startPosition)}else this.hls.trigger(O.Events.ERROR,{type:A.ErrorTypes.MEDIA_ERROR,details:A.ErrorDetails.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:n.url,reason:"no level with compatible codecs found in manifest"})},t.onError=function(s,n){if(e.prototype.onError.call(this,s,n),!n.fatal){var o=n.context,c=this._levels[this.currentLevelIndex];if(o&&(o.type===L.PlaylistContextType.AUDIO_TRACK&&c.audioGroupIds&&o.groupId===c.audioGroupIds[c.urlId]||o.type===L.PlaylistContextType.SUBTITLE_TRACK&&c.textGroupIds&&o.groupId===c.textGroupIds[c.urlId])){this.redundantFailover(this.currentLevelIndex);return}var v=!1,u=!0,a;switch(n.details){case A.ErrorDetails.FRAG_LOAD_ERROR:case A.ErrorDetails.FRAG_LOAD_TIMEOUT:case A.ErrorDetails.KEY_LOAD_ERROR:case A.ErrorDetails.KEY_LOAD_TIMEOUT:if(n.frag){var l=this._levels[n.frag.level];l?(l.fragmentError++,l.fragmentError>this.hls.config.fragLoadingMaxRetry&&(a=n.frag.level)):a=n.frag.level}break;case A.ErrorDetails.LEVEL_LOAD_ERROR:case A.ErrorDetails.LEVEL_LOAD_TIMEOUT:o&&(o.deliveryDirectives&&(u=!1),a=o.level),v=!0;break;case A.ErrorDetails.REMUX_ALLOC_ERROR:a=n.level,v=!0;break}a!==void 0&&this.recoverLevel(n,a,v,u)}},t.recoverLevel=function(s,n,o,c){var v=s.details,u=this._levels[n];if(u.loadError++,o){var a=this.retryLoadingOrFail(s);if(a)s.levelRetry=!0;else{this.currentLevelIndex=-1;return}}if(c){var l=u.url.length;if(l>1&&u.loadError<l)s.levelRetry=!0,this.redundantFailover(n);else if(this.manualLevelIndex===-1){var d=n===0?this._levels.length-1:n-1;this.currentLevelIndex!==d&&this._levels[d].loadError===0&&(this.warn(v+": switch to "+d),s.levelRetry=!0,this.hls.nextAutoLevel=d)}}},t.redundantFailover=function(s){var n=this._levels[s],o=n.url.length;if(o>1){var c=(n.urlId+1)%o;this.warn("Switching to redundant URL-id "+c),this._levels.forEach(function(v){v.urlId=c}),this.level=s}},t.onFragLoaded=function(s,n){var o=n.frag;if(o!==void 0&&o.type===L.PlaylistLevelType.MAIN){var c=this._levels[o.level];c!==void 0&&(c.fragmentError=0,c.loadError=0)}},t.onLevelLoaded=function(s,n){var o,c=n.level,v=n.details,u=this._levels[c];if(!u){var a;this.warn("Invalid level index "+c),(a=n.deliveryDirectives)!==null&&a!==void 0&&a.skip&&(v.deltaUpdateFailed=!0);return}c===this.currentLevelIndex?(u.fragmentError===0&&(u.loadError=0,this.retryCount=0),this.playlistLoaded(c,n,u.details)):(o=n.deliveryDirectives)!==null&&o!==void 0&&o.skip&&(v.deltaUpdateFailed=!0)},t.onAudioTrackSwitched=function(s,n){var o=this.hls.levels[this.currentLevelIndex];if(!!o&&o.audioGroupIds){for(var c=-1,v=this.hls.audioTracks[n.id].groupId,u=0;u<o.audioGroupIds.length;u++)if(o.audioGroupIds[u]===v){c=u;break}c!==o.urlId&&(o.urlId=c,this.startLoad())}},t.loadPlaylist=function(s){var n=this.currentLevelIndex,o=this._levels[n];if(this.canLoad&&o&&o.url.length>0){var c=o.urlId,v=o.url[c];if(s)try{v=s.addDirectives(v)}catch(u){this.warn("Could not construct new URL with HLS Delivery Directives: "+u)}this.log("Attempt loading level index "+n+(s?" at sn "+s.msn+" part "+s.part:"")+" with URL-id "+c+" "+v),this.clearTimer(),this.hls.trigger(O.Events.LEVEL_LOADING,{url:v,level:n,id:c,deliveryDirectives:s||null})}},t.removeLevel=function(s,n){var o=function(u,a){return a!==n},c=this._levels.filter(function(v,u){return u!==s?!0:v.url.length>1&&n!==void 0?(v.url=v.url.filter(o),v.audioGroupIds&&(v.audioGroupIds=v.audioGroupIds.filter(o)),v.textGroupIds&&(v.textGroupIds=v.textGroupIds.filter(o)),v.urlId=0,!0):!1}).map(function(v,u){var a=v.details;return a!=null&&a.fragments&&a.fragments.forEach(function(l){l.level=u}),v});this._levels=c,this.hls.trigger(O.Events.LEVELS_UPDATED,{levels:c})},T(r,[{key:"levels",get:function(){return this._levels.length===0?null:this._levels}},{key:"level",get:function(){return this.currentLevelIndex},set:function(s){var n,o=this._levels;if(o.length!==0&&!(this.currentLevelIndex===s&&(n=o[s])!==null&&n!==void 0&&n.details)){if(s<0||s>=o.length){var c=s<0;if(this.hls.trigger(O.Events.ERROR,{type:A.ErrorTypes.OTHER_ERROR,details:A.ErrorDetails.LEVEL_SWITCH_ERROR,level:s,fatal:c,reason:"invalid level idx"}),c)return;s=Math.min(s,o.length-1)}this.clearTimer();var v=this.currentLevelIndex,u=o[v],a=o[s];this.log("switching to level "+s+" from "+v),this.currentLevelIndex=s;var l=g({},a,{level:s,maxBitrate:a.maxBitrate,uri:a.uri,urlId:a.urlId});delete l._urlId,this.hls.trigger(O.Events.LEVEL_SWITCHING,l);var d=a.details;if(!d||d.live){var E=this.switchParams(a.uri,u==null?void 0:u.details);this.loadPlaylist(E)}}}},{key:"manualLevel",get:function(){return this.manualLevelIndex},set:function(s){this.manualLevelIndex=s,this._startLevel===void 0&&(this._startLevel=s),s!==-1&&(this.level=s)}},{key:"firstLevel",get:function(){return this._firstLevel},set:function(s){this._firstLevel=s}},{key:"startLevel",get:function(){if(this._startLevel===void 0){var s=this.hls.config.startLevel;return s!==void 0?s:this._firstLevel}else return this._startLevel},set:function(s){this._startLevel=s}},{key:"nextLoadLevel",get:function(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel},set:function(s){this.level=s,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=s)}}]),r}(R.default)},"./src/controller/level-helper.ts":function(K,P,p){p.r(P),p.d(P,"addGroupId",function(){return A}),p.d(P,"assignTrackIdsByGroup",function(){return F}),p.d(P,"updatePTS",function(){return D}),p.d(P,"updateFragPTSDTS",function(){return L}),p.d(P,"mergeDetails",function(){return g}),p.d(P,"mapPartIntersection",function(){return S}),p.d(P,"mapFragmentIntersection",function(){return T}),p.d(P,"adjustSliding",function(){return x}),p.d(P,"addSliding",function(){return m}),p.d(P,"computeReloadInterval",function(){return h}),p.d(P,"getFragmentWithSN",function(){return i}),p.d(P,"getPartWith",function(){return e});var M=p("./src/polyfills/number.ts"),O=p("./src/utils/logger.ts");function A(r,t,f){switch(t){case"audio":r.audioGroupIds||(r.audioGroupIds=[]),r.audioGroupIds.push(f);break;case"text":r.textGroupIds||(r.textGroupIds=[]),r.textGroupIds.push(f);break}}function F(r){var t={};r.forEach(function(f){var s=f.groupId||"";f.id=t[s]=t[s]||0,t[s]++})}function D(r,t,f){var s=r[t],n=r[f];R(s,n)}function R(r,t){var f=t.startPTS;if(Object(M.isFiniteNumber)(f)){var s=0,n;t.sn>r.sn?(s=f-r.start,n=r):(s=r.start-f,n=t),n.duration!==s&&(n.duration=s)}else if(t.sn>r.sn){var o=r.cc===t.cc;o&&r.minEndPTS?t.start=r.start+(r.minEndPTS-r.start):t.start=r.start+r.duration}else t.start=Math.max(r.start-t.duration,0)}function L(r,t,f,s,n,o){var c=s-f;c<=0&&(O.logger.warn("Fragment should have a positive duration",t),s=f+t.duration,o=n+t.duration);var v=f,u=s,a=t.startPTS,l=t.endPTS;if(Object(M.isFiniteNumber)(a)){var d=Math.abs(a-f);Object(M.isFiniteNumber)(t.deltaPTS)?t.deltaPTS=Math.max(d,t.deltaPTS):t.deltaPTS=d,v=Math.max(f,a),f=Math.min(f,a),n=Math.min(n,t.startDTS),u=Math.min(s,l),s=Math.max(s,l),o=Math.max(o,t.endDTS)}t.duration=s-f;var E=f-t.start;t.appendedPTS=s,t.start=t.startPTS=f,t.maxStartPTS=v,t.startDTS=n,t.endPTS=s,t.minEndPTS=u,t.endDTS=o;var y=t.sn;if(!r||y<r.startSN||y>r.endSN)return 0;var I,C=y-r.startSN,_=r.fragments;for(_[C]=t,I=C;I>0;I--)R(_[I],_[I-1]);for(I=C;I<_.length-1;I++)R(_[I],_[I+1]);return r.fragmentHint&&R(_[_.length-1],r.fragmentHint),r.PTSKnown=r.alignedSliding=!0,E}function g(r,t){for(var f=null,s=r.fragments,n=s.length-1;n>=0;n--){var o=s[n].initSegment;if(o){f=o;break}}r.fragmentHint&&delete r.fragmentHint.endPTS;var c=0,v;if(T(r,t,function(y,I){var C;y.relurl&&(c=y.cc-I.cc),Object(M.isFiniteNumber)(y.startPTS)&&Object(M.isFiniteNumber)(y.endPTS)&&(I.start=I.startPTS=y.startPTS,I.startDTS=y.startDTS,I.appendedPTS=y.appendedPTS,I.maxStartPTS=y.maxStartPTS,I.endPTS=y.endPTS,I.endDTS=y.endDTS,I.minEndPTS=y.minEndPTS,I.duration=y.endPTS-y.startPTS,I.duration&&(v=I),t.PTSKnown=t.alignedSliding=!0),I.elementaryStreams=y.elementaryStreams,I.loader=y.loader,I.stats=y.stats,I.urlId=y.urlId,y.initSegment?(I.initSegment=y.initSegment,f=y.initSegment):(!I.initSegment||I.initSegment.relurl==((C=f)===null||C===void 0?void 0:C.relurl))&&(I.initSegment=f)}),t.skippedSegments&&(t.deltaUpdateFailed=t.fragments.some(function(y){return!y}),t.deltaUpdateFailed)){O.logger.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(var u=t.skippedSegments;u--;)t.fragments.shift();t.startSN=t.fragments[0].sn,t.startCC=t.fragments[0].cc}var a=t.fragments;if(c){O.logger.warn("discontinuity sliding from playlist, take drift into account");for(var l=0;l<a.length;l++)a[l].cc+=c}t.skippedSegments&&(t.startCC=t.fragments[0].cc),S(r.partList,t.partList,function(y,I){I.elementaryStreams=y.elementaryStreams,I.stats=y.stats}),v?L(t,v,v.startPTS,v.endPTS,v.startDTS,v.endDTS):x(r,t),a.length&&(t.totalduration=t.edge-a[0].start),t.driftStartTime=r.driftStartTime,t.driftStart=r.driftStart;var d=t.advancedDateTime;if(t.advanced&&d){var E=t.edge;t.driftStart||(t.driftStartTime=d,t.driftStart=E),t.driftEndTime=d,t.driftEnd=E}else t.driftEndTime=r.driftEndTime,t.driftEnd=r.driftEnd,t.advancedDateTime=r.advancedDateTime}function S(r,t,f){if(r&&t)for(var s=0,n=0,o=r.length;n<=o;n++){var c=r[n],v=t[n+s];c&&v&&c.index===v.index&&c.fragment.sn===v.fragment.sn?f(c,v):s--}}function T(r,t,f){for(var s=t.skippedSegments,n=Math.max(r.startSN,t.startSN)-t.startSN,o=(r.fragmentHint?1:0)+(s?t.endSN:Math.min(r.endSN,t.endSN))-t.startSN,c=t.startSN-r.startSN,v=t.fragmentHint?t.fragments.concat(t.fragmentHint):t.fragments,u=r.fragmentHint?r.fragments.concat(r.fragmentHint):r.fragments,a=n;a<=o;a++){var l=u[c+a],d=v[a];s&&!d&&a<s&&(d=t.fragments[a]=l),l&&d&&f(l,d)}}function x(r,t){var f=t.startSN+t.skippedSegments-r.startSN,s=r.fragments;f<0||f>=s.length||m(t,s[f].start)}function m(r,t){if(t){for(var f=r.fragments,s=r.skippedSegments;s<f.length;s++)f[s].start+=t;r.fragmentHint&&(r.fragmentHint.start+=t)}}function h(r,t){var f=1e3*r.levelTargetDuration,s=f/2,n=r.age,o=n>0&&n<f*3,c=t.loading.end-t.loading.start,v,u=r.availabilityDelay;if(r.updated===!1)if(o){var a=333*r.misses;v=Math.max(Math.min(s,c*2),a),r.availabilityDelay=(r.availabilityDelay||0)+v}else v=s;else o?(u=Math.min(u||f/2,n),r.availabilityDelay=u,v=u+f-n):v=f-c;return Math.round(v)}function i(r,t,f){if(!r||!r.details)return null;var s=r.details,n=s.fragments[t-s.startSN];return n||(n=s.fragmentHint,n&&n.sn===t)?n:t<s.startSN&&f&&f.sn===t?f:null}function e(r,t,f){if(!r||!r.details)return null;var s=r.details.partList;if(s)for(var n=s.length;n--;){var o=s[n];if(o.index===f&&o.fragment.sn===t)return o}return null}},"./src/controller/stream-controller.ts":function(K,P,p){p.r(P),p.d(P,"default",function(){return s});var M=p("./src/polyfills/number.ts"),O=p("./src/controller/base-stream-controller.ts"),A=p("./src/is-supported.ts"),F=p("./src/events.ts"),D=p("./src/utils/buffer-helper.ts"),R=p("./src/controller/fragment-tracker.ts"),L=p("./src/types/loader.ts"),g=p("./src/loader/fragment.ts"),S=p("./src/demux/transmuxer-interface.ts"),T=p("./src/types/transmuxer.ts"),x=p("./src/controller/gap-controller.ts"),m=p("./src/errors.ts"),h=p("./src/utils/logger.ts");function i(n,o){for(var c=0;c<o.length;c++){var v=o[c];v.enumerable=v.enumerable||!1,v.configurable=!0,"value"in v&&(v.writable=!0),Object.defineProperty(n,v.key,v)}}function e(n,o,c){return o&&i(n.prototype,o),c&&i(n,c),n}function r(n,o){n.prototype=Object.create(o.prototype),n.prototype.constructor=n,t(n,o)}function t(n,o){return t=Object.setPrototypeOf||function(v,u){return v.__proto__=u,v},t(n,o)}var f=100,s=function(n){r(o,n);function o(v,u){var a;return a=n.call(this,v,u,"[stream-controller]")||this,a.audioCodecSwap=!1,a.gapController=null,a.level=-1,a._forceStartLoad=!1,a.altAudio=!1,a.audioOnly=!1,a.fragPlaying=null,a.onvplaying=null,a.onvseeked=null,a.fragLastKbps=0,a.stalled=!1,a.couldBacktrack=!1,a.audioCodecSwitch=!1,a.videoBuffer=null,a._registerListeners(),a}var c=o.prototype;return c._registerListeners=function(){var u=this.hls;u.on(F.Events.MEDIA_ATTACHED,this.onMediaAttached,this),u.on(F.Events.MEDIA_DETACHING,this.onMediaDetaching,this),u.on(F.Events.MANIFEST_LOADING,this.onManifestLoading,this),u.on(F.Events.MANIFEST_PARSED,this.onManifestParsed,this),u.on(F.Events.LEVEL_LOADING,this.onLevelLoading,this),u.on(F.Events.LEVEL_LOADED,this.onLevelLoaded,this),u.on(F.Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),u.on(F.Events.ERROR,this.onError,this),u.on(F.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),u.on(F.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),u.on(F.Events.BUFFER_CREATED,this.onBufferCreated,this),u.on(F.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),u.on(F.Events.LEVELS_UPDATED,this.onLevelsUpdated,this),u.on(F.Events.FRAG_BUFFERED,this.onFragBuffered,this)},c._unregisterListeners=function(){var u=this.hls;u.off(F.Events.MEDIA_ATTACHED,this.onMediaAttached,this),u.off(F.Events.MEDIA_DETACHING,this.onMediaDetaching,this),u.off(F.Events.MANIFEST_LOADING,this.onManifestLoading,this),u.off(F.Events.MANIFEST_PARSED,this.onManifestParsed,this),u.off(F.Events.LEVEL_LOADED,this.onLevelLoaded,this),u.off(F.Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),u.off(F.Events.ERROR,this.onError,this),u.off(F.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),u.off(F.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),u.off(F.Events.BUFFER_CREATED,this.onBufferCreated,this),u.off(F.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),u.off(F.Events.LEVELS_UPDATED,this.onLevelsUpdated,this),u.off(F.Events.FRAG_BUFFERED,this.onFragBuffered,this)},c.onHandlerDestroying=function(){this._unregisterListeners(),this.onMediaDetaching()},c.startLoad=function(u){if(this.levels){var a=this.lastCurrentTime,l=this.hls;if(this.stopLoad(),this.setInterval(f),this.level=-1,this.fragLoadError=0,!this.startFragRequested){var d=l.startLevel;d===-1&&(l.config.testBandwidth?(d=0,this.bitrateTest=!0):d=l.nextAutoLevel),this.level=l.nextLoadLevel=d,this.loadedmetadata=!1}a>0&&u===-1&&(this.log("Override startPosition with lastCurrentTime @"+a.toFixed(3)),u=a),this.state=O.State.IDLE,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=u,this.tick()}else this._forceStartLoad=!0,this.state=O.State.STOPPED},c.stopLoad=function(){this._forceStartLoad=!1,n.prototype.stopLoad.call(this)},c.doTick=function(){switch(this.state){case O.State.IDLE:this.doTickIdle();break;case O.State.WAITING_LEVEL:{var u,a=this.levels,l=this.level,d=a==null||(u=a[l])===null||u===void 0?void 0:u.details;if(d&&(!d.live||this.levelLastLoaded===this.level)){if(this.waitForCdnTuneIn(d))break;this.state=O.State.IDLE;break}break}case O.State.FRAG_LOADING_WAITING_RETRY:{var E,y=self.performance.now(),I=this.retryDate;(!I||y>=I||(E=this.media)!==null&&E!==void 0&&E.seeking)&&(this.log("retryDate reached, switch back to IDLE state"),this.state=O.State.IDLE)}break}this.onTickEnd()},c.onTickEnd=function(){n.prototype.onTickEnd.call(this),this.checkBuffer(),this.checkFragmentChanged()},c.doTickIdle=function(){var u,a,l=this.hls,d=this.levelLastLoaded,E=this.levels,y=this.media,I=l.config,C=l.nextLoadLevel;if(!(d===null||!y&&(this.startFragRequested||!I.startFragPrefetch))&&!(this.altAudio&&this.audioOnly)&&!(!E||!E[C])){var _=E[C];this.level=l.nextLoadLevel=C;var B=_.details;if(!B||this.state===O.State.WAITING_LEVEL||B.live&&this.levelLastLoaded!==C){this.state=O.State.WAITING_LEVEL;return}var U=this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:y,L.PlaylistLevelType.MAIN);if(U!==null){var N=U.len,k=this.getMaxBufferLength(_.maxBitrate);if(!(N>=k)){if(this._streamEnded(U,B)){var w={};this.altAudio&&(w.type="video"),this.hls.trigger(F.Events.BUFFER_EOS,w),this.state=O.State.ENDED;return}var G=U.end,W=this.getNextFragment(G,B);if(this.couldBacktrack&&!this.fragPrevious&&W&&W.sn!=="initSegment"){var Y=W.sn-B.startSN;Y>1&&(W=B.fragments[Y-1],this.fragmentTracker.removeFragment(W))}if(W&&this.fragmentTracker.getState(W)===R.FragmentState.OK&&this.nextLoadPosition>G){var H=this.audioOnly&&!this.altAudio?g.ElementaryStreamTypes.AUDIO:g.ElementaryStreamTypes.VIDEO;this.afterBufferFlushed(y,H,L.PlaylistLevelType.MAIN),W=this.getNextFragment(this.nextLoadPosition,B)}!W||(W.initSegment&&!W.initSegment.data&&!this.bitrateTest&&(W=W.initSegment),((u=W.decryptdata)===null||u===void 0?void 0:u.keyFormat)==="identity"&&!((a=W.decryptdata)!==null&&a!==void 0&&a.key)?this.loadKey(W,B):this.loadFragment(W,B,G))}}}},c.loadFragment=function(u,a,l){var d,E=this.fragmentTracker.getState(u);if(this.fragCurrent=u,E===R.FragmentState.BACKTRACKED){var y=this.fragmentTracker.getBacktrackData(u);if(y){this._handleFragmentLoadProgress(y),this._handleFragmentLoadComplete(y);return}else E=R.FragmentState.NOT_LOADED}E===R.FragmentState.NOT_LOADED||E===R.FragmentState.PARTIAL?u.sn==="initSegment"?this._loadInitSegment(u):this.bitrateTest?(u.bitrateTest=!0,this.log("Fragment "+u.sn+" of level "+u.level+" is being downloaded to test bitrate and will not be buffered"),this._loadBitrateTestFrag(u)):(this.startFragRequested=!0,n.prototype.loadFragment.call(this,u,a,l)):E===R.FragmentState.APPENDING?this.reduceMaxBufferLength(u.duration)&&this.fragmentTracker.removeFragment(u):((d=this.media)===null||d===void 0?void 0:d.buffered.length)===0&&this.fragmentTracker.removeAllFragments()},c.getAppendedFrag=function(u){var a=this.fragmentTracker.getAppendedFrag(u,L.PlaylistLevelType.MAIN);return a&&"fragment"in a?a.fragment:a},c.getBufferedFrag=function(u){return this.fragmentTracker.getBufferedFrag(u,L.PlaylistLevelType.MAIN)},c.followingBufferedFrag=function(u){return u?this.getBufferedFrag(u.end+.5):null},c.immediateLevelSwitch=function(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)},c.nextLevelSwitch=function(){var u=this.levels,a=this.media;if(a!=null&&a.readyState){var l,d=this.getAppendedFrag(a.currentTime);if(d&&d.start>1&&this.flushMainBuffer(0,d.start-1),!a.paused&&u){var E=this.hls.nextLoadLevel,y=u[E],I=this.fragLastKbps;I&&this.fragCurrent?l=this.fragCurrent.duration*y.maxBitrate/(1e3*I)+1:l=0}else l=0;var C=this.getBufferedFrag(a.currentTime+l);if(C){var _=this.followingBufferedFrag(C);if(_){this.abortCurrentFrag();var B=_.maxStartPTS?_.maxStartPTS:_.start,U=_.duration,N=Math.max(C.end,B+Math.min(Math.max(U-this.config.maxFragLookUpTolerance,U*.5),U*.75));this.flushMainBuffer(N,Number.POSITIVE_INFINITY)}}}},c.abortCurrentFrag=function(){var u=this.fragCurrent;this.fragCurrent=null,u!=null&&u.loader&&u.loader.abort(),this.state===O.State.KEY_LOADING&&(this.state=O.State.IDLE),this.nextLoadPosition=this.getLoadPosition()},c.flushMainBuffer=function(u,a){n.prototype.flushMainBuffer.call(this,u,a,this.altAudio?"video":null)},c.onMediaAttached=function(u,a){n.prototype.onMediaAttached.call(this,u,a);var l=a.media;this.onvplaying=this.onMediaPlaying.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),l.addEventListener("playing",this.onvplaying),l.addEventListener("seeked",this.onvseeked),this.gapController=new x.default(this.config,l,this.fragmentTracker,this.hls)},c.onMediaDetaching=function(){var u=this.media;u&&(u.removeEventListener("playing",this.onvplaying),u.removeEventListener("seeked",this.onvseeked),this.onvplaying=this.onvseeked=null,this.videoBuffer=null),this.fragPlaying=null,this.gapController&&(this.gapController.destroy(),this.gapController=null),n.prototype.onMediaDetaching.call(this)},c.onMediaPlaying=function(){this.tick()},c.onMediaSeeked=function(){var u=this.media,a=u?u.currentTime:null;Object(M.isFiniteNumber)(a)&&this.log("Media seeked to "+a.toFixed(3)),this.tick()},c.onManifestLoading=function(){this.log("Trigger BUFFER_RESET"),this.hls.trigger(F.Events.BUFFER_RESET,void 0),this.fragmentTracker.removeAllFragments(),this.couldBacktrack=this.stalled=!1,this.startPosition=this.lastCurrentTime=0,this.fragPlaying=null},c.onManifestParsed=function(u,a){var l=!1,d=!1,E;a.levels.forEach(function(y){E=y.audioCodec,E&&(E.indexOf("mp4a.40.2")!==-1&&(l=!0),E.indexOf("mp4a.40.5")!==-1&&(d=!0))}),this.audioCodecSwitch=l&&d&&!Object(A.changeTypeSupported)(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=a.levels,this.startFragRequested=!1},c.onLevelLoading=function(u,a){var l=this.levels;if(!(!l||this.state!==O.State.IDLE)){var d=l[a.level];(!d.details||d.details.live&&this.levelLastLoaded!==a.level||this.waitForCdnTuneIn(d.details))&&(this.state=O.State.WAITING_LEVEL)}},c.onLevelLoaded=function(u,a){var l,d=this.levels,E=a.level,y=a.details,I=y.totalduration;if(!d){this.warn("Levels were reset while loading level "+E);return}this.log("Level "+E+" loaded ["+y.startSN+","+y.endSN+"], cc ["+y.startCC+", "+y.endCC+"] duration:"+I);var C=this.fragCurrent;C&&(this.state===O.State.FRAG_LOADING||this.state===O.State.FRAG_LOADING_WAITING_RETRY)&&C.level!==a.level&&C.loader&&(this.state=O.State.IDLE,C.loader.abort());var _=d[E],B=0;if(y.live||(l=_.details)!==null&&l!==void 0&&l.live){if(y.fragments[0]||(y.deltaUpdateFailed=!0),y.deltaUpdateFailed)return;B=this.alignPlaylists(y,_.details)}if(_.details=y,this.levelLastLoaded=E,this.hls.trigger(F.Events.LEVEL_UPDATED,{details:y,level:E}),this.state===O.State.WAITING_LEVEL){if(this.waitForCdnTuneIn(y))return;this.state=O.State.IDLE}this.startFragRequested?y.live&&this.synchronizeToLiveEdge(y):this.setStartPosition(y,B),this.tick()},c._handleFragmentLoadProgress=function(u){var a,l=u.frag,d=u.part,E=u.payload,y=this.levels;if(!y){this.warn("Levels were reset while fragment load was in progress. Fragment "+l.sn+" of level "+l.level+" will not be buffered");return}var I=y[l.level],C=I.details;if(!C){this.warn("Dropping fragment "+l.sn+" of level "+l.level+" after level details were reset");return}var _=I.videoCodec,B=C.PTSKnown||!C.live,U=(a=l.initSegment)===null||a===void 0?void 0:a.data,N=this._getAudioCodec(I),k=this.transmuxer=this.transmuxer||new S.default(this.hls,L.PlaylistLevelType.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),w=d?d.index:-1,G=w!==-1,W=new T.ChunkMetadata(l.level,l.sn,l.stats.chunkCount,E.byteLength,w,G),Y=this.initPTS[l.cc];k.push(E,U,N,_,l,d,C.totalduration,B,W,Y)},c.onAudioTrackSwitching=function(u,a){var l=this.altAudio,d=!!a.url,E=a.id;if(!d){if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;var y=this.fragCurrent;y!=null&&y.loader&&(this.log("Switching to main audio track, cancel main fragment load"),y.loader.abort()),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();var I=this.hls;l&&I.trigger(F.Events.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),I.trigger(F.Events.AUDIO_TRACK_SWITCHED,{id:E})}},c.onAudioTrackSwitched=function(u,a){var l=a.id,d=!!this.hls.audioTracks[l].url;if(d){var E=this.videoBuffer;E&&this.mediaBuffer!==E&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=E)}this.altAudio=d,this.tick()},c.onBufferCreated=function(u,a){var l=a.tracks,d,E,y=!1;for(var I in l){var C=l[I];if(C.id==="main"){if(E=I,d=C,I==="video"){var _=l[I];_&&(this.videoBuffer=_.buffer)}}else y=!0}y&&d?(this.log("Alternate track found, use "+E+".buffered to schedule main fragment loading"),this.mediaBuffer=d.buffer):this.mediaBuffer=this.media},c.onFragBuffered=function(u,a){var l=a.frag,d=a.part;if(!(l&&l.type!==L.PlaylistLevelType.MAIN)){if(this.fragContextChanged(l)){this.warn("Fragment "+l.sn+(d?" p: "+d.index:"")+" of level "+l.level+" finished buffering, but was aborted. state: "+this.state),this.state===O.State.PARSED&&(this.state=O.State.IDLE);return}var E=d?d.stats:l.stats;this.fragLastKbps=Math.round(8*E.total/(E.buffering.end-E.loading.first)),l.sn!=="initSegment"&&(this.fragPrevious=l),this.fragBufferedComplete(l,d)}},c.onError=function(u,a){switch(a.details){case m.ErrorDetails.FRAG_LOAD_ERROR:case m.ErrorDetails.FRAG_LOAD_TIMEOUT:case m.ErrorDetails.KEY_LOAD_ERROR:case m.ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(L.PlaylistLevelType.MAIN,a);break;case m.ErrorDetails.LEVEL_LOAD_ERROR:case m.ErrorDetails.LEVEL_LOAD_TIMEOUT:this.state!==O.State.ERROR&&(a.fatal?(this.warn(""+a.details),this.state=O.State.ERROR):!a.levelRetry&&this.state===O.State.WAITING_LEVEL&&(this.state=O.State.IDLE));break;case m.ErrorDetails.BUFFER_FULL_ERROR:if(a.parent==="main"&&(this.state===O.State.PARSING||this.state===O.State.PARSED)){var l=!0,d=this.getFwdBufferInfo(this.media,L.PlaylistLevelType.MAIN);d&&d.len>.5&&(l=!this.reduceMaxBufferLength(d.len)),l&&(this.warn("buffer full error also media.currentTime is not buffered, flush main"),this.immediateLevelSwitch()),this.resetLoadingState()}break}},c.checkBuffer=function(){var u=this.media,a=this.gapController;if(!(!u||!a||!u.readyState)){var l=D.BufferHelper.getBuffered(u);!this.loadedmetadata&&l.length?(this.loadedmetadata=!0,this.seekToStartPos()):a.poll(this.lastCurrentTime),this.lastCurrentTime=u.currentTime}},c.onFragLoadEmergencyAborted=function(){this.state=O.State.IDLE,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tickImmediate()},c.onBufferFlushed=function(u,a){var l=a.type;if(l!==g.ElementaryStreamTypes.AUDIO||this.audioOnly&&!this.altAudio){var d=(l===g.ElementaryStreamTypes.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;this.afterBufferFlushed(d,l,L.PlaylistLevelType.MAIN)}},c.onLevelsUpdated=function(u,a){this.levels=a.levels},c.swapAudioCodec=function(){this.audioCodecSwap=!this.audioCodecSwap},c.seekToStartPos=function(){var u=this.media,a=u.currentTime,l=this.startPosition;if(l>=0&&a<l){if(u.seeking){h.logger.log("could not seek to "+l+", already seeking at "+a);return}var d=D.BufferHelper.getBuffered(u),E=d.length?d.start(0):0,y=E-l;y>0&&(y<this.config.maxBufferHole||y<this.config.maxFragLookUpTolerance)&&(h.logger.log("adjusting start position by "+y+" to match buffer start"),l+=y,this.startPosition=l),this.log("seek to target start position "+l+" from current time "+a),u.currentTime=l}},c._getAudioCodec=function(u){var a=this.config.defaultAudioCodec||u.audioCodec;return this.audioCodecSwap&&a&&(this.log("Swapping audio codec"),a.indexOf("mp4a.40.5")!==-1?a="mp4a.40.2":a="mp4a.40.5"),a},c._loadBitrateTestFrag=function(u){var a=this;this._doFragLoad(u).then(function(l){var d=a.hls;if(!(!l||d.nextLoadLevel||a.fragContextChanged(u))){a.fragLoadError=0,a.state=O.State.IDLE,a.startFragRequested=!1,a.bitrateTest=!1;var E=u.stats;E.parsing.start=E.parsing.end=E.buffering.start=E.buffering.end=self.performance.now(),d.trigger(F.Events.FRAG_LOADED,l)}})},c._handleTransmuxComplete=function(u){var a,l="main",d=this.hls,E=u.remuxResult,y=u.chunkMeta,I=this.getCurrentContext(y);if(!I){this.warn("The loading context changed while buffering fragment "+y.sn+" of level "+y.level+". This chunk will not be buffered."),this.resetLiveStartWhenNotLoaded(y.level);return}var C=I.frag,_=I.part,B=I.level,U=E.video,N=E.text,k=E.id3,w=E.initSegment,G=this.altAudio?void 0:E.audio;if(!this.fragContextChanged(C)){if(this.state=O.State.PARSING,w){w.tracks&&(this._bufferInitSegment(B,w.tracks,C,y),d.trigger(F.Events.FRAG_PARSING_INIT_SEGMENT,{frag:C,id:l,tracks:w.tracks}));var W=w.initPTS,Y=w.timescale;Object(M.isFiniteNumber)(W)&&(this.initPTS[C.cc]=W,d.trigger(F.Events.INIT_PTS_FOUND,{frag:C,id:l,initPTS:W,timescale:Y}))}if(U&&E.independent!==!1){if(B.details){var H=U.startPTS,z=U.endPTS,Q=U.startDTS,$=U.endDTS;if(_)_.elementaryStreams[U.type]={startPTS:H,endPTS:z,startDTS:Q,endDTS:$};else if(U.firstKeyFrame&&U.independent&&(this.couldBacktrack=!0),U.dropped&&U.independent){var X=this.getLoadPosition()+this.config.maxBufferHole;if(X<H){this.backtrack(C);return}C.setElementaryStreamInfo(U.type,C.start,z,C.start,$,!0)}C.setElementaryStreamInfo(U.type,H,z,Q,$),this.bufferFragmentData(U,C,_,y)}}else if(E.independent===!1){this.backtrack(C);return}if(G){var J=G.startPTS,Z=G.endPTS,q=G.startDTS,ee=G.endDTS;_&&(_.elementaryStreams[g.ElementaryStreamTypes.AUDIO]={startPTS:J,endPTS:Z,startDTS:q,endDTS:ee}),C.setElementaryStreamInfo(g.ElementaryStreamTypes.AUDIO,J,Z,q,ee),this.bufferFragmentData(G,C,_,y)}if(k!=null&&(a=k.samples)!==null&&a!==void 0&&a.length){var ae={frag:C,id:l,samples:k.samples};d.trigger(F.Events.FRAG_PARSING_METADATA,ae)}if(N){var te={frag:C,id:l,samples:N.samples};d.trigger(F.Events.FRAG_PARSING_USERDATA,te)}}},c._bufferInitSegment=function(u,a,l,d){var E=this;if(this.state===O.State.PARSING){this.audioOnly=!!a.audio&&!a.video,this.altAudio&&!this.audioOnly&&delete a.audio;var y=a.audio,I=a.video,C=a.audiovideo;if(y){var _=u.audioCodec,B=navigator.userAgent.toLowerCase();this.audioCodecSwitch&&(_&&(_.indexOf("mp4a.40.5")!==-1?_="mp4a.40.2":_="mp4a.40.5"),y.metadata.channelCount!==1&&B.indexOf("firefox")===-1&&(_="mp4a.40.5")),B.indexOf("android")!==-1&&y.container!=="audio/mpeg"&&(_="mp4a.40.2",this.log("Android: force audio codec to "+_)),u.audioCodec&&u.audioCodec!==_&&this.log('Swapping manifest audio codec "'+u.audioCodec+'" for "'+_+'"'),y.levelCodec=_,y.id="main",this.log("Init audio buffer, container:"+y.container+", codecs[selected/level/parsed]=["+(_||"")+"/"+(u.audioCodec||"")+"/"+y.codec+"]")}I&&(I.levelCodec=u.videoCodec,I.id="main",this.log("Init video buffer, container:"+I.container+", codecs[level/parsed]=["+(u.videoCodec||"")+"/"+I.codec+"]")),C&&this.log("Init audiovideo buffer, container:"+C.container+", codecs[level/parsed]=["+(u.attrs.CODECS||"")+"/"+C.codec+"]"),this.hls.trigger(F.Events.BUFFER_CODECS,a),Object.keys(a).forEach(function(U){var N=a[U],k=N.initSegment;k!=null&&k.byteLength&&E.hls.trigger(F.Events.BUFFER_APPENDING,{type:U,data:k,frag:l,part:null,chunkMeta:d,parent:l.type})}),this.tick()}},c.backtrack=function(u){this.couldBacktrack=!0,this.resetTransmuxer(),this.flushBufferGap(u);var a=this.fragmentTracker.backtrack(u);this.fragPrevious=null,this.nextLoadPosition=u.start,a?this.resetFragmentLoading(u):this.state=O.State.BACKTRACKING},c.checkFragmentChanged=function(){var u=this.media,a=null;if(u&&u.readyState>1&&u.seeking===!1){var l=u.currentTime;if(D.BufferHelper.isBuffered(u,l)?a=this.getAppendedFrag(l):D.BufferHelper.isBuffered(u,l+.1)&&(a=this.getAppendedFrag(l+.1)),a){var d=this.fragPlaying,E=a.level;(!d||a.sn!==d.sn||d.level!==E||a.urlId!==d.urlId)&&(this.hls.trigger(F.Events.FRAG_CHANGED,{frag:a}),(!d||d.level!==E)&&this.hls.trigger(F.Events.LEVEL_SWITCHED,{level:E}),this.fragPlaying=a)}}},e(o,[{key:"nextLevel",get:function(){var u=this.nextBufferedFrag;return u?u.level:-1}},{key:"currentLevel",get:function(){var u=this.media;if(u){var a=this.getAppendedFrag(u.currentTime);if(a)return a.level}return-1}},{key:"nextBufferedFrag",get:function(){var u=this.media;if(u){var a=this.getAppendedFrag(u.currentTime);return this.followingBufferedFrag(a)}else return null}},{key:"forceStartLoad",get:function(){return this._forceStartLoad}}]),o}(O.default)},"./src/controller/subtitle-stream-controller.ts":function(K,P,p){p.r(P),p.d(P,"SubtitleStreamController",function(){return r});var M=p("./src/events.ts"),O=p("./src/utils/logger.ts"),A=p("./src/utils/buffer-helper.ts"),F=p("./src/controller/fragment-finders.ts"),D=p("./src/utils/discontinuities.ts"),R=p("./src/controller/level-helper.ts"),L=p("./src/controller/fragment-tracker.ts"),g=p("./src/controller/base-stream-controller.ts"),S=p("./src/types/loader.ts"),T=p("./src/types/level.ts");function x(t,f){for(var s=0;s<f.length;s++){var n=f[s];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function m(t,f,s){return f&&x(t.prototype,f),s&&x(t,s),t}function h(t,f){t.prototype=Object.create(f.prototype),t.prototype.constructor=t,i(t,f)}function i(t,f){return i=Object.setPrototypeOf||function(n,o){return n.__proto__=o,n},i(t,f)}var e=500,r=function(t){h(f,t);function f(n,o){var c;return c=t.call(this,n,o,"[subtitle-stream-controller]")||this,c.levels=[],c.currentTrackId=-1,c.tracksBuffered=[],c.mainDetails=null,c._registerListeners(),c}var s=f.prototype;return s.onHandlerDestroying=function(){this._unregisterListeners(),this.mainDetails=null},s._registerListeners=function(){var o=this.hls;o.on(M.Events.MEDIA_ATTACHED,this.onMediaAttached,this),o.on(M.Events.MEDIA_DETACHING,this.onMediaDetaching,this),o.on(M.Events.MANIFEST_LOADING,this.onManifestLoading,this),o.on(M.Events.LEVEL_LOADED,this.onLevelLoaded,this),o.on(M.Events.ERROR,this.onError,this),o.on(M.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),o.on(M.Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),o.on(M.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),o.on(M.Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),o.on(M.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},s._unregisterListeners=function(){var o=this.hls;o.off(M.Events.MEDIA_ATTACHED,this.onMediaAttached,this),o.off(M.Events.MEDIA_DETACHING,this.onMediaDetaching,this),o.off(M.Events.MANIFEST_LOADING,this.onManifestLoading,this),o.off(M.Events.LEVEL_LOADED,this.onLevelLoaded,this),o.off(M.Events.ERROR,this.onError,this),o.off(M.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),o.off(M.Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),o.off(M.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),o.off(M.Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),o.off(M.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},s.startLoad=function(){this.stopLoad(),this.state=g.State.IDLE,this.setInterval(e),this.tick()},s.onManifestLoading=function(){this.mainDetails=null,this.fragmentTracker.removeAllFragments()},s.onLevelLoaded=function(o,c){this.mainDetails=c.details},s.onSubtitleFragProcessed=function(o,c){var v=c.frag,u=c.success;if(this.fragPrevious=v,this.state=g.State.IDLE,!!u){var a=this.tracksBuffered[this.currentTrackId];if(!!a){for(var l,d=v.start,E=0;E<a.length;E++)if(d>=a[E].start&&d<=a[E].end){l=a[E];break}var y=v.start+v.duration;l?l.end=y:(l={start:d,end:y},a.push(l)),this.fragmentTracker.fragBuffered(v)}}},s.onBufferFlushing=function(o,c){var v=c.startOffset,u=c.endOffset;if(v===0&&u!==Number.POSITIVE_INFINITY){var a=this.currentTrackId,l=this.levels;if(!l.length||!l[a]||!l[a].details)return;var d=l[a].details,E=d.targetduration,y=u-E;if(y<=0)return;c.endOffsetSubtitles=Math.max(0,y),this.tracksBuffered.forEach(function(I){for(var C=0;C<I.length;){if(I[C].end<=y){I.shift();continue}else if(I[C].start<y)I[C].start=y;else break;C++}}),this.fragmentTracker.removeFragmentsInRange(v,y,S.PlaylistLevelType.SUBTITLE)}},s.onError=function(o,c){var v,u=c.frag;!u||u.type!==S.PlaylistLevelType.SUBTITLE||((v=this.fragCurrent)!==null&&v!==void 0&&v.loader&&this.fragCurrent.loader.abort(),this.state=g.State.IDLE)},s.onSubtitleTracksUpdated=function(o,c){var v=this,u=c.subtitleTracks;this.tracksBuffered=[],this.levels=u.map(function(a){return new T.Level(a)}),this.fragmentTracker.removeAllFragments(),this.fragPrevious=null,this.levels.forEach(function(a){v.tracksBuffered[a.id]=[]}),this.mediaBuffer=null},s.onSubtitleTrackSwitch=function(o,c){if(this.currentTrackId=c.id,!this.levels.length||this.currentTrackId===-1){this.clearInterval();return}var v=this.levels[this.currentTrackId];v!=null&&v.details?(this.mediaBuffer=this.mediaBufferTimeRanges,this.setInterval(e)):this.mediaBuffer=null},s.onSubtitleTrackLoaded=function(o,c){var v,u=c.details,a=c.id,l=this.currentTrackId,d=this.levels;if(!!d.length){var E=d[l];if(!(a>=d.length||a!==l||!E)){if(this.mediaBuffer=this.mediaBufferTimeRanges,u.live||(v=E.details)!==null&&v!==void 0&&v.live){var y=this.mainDetails;if(u.deltaUpdateFailed||!y)return;var I=y.fragments[0];if(!E.details)u.hasProgramDateTime&&y.hasProgramDateTime?Object(D.alignMediaPlaylistByPDT)(u,y):I&&Object(R.addSliding)(u,I.start);else{var C=this.alignPlaylists(u,E.details);C===0&&I&&Object(R.addSliding)(u,I.start)}}if(E.details=u,this.levelLastLoaded=a,this.tick(),u.live&&!this.fragCurrent&&this.media&&this.state===g.State.IDLE){var _=Object(F.findFragmentByPTS)(null,u.fragments,this.media.currentTime,0);_||(this.warn("Subtitle playlist not aligned with playback"),E.details=void 0)}}}},s._handleFragmentLoadComplete=function(o){var c=o.frag,v=o.payload,u=c.decryptdata,a=this.hls;if(!this.fragContextChanged(c)&&v&&v.byteLength>0&&u&&u.key&&u.iv&&u.method==="AES-128"){var l=performance.now();this.decrypter.webCryptoDecrypt(new Uint8Array(v),u.key.buffer,u.iv.buffer).then(function(d){var E=performance.now();a.trigger(M.Events.FRAG_DECRYPTED,{frag:c,payload:d,stats:{tstart:l,tdecrypt:E}})})}},s.doTick=function(){if(!this.media){this.state=g.State.IDLE;return}if(this.state===g.State.IDLE){var o,c=this.currentTrackId,v=this.levels;if(!v.length||!v[c]||!v[c].details)return;var u=v[c].details,a=u.targetduration,l=this.config,d=this.media,E=A.BufferHelper.bufferedInfo(this.mediaBufferTimeRanges,d.currentTime-a,l.maxBufferHole),y=E.end,I=E.len,C=this.getMaxBufferLength()+a;if(I>C)return;console.assert(u,"Subtitle track details are defined on idle subtitle stream controller tick");var _=u.fragments,B=_.length,U=u.edge,N,k=this.fragPrevious;if(y<U){var w=l.maxFragLookUpTolerance;k&&u.hasProgramDateTime&&(N=Object(F.findFragmentByPDT)(_,k.endProgramDateTime,w)),N||(N=Object(F.findFragmentByPTS)(k,_,y,w),!N&&k&&k.start<_[0].start&&(N=_[0]))}else N=_[B-1];(o=N)!==null&&o!==void 0&&o.encrypted?(O.logger.log("Loading key for "+N.sn),this.state=g.State.KEY_LOADING,this.hls.trigger(M.Events.KEY_LOADING,{frag:N})):N&&this.fragmentTracker.getState(N)===L.FragmentState.NOT_LOADED&&this.loadFragment(N,u,y)}},s.loadFragment=function(o,c,v){this.fragCurrent=o,t.prototype.loadFragment.call(this,o,c,v)},m(f,[{key:"mediaBufferTimeRanges",get:function(){return this.tracksBuffered[this.currentTrackId]||[]}}]),f}(g.default)},"./src/controller/subtitle-track-controller.ts":function(K,P,p){p.r(P);var M=p("./src/events.ts"),O=p("./src/utils/texttrack-utils.ts"),A=p("./src/controller/base-playlist-controller.ts"),F=p("./src/types/loader.ts");function D(x,m){for(var h=0;h<m.length;h++){var i=m[h];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(x,i.key,i)}}function R(x,m,h){return m&&D(x.prototype,m),h&&D(x,h),x}function L(x,m){x.prototype=Object.create(m.prototype),x.prototype.constructor=x,g(x,m)}function g(x,m){return g=Object.setPrototypeOf||function(i,e){return i.__proto__=e,i},g(x,m)}var S=function(x){L(m,x);function m(i){var e;return e=x.call(this,i,"[subtitle-track-controller]")||this,e.media=null,e.tracks=[],e.groupId=null,e.tracksInGroup=[],e.trackId=-1,e.selectDefaultTrack=!0,e.queuedDefaultTrack=-1,e.trackChangeListener=function(){return e.onTextTracksChanged()},e.asyncPollTrackChange=function(){return e.pollTrackChange(0)},e.useTextTrackPolling=!1,e.subtitlePollingInterval=-1,e.subtitleDisplay=!0,e.registerListeners(),e}var h=m.prototype;return h.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.trackChangeListener=this.asyncPollTrackChange=null,x.prototype.destroy.call(this)},h.registerListeners=function(){var e=this.hls;e.on(M.Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(M.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(M.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.on(M.Events.MANIFEST_PARSED,this.onManifestParsed,this),e.on(M.Events.LEVEL_LOADING,this.onLevelLoading,this),e.on(M.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(M.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(M.Events.ERROR,this.onError,this)},h.unregisterListeners=function(){var e=this.hls;e.off(M.Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(M.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(M.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.off(M.Events.MANIFEST_PARSED,this.onManifestParsed,this),e.off(M.Events.LEVEL_LOADING,this.onLevelLoading,this),e.off(M.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(M.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(M.Events.ERROR,this.onError,this)},h.onMediaAttached=function(e,r){this.media=r.media,!!this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))},h.pollTrackChange=function(e){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.trackChangeListener,e)},h.onMediaDetaching=function(){if(!!this.media){self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||this.media.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId);var e=T(this.media.textTracks);e.forEach(function(r){Object(O.clearCurrentCues)(r)}),this.subtitleTrack=-1,this.media=null}},h.onManifestLoading=function(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.selectDefaultTrack=!0},h.onManifestParsed=function(e,r){this.tracks=r.subtitleTracks},h.onSubtitleTrackLoaded=function(e,r){var t=r.id,f=r.details,s=this.trackId,n=this.tracksInGroup[s];if(!n){this.warn("Invalid subtitle track id "+t);return}var o=n.details;n.details=r.details,this.log("subtitle track "+t+" loaded ["+f.startSN+"-"+f.endSN+"]"),t===this.trackId&&(this.retryCount=0,this.playlistLoaded(t,r,o))},h.onLevelLoading=function(e,r){this.switchLevel(r.level)},h.onLevelSwitching=function(e,r){this.switchLevel(r.level)},h.switchLevel=function(e){var r=this.hls.levels[e];if(!!(r!=null&&r.textGroupIds)){var t=r.textGroupIds[r.urlId];if(this.groupId!==t){var f=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0,s=this.tracks.filter(function(c){return!t||c.groupId===t});this.tracksInGroup=s;var n=this.findTrackId(f==null?void 0:f.name)||this.findTrackId();this.groupId=t;var o={subtitleTracks:s};this.log("Updating subtitle tracks, "+s.length+' track(s) found in "'+t+'" group-id'),this.hls.trigger(M.Events.SUBTITLE_TRACKS_UPDATED,o),n!==-1&&this.setSubtitleTrack(n,f)}}},h.findTrackId=function(e){for(var r=this.tracksInGroup,t=0;t<r.length;t++){var f=r[t];if((!this.selectDefaultTrack||f.default)&&(!e||e===f.name))return f.id}return-1},h.onError=function(e,r){x.prototype.onError.call(this,e,r),!(r.fatal||!r.context)&&r.context.type===F.PlaylistContextType.SUBTITLE_TRACK&&r.context.id===this.trackId&&r.context.groupId===this.groupId&&this.retryLoadingOrFail(r)},h.loadPlaylist=function(e){var r=this.tracksInGroup[this.trackId];if(this.shouldLoadTrack(r)){var t=r.id,f=r.groupId,s=r.url;if(e)try{s=e.addDirectives(s)}catch(n){this.warn("Could not construct new URL with HLS Delivery Directives: "+n)}this.log("Loading subtitle playlist for id "+t),this.hls.trigger(M.Events.SUBTITLE_TRACK_LOADING,{url:s,id:t,groupId:f,deliveryDirectives:e||null})}},h.toggleTrackModes=function(e){var r=this,t=this.media,f=this.subtitleDisplay,s=this.trackId;if(!!t){var n=T(t.textTracks),o=n.filter(function(u){return u.groupId===r.groupId});if(e===-1)[].slice.call(n).forEach(function(u){u.mode="disabled"});else{var c=o[s];c&&(c.mode="disabled")}var v=o[e];v&&(v.mode=f?"showing":"hidden")}},h.setSubtitleTrack=function(e,r){var t,f=this.tracksInGroup;if(!this.media){this.queuedDefaultTrack=e;return}if(this.trackId!==e&&this.toggleTrackModes(e),!(this.trackId===e&&(e===-1||(t=f[e])!==null&&t!==void 0&&t.details)||e<-1||e>=f.length)){this.clearTimer();var s=f[e];if(this.log("Switching to subtitle track "+e),this.trackId=e,s){var n=s.id,o=s.groupId,c=o===void 0?"":o,v=s.name,u=s.type,a=s.url;this.hls.trigger(M.Events.SUBTITLE_TRACK_SWITCH,{id:n,groupId:c,name:v,type:u,url:a});var l=this.switchParams(s.url,r==null?void 0:r.details);this.loadPlaylist(l)}else this.hls.trigger(M.Events.SUBTITLE_TRACK_SWITCH,{id:e})}},h.onTextTracksChanged=function(){if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),!(!this.media||!this.hls.config.renderTextTracksNatively)){for(var e=-1,r=T(this.media.textTracks),t=0;t<r.length;t++)if(r[t].mode==="hidden")e=t;else if(r[t].mode==="showing"){e=t;break}this.subtitleTrack!==e&&(this.subtitleTrack=e)}},R(m,[{key:"subtitleTracks",get:function(){return this.tracksInGroup}},{key:"subtitleTrack",get:function(){return this.trackId},set:function(e){this.selectDefaultTrack=!1;var r=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0;this.setSubtitleTrack(e,r)}}]),m}(A.default);function T(x){for(var m=[],h=0;h<x.length;h++){var i=x[h];i.kind==="subtitles"&&i.label&&m.push(x[h])}return m}P.default=S},"./src/controller/timeline-controller.ts":function(K,P,p){p.r(P),p.d(P,"TimelineController",function(){return T});var M=p("./src/polyfills/number.ts"),O=p("./src/events.ts"),A=p("./src/utils/cea-608-parser.ts"),F=p("./src/utils/output-filter.ts"),D=p("./src/utils/webvtt-parser.ts"),R=p("./src/utils/texttrack-utils.ts"),L=p("./src/utils/imsc1-ttml-parser.ts"),g=p("./src/types/loader.ts"),S=p("./src/utils/logger.ts"),T=function(){function i(r){if(this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.timescale=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastSn=-1,this.prevCC=-1,this.vttCCs=h(),this.captionsProperties=void 0,this.hls=r,this.config=r.config,this.Cues=r.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},this.config.enableCEA708Captions){var t=new F.default(this,"textTrack1"),f=new F.default(this,"textTrack2"),s=new F.default(this,"textTrack3"),n=new F.default(this,"textTrack4");this.cea608Parser1=new A.default(1,t,f),this.cea608Parser2=new A.default(3,s,n)}r.on(O.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),r.on(O.Events.MEDIA_DETACHING,this.onMediaDetaching,this),r.on(O.Events.MANIFEST_LOADING,this.onManifestLoading,this),r.on(O.Events.MANIFEST_LOADED,this.onManifestLoaded,this),r.on(O.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),r.on(O.Events.FRAG_LOADING,this.onFragLoading,this),r.on(O.Events.FRAG_LOADED,this.onFragLoaded,this),r.on(O.Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),r.on(O.Events.FRAG_DECRYPTED,this.onFragDecrypted,this),r.on(O.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),r.on(O.Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),r.on(O.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)}var e=i.prototype;return e.destroy=function(){var t=this.hls;t.off(O.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),t.off(O.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(O.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.off(O.Events.MANIFEST_LOADED,this.onManifestLoaded,this),t.off(O.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),t.off(O.Events.FRAG_LOADING,this.onFragLoading,this),t.off(O.Events.FRAG_LOADED,this.onFragLoaded,this),t.off(O.Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),t.off(O.Events.FRAG_DECRYPTED,this.onFragDecrypted,this),t.off(O.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),t.off(O.Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),t.off(O.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.cea608Parser1=this.cea608Parser2=null},e.addCues=function(t,f,s,n,o){for(var c=!1,v=o.length;v--;){var u=o[v],a=m(u[0],u[1],f,s);if(a>=0&&(u[0]=Math.min(u[0],f),u[1]=Math.max(u[1],s),c=!0,a/(s-f)>.5))return}if(c||o.push([f,s]),this.config.renderTextTracksNatively){var l=this.captionsTracks[t];this.Cues.newCue(l,f,s,n)}else{var d=this.Cues.newCue(null,f,s,n);this.hls.trigger(O.Events.CUES_PARSED,{type:"captions",cues:d,track:t})}},e.onInitPtsFound=function(t,f){var s=this,n=f.frag,o=f.id,c=f.initPTS,v=f.timescale,u=this.unparsedVttFrags;o==="main"&&(this.initPTS[n.cc]=c,this.timescale[n.cc]=v),u.length&&(this.unparsedVttFrags=[],u.forEach(function(a){s.onFragLoaded(O.Events.FRAG_LOADED,a)}))},e.getExistingTrack=function(t){var f=this.media;if(f)for(var s=0;s<f.textTracks.length;s++){var n=f.textTracks[s];if(n[t])return n}return null},e.createCaptionsTrack=function(t){this.config.renderTextTracksNatively?this.createNativeTrack(t):this.createNonNativeTrack(t)},e.createNativeTrack=function(t){if(!this.captionsTracks[t]){var f=this.captionsProperties,s=this.captionsTracks,n=this.media,o=f[t],c=o.label,v=o.languageCode,u=this.getExistingTrack(t);if(u)s[t]=u,Object(R.clearCurrentCues)(s[t]),Object(R.sendAddTrackEvent)(s[t],n);else{var a=this.createTextTrack("captions",c,v);a&&(a[t]=!0,s[t]=a)}}},e.createNonNativeTrack=function(t){if(!this.nonNativeCaptionsTracks[t]){var f=this.captionsProperties[t];if(!!f){var s=f.label,n={_id:t,label:s,kind:"captions",default:f.media?!!f.media.default:!1,closedCaptions:f.media};this.nonNativeCaptionsTracks[t]=n,this.hls.trigger(O.Events.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[n]})}}},e.createTextTrack=function(t,f,s){var n=this.media;if(!!n)return n.addTextTrack(t,f,s)},e.onMediaAttaching=function(t,f){this.media=f.media,this._cleanTracks()},e.onMediaDetaching=function(){var t=this.captionsTracks;Object.keys(t).forEach(function(f){Object(R.clearCurrentCues)(t[f]),delete t[f]}),this.nonNativeCaptionsTracks={}},e.onManifestLoading=function(){this.lastSn=-1,this.prevCC=-1,this.vttCCs=h(),this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=this.unparsedVttFrags||[],this.initPTS=[],this.timescale=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())},e._cleanTracks=function(){var t=this.media;if(!!t){var f=t.textTracks;if(f)for(var s=0;s<f.length;s++)Object(R.clearCurrentCues)(f[s])}},e.onSubtitleTracksUpdated=function(t,f){var s=this;this.textTracks=[];var n=f.subtitleTracks||[],o=n.some(function(a){return a.textCodec===L.IMSC1_CODEC});if(this.config.enableWebVTT||o&&this.config.enableIMSC1){var c=this.tracks&&n&&this.tracks.length===n.length;if(this.tracks=n||[],this.config.renderTextTracksNatively){var v=this.media?this.media.textTracks:[];this.tracks.forEach(function(a,l){var d;if(l<v.length){for(var E=null,y=0;y<v.length;y++)if(x(v[y],a)){E=v[y];break}E&&(d=E)}d?Object(R.clearCurrentCues)(d):(d=s.createTextTrack("subtitles",a.name,a.lang),d&&(d.mode="disabled")),d&&(d.groupId=a.groupId,s.textTracks.push(d))})}else if(!c&&this.tracks&&this.tracks.length){var u=this.tracks.map(function(a){return{label:a.name,kind:a.type.toLowerCase(),default:a.default,subtitleTrack:a}});this.hls.trigger(O.Events.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:u})}}},e.onManifestLoaded=function(t,f){var s=this;this.config.enableCEA708Captions&&f.captions&&f.captions.forEach(function(n){var o=/(?:CC|SERVICE)([1-4])/.exec(n.instreamId);if(!!o){var c="textTrack"+o[1],v=s.captionsProperties[c];!v||(v.label=n.name,n.lang&&(v.languageCode=n.lang),v.media=n)}})},e.onFragLoading=function(t,f){var s=this.cea608Parser1,n=this.cea608Parser2,o=this.lastSn;if(!(!this.enabled||!(s&&n))&&f.frag.type===g.PlaylistLevelType.MAIN){var c=f.frag.sn;c!==o+1&&(s.reset(),n.reset()),this.lastSn=c}},e.onFragLoaded=function(t,f){var s=f.frag,n=f.payload,o=this.initPTS,c=this.unparsedVttFrags;if(s.type===g.PlaylistLevelType.SUBTITLE)if(n.byteLength){if(!Object(M.isFiniteNumber)(o[s.cc])){c.push(f),o.length&&this.hls.trigger(O.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:s,error:new Error("Missing initial subtitle PTS")});return}var v=s.decryptdata;if(v==null||v.key==null||v.method!=="AES-128"){var u=this.tracks[s.level],a=this.vttCCs;a[s.cc]||(a[s.cc]={start:s.start,prevCC:this.prevCC,new:!0},this.prevCC=s.cc),u&&u.textCodec===L.IMSC1_CODEC?this._parseIMSC1(s,n):this._parseVTTs(s,n,a)}}else this.hls.trigger(O.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:s,error:new Error("Empty subtitle payload")})},e._parseIMSC1=function(t,f){var s=this,n=this.hls;Object(L.parseIMSC1)(f,this.initPTS[t.cc],this.timescale[t.cc],function(o){s._appendCues(o,t.level),n.trigger(O.Events.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:t})},function(o){S.logger.log("Failed to parse IMSC1: "+o),n.trigger(O.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:t,error:o})})},e._parseVTTs=function(t,f,s){var n=this,o=this.hls;Object(D.parseWebVTT)(f,this.initPTS[t.cc],this.timescale[t.cc],s,t.cc,t.start,function(c){n._appendCues(c,t.level),o.trigger(O.Events.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:t})},function(c){n._fallbackToIMSC1(t,f),S.logger.log("Failed to parse VTT cue: "+c),o.trigger(O.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:t,error:c})})},e._fallbackToIMSC1=function(t,f){var s=this,n=this.tracks[t.level];n.textCodec||Object(L.parseIMSC1)(f,this.initPTS[t.cc],this.timescale[t.cc],function(){n.textCodec=L.IMSC1_CODEC,s._parseIMSC1(t,f)},function(){n.textCodec="wvtt"})},e._appendCues=function(t,f){var s=this.hls;if(this.config.renderTextTracksNatively){var n=this.textTracks[f];if(n.mode==="disabled")return;t.forEach(function(v){return Object(R.addCueToTrack)(n,v)})}else{var o=this.tracks[f],c=o.default?"default":"subtitles"+f;s.trigger(O.Events.CUES_PARSED,{type:"subtitles",cues:t,track:c})}},e.onFragDecrypted=function(t,f){var s=f.frag;if(s.type===g.PlaylistLevelType.SUBTITLE){if(!Object(M.isFiniteNumber)(this.initPTS[s.cc])){this.unparsedVttFrags.push(f);return}this.onFragLoaded(O.Events.FRAG_LOADED,f)}},e.onSubtitleTracksCleared=function(){this.tracks=[],this.captionsTracks={}},e.onFragParsingUserdata=function(t,f){var s=this.cea608Parser1,n=this.cea608Parser2;if(!(!this.enabled||!(s&&n)))for(var o=0;o<f.samples.length;o++){var c=f.samples[o].bytes;if(c){var v=this.extractCea608Data(c);s.addData(f.samples[o].pts,v[0]),n.addData(f.samples[o].pts,v[1])}}},e.onBufferFlushing=function(t,f){var s=f.startOffset,n=f.endOffset,o=f.endOffsetSubtitles,c=f.type,v=this.media;if(!(!v||v.currentTime<n)){if(!c||c==="video"){var u=this.captionsTracks;Object.keys(u).forEach(function(l){return Object(R.removeCuesInRange)(u[l],s,n)})}if(this.config.renderTextTracksNatively&&s===0&&o!==void 0){var a=this.textTracks;Object.keys(a).forEach(function(l){return Object(R.removeCuesInRange)(a[l],s,o)})}}},e.extractCea608Data=function(t){for(var f=t[0]&31,s=2,n=[[],[]],o=0;o<f;o++){var c=t[s++],v=127&t[s++],u=127&t[s++],a=(4&c)!=0,l=3&c;v===0&&u===0||a&&(l===0||l===1)&&(n[l].push(v),n[l].push(u))}return n},i}();function x(i,e){return i&&i.label===e.name&&!(i.textTrack1||i.textTrack2)}function m(i,e,r,t){return Math.min(e,t)-Math.max(i,r)}function h(){return{ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!1}}}},"./src/crypt/aes-crypto.ts":function(K,P,p){p.r(P),p.d(P,"default",function(){return M});var M=function(){function O(F,D){this.subtle=void 0,this.aesIV=void 0,this.subtle=F,this.aesIV=D}var A=O.prototype;return A.decrypt=function(D,R){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},R,D)},O}()},"./src/crypt/aes-decryptor.ts":function(K,P,p){p.r(P),p.d(P,"removePadding",function(){return O}),p.d(P,"default",function(){return A});var M=p("./src/utils/typed-array.ts");function O(F){var D=F.byteLength,R=D&&new DataView(F.buffer).getUint8(D-1);return R?Object(M.sliceUint8)(F,0,D-R):F}var A=function(){function F(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}var D=F.prototype;return D.uint8ArrayToUint32Array_=function(L){for(var g=new DataView(L),S=new Uint32Array(4),T=0;T<4;T++)S[T]=g.getUint32(T*4);return S},D.initTable=function(){var L=this.sBox,g=this.invSBox,S=this.subMix,T=S[0],x=S[1],m=S[2],h=S[3],i=this.invSubMix,e=i[0],r=i[1],t=i[2],f=i[3],s=new Uint32Array(256),n=0,o=0,c=0;for(c=0;c<256;c++)c<128?s[c]=c<<1:s[c]=c<<1^283;for(c=0;c<256;c++){var v=o^o<<1^o<<2^o<<3^o<<4;v=v>>>8^v&255^99,L[n]=v,g[v]=n;var u=s[n],a=s[u],l=s[a],d=s[v]*257^v*16843008;T[n]=d<<24|d>>>8,x[n]=d<<16|d>>>16,m[n]=d<<8|d>>>24,h[n]=d,d=l*16843009^a*65537^u*257^n*16843008,e[v]=d<<24|d>>>8,r[v]=d<<16|d>>>16,t[v]=d<<8|d>>>24,f[v]=d,n?(n=u^s[s[s[l^u]]],o^=s[s[o]]):n=o=1}},D.expandKey=function(L){for(var g=this.uint8ArrayToUint32Array_(L),S=!0,T=0;T<g.length&&S;)S=g[T]===this.key[T],T++;if(!S){this.key=g;var x=this.keySize=g.length;if(x!==4&&x!==6&&x!==8)throw new Error("Invalid aes key size="+x);var m=this.ksRows=(x+6+1)*4,h,i,e=this.keySchedule=new Uint32Array(m),r=this.invKeySchedule=new Uint32Array(m),t=this.sBox,f=this.rcon,s=this.invSubMix,n=s[0],o=s[1],c=s[2],v=s[3],u,a;for(h=0;h<m;h++){if(h<x){u=e[h]=g[h];continue}a=u,h%x==0?(a=a<<8|a>>>24,a=t[a>>>24]<<24|t[a>>>16&255]<<16|t[a>>>8&255]<<8|t[a&255],a^=f[h/x|0]<<24):x>6&&h%x==4&&(a=t[a>>>24]<<24|t[a>>>16&255]<<16|t[a>>>8&255]<<8|t[a&255]),e[h]=u=(e[h-x]^a)>>>0}for(i=0;i<m;i++)h=m-i,i&3?a=e[h]:a=e[h-4],i<4||h<=4?r[i]=a:r[i]=n[t[a>>>24]]^o[t[a>>>16&255]]^c[t[a>>>8&255]]^v[t[a&255]],r[i]=r[i]>>>0}},D.networkToHostOrderSwap=function(L){return L<<24|(L&65280)<<8|(L&16711680)>>8|L>>>24},D.decrypt=function(L,g,S){for(var T=this.keySize+6,x=this.invKeySchedule,m=this.invSBox,h=this.invSubMix,i=h[0],e=h[1],r=h[2],t=h[3],f=this.uint8ArrayToUint32Array_(S),s=f[0],n=f[1],o=f[2],c=f[3],v=new Int32Array(L),u=new Int32Array(v.length),a,l,d,E,y,I,C,_,B,U,N,k,w,G,W=this.networkToHostOrderSwap;g<v.length;){for(B=W(v[g]),U=W(v[g+1]),N=W(v[g+2]),k=W(v[g+3]),y=B^x[0],I=k^x[1],C=N^x[2],_=U^x[3],w=4,G=1;G<T;G++)a=i[y>>>24]^e[I>>16&255]^r[C>>8&255]^t[_&255]^x[w],l=i[I>>>24]^e[C>>16&255]^r[_>>8&255]^t[y&255]^x[w+1],d=i[C>>>24]^e[_>>16&255]^r[y>>8&255]^t[I&255]^x[w+2],E=i[_>>>24]^e[y>>16&255]^r[I>>8&255]^t[C&255]^x[w+3],y=a,I=l,C=d,_=E,w=w+4;a=m[y>>>24]<<24^m[I>>16&255]<<16^m[C>>8&255]<<8^m[_&255]^x[w],l=m[I>>>24]<<24^m[C>>16&255]<<16^m[_>>8&255]<<8^m[y&255]^x[w+1],d=m[C>>>24]<<24^m[_>>16&255]<<16^m[y>>8&255]<<8^m[I&255]^x[w+2],E=m[_>>>24]<<24^m[y>>16&255]<<16^m[I>>8&255]<<8^m[C&255]^x[w+3],u[g]=W(a^s),u[g+1]=W(E^n),u[g+2]=W(d^o),u[g+3]=W(l^c),s=B,n=U,o=N,c=k,g=g+4}return u.buffer},F}()},"./src/crypt/decrypter.ts":function(K,P,p){p.r(P),p.d(P,"default",function(){return g});var M=p("./src/crypt/aes-crypto.ts"),O=p("./src/crypt/fast-aes-key.ts"),A=p("./src/crypt/aes-decryptor.ts"),F=p("./src/utils/logger.ts"),D=p("./src/utils/mp4-tools.ts"),R=p("./src/utils/typed-array.ts"),L=16,g=function(){function S(x,m,h){var i=h===void 0?{}:h,e=i.removePKCS7Padding,r=e===void 0?!0:e;if(this.logEnabled=!0,this.observer=void 0,this.config=void 0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.observer=x,this.config=m,this.removePKCS7Padding=r,r)try{var t=self.crypto;t&&(this.subtle=t.subtle||t.webkitSubtle)}catch{}this.subtle===null&&(this.config.enableSoftwareAES=!0)}var T=S.prototype;return T.destroy=function(){this.observer=null},T.isSync=function(){return this.config.enableSoftwareAES},T.flush=function(){var m=this.currentResult;if(!m){this.reset();return}var h=new Uint8Array(m);return this.reset(),this.removePKCS7Padding?Object(A.removePadding)(h):h},T.reset=function(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)},T.decrypt=function(m,h,i,e){if(this.config.enableSoftwareAES){this.softwareDecrypt(new Uint8Array(m),h,i);var r=this.flush();r&&e(r.buffer)}else this.webCryptoDecrypt(new Uint8Array(m),h,i).then(e)},T.softwareDecrypt=function(m,h,i){var e=this.currentIV,r=this.currentResult,t=this.remainderData;this.logOnce("JS AES decrypt"),t&&(m=Object(D.appendUint8Array)(t,m),this.remainderData=null);var f=this.getValidChunk(m);if(!f.length)return null;e&&(i=e);var s=this.softwareDecrypter;s||(s=this.softwareDecrypter=new A.default),s.expandKey(h);var n=r;return this.currentResult=s.decrypt(f.buffer,0,i),this.currentIV=Object(R.sliceUint8)(f,-16).buffer,n||null},T.webCryptoDecrypt=function(m,h,i){var e=this,r=this.subtle;return(this.key!==h||!this.fastAesKey)&&(this.key=h,this.fastAesKey=new O.default(r,h)),this.fastAesKey.expandKey().then(function(t){if(!r)return Promise.reject(new Error("web crypto not initialized"));var f=new M.default(r,i);return f.decrypt(m.buffer,t)}).catch(function(t){return e.onWebCryptoError(t,m,h,i)})},T.onWebCryptoError=function(m,h,i,e){return F.logger.warn("[decrypter.ts]: WebCrypto Error, disable WebCrypto API:",m),this.config.enableSoftwareAES=!0,this.logEnabled=!0,this.softwareDecrypt(h,i,e)},T.getValidChunk=function(m){var h=m,i=m.length-m.length%L;return i!==m.length&&(h=Object(R.sliceUint8)(m,0,i),this.remainderData=Object(R.sliceUint8)(m,i)),h},T.logOnce=function(m){!this.logEnabled||(F.logger.log("[decrypter.ts]: "+m),this.logEnabled=!1)},S}()},"./src/crypt/fast-aes-key.ts":function(K,P,p){p.r(P),p.d(P,"default",function(){return M});var M=function(){function O(F,D){this.subtle=void 0,this.key=void 0,this.subtle=F,this.key=D}var A=O.prototype;return A.expandKey=function(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])},O}()},"./src/demux/aacdemuxer.ts":function(K,P,p){p.r(P);var M=p("./src/demux/base-audio-demuxer.ts"),O=p("./src/demux/adts.ts"),A=p("./src/utils/logger.ts"),F=p("./src/demux/id3.ts");function D(g,S){g.prototype=Object.create(S.prototype),g.prototype.constructor=g,R(g,S)}function R(g,S){return R=Object.setPrototypeOf||function(x,m){return x.__proto__=m,x},R(g,S)}var L=function(g){D(S,g);function S(x,m){var h;return h=g.call(this)||this,h.observer=void 0,h.config=void 0,h.observer=x,h.config=m,h}var T=S.prototype;return T.resetInitSegment=function(m,h,i){g.prototype.resetInitSegment.call(this,m,h,i),this._audioTrack={container:"audio/adts",type:"audio",id:0,pid:-1,sequenceNumber:0,isAAC:!0,samples:[],manifestCodec:m,duration:i,inputTimeScale:9e4,dropped:0}},S.probe=function(m){if(!m)return!1;for(var h=F.getID3Data(m,0)||[],i=h.length,e=m.length;i<e;i++)if(O.probe(m,i))return A.logger.log("ADTS sync word found !"),!0;return!1},T.canParse=function(m,h){return O.canParse(m,h)},T.appendFrame=function(m,h,i){O.initTrackConfig(m,this.observer,h,i,m.manifestCodec);var e=O.appendFrame(m,h,i,this.initPTS,this.frameIndex);if(e&&e.missing===0)return e},S}(M.default);L.minProbeByteLength=9,P.default=L},"./src/demux/adts.ts":function(K,P,p){p.r(P),p.d(P,"getAudioConfig",function(){return F}),p.d(P,"isHeaderPattern",function(){return D}),p.d(P,"getHeaderLength",function(){return R}),p.d(P,"getFullFrameLength",function(){return L}),p.d(P,"canGetFrameLength",function(){return g}),p.d(P,"isHeader",function(){return S}),p.d(P,"canParse",function(){return T}),p.d(P,"probe",function(){return x}),p.d(P,"initTrackConfig",function(){return m}),p.d(P,"getFrameDuration",function(){return h}),p.d(P,"parseFrameHeader",function(){return i}),p.d(P,"appendFrame",function(){return e});var M=p("./src/utils/logger.ts"),O=p("./src/errors.ts"),A=p("./src/events.ts");function F(r,t,f,s){var n,o,c,v,u=navigator.userAgent.toLowerCase(),a=s,l=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];n=((t[f+2]&192)>>>6)+1;var d=(t[f+2]&60)>>>2;if(d>l.length-1){r.trigger(A.Events.ERROR,{type:O.ErrorTypes.MEDIA_ERROR,details:O.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ADTS sampling index:"+d});return}return c=(t[f+2]&1)<<2,c|=(t[f+3]&192)>>>6,M.logger.log("manifest codec:"+s+", ADTS type:"+n+", samplingIndex:"+d),/firefox/i.test(u)?d>=6?(n=5,v=new Array(4),o=d-3):(n=2,v=new Array(2),o=d):u.indexOf("android")!==-1?(n=2,v=new Array(2),o=d):(n=5,v=new Array(4),s&&(s.indexOf("mp4a.40.29")!==-1||s.indexOf("mp4a.40.5")!==-1)||!s&&d>=6?o=d-3:((s&&s.indexOf("mp4a.40.2")!==-1&&(d>=6&&c===1||/vivaldi/i.test(u))||!s&&c===1)&&(n=2,v=new Array(2)),o=d)),v[0]=n<<3,v[0]|=(d&14)>>1,v[1]|=(d&1)<<7,v[1]|=c<<3,n===5&&(v[1]|=(o&14)>>1,v[2]=(o&1)<<7,v[2]|=2<<2,v[3]=0),{config:v,samplerate:l[d],channelCount:c,codec:"mp4a.40."+n,manifestCodec:a}}function D(r,t){return r[t]===255&&(r[t+1]&246)==240}function R(r,t){return r[t+1]&1?7:9}function L(r,t){return(r[t+3]&3)<<11|r[t+4]<<3|(r[t+5]&224)>>>5}function g(r,t){return t+5<r.length}function S(r,t){return t+1<r.length&&D(r,t)}function T(r,t){return g(r,t)&&D(r,t)&&L(r,t)<=r.length-t}function x(r,t){if(S(r,t)){var f=R(r,t);if(t+f>=r.length)return!1;var s=L(r,t);if(s<=f)return!1;var n=t+s;return n===r.length||S(r,n)}return!1}function m(r,t,f,s,n){if(!r.samplerate){var o=F(t,f,s,n);if(!o)return;r.config=o.config,r.samplerate=o.samplerate,r.channelCount=o.channelCount,r.codec=o.codec,r.manifestCodec=o.manifestCodec,M.logger.log("parsed codec:"+r.codec+", rate:"+o.samplerate+", channels:"+o.channelCount)}}function h(r){return 1024*9e4/r}function i(r,t,f,s,n){var o=R(r,t),c=L(r,t);if(c-=o,c>0){var v=f+s*n;return{headerLength:o,frameLength:c,stamp:v}}}function e(r,t,f,s,n){var o=h(r.samplerate),c=i(t,f,s,n,o);if(c){var v=c.frameLength,u=c.headerLength,a=c.stamp,l=u+v,d=Math.max(0,f+l-t.length),E;d?(E=new Uint8Array(l-u),E.set(t.subarray(f+u,t.length),0)):E=t.subarray(f+u,f+l);var y={unit:E,pts:a};return d||r.samples.push(y),{sample:y,length:l,missing:d}}}},"./src/demux/base-audio-demuxer.ts":function(K,P,p){p.r(P),p.d(P,"initPTSFn",function(){return L});var M=p("./src/polyfills/number.ts"),O=p("./src/demux/id3.ts"),A=p("./src/demux/dummy-demuxed-track.ts"),F=p("./src/utils/mp4-tools.ts"),D=p("./src/utils/typed-array.ts"),R=function(){function g(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.initPTS=null}var S=g.prototype;return S.resetInitSegment=function(x,m,h){this._id3Track={type:"id3",id:0,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}},S.resetTimeStamp=function(){},S.resetContiguity=function(){},S.canParse=function(x,m){return!1},S.appendFrame=function(x,m,h){},S.demux=function(x,m){this.cachedData&&(x=Object(F.appendUint8Array)(this.cachedData,x),this.cachedData=null);var h=O.getID3Data(x,0),i=h?h.length:0,e,r,t=this._audioTrack,f=this._id3Track,s=h?O.getTimeStamp(h):void 0,n=x.length;for((this.frameIndex===0||this.initPTS===null)&&(this.initPTS=L(s,m)),h&&h.length>0&&f.samples.push({pts:this.initPTS,dts:this.initPTS,data:h}),r=this.initPTS;i<n;){if(this.canParse(x,i)){var o=this.appendFrame(t,x,i);o?(this.frameIndex++,r=o.sample.pts,i+=o.length,e=i):i=n}else O.canParse(x,i)?(h=O.getID3Data(x,i),f.samples.push({pts:r,dts:r,data:h}),i+=h.length,e=i):i++;if(i===n&&e!==n){var c=Object(D.sliceUint8)(x,e);this.cachedData?this.cachedData=Object(F.appendUint8Array)(this.cachedData,c):this.cachedData=c}}return{audioTrack:t,avcTrack:Object(A.dummyTrack)(),id3Track:f,textTrack:Object(A.dummyTrack)()}},S.demuxSampleAes=function(x,m,h){return Promise.reject(new Error("["+this+"] This demuxer does not support Sample-AES decryption"))},S.flush=function(x){var m=this.cachedData;return m&&(this.cachedData=null,this.demux(m,0)),this.frameIndex=0,{audioTrack:this._audioTrack,avcTrack:Object(A.dummyTrack)(),id3Track:this._id3Track,textTrack:Object(A.dummyTrack)()}},S.destroy=function(){},g}(),L=function(S,T){return Object(M.isFiniteNumber)(S)?S*90:T*9e4};P.default=R},"./src/demux/chunk-cache.ts":function(K,P,p){p.r(P),p.d(P,"default",function(){return M});var M=function(){function A(){this.chunks=[],this.dataLength=0}var F=A.prototype;return F.push=function(R){this.chunks.push(R),this.dataLength+=R.length},F.flush=function(){var R=this.chunks,L=this.dataLength,g;if(R.length)R.length===1?g=R[0]:g=O(R,L);else return new Uint8Array(0);return this.reset(),g},F.reset=function(){this.chunks.length=0,this.dataLength=0},A}();function O(A,F){for(var D=new Uint8Array(F),R=0,L=0;L<A.length;L++){var g=A[L];D.set(g,R),R+=g.length}return D}},"./src/demux/dummy-demuxed-track.ts":function(K,P,p){p.r(P),p.d(P,"dummyTrack",function(){return M});function M(){return{type:"",id:-1,pid:-1,inputTimeScale:9e4,sequenceNumber:-1,samples:[],dropped:0}}},"./src/demux/exp-golomb.ts":function(K,P,p){p.r(P);var M=p("./src/utils/logger.ts"),O=function(){function A(D){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=D,this.bytesAvailable=D.byteLength,this.word=0,this.bitsAvailable=0}var F=A.prototype;return F.loadWord=function(){var R=this.data,L=this.bytesAvailable,g=R.byteLength-L,S=new Uint8Array(4),T=Math.min(4,L);if(T===0)throw new Error("no bytes available");S.set(R.subarray(g,g+T)),this.word=new DataView(S.buffer).getUint32(0),this.bitsAvailable=T*8,this.bytesAvailable-=T},F.skipBits=function(R){var L;this.bitsAvailable>R?(this.word<<=R,this.bitsAvailable-=R):(R-=this.bitsAvailable,L=R>>3,R-=L>>3,this.bytesAvailable-=L,this.loadWord(),this.word<<=R,this.bitsAvailable-=R)},F.readBits=function(R){var L=Math.min(this.bitsAvailable,R),g=this.word>>>32-L;return R>32&&M.logger.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=L,this.bitsAvailable>0?this.word<<=L:this.bytesAvailable>0&&this.loadWord(),L=R-L,L>0&&this.bitsAvailable?g<<L|this.readBits(L):g},F.skipLZ=function(){var R;for(R=0;R<this.bitsAvailable;++R)if((this.word&2147483648>>>R)!=0)return this.word<<=R,this.bitsAvailable-=R,R;return this.loadWord(),R+this.skipLZ()},F.skipUEG=function(){this.skipBits(1+this.skipLZ())},F.skipEG=function(){this.skipBits(1+this.skipLZ())},F.readUEG=function(){var R=this.skipLZ();return this.readBits(R+1)-1},F.readEG=function(){var R=this.readUEG();return 1&R?1+R>>>1:-1*(R>>>1)},F.readBoolean=function(){return this.readBits(1)===1},F.readUByte=function(){return this.readBits(8)},F.readUShort=function(){return this.readBits(16)},F.readUInt=function(){return this.readBits(32)},F.skipScalingList=function(R){for(var L=8,g=8,S,T=0;T<R;T++)g!==0&&(S=this.readEG(),g=(L+S+256)%256),L=g===0?L:g},F.readSPS=function(){var R=0,L=0,g=0,S=0,T,x,m,h=this.readUByte.bind(this),i=this.readBits.bind(this),e=this.readUEG.bind(this),r=this.readBoolean.bind(this),t=this.skipBits.bind(this),f=this.skipEG.bind(this),s=this.skipUEG.bind(this),n=this.skipScalingList.bind(this);h();var o=h();if(i(5),t(3),h(),s(),o===100||o===110||o===122||o===244||o===44||o===83||o===86||o===118||o===128){var c=e();if(c===3&&t(1),s(),s(),t(1),r())for(x=c!==3?8:12,m=0;m<x;m++)r()&&(m<6?n(16):n(64))}s();var v=e();if(v===0)e();else if(v===1)for(t(1),f(),f(),T=e(),m=0;m<T;m++)f();s(),t(1);var u=e(),a=e(),l=i(1);l===0&&t(1),t(1),r()&&(R=e(),L=e(),g=e(),S=e());var d=[1,1];if(r()&&r()){var E=h();switch(E){case 1:d=[1,1];break;case 2:d=[12,11];break;case 3:d=[10,11];break;case 4:d=[16,11];break;case 5:d=[40,33];break;case 6:d=[24,11];break;case 7:d=[20,11];break;case 8:d=[32,11];break;case 9:d=[80,33];break;case 10:d=[18,11];break;case 11:d=[15,11];break;case 12:d=[64,33];break;case 13:d=[160,99];break;case 14:d=[4,3];break;case 15:d=[3,2];break;case 16:d=[2,1];break;case 255:{d=[h()<<8|h(),h()<<8|h()];break}}}return{width:Math.ceil((u+1)*16-R*2-L*2),height:(2-l)*(a+1)*16-(l?2:4)*(g+S),pixelRatio:d}},F.readSliceType=function(){return this.readUByte(),this.readUEG(),this.readUEG()},A}();P.default=O},"./src/demux/id3.ts":function(K,P,p){p.r(P),p.d(P,"isHeader",function(){return M}),p.d(P,"isFooter",function(){return O}),p.d(P,"getID3Data",function(){return A}),p.d(P,"canParse",function(){return D}),p.d(P,"getTimeStamp",function(){return R}),p.d(P,"isTimeStampFrame",function(){return L}),p.d(P,"getID3Frames",function(){return S}),p.d(P,"decodeFrame",function(){return T}),p.d(P,"utf8ArrayToStr",function(){return e}),p.d(P,"testables",function(){return r});var M=function(n,o){return o+10<=n.length&&n[o]===73&&n[o+1]===68&&n[o+2]===51&&n[o+3]<255&&n[o+4]<255&&n[o+6]<128&&n[o+7]<128&&n[o+8]<128&&n[o+9]<128},O=function(n,o){return o+10<=n.length&&n[o]===51&&n[o+1]===68&&n[o+2]===73&&n[o+3]<255&&n[o+4]<255&&n[o+6]<128&&n[o+7]<128&&n[o+8]<128&&n[o+9]<128},A=function(n,o){for(var c=o,v=0;M(n,o);){v+=10;var u=F(n,o+6);v+=u,O(n,o+10)&&(v+=10),o+=v}if(v>0)return n.subarray(c,c+v)},F=function(n,o){var c=0;return c=(n[o]&127)<<21,c|=(n[o+1]&127)<<14,c|=(n[o+2]&127)<<7,c|=n[o+3]&127,c},D=function(n,o){return M(n,o)&&F(n,o+6)+10<=n.length-o},R=function(n){for(var o=S(n),c=0;c<o.length;c++){var v=o[c];if(L(v))return i(v)}},L=function(n){return n&&n.key==="PRIV"&&n.info==="com.apple.streaming.transportStreamTimestamp"},g=function(n){var o=String.fromCharCode(n[0],n[1],n[2],n[3]),c=F(n,4),v=10;return{type:o,size:c,data:n.subarray(v,v+c)}},S=function(n){for(var o=0,c=[];M(n,o);){var v=F(n,o+6);o+=10;for(var u=o+v;o+8<u;){var a=g(n.subarray(o)),l=T(a);l&&c.push(l),o+=a.size+10}O(n,o)&&(o+=10)}return c},T=function(n){return n.type==="PRIV"?x(n):n.type[0]==="W"?h(n):m(n)},x=function(n){if(!(n.size<2)){var o=e(n.data,!0),c=new Uint8Array(n.data.subarray(o.length+1));return{key:n.type,info:o,data:c.buffer}}},m=function(n){if(!(n.size<2)){if(n.type==="TXXX"){var o=1,c=e(n.data.subarray(o),!0);o+=c.length+1;var v=e(n.data.subarray(o));return{key:n.type,info:c,data:v}}var u=e(n.data.subarray(1));return{key:n.type,data:u}}},h=function(n){if(n.type==="WXXX"){if(n.size<2)return;var o=1,c=e(n.data.subarray(o),!0);o+=c.length+1;var v=e(n.data.subarray(o));return{key:n.type,info:c,data:v}}var u=e(n.data);return{key:n.type,data:u}},i=function(n){if(n.data.byteLength===8){var o=new Uint8Array(n.data),c=o[3]&1,v=(o[4]<<23)+(o[5]<<15)+(o[6]<<7)+o[7];return v/=45,c&&(v+=4772185884e-2),Math.round(v)}},e=function(n,o){o===void 0&&(o=!1);var c=f();if(c){var v=c.decode(n);if(o){var u=v.indexOf("\0");return u!==-1?v.substring(0,u):v}return v.replace(/\0/g,"")}for(var a=n.length,l,d,E,y="",I=0;I<a;){if(l=n[I++],l===0&&o)return y;if(l===0||l===3)continue;switch(l>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:y+=String.fromCharCode(l);break;case 12:case 13:d=n[I++],y+=String.fromCharCode((l&31)<<6|d&63);break;case 14:d=n[I++],E=n[I++],y+=String.fromCharCode((l&15)<<12|(d&63)<<6|(E&63)<<0);break}}return y},r={decodeTextFrame:m},t;function f(){return!t&&typeof self.TextDecoder!="undefined"&&(t=new self.TextDecoder("utf-8")),t}},"./src/demux/mp3demuxer.ts":function(K,P,p){p.r(P);var M=p("./src/demux/base-audio-demuxer.ts"),O=p("./src/demux/id3.ts"),A=p("./src/utils/logger.ts"),F=p("./src/demux/mpegaudio.ts");function D(g,S){g.prototype=Object.create(S.prototype),g.prototype.constructor=g,R(g,S)}function R(g,S){return R=Object.setPrototypeOf||function(x,m){return x.__proto__=m,x},R(g,S)}var L=function(g){D(S,g);function S(){return g.apply(this,arguments)||this}var T=S.prototype;return T.resetInitSegment=function(m,h,i){g.prototype.resetInitSegment.call(this,m,h,i),this._audioTrack={container:"audio/mpeg",type:"audio",id:0,pid:-1,sequenceNumber:0,isAAC:!1,samples:[],manifestCodec:m,duration:i,inputTimeScale:9e4,dropped:0}},S.probe=function(m){if(!m)return!1;for(var h=O.getID3Data(m,0)||[],i=h.length,e=m.length;i<e;i++)if(F.probe(m,i))return A.logger.log("MPEG Audio sync word found !"),!0;return!1},T.canParse=function(m,h){return F.canParse(m,h)},T.appendFrame=function(m,h,i){if(this.initPTS!==null)return F.appendFrame(m,h,i,this.initPTS,this.frameIndex)},S}(M.default);L.minProbeByteLength=4,P.default=L},"./src/demux/mp4demuxer.ts":function(K,P,p){p.r(P);var M=p("./src/utils/mp4-tools.ts"),O=p("./src/demux/dummy-demuxed-track.ts"),A=function(){function F(R,L){this.remainderData=null,this.config=void 0,this.config=L}var D=F.prototype;return D.resetTimeStamp=function(){},D.resetInitSegment=function(){},D.resetContiguity=function(){},F.probe=function(L){return Object(M.findBox)({data:L,start:0,end:Math.min(L.length,16384)},["moof"]).length>0},D.demux=function(L){var g=L,S=Object(O.dummyTrack)();if(this.config.progressive){this.remainderData&&(g=Object(M.appendUint8Array)(this.remainderData,L));var T=Object(M.segmentValidRange)(g);this.remainderData=T.remainder,S.samples=T.valid||new Uint8Array}else S.samples=g;return{audioTrack:Object(O.dummyTrack)(),avcTrack:S,id3Track:Object(O.dummyTrack)(),textTrack:Object(O.dummyTrack)()}},D.flush=function(){var L=Object(O.dummyTrack)();return L.samples=this.remainderData||new Uint8Array,this.remainderData=null,{audioTrack:Object(O.dummyTrack)(),avcTrack:L,id3Track:Object(O.dummyTrack)(),textTrack:Object(O.dummyTrack)()}},D.demuxSampleAes=function(L,g,S){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))},D.destroy=function(){},F}();A.minProbeByteLength=1024,P.default=A},"./src/demux/mpegaudio.ts":function(K,P,p){p.r(P),p.d(P,"appendFrame",function(){return R}),p.d(P,"parseHeader",function(){return L}),p.d(P,"isHeaderPattern",function(){return g}),p.d(P,"isHeader",function(){return S}),p.d(P,"canParse",function(){return T}),p.d(P,"probe",function(){return x});var M=null,O=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],A=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],F=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],D=[0,1,1,4];function R(m,h,i,e,r){if(!(i+24>h.length)){var t=L(h,i);if(t&&i+t.frameLength<=h.length){var f=t.samplesPerFrame*9e4/t.sampleRate,s=e+r*f,n={unit:h.subarray(i,i+t.frameLength),pts:s,dts:s};return m.config=[],m.channelCount=t.channelCount,m.samplerate=t.sampleRate,m.samples.push(n),{sample:n,length:t.frameLength,missing:0}}}}function L(m,h){var i=m[h+1]>>3&3,e=m[h+1]>>1&3,r=m[h+2]>>4&15,t=m[h+2]>>2&3;if(i!==1&&r!==0&&r!==15&&t!==3){var f=m[h+2]>>1&1,s=m[h+3]>>6,n=i===3?3-e:e===3?3:4,o=O[n*14+r-1]*1e3,c=i===3?0:i===2?1:2,v=A[c*3+t],u=s===3?1:2,a=F[i][e],l=D[e],d=a*8*l,E=Math.floor(a*o/v+f)*l;if(M===null){var y=navigator.userAgent||"",I=y.match(/Chrome\/(\d+)/i);M=I?parseInt(I[1]):0}var C=!!M&&M<=87;return C&&e===2&&o>=224e3&&s===0&&(m[h+3]=m[h+3]|128),{sampleRate:v,channelCount:u,frameLength:E,samplesPerFrame:d}}}function g(m,h){return m[h]===255&&(m[h+1]&224)==224&&(m[h+1]&6)!=0}function S(m,h){return h+1<m.length&&g(m,h)}function T(m,h){var i=4;return g(m,h)&&i<=m.length-h}function x(m,h){if(h+1<m.length&&g(m,h)){var i=4,e=L(m,h),r=i;e!=null&&e.frameLength&&(r=e.frameLength);var t=h+r;return t===m.length||S(m,t)}return!1}},"./src/demux/sample-aes.ts":function(K,P,p){p.r(P);var M=p("./src/crypt/decrypter.ts"),O=p("./src/demux/tsdemuxer.ts"),A=function(){function F(R,L,g){this.keyData=void 0,this.decrypter=void 0,this.keyData=g,this.decrypter=new M.default(R,L,{removePKCS7Padding:!1})}var D=F.prototype;return D.decryptBuffer=function(L,g){this.decrypter.decrypt(L,this.keyData.key.buffer,this.keyData.iv.buffer,g)},D.decryptAacSample=function(L,g,S,T){var x=L[g].unit,m=x.subarray(16,x.length-x.length%16),h=m.buffer.slice(m.byteOffset,m.byteOffset+m.length),i=this;this.decryptBuffer(h,function(e){var r=new Uint8Array(e);x.set(r,16),T||i.decryptAacSamples(L,g+1,S)})},D.decryptAacSamples=function(L,g,S){for(;;g++){if(g>=L.length){S();return}if(!(L[g].unit.length<32)){var T=this.decrypter.isSync();if(this.decryptAacSample(L,g,S,T),!T)return}}},D.getAvcEncryptedData=function(L){for(var g=Math.floor((L.length-48)/160)*16+16,S=new Int8Array(g),T=0,x=32;x<=L.length-16;x+=160,T+=16)S.set(L.subarray(x,x+16),T);return S},D.getAvcDecryptedUnit=function(L,g){for(var S=new Uint8Array(g),T=0,x=32;x<=L.length-16;x+=160,T+=16)L.set(S.subarray(T,T+16),x);return L},D.decryptAvcSample=function(L,g,S,T,x,m){var h=Object(O.discardEPB)(x.data),i=this.getAvcEncryptedData(h),e=this;this.decryptBuffer(i.buffer,function(r){x.data=e.getAvcDecryptedUnit(h,r),m||e.decryptAvcSamples(L,g,S+1,T)})},D.decryptAvcSamples=function(L,g,S,T){if(L instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;g++,S=0){if(g>=L.length){T();return}for(var x=L[g].units;!(S>=x.length);S++){var m=x[S];if(!(m.data.length<=48||m.type!==1&&m.type!==5)){var h=this.decrypter.isSync();if(this.decryptAvcSample(L,g,S,T,m,h),!h)return}}}},F}();P.default=A},"./src/demux/transmuxer-interface.ts":function(K,P,p){p.r(P),p.d(P,"default",function(){return S});var M=p("./node_modules/webworkify-webpack/index.js"),O=p("./src/events.ts"),A=p("./src/demux/transmuxer.ts"),F=p("./src/utils/logger.ts"),D=p("./src/errors.ts"),R=p("./src/utils/mediasource-helper.ts"),L=p("./node_modules/eventemitter3/index.js"),g=Object(R.getMediaSource)()||{isTypeSupported:function(){return!1}},S=function(){function T(m,h,i,e){var r=this;this.hls=void 0,this.id=void 0,this.observer=void 0,this.frag=null,this.part=null,this.worker=void 0,this.onwmsg=void 0,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0,this.hls=m,this.id=h,this.onTransmuxComplete=i,this.onFlush=e;var t=m.config,f=function(v,u){u=u||{},u.frag=r.frag,u.id=r.id,m.trigger(v,u)};this.observer=new L.EventEmitter,this.observer.on(O.Events.FRAG_DECRYPTED,f),this.observer.on(O.Events.ERROR,f);var s={mp4:g.isTypeSupported("video/mp4"),mpeg:g.isTypeSupported("audio/mpeg"),mp3:g.isTypeSupported('audio/mp4; codecs="mp3"')},n=navigator.vendor;if(t.enableWorker&&typeof Worker!="undefined"){F.logger.log("demuxing in webworker");var o;try{o=this.worker=M("./src/demux/transmuxer-worker.ts"),this.onwmsg=this.onWorkerMessage.bind(this),o.addEventListener("message",this.onwmsg),o.onerror=function(c){m.trigger(O.Events.ERROR,{type:D.ErrorTypes.OTHER_ERROR,details:D.ErrorDetails.INTERNAL_EXCEPTION,fatal:!0,event:"demuxerWorker",error:new Error(c.message+"  ("+c.filename+":"+c.lineno+")")})},o.postMessage({cmd:"init",typeSupported:s,vendor:n,id:h,config:JSON.stringify(t)})}catch(c){F.logger.warn("Error in worker:",c),F.logger.error("Error while initializing DemuxerWorker, fallback to inline"),o&&self.URL.revokeObjectURL(o.objectURL),this.transmuxer=new A.default(this.observer,s,t,n,h),this.worker=null}}else this.transmuxer=new A.default(this.observer,s,t,n,h)}var x=T.prototype;return x.destroy=function(){var h=this.worker;if(h)h.removeEventListener("message",this.onwmsg),h.terminate(),this.worker=null;else{var i=this.transmuxer;i&&(i.destroy(),this.transmuxer=null)}var e=this.observer;e&&e.removeAllListeners(),this.observer=null},x.push=function(h,i,e,r,t,f,s,n,o,c){var v=this;o.transmuxing.start=self.performance.now();var u=this.transmuxer,a=this.worker,l=f?f.start:t.start,d=t.decryptdata,E=this.frag,y=!(E&&t.cc===E.cc),I=!(E&&o.level===E.level),C=E?o.sn-E.sn:-1,_=this.part?o.part-this.part.index:1,B=!I&&(C===1||C===0&&_===1),U=self.performance.now();(I||C||t.stats.parsing.start===0)&&(t.stats.parsing.start=U),f&&(_||!B)&&(f.stats.parsing.start=U);var N=new A.TransmuxState(y,B,n,I,l);if(!B||y){F.logger.log("[transmuxer-interface, "+t.type+"]: Starting new transmux session for sn: "+o.sn+" p: "+o.part+" level: "+o.level+" id: "+o.id+`
        discontinuity: `+y+`
        trackSwitch: `+I+`
        contiguous: `+B+`
        accurateTimeOffset: `+n+`
        timeOffset: `+l);var k=new A.TransmuxConfig(e,r,i,s,c);this.configureTransmuxer(k)}if(this.frag=t,this.part=f,a)a.postMessage({cmd:"demux",data:h,decryptdata:d,chunkMeta:o,state:N},h instanceof ArrayBuffer?[h]:[]);else if(u){var w=u.push(h,d,o,N);Object(A.isPromise)(w)?w.then(function(G){v.handleTransmuxComplete(G)}):this.handleTransmuxComplete(w)}},x.flush=function(h){var i=this;h.transmuxing.start=self.performance.now();var e=this.transmuxer,r=this.worker;if(r)r.postMessage({cmd:"flush",chunkMeta:h});else if(e){var t=e.flush(h);Object(A.isPromise)(t)?t.then(function(f){i.handleFlushResult(f,h)}):this.handleFlushResult(t,h)}},x.handleFlushResult=function(h,i){var e=this;h.forEach(function(r){e.handleTransmuxComplete(r)}),this.onFlush(i)},x.onWorkerMessage=function(h){var i=h.data,e=this.hls;switch(i.event){case"init":{self.URL.revokeObjectURL(this.worker.objectURL);break}case"transmuxComplete":{this.handleTransmuxComplete(i.data);break}case"flush":{this.onFlush(i.data);break}default:{i.data=i.data||{},i.data.frag=this.frag,i.data.id=this.id,e.trigger(i.event,i.data);break}}},x.configureTransmuxer=function(h){var i=this.worker,e=this.transmuxer;i?i.postMessage({cmd:"configure",config:h}):e&&e.configure(h)},x.handleTransmuxComplete=function(h){h.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(h)},T}()},"./src/demux/transmuxer-worker.ts":function(K,P,p){p.r(P),p.d(P,"default",function(){return D});var M=p("./src/demux/transmuxer.ts"),O=p("./src/events.ts"),A=p("./src/utils/logger.ts"),F=p("./node_modules/eventemitter3/index.js");function D(T){var x=new F.EventEmitter,m=function(i,e){T.postMessage({event:i,data:e})};x.on(O.Events.FRAG_DECRYPTED,m),x.on(O.Events.ERROR,m),T.addEventListener("message",function(h){var i=h.data;switch(i.cmd){case"init":{var e=JSON.parse(i.config);T.transmuxer=new M.default(x,i.typeSupported,e,i.vendor,i.id),Object(A.enableLogs)(e.debug),m("init",null);break}case"configure":{T.transmuxer.configure(i.config);break}case"demux":{var r=T.transmuxer.push(i.data,i.decryptdata,i.chunkMeta,i.state);Object(M.isPromise)(r)?r.then(function(s){R(T,s)}):R(T,r);break}case"flush":{var t=i.chunkMeta,f=T.transmuxer.flush(t);Object(M.isPromise)(f)?f.then(function(s){g(T,s,t)}):g(T,f,t);break}}})}function R(T,x){if(!S(x.remuxResult)){var m=[],h=x.remuxResult,i=h.audio,e=h.video;i&&L(m,i),e&&L(m,e),T.postMessage({event:"transmuxComplete",data:x},m)}}function L(T,x){x.data1&&T.push(x.data1.buffer),x.data2&&T.push(x.data2.buffer)}function g(T,x,m){x.forEach(function(h){R(T,h)}),T.postMessage({event:"flush",data:m})}function S(T){return!T.audio&&!T.video&&!T.text&&!T.id3&&!T.initSegment}},"./src/demux/transmuxer.ts":function(K,P,p){p.r(P),p.d(P,"default",function(){return r}),p.d(P,"isPromise",function(){return s}),p.d(P,"TransmuxConfig",function(){return n}),p.d(P,"TransmuxState",function(){return o});var M=p("./src/events.ts"),O=p("./src/errors.ts"),A=p("./src/crypt/decrypter.ts"),F=p("./src/demux/aacdemuxer.ts"),D=p("./src/demux/mp4demuxer.ts"),R=p("./src/demux/tsdemuxer.ts"),L=p("./src/demux/mp3demuxer.ts"),g=p("./src/remux/mp4-remuxer.ts"),S=p("./src/remux/passthrough-remuxer.ts"),T=p("./src/demux/chunk-cache.ts"),x=p("./src/utils/mp4-tools.ts"),m=p("./src/utils/logger.ts"),h;try{h=self.performance.now.bind(self.performance)}catch{m.logger.debug("Unable to use Performance API on this environment"),h=self.Date.now}var i=[{demux:R.default,remux:g.default},{demux:D.default,remux:S.default},{demux:F.default,remux:g.default},{demux:L.default,remux:g.default}],e=1024;i.forEach(function(c){var v=c.demux;e=Math.max(e,v.minProbeByteLength)});var r=function(){function c(u,a,l,d,E){this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.vendor=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.cache=new T.default,this.observer=u,this.typeSupported=a,this.config=l,this.vendor=d,this.id=E}var v=c.prototype;return v.configure=function(a){this.transmuxConfig=a,this.decrypter&&this.decrypter.reset()},v.push=function(a,l,d,E){var y=this,I=d.transmuxing;I.executeStart=h();var C=new Uint8Array(a),_=this.cache,B=this.config,U=this.currentTransmuxState,N=this.transmuxConfig;E&&(this.currentTransmuxState=E);var k=t(C,l);if(k&&k.method==="AES-128"){var w=this.getDecrypter();if(B.enableSoftwareAES){var G=w.softwareDecrypt(C,k.key.buffer,k.iv.buffer);if(!G)return I.executeEnd=h(),f(d);C=new Uint8Array(G)}else return this.decryptionPromise=w.webCryptoDecrypt(C,k.key.buffer,k.iv.buffer).then(function(fe){var se=y.push(fe,null,d);return y.decryptionPromise=null,se}),this.decryptionPromise}var W=E||U,Y=W.contiguous,H=W.discontinuity,z=W.trackSwitch,Q=W.accurateTimeOffset,$=W.timeOffset,X=N.audioCodec,J=N.videoCodec,Z=N.defaultInitPts,q=N.duration,ee=N.initSegmentData;if((H||z)&&this.resetInitSegment(ee,X,J,q),H&&this.resetInitialTimestamp(Z),Y||this.resetContiguity(),this.needsProbing(C,H,z)){if(_.dataLength){var ae=_.flush();C=Object(x.appendUint8Array)(ae,C)}this.configureTransmuxer(C,N)}var te=this.transmux(C,k,$,Q,d),ie=this.currentTransmuxState;return ie.contiguous=!0,ie.discontinuity=!1,ie.trackSwitch=!1,I.executeEnd=h(),te},v.flush=function(a){var l=this,d=a.transmuxing;d.executeStart=h();var E=this.decrypter,y=this.cache,I=this.currentTransmuxState,C=this.decryptionPromise;if(C)return C.then(function(){return l.flush(a)});var _=[],B=I.timeOffset;if(E){var U=E.flush();U&&_.push(this.push(U,null,a))}var N=y.dataLength;y.reset();var k=this.demuxer,w=this.remuxer;if(!k||!w)return N>=e&&this.observer.emit(M.Events.ERROR,M.Events.ERROR,{type:O.ErrorTypes.MEDIA_ERROR,details:O.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"no demux matching with content found"}),d.executeEnd=h(),[f(a)];var G=k.flush(B);return s(G)?G.then(function(W){return l.flushRemux(_,W,a),_}):(this.flushRemux(_,G,a),_)},v.flushRemux=function(a,l,d){var E=l.audioTrack,y=l.avcTrack,I=l.id3Track,C=l.textTrack,_=this.currentTransmuxState,B=_.accurateTimeOffset,U=_.timeOffset;m.logger.log("[transmuxer.ts]: Flushed fragment "+d.sn+(d.part>-1?" p: "+d.part:"")+" of level "+d.level);var N=this.remuxer.remux(E,y,I,C,U,B,!0,this.id);a.push({remuxResult:N,chunkMeta:d}),d.transmuxing.executeEnd=h()},v.resetInitialTimestamp=function(a){var l=this.demuxer,d=this.remuxer;!l||!d||(l.resetTimeStamp(a),d.resetTimeStamp(a))},v.resetContiguity=function(){var a=this.demuxer,l=this.remuxer;!a||!l||(a.resetContiguity(),l.resetNextTimestamp())},v.resetInitSegment=function(a,l,d,E){var y=this.demuxer,I=this.remuxer;!y||!I||(y.resetInitSegment(l,d,E),I.resetInitSegment(a,l,d))},v.destroy=function(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)},v.transmux=function(a,l,d,E,y){var I;return l&&l.method==="SAMPLE-AES"?I=this.transmuxSampleAes(a,l,d,E,y):I=this.transmuxUnencrypted(a,d,E,y),I},v.transmuxUnencrypted=function(a,l,d,E){var y=this.demuxer.demux(a,l,!1,!this.config.progressive),I=y.audioTrack,C=y.avcTrack,_=y.id3Track,B=y.textTrack,U=this.remuxer.remux(I,C,_,B,l,d,!1,this.id);return{remuxResult:U,chunkMeta:E}},v.transmuxSampleAes=function(a,l,d,E,y){var I=this;return this.demuxer.demuxSampleAes(a,l,d).then(function(C){var _=I.remuxer.remux(C.audioTrack,C.avcTrack,C.id3Track,C.textTrack,d,E,!1,I.id);return{remuxResult:_,chunkMeta:y}})},v.configureTransmuxer=function(a,l){for(var d=this.config,E=this.observer,y=this.typeSupported,I=this.vendor,C=l.audioCodec,_=l.defaultInitPts,B=l.duration,U=l.initSegmentData,N=l.videoCodec,k,w=0,G=i.length;w<G;w++)if(i[w].demux.probe(a)){k=i[w];break}k||(m.logger.warn("Failed to find demuxer by probing frag, treating as mp4 passthrough"),k={demux:D.default,remux:S.default});var W=this.demuxer,Y=this.remuxer,H=k.remux,z=k.demux;(!Y||!(Y instanceof H))&&(this.remuxer=new H(E,d,y,I)),(!W||!(W instanceof z))&&(this.demuxer=new z(E,d,y),this.probe=z.probe),this.resetInitSegment(U,C,N,B),this.resetInitialTimestamp(_)},v.needsProbing=function(a,l,d){return!this.demuxer||!this.remuxer||l||d},v.getDecrypter=function(){var a=this.decrypter;return a||(a=this.decrypter=new A.default(this.observer,this.config)),a},c}();function t(c,v){var u=null;return c.byteLength>0&&v!=null&&v.key!=null&&v.iv!==null&&v.method!=null&&(u=v),u}var f=function(v){return{remuxResult:{},chunkMeta:v}};function s(c){return"then"in c&&c.then instanceof Function}var n=function(v,u,a,l,d){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=v,this.videoCodec=u,this.initSegmentData=a,this.duration=l,this.defaultInitPts=d},o=function(v,u,a,l,d){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.discontinuity=v,this.contiguous=u,this.accurateTimeOffset=a,this.trackSwitch=l,this.timeOffset=d}},"./src/demux/tsdemuxer.ts":function(K,P,p){p.r(P),p.d(P,"discardEPB",function(){return f});var M=p("./src/demux/adts.ts"),O=p("./src/demux/mpegaudio.ts"),A=p("./src/demux/exp-golomb.ts"),F=p("./src/demux/id3.ts"),D=p("./src/demux/sample-aes.ts"),R=p("./src/events.ts"),L=p("./src/utils/mp4-tools.ts"),g=p("./src/utils/logger.ts"),S=p("./src/errors.ts"),T={video:1,audio:2,id3:3,text:4},x=function(){function s(o,c,v){this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._duration=0,this.aacLastPTS=null,this._initPTS=null,this._initDTS=null,this._pmtId=-1,this._avcTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.observer=o,this.config=c,this.typeSupported=v}s.probe=function(c){var v=s.syncOffset(c);return v<0?!1:(v&&g.logger.warn("MPEG2-TS detected but first sync word found @ offset "+v+", junk ahead ?"),!0)},s.syncOffset=function(c){for(var v=Math.min(1e3,c.length-3*188),u=0;u<v;){if(c[u]===71&&c[u+188]===71&&c[u+2*188]===71)return u;u++}return-1},s.createTrack=function(c,v){return{container:c==="video"||c==="audio"?"video/mp2t":void 0,type:c,id:T[c],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:c==="audio"?v:void 0}};var n=s.prototype;return n.resetInitSegment=function(c,v,u){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack=s.createTrack("video",u),this._audioTrack=s.createTrack("audio",u),this._id3Track=s.createTrack("id3",u),this._txtTrack=s.createTrack("text",u),this._audioTrack.isAAC=!0,this.aacOverFlow=null,this.aacLastPTS=null,this.avcSample=null,this.audioCodec=c,this.videoCodec=v,this._duration=u},n.resetTimeStamp=function(){},n.resetContiguity=function(){var c=this._audioTrack,v=this._avcTrack,u=this._id3Track;c&&(c.pesData=null),v&&(v.pesData=null),u&&(u.pesData=null),this.aacOverFlow=null,this.aacLastPTS=null},n.demux=function(c,v,u,a){u===void 0&&(u=!1),a===void 0&&(a=!1),u||(this.sampleAes=null);var l,d=this._avcTrack,E=this._audioTrack,y=this._id3Track,I=d.pid,C=d.pesData,_=E.pid,B=y.pid,U=E.pesData,N=y.pesData,k=!1,w=this.pmtParsed,G=this._pmtId,W=c.length;if(this.remainderData&&(c=Object(L.appendUint8Array)(this.remainderData,c),W=c.length,this.remainderData=null),W<188&&!a)return this.remainderData=c,{audioTrack:E,avcTrack:d,id3Track:y,textTrack:this._txtTrack};var Y=Math.max(0,s.syncOffset(c));W-=(W+Y)%188,W<c.byteLength&&!a&&(this.remainderData=new Uint8Array(c.buffer,W,c.buffer.byteLength-W));for(var H=Y;H<W;H+=188)if(c[H]===71){var z=!!(c[H+1]&64),Q=((c[H+1]&31)<<8)+c[H+2],$=(c[H+3]&48)>>4,X=void 0;if($>1){if(X=H+5+c[H+4],X===H+188)continue}else X=H+4;switch(Q){case I:z&&(C&&(l=e(C))&&this.parseAVCPES(l,!1),C={data:[],size:0}),C&&(C.data.push(c.subarray(X,H+188)),C.size+=H+188-X);break;case _:z&&(U&&(l=e(U))&&(E.isAAC?this.parseAACPES(l):this.parseMPEGPES(l)),U={data:[],size:0}),U&&(U.data.push(c.subarray(X,H+188)),U.size+=H+188-X);break;case B:z&&(N&&(l=e(N))&&this.parseID3PES(l),N={data:[],size:0}),N&&(N.data.push(c.subarray(X,H+188)),N.size+=H+188-X);break;case 0:z&&(X+=c[X]+1),G=this._pmtId=h(c,X);break;case G:{z&&(X+=c[X]+1);var J=i(c,X,this.typeSupported.mpeg===!0||this.typeSupported.mp3===!0,u);I=J.avc,I>0&&(d.pid=I),_=J.audio,_>0&&(E.pid=_,E.isAAC=J.isAAC),B=J.id3,B>0&&(y.pid=B),k&&!w&&(g.logger.log("reparse from beginning"),k=!1,H=Y-188),w=this.pmtParsed=!0;break}case 17:case 8191:break;default:k=!0;break}}else this.observer.emit(R.Events.ERROR,R.Events.ERROR,{type:S.ErrorTypes.MEDIA_ERROR,details:S.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"TS packet did not start with 0x47"});d.pesData=C,E.pesData=U,y.pesData=N;var Z={audioTrack:E,avcTrack:d,id3Track:y,textTrack:this._txtTrack};return a&&this.extractRemainingSamples(Z),Z},n.flush=function(){var c=this.remainderData;this.remainderData=null;var v;return c?v=this.demux(c,-1,!1,!0):v={audioTrack:this._audioTrack,avcTrack:this._avcTrack,textTrack:this._txtTrack,id3Track:this._id3Track},this.extractRemainingSamples(v),this.sampleAes?this.decrypt(v,this.sampleAes):v},n.extractRemainingSamples=function(c){var v=c.audioTrack,u=c.avcTrack,a=c.id3Track,l=u.pesData,d=v.pesData,E=a.pesData,y;l&&(y=e(l))?(this.parseAVCPES(y,!0),u.pesData=null):u.pesData=l,d&&(y=e(d))?(v.isAAC?this.parseAACPES(y):this.parseMPEGPES(y),v.pesData=null):(d!=null&&d.size&&g.logger.log("last AAC PES packet truncated,might overlap between fragments"),v.pesData=d),E&&(y=e(E))?(this.parseID3PES(y),a.pesData=null):a.pesData=E},n.demuxSampleAes=function(c,v,u){var a=this.demux(c,u,!0,!this.config.progressive),l=this.sampleAes=new D.default(this.observer,this.config,v);return this.decrypt(a,l)},n.decrypt=function(c,v){return new Promise(function(u){var a=c.audioTrack,l=c.avcTrack;a.samples&&a.isAAC?v.decryptAacSamples(a.samples,0,function(){l.samples?v.decryptAvcSamples(l.samples,0,0,function(){u(c)}):u(c)}):l.samples&&v.decryptAvcSamples(l.samples,0,0,function(){u(c)})})},n.destroy=function(){this._initPTS=this._initDTS=null,this._duration=0},n.parseAVCPES=function(c,v){var u=this,a=this._avcTrack,l=this.parseAVCNALu(c.data),d=this.avcSample,E,y=!1;c.data=null,d&&l.length&&!a.audFound&&(r(d,a),d=this.avcSample=m(!1,c.pts,c.dts,"")),l.forEach(function(I){switch(I.type){case 1:{E=!0,d||(d=u.avcSample=m(!0,c.pts,c.dts,"")),d.frame=!0;var C=I.data;if(y&&C.length>4){var _=new A.default(C).readSliceType();(_===2||_===4||_===7||_===9)&&(d.key=!0)}break}case 5:E=!0,d||(d=u.avcSample=m(!0,c.pts,c.dts,"")),d.key=!0,d.frame=!0;break;case 6:{E=!0;var B=new A.default(f(I.data));B.readUByte();for(var U=0,N=0,k=!1,w=0;!k&&B.bytesAvailable>1;){U=0;do w=B.readUByte(),U+=w;while(w===255);N=0;do w=B.readUByte(),N+=w;while(w===255);if(U===4&&B.bytesAvailable!==0){k=!0;var G=B.readUByte();if(G===181){var W=B.readUShort();if(W===49){var Y=B.readUInt();if(Y===1195456820){var H=B.readUByte();if(H===3){for(var z=B.readUByte(),Q=B.readUByte(),$=31&z,X=[z,Q],J=0;J<$;J++)X.push(B.readUByte()),X.push(B.readUByte()),X.push(B.readUByte());t(u._txtTrack.samples,{type:3,pts:c.pts,bytes:X})}}}}}else if(U===5&&B.bytesAvailable!==0){if(k=!0,N>16){for(var Z=[],q=0;q<16;q++)Z.push(B.readUByte().toString(16)),(q===3||q===5||q===7||q===9)&&Z.push("-");for(var ee=N-16,ae=new Uint8Array(ee),te=0;te<ee;te++)ae[te]=B.readUByte();t(u._txtTrack.samples,{pts:c.pts,payloadType:U,uuid:Z.join(""),userData:Object(F.utf8ArrayToStr)(ae),userDataBytes:ae})}}else if(N<B.bytesAvailable)for(var ie=0;ie<N;ie++)B.readUByte()}break}case 7:if(E=!0,y=!0,!a.sps){var fe=new A.default(I.data),se=fe.readSPS();a.width=se.width,a.height=se.height,a.pixelRatio=se.pixelRatio,a.sps=[I.data],a.duration=u._duration;for(var de=I.data.subarray(1,4),oe="avc1.",ce=0;ce<3;ce++){var re=de[ce].toString(16);re.length<2&&(re="0"+re),oe+=re}a.codec=oe}break;case 8:E=!0,a.pps||(a.pps=[I.data]);break;case 9:E=!1,a.audFound=!0,d&&r(d,a),d=u.avcSample=m(!1,c.pts,c.dts,"");break;case 12:E=!1;break;default:E=!1,d&&(d.debug+="unknown NAL "+I.type+" ");break}if(d&&E){var De=d.units;De.push(I)}}),v&&d&&(r(d,a),this.avcSample=null)},n.getLastNalUnit=function(){var c,v=this.avcSample,u;if(!v||v.units.length===0){var a=this._avcTrack.samples;v=a[a.length-1]}if((c=v)!==null&&c!==void 0&&c.units){var l=v.units;u=l[l.length-1]}return u},n.parseAVCNALu=function(c){var v=c.byteLength,u=this._avcTrack,a=u.naluState||0,l=a,d=[],E=0,y,I,C,_=-1,B=0;for(a===-1&&(_=0,B=c[0]&31,a=0,E=1);E<v;){if(y=c[E++],!a){a=y?0:1;continue}if(a===1){a=y?0:2;continue}if(!y)a=3;else if(y===1){if(_>=0){var U={data:c.subarray(_,E-a-1),type:B};d.push(U)}else{var N=this.getLastNalUnit();if(N&&(l&&E<=4-l&&N.state&&(N.data=N.data.subarray(0,N.data.byteLength-l)),I=E-a-1,I>0)){var k=new Uint8Array(N.data.byteLength+I);k.set(N.data,0),k.set(c.subarray(0,I),N.data.byteLength),N.data=k}}E<v?(C=c[E]&31,_=E,B=C,a=0):a=-1}else a=0}if(_>=0&&a>=0){var w={data:c.subarray(_,v),type:B,state:a};d.push(w)}if(d.length===0){var G=this.getLastNalUnit();if(G){var W=new Uint8Array(G.data.byteLength+c.byteLength);W.set(G.data,0),W.set(c,G.data.byteLength),G.data=W}}return u.naluState=a,d},n.parseAACPES=function(c){var v=0,u=this._audioTrack,a=this.aacOverFlow,l=c.data;if(a){this.aacOverFlow=null;var d=a.sample.unit.byteLength,E=Math.min(a.missing,d),y=d-E;a.sample.unit.set(l.subarray(0,E),y),u.samples.push(a.sample),v=a.missing}var I,C;for(I=v,C=l.length;I<C-1&&!M.isHeader(l,I);I++);if(I!==v){var _,B;if(I<C-1?(_="AAC PES did not start with ADTS header,offset:"+I,B=!1):(_="no ADTS header found in AAC PES",B=!0),g.logger.warn("parsing error:"+_),this.observer.emit(R.Events.ERROR,R.Events.ERROR,{type:S.ErrorTypes.MEDIA_ERROR,details:S.ErrorDetails.FRAG_PARSING_ERROR,fatal:B,reason:_}),B)return}M.initTrackConfig(u,this.observer,l,I,this.audioCodec);var U;if(c.pts!==void 0)U=c.pts;else if(a){var N=M.getFrameDuration(u.samplerate);U=a.sample.pts+N}else{g.logger.warn("[tsdemuxer]: AAC PES unknown PTS");return}for(var k=0;I<C;)if(M.isHeader(l,I)){if(I+5<C){var w=M.appendFrame(u,l,I,U,k);if(w)if(w.missing)this.aacOverFlow=w;else{I+=w.length,k++;continue}}break}else I++},n.parseMPEGPES=function(c){var v=c.data,u=v.length,a=0,l=0,d=c.pts;if(d===void 0){g.logger.warn("[tsdemuxer]: MPEG PES unknown PTS");return}for(;l<u;)if(O.isHeader(v,l)){var E=O.appendFrame(this._audioTrack,v,l,d,a);if(E)l+=E.length,a++;else break}else l++},n.parseID3PES=function(c){if(c.pts===void 0){g.logger.warn("[tsdemuxer]: ID3 PES unknown PTS");return}this._id3Track.samples.push(c)},s}();x.minProbeByteLength=188;function m(s,n,o,c){return{key:s,frame:!1,pts:n,dts:o,units:[],debug:c,length:0}}function h(s,n){return(s[n+10]&31)<<8|s[n+11]}function i(s,n,o,c){var v={audio:-1,avc:-1,id3:-1,isAAC:!0},u=(s[n+1]&15)<<8|s[n+2],a=n+3+u-4,l=(s[n+10]&15)<<8|s[n+11];for(n+=12+l;n<a;){var d=(s[n+1]&31)<<8|s[n+2];switch(s[n]){case 207:if(!c){g.logger.log("ADTS AAC with AES-128-CBC frame encryption found in unencrypted stream");break}case 15:v.audio===-1&&(v.audio=d);break;case 21:v.id3===-1&&(v.id3=d);break;case 219:if(!c){g.logger.log("H.264 with AES-128-CBC slice encryption found in unencrypted stream");break}case 27:v.avc===-1&&(v.avc=d);break;case 3:case 4:o?v.audio===-1&&(v.audio=d,v.isAAC=!1):g.logger.log("MPEG audio found, not supported in this browser");break;case 36:g.logger.warn("Unsupported HEVC stream type found");break}n+=((s[n+3]&15)<<8|s[n+4])+5}return v}function e(s){var n=0,o,c,v,u,a,l=s.data;if(!s||s.size===0)return null;for(;l[0].length<19&&l.length>1;){var d=new Uint8Array(l[0].length+l[1].length);d.set(l[0]),d.set(l[1],l[0].length),l[0]=d,l.splice(1,1)}o=l[0];var E=(o[0]<<16)+(o[1]<<8)+o[2];if(E===1){if(c=(o[4]<<8)+o[5],c&&c>s.size-6)return null;var y=o[7];y&192&&(u=(o[9]&14)*536870912+(o[10]&255)*4194304+(o[11]&254)*16384+(o[12]&255)*128+(o[13]&254)/2,y&64?(a=(o[14]&14)*536870912+(o[15]&255)*4194304+(o[16]&254)*16384+(o[17]&255)*128+(o[18]&254)/2,u-a>60*9e4&&(g.logger.warn(Math.round((u-a)/9e4)+"s delta between PTS and DTS, align them"),u=a)):a=u),v=o[8];var I=v+9;if(s.size<=I)return null;s.size-=I;for(var C=new Uint8Array(s.size),_=0,B=l.length;_<B;_++){o=l[_];var U=o.byteLength;if(I)if(I>U){I-=U;continue}else o=o.subarray(I),U-=I,I=0;C.set(o,n),n+=U}return c&&(c-=v+3),{data:C,pts:u,dts:a,len:c}}return null}function r(s,n){if(s.units.length&&s.frame){if(s.pts===void 0){var o=n.samples,c=o.length;if(c){var v=o[c-1];s.pts=v.pts,s.dts=v.dts}else{n.dropped++;return}}n.samples.push(s)}s.debug.length&&g.logger.log(s.pts+"/"+s.dts+":"+s.debug)}function t(s,n){var o=s.length;if(o>0){if(n.pts>=s[o-1].pts)s.push(n);else for(var c=o-1;c>=0;c--)if(n.pts<s[c].pts){s.splice(c,0,n);break}}else s.push(n)}function f(s){for(var n=s.byteLength,o=[],c=1;c<n-2;)s[c]===0&&s[c+1]===0&&s[c+2]===3?(o.push(c+2),c+=2):c++;if(o.length===0)return s;var v=n-o.length,u=new Uint8Array(v),a=0;for(c=0;c<v;a++,c++)a===o[0]&&(a++,o.shift()),u[c]=s[a];return u}P.default=x},"./src/errors.ts":function(K,P,p){p.r(P),p.d(P,"ErrorTypes",function(){return M}),p.d(P,"ErrorDetails",function(){return O});var M;(function(A){A.NETWORK_ERROR="networkError",A.MEDIA_ERROR="mediaError",A.KEY_SYSTEM_ERROR="keySystemError",A.MUX_ERROR="muxError",A.OTHER_ERROR="otherError"})(M||(M={}));var O;(function(A){A.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",A.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",A.KEY_SYSTEM_NO_SESSION="keySystemNoSession",A.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",A.KEY_SYSTEM_NO_INIT_DATA="keySystemNoInitData",A.MANIFEST_LOAD_ERROR="manifestLoadError",A.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",A.MANIFEST_PARSING_ERROR="manifestParsingError",A.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",A.LEVEL_EMPTY_ERROR="levelEmptyError",A.LEVEL_LOAD_ERROR="levelLoadError",A.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",A.LEVEL_SWITCH_ERROR="levelSwitchError",A.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",A.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",A.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",A.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",A.FRAG_LOAD_ERROR="fragLoadError",A.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",A.FRAG_DECRYPT_ERROR="fragDecryptError",A.FRAG_PARSING_ERROR="fragParsingError",A.REMUX_ALLOC_ERROR="remuxAllocError",A.KEY_LOAD_ERROR="keyLoadError",A.KEY_LOAD_TIMEOUT="keyLoadTimeOut",A.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",A.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",A.BUFFER_APPEND_ERROR="bufferAppendError",A.BUFFER_APPENDING_ERROR="bufferAppendingError",A.BUFFER_STALLED_ERROR="bufferStalledError",A.BUFFER_FULL_ERROR="bufferFullError",A.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",A.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",A.INTERNAL_EXCEPTION="internalException",A.INTERNAL_ABORTED="aborted",A.UNKNOWN="unknown"})(O||(O={}))},"./src/events.ts":function(K,P,p){p.r(P),p.d(P,"Events",function(){return M});var M;(function(O){O.MEDIA_ATTACHING="hlsMediaAttaching",O.MEDIA_ATTACHED="hlsMediaAttached",O.MEDIA_DETACHING="hlsMediaDetaching",O.MEDIA_DETACHED="hlsMediaDetached",O.BUFFER_RESET="hlsBufferReset",O.BUFFER_CODECS="hlsBufferCodecs",O.BUFFER_CREATED="hlsBufferCreated",O.BUFFER_APPENDING="hlsBufferAppending",O.BUFFER_APPENDED="hlsBufferAppended",O.BUFFER_EOS="hlsBufferEos",O.BUFFER_FLUSHING="hlsBufferFlushing",O.BUFFER_FLUSHED="hlsBufferFlushed",O.MANIFEST_LOADING="hlsManifestLoading",O.MANIFEST_LOADED="hlsManifestLoaded",O.MANIFEST_PARSED="hlsManifestParsed",O.LEVEL_SWITCHING="hlsLevelSwitching",O.LEVEL_SWITCHED="hlsLevelSwitched",O.LEVEL_LOADING="hlsLevelLoading",O.LEVEL_LOADED="hlsLevelLoaded",O.LEVEL_UPDATED="hlsLevelUpdated",O.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",O.LEVELS_UPDATED="hlsLevelsUpdated",O.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",O.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",O.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",O.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",O.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",O.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",O.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",O.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",O.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",O.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",O.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",O.CUES_PARSED="hlsCuesParsed",O.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",O.INIT_PTS_FOUND="hlsInitPtsFound",O.FRAG_LOADING="hlsFragLoading",O.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",O.FRAG_LOADED="hlsFragLoaded",O.FRAG_DECRYPTED="hlsFragDecrypted",O.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",O.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",O.FRAG_PARSING_METADATA="hlsFragParsingMetadata",O.FRAG_PARSED="hlsFragParsed",O.FRAG_BUFFERED="hlsFragBuffered",O.FRAG_CHANGED="hlsFragChanged",O.FPS_DROP="hlsFpsDrop",O.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",O.ERROR="hlsError",O.DESTROYING="hlsDestroying",O.KEY_LOADING="hlsKeyLoading",O.KEY_LOADED="hlsKeyLoaded",O.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",O.BACK_BUFFER_REACHED="hlsBackBufferReached"})(M||(M={}))},"./src/hls.ts":function(K,P,p){p.r(P),p.d(P,"default",function(){return t});var M=p("./node_modules/url-toolkit/src/url-toolkit.js"),O=p("./src/loader/playlist-loader.ts"),A=p("./src/loader/key-loader.ts"),F=p("./src/controller/id3-track-controller.ts"),D=p("./src/controller/latency-controller.ts"),R=p("./src/controller/level-controller.ts"),L=p("./src/controller/fragment-tracker.ts"),g=p("./src/controller/stream-controller.ts"),S=p("./src/is-supported.ts"),T=p("./src/utils/logger.ts"),x=p("./src/config.ts"),m=p("./node_modules/eventemitter3/index.js"),h=p("./src/events.ts"),i=p("./src/errors.ts");function e(f,s){for(var n=0;n<s.length;n++){var o=s[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(f,o.key,o)}}function r(f,s,n){return s&&e(f.prototype,s),n&&e(f,n),f}var t=function(){f.isSupported=function(){return Object(S.isSupported)()};function f(n){n===void 0&&(n={}),this.config=void 0,this.userConfig=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new m.EventEmitter,this._autoLevelCapping=void 0,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this.url=null;var o=this.config=Object(x.mergeConfig)(f.DefaultConfig,n);this.userConfig=n,Object(T.enableLogs)(o.debug),this._autoLevelCapping=-1,o.progressive&&Object(x.enableStreamingMode)(o);var c=o.abrController,v=o.bufferController,u=o.capLevelController,a=o.fpsController,l=this.abrController=new c(this),d=this.bufferController=new v(this),E=this.capLevelController=new u(this),y=new a(this),I=new O.default(this),C=new A.default(this),_=new F.default(this),B=this.levelController=new R.default(this),U=new L.FragmentTracker(this),N=this.streamController=new g.default(this,U);E.setStreamController(N),y.setStreamController(N);var k=[B,N];this.networkControllers=k;var w=[I,C,l,d,E,y,_,U];this.audioTrackController=this.createController(o.audioTrackController,null,k),this.createController(o.audioStreamController,U,k),this.subtitleTrackController=this.createController(o.subtitleTrackController,null,k),this.createController(o.subtitleStreamController,U,k),this.createController(o.timelineController,null,w),this.emeController=this.createController(o.emeController,null,w),this.cmcdController=this.createController(o.cmcdController,null,w),this.latencyController=this.createController(D.default,null,w),this.coreComponents=w}var s=f.prototype;return s.createController=function(o,c,v){if(o){var u=c?new o(this,c):new o(this);return v&&v.push(u),u}return null},s.on=function(o,c,v){v===void 0&&(v=this),this._emitter.on(o,c,v)},s.once=function(o,c,v){v===void 0&&(v=this),this._emitter.once(o,c,v)},s.removeAllListeners=function(o){this._emitter.removeAllListeners(o)},s.off=function(o,c,v,u){v===void 0&&(v=this),this._emitter.off(o,c,v,u)},s.listeners=function(o){return this._emitter.listeners(o)},s.emit=function(o,c,v){return this._emitter.emit(o,c,v)},s.trigger=function(o,c){if(this.config.debug)return this.emit(o,o,c);try{return this.emit(o,o,c)}catch(v){T.logger.error("An internal error happened while handling event "+o+'. Error message: "'+v.message+'". Here is a stacktrace:',v),this.trigger(h.Events.ERROR,{type:i.ErrorTypes.OTHER_ERROR,details:i.ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:o,error:v})}return!1},s.listenerCount=function(o){return this._emitter.listenerCount(o)},s.destroy=function(){T.logger.log("destroy"),this.trigger(h.Events.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this.url=null,this.networkControllers.forEach(function(o){return o.destroy()}),this.networkControllers.length=0,this.coreComponents.forEach(function(o){return o.destroy()}),this.coreComponents.length=0},s.attachMedia=function(o){T.logger.log("attachMedia"),this._media=o,this.trigger(h.Events.MEDIA_ATTACHING,{media:o})},s.detachMedia=function(){T.logger.log("detachMedia"),this.trigger(h.Events.MEDIA_DETACHING,void 0),this._media=null},s.loadSource=function(o){this.stopLoad();var c=this.media,v=this.url,u=this.url=M.buildAbsoluteURL(self.location.href,o,{alwaysNormalize:!0});T.logger.log("loadSource:"+u),c&&v&&v!==u&&this.bufferController.hasSourceTypes()&&(this.detachMedia(),this.attachMedia(c)),this.trigger(h.Events.MANIFEST_LOADING,{url:o})},s.startLoad=function(o){o===void 0&&(o=-1),T.logger.log("startLoad("+o+")"),this.networkControllers.forEach(function(c){c.startLoad(o)})},s.stopLoad=function(){T.logger.log("stopLoad"),this.networkControllers.forEach(function(o){o.stopLoad()})},s.swapAudioCodec=function(){T.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()},s.recoverMediaError=function(){T.logger.log("recoverMediaError");var o=this._media;this.detachMedia(),o&&this.attachMedia(o)},s.removeLevel=function(o,c){c===void 0&&(c=0),this.levelController.removeLevel(o,c)},r(f,[{key:"levels",get:function(){var o=this.levelController.levels;return o||[]}},{key:"currentLevel",get:function(){return this.streamController.currentLevel},set:function(o){T.logger.log("set currentLevel:"+o),this.loadLevel=o,this.abrController.clearTimer(),this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function(){return this.streamController.nextLevel},set:function(o){T.logger.log("set nextLevel:"+o),this.levelController.manualLevel=o,this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function(){return this.levelController.level},set:function(o){T.logger.log("set loadLevel:"+o),this.levelController.manualLevel=o}},{key:"nextLoadLevel",get:function(){return this.levelController.nextLoadLevel},set:function(o){this.levelController.nextLoadLevel=o}},{key:"firstLevel",get:function(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},set:function(o){T.logger.log("set firstLevel:"+o),this.levelController.firstLevel=o}},{key:"startLevel",get:function(){return this.levelController.startLevel},set:function(o){T.logger.log("set startLevel:"+o),o!==-1&&(o=Math.max(o,this.minAutoLevel)),this.levelController.startLevel=o}},{key:"capLevelToPlayerSize",get:function(){return this.config.capLevelToPlayerSize},set:function(o){var c=!!o;c!==this.config.capLevelToPlayerSize&&(c?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=c)}},{key:"autoLevelCapping",get:function(){return this._autoLevelCapping},set:function(o){this._autoLevelCapping!==o&&(T.logger.log("set autoLevelCapping:"+o),this._autoLevelCapping=o)}},{key:"bandwidthEstimate",get:function(){var o=this.abrController.bwEstimator;return o?o.getEstimate():NaN}},{key:"autoLevelEnabled",get:function(){return this.levelController.manualLevel===-1}},{key:"manualLevel",get:function(){return this.levelController.manualLevel}},{key:"minAutoLevel",get:function(){var o=this.levels,c=this.config.minAutoBitrate;if(!o)return 0;for(var v=o.length,u=0;u<v;u++)if(o[u].maxBitrate>c)return u;return 0}},{key:"maxAutoLevel",get:function(){var o=this.levels,c=this.autoLevelCapping,v;return c===-1&&o&&o.length?v=o.length-1:v=c,v}},{key:"nextAutoLevel",get:function(){return Math.min(Math.max(this.abrController.nextAutoLevel,this.minAutoLevel),this.maxAutoLevel)},set:function(o){this.abrController.nextAutoLevel=Math.max(this.minAutoLevel,o)}},{key:"audioTracks",get:function(){var o=this.audioTrackController;return o?o.audioTracks:[]}},{key:"audioTrack",get:function(){var o=this.audioTrackController;return o?o.audioTrack:-1},set:function(o){var c=this.audioTrackController;c&&(c.audioTrack=o)}},{key:"subtitleTracks",get:function(){var o=this.subtitleTrackController;return o?o.subtitleTracks:[]}},{key:"subtitleTrack",get:function(){var o=this.subtitleTrackController;return o?o.subtitleTrack:-1},set:function(o){var c=this.subtitleTrackController;c&&(c.subtitleTrack=o)}},{key:"media",get:function(){return this._media}},{key:"subtitleDisplay",get:function(){var o=this.subtitleTrackController;return o?o.subtitleDisplay:!1},set:function(o){var c=this.subtitleTrackController;c&&(c.subtitleDisplay=o)}},{key:"lowLatencyMode",get:function(){return this.config.lowLatencyMode},set:function(o){this.config.lowLatencyMode=o}},{key:"liveSyncPosition",get:function(){return this.latencyController.liveSyncPosition}},{key:"latency",get:function(){return this.latencyController.latency}},{key:"maxLatency",get:function(){return this.latencyController.maxLatency}},{key:"targetLatency",get:function(){return this.latencyController.targetLatency}},{key:"drift",get:function(){return this.latencyController.drift}},{key:"forceStartLoad",get:function(){return this.streamController.forceStartLoad}}],[{key:"version",get:function(){return"1.1.1"}},{key:"Events",get:function(){return h.Events}},{key:"ErrorTypes",get:function(){return i.ErrorTypes}},{key:"ErrorDetails",get:function(){return i.ErrorDetails}},{key:"DefaultConfig",get:function(){return f.defaultConfig?f.defaultConfig:x.hlsDefaultConfig},set:function(o){f.defaultConfig=o}}]),f}();t.defaultConfig=void 0},"./src/is-supported.ts":function(K,P,p){p.r(P),p.d(P,"isSupported",function(){return A}),p.d(P,"changeTypeSupported",function(){return F});var M=p("./src/utils/mediasource-helper.ts");function O(){return self.SourceBuffer||self.WebKitSourceBuffer}function A(){var D=Object(M.getMediaSource)();if(!D)return!1;var R=O(),L=D&&typeof D.isTypeSupported=="function"&&D.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),g=!R||R.prototype&&typeof R.prototype.appendBuffer=="function"&&typeof R.prototype.remove=="function";return!!L&&!!g}function F(){var D,R=O();return typeof(R==null||(D=R.prototype)===null||D===void 0?void 0:D.changeType)=="function"}},"./src/loader/fragment-loader.ts":function(K,P,p){p.r(P),p.d(P,"default",function(){return x}),p.d(P,"LoadError",function(){return h});var M=p("./src/polyfills/number.ts"),O=p("./src/errors.ts");function A(i,e){i.prototype=Object.create(e.prototype),i.prototype.constructor=i,g(i,e)}function F(i){var e=typeof Map=="function"?new Map:void 0;return F=function(t){if(t===null||!L(t))return t;if(typeof t!="function")throw new TypeError("Super expression must either be null or a function");if(typeof e!="undefined"){if(e.has(t))return e.get(t);e.set(t,f)}function f(){return D(t,arguments,S(this).constructor)}return f.prototype=Object.create(t.prototype,{constructor:{value:f,enumerable:!1,writable:!0,configurable:!0}}),g(f,t)},F(i)}function D(i,e,r){return R()?D=Reflect.construct:D=function(f,s,n){var o=[null];o.push.apply(o,s);var c=Function.bind.apply(f,o),v=new c;return n&&g(v,n.prototype),v},D.apply(null,arguments)}function R(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function L(i){return Function.toString.call(i).indexOf("[native code]")!==-1}function g(i,e){return g=Object.setPrototypeOf||function(t,f){return t.__proto__=f,t},g(i,e)}function S(i){return S=Object.setPrototypeOf?Object.getPrototypeOf:function(r){return r.__proto__||Object.getPrototypeOf(r)},S(i)}var T=Math.pow(2,17),x=function(){function i(r){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=r}var e=i.prototype;return e.destroy=function(){this.loader&&(this.loader.destroy(),this.loader=null)},e.abort=function(){this.loader&&this.loader.abort()},e.load=function(t,f){var s=this,n=t.url;if(!n)return Promise.reject(new h({type:O.ErrorTypes.NETWORK_ERROR,details:O.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:t,networkDetails:null},"Fragment does not have a "+(n?"part list":"url")));this.abort();var o=this.config,c=o.fLoader,v=o.loader;return new Promise(function(u,a){s.loader&&s.loader.destroy();var l=s.loader=t.loader=c?new c(o):new v(o),d=m(t),E={timeout:o.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:o.fragLoadingMaxRetryTimeout,highWaterMark:T};t.stats=l.stats,l.load(d,E,{onSuccess:function(I,C,_,B){s.resetLoader(t,l),u({frag:t,part:null,payload:I.data,networkDetails:B})},onError:function(I,C,_){s.resetLoader(t,l),a(new h({type:O.ErrorTypes.NETWORK_ERROR,details:O.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:t,response:I,networkDetails:_}))},onAbort:function(I,C,_){s.resetLoader(t,l),a(new h({type:O.ErrorTypes.NETWORK_ERROR,details:O.ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:t,networkDetails:_}))},onTimeout:function(I,C,_){s.resetLoader(t,l),a(new h({type:O.ErrorTypes.NETWORK_ERROR,details:O.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:t,networkDetails:_}))},onProgress:function(I,C,_,B){f&&f({frag:t,part:null,payload:_,networkDetails:B})}})})},e.loadPart=function(t,f,s){var n=this;this.abort();var o=this.config,c=o.fLoader,v=o.loader;return new Promise(function(u,a){n.loader&&n.loader.destroy();var l=n.loader=t.loader=c?new c(o):new v(o),d=m(t,f),E={timeout:o.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:o.fragLoadingMaxRetryTimeout,highWaterMark:T};f.stats=l.stats,l.load(d,E,{onSuccess:function(I,C,_,B){n.resetLoader(t,l),n.updateStatsFromPart(t,f);var U={frag:t,part:f,payload:I.data,networkDetails:B};s(U),u(U)},onError:function(I,C,_){n.resetLoader(t,l),a(new h({type:O.ErrorTypes.NETWORK_ERROR,details:O.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:t,part:f,response:I,networkDetails:_}))},onAbort:function(I,C,_){t.stats.aborted=f.stats.aborted,n.resetLoader(t,l),a(new h({type:O.ErrorTypes.NETWORK_ERROR,details:O.ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:t,part:f,networkDetails:_}))},onTimeout:function(I,C,_){n.resetLoader(t,l),a(new h({type:O.ErrorTypes.NETWORK_ERROR,details:O.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:t,part:f,networkDetails:_}))}})})},e.updateStatsFromPart=function(t,f){var s=t.stats,n=f.stats,o=n.total;if(s.loaded+=n.loaded,o){var c=Math.round(t.duration/f.duration),v=Math.min(Math.round(s.loaded/o),c),u=c-v,a=u*Math.round(s.loaded/v);s.total=s.loaded+a}else s.total=Math.max(s.loaded,s.total);var l=s.loading,d=n.loading;l.start?l.first+=d.first-d.start:(l.start=d.start,l.first=d.first),l.end=d.end},e.resetLoader=function(t,f){t.loader=null,this.loader===f&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),f.destroy()},i}();function m(i,e){e===void 0&&(e=null);var r=e||i,t={frag:i,part:e,responseType:"arraybuffer",url:r.url,headers:{},rangeStart:0,rangeEnd:0},f=r.byteRangeStartOffset,s=r.byteRangeEndOffset;return Object(M.isFiniteNumber)(f)&&Object(M.isFiniteNumber)(s)&&(t.rangeStart=f,t.rangeEnd=s),t}var h=function(i){A(e,i);function e(r){for(var t,f=arguments.length,s=new Array(f>1?f-1:0),n=1;n<f;n++)s[n-1]=arguments[n];return t=i.call.apply(i,[this].concat(s))||this,t.data=void 0,t.data=r,t}return e}(F(Error))},"./src/loader/fragment.ts":function(K,P,p){p.r(P),p.d(P,"ElementaryStreamTypes",function(){return T}),p.d(P,"BaseSegment",function(){return x}),p.d(P,"Fragment",function(){return m}),p.d(P,"Part",function(){return h});var M=p("./src/polyfills/number.ts"),O=p("./node_modules/url-toolkit/src/url-toolkit.js"),A=p("./src/utils/logger.ts"),F=p("./src/loader/level-key.ts"),D=p("./src/loader/load-stats.ts");function R(i,e){i.prototype=Object.create(e.prototype),i.prototype.constructor=i,L(i,e)}function L(i,e){return L=Object.setPrototypeOf||function(t,f){return t.__proto__=f,t},L(i,e)}function g(i,e){for(var r=0;r<e.length;r++){var t=e[r];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(i,t.key,t)}}function S(i,e,r){return e&&g(i.prototype,e),r&&g(i,r),i}var T;(function(i){i.AUDIO="audio",i.VIDEO="video",i.AUDIOVIDEO="audiovideo"})(T||(T={}));var x=function(){function i(r){var t;this._byteRange=null,this._url=null,this.baseurl=void 0,this.relurl=void 0,this.elementaryStreams=(t={},t[T.AUDIO]=null,t[T.VIDEO]=null,t[T.AUDIOVIDEO]=null,t),this.baseurl=r}var e=i.prototype;return e.setByteRange=function(t,f){var s=t.split("@",2),n=[];s.length===1?n[0]=f?f.byteRangeEndOffset:0:n[0]=parseInt(s[1]),n[1]=parseInt(s[0])+n[0],this._byteRange=n},S(i,[{key:"byteRange",get:function(){return this._byteRange?this._byteRange:[]}},{key:"byteRangeStartOffset",get:function(){return this.byteRange[0]}},{key:"byteRangeEndOffset",get:function(){return this.byteRange[1]}},{key:"url",get:function(){return!this._url&&this.baseurl&&this.relurl&&(this._url=Object(O.buildAbsoluteURL)(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""},set:function(t){this._url=t}}]),i}(),m=function(i){R(e,i);function e(t,f){var s;return s=i.call(this,f)||this,s._decryptdata=null,s.rawProgramDateTime=null,s.programDateTime=null,s.tagList=[],s.duration=0,s.sn=0,s.levelkey=void 0,s.type=void 0,s.loader=null,s.level=-1,s.cc=0,s.startPTS=void 0,s.endPTS=void 0,s.appendedPTS=void 0,s.startDTS=void 0,s.endDTS=void 0,s.start=0,s.deltaPTS=void 0,s.maxStartPTS=void 0,s.minEndPTS=void 0,s.stats=new D.LoadStats,s.urlId=0,s.data=void 0,s.bitrateTest=!1,s.title=null,s.initSegment=null,s.type=t,s}var r=e.prototype;return r.createInitializationVector=function(f){for(var s=new Uint8Array(16),n=12;n<16;n++)s[n]=f>>8*(15-n)&255;return s},r.setDecryptDataFromLevelKey=function(f,s){var n=f;return(f==null?void 0:f.method)==="AES-128"&&f.uri&&!f.iv&&(n=F.LevelKey.fromURI(f.uri),n.method=f.method,n.iv=this.createInitializationVector(s),n.keyFormat="identity"),n},r.setElementaryStreamInfo=function(f,s,n,o,c,v){v===void 0&&(v=!1);var u=this.elementaryStreams,a=u[f];if(!a){u[f]={startPTS:s,endPTS:n,startDTS:o,endDTS:c,partial:v};return}a.startPTS=Math.min(a.startPTS,s),a.endPTS=Math.max(a.endPTS,n),a.startDTS=Math.min(a.startDTS,o),a.endDTS=Math.max(a.endDTS,c)},r.clearElementaryStreamInfo=function(){var f=this.elementaryStreams;f[T.AUDIO]=null,f[T.VIDEO]=null,f[T.AUDIOVIDEO]=null},S(e,[{key:"decryptdata",get:function(){if(!this.levelkey&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkey){var f=this.sn;typeof f!="number"&&(this.levelkey&&this.levelkey.method==="AES-128"&&!this.levelkey.iv&&A.logger.warn('missing IV for initialization segment with method="'+this.levelkey.method+'" - compliance issue'),f=0),this._decryptdata=this.setDecryptDataFromLevelKey(this.levelkey,f)}return this._decryptdata}},{key:"end",get:function(){return this.start+this.duration}},{key:"endProgramDateTime",get:function(){if(this.programDateTime===null||!Object(M.isFiniteNumber)(this.programDateTime))return null;var f=Object(M.isFiniteNumber)(this.duration)?this.duration:0;return this.programDateTime+f*1e3}},{key:"encrypted",get:function(){var f;return!!((f=this.decryptdata)!==null&&f!==void 0&&f.keyFormat&&this.decryptdata.uri)}}]),e}(x),h=function(i){R(e,i);function e(r,t,f,s,n){var o;o=i.call(this,f)||this,o.fragOffset=0,o.duration=0,o.gap=!1,o.independent=!1,o.relurl=void 0,o.fragment=void 0,o.index=void 0,o.stats=new D.LoadStats,o.duration=r.decimalFloatingPoint("DURATION"),o.gap=r.bool("GAP"),o.independent=r.bool("INDEPENDENT"),o.relurl=r.enumeratedString("URI"),o.fragment=t,o.index=s;var c=r.enumeratedString("BYTERANGE");return c&&o.setByteRange(c,n),n&&(o.fragOffset=n.fragOffset+n.duration),o}return S(e,[{key:"start",get:function(){return this.fragment.start+this.fragOffset}},{key:"end",get:function(){return this.start+this.duration}},{key:"loaded",get:function(){var t=this.elementaryStreams;return!!(t.audio||t.video||t.audiovideo)}}]),e}(x)},"./src/loader/key-loader.ts":function(K,P,p){p.r(P),p.d(P,"default",function(){return F});var M=p("./src/events.ts"),O=p("./src/errors.ts"),A=p("./src/utils/logger.ts"),F=function(){function D(L){this.hls=void 0,this.loaders={},this.decryptkey=null,this.decrypturl=null,this.hls=L,this._registerListeners()}var R=D.prototype;return R._registerListeners=function(){this.hls.on(M.Events.KEY_LOADING,this.onKeyLoading,this)},R._unregisterListeners=function(){this.hls.off(M.Events.KEY_LOADING,this.onKeyLoading)},R.destroy=function(){this._unregisterListeners();for(var g in this.loaders){var S=this.loaders[g];S&&S.destroy()}this.loaders={}},R.onKeyLoading=function(g,S){var T=S.frag,x=T.type,m=this.loaders[x];if(!T.decryptdata){A.logger.warn("Missing decryption data on fragment in onKeyLoading");return}var h=T.decryptdata.uri;if(h!==this.decrypturl||this.decryptkey===null){var i=this.hls.config;if(m&&(A.logger.warn("abort previous key loader for type:"+x),m.abort()),!h){A.logger.warn("key uri is falsy");return}var e=i.loader,r=T.loader=this.loaders[x]=new e(i);this.decrypturl=h,this.decryptkey=null;var t={url:h,frag:T,responseType:"arraybuffer"},f={timeout:i.fragLoadingTimeOut,maxRetry:0,retryDelay:i.fragLoadingRetryDelay,maxRetryDelay:i.fragLoadingMaxRetryTimeout,highWaterMark:0},s={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};r.load(t,f,s)}else this.decryptkey&&(T.decryptdata.key=this.decryptkey,this.hls.trigger(M.Events.KEY_LOADED,{frag:T}))},R.loadsuccess=function(g,S,T){var x=T.frag;if(!x.decryptdata){A.logger.error("after key load, decryptdata unset");return}this.decryptkey=x.decryptdata.key=new Uint8Array(g.data),x.loader=null,delete this.loaders[x.type],this.hls.trigger(M.Events.KEY_LOADED,{frag:x})},R.loaderror=function(g,S){var T=S.frag,x=T.loader;x&&x.abort(),delete this.loaders[T.type],this.hls.trigger(M.Events.ERROR,{type:O.ErrorTypes.NETWORK_ERROR,details:O.ErrorDetails.KEY_LOAD_ERROR,fatal:!1,frag:T,response:g})},R.loadtimeout=function(g,S){var T=S.frag,x=T.loader;x&&x.abort(),delete this.loaders[T.type],this.hls.trigger(M.Events.ERROR,{type:O.ErrorTypes.NETWORK_ERROR,details:O.ErrorDetails.KEY_LOAD_TIMEOUT,fatal:!1,frag:T})},D}()},"./src/loader/level-details.ts":function(K,P,p){p.r(P),p.d(P,"LevelDetails",function(){return D});var M=p("./src/polyfills/number.ts");function O(R,L){for(var g=0;g<L.length;g++){var S=L[g];S.enumerable=S.enumerable||!1,S.configurable=!0,"value"in S&&(S.writable=!0),Object.defineProperty(R,S.key,S)}}function A(R,L,g){return L&&O(R.prototype,L),g&&O(R,g),R}var F=10,D=function(){function R(g){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.live=!0,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.availabilityDelay=void 0,this.misses=0,this.needSidxRanges=!1,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.fragments=[],this.url=g}var L=R.prototype;return L.reloaded=function(S){if(!S){this.advanced=!0,this.updated=!0;return}var T=this.lastPartSn-S.lastPartSn,x=this.lastPartIndex-S.lastPartIndex;this.updated=this.endSN!==S.endSN||!!x||!!T,this.advanced=this.endSN>S.endSN||T>0||T===0&&x>0,this.updated||this.advanced?this.misses=Math.floor(S.misses*.6):this.misses=S.misses+1,this.availabilityDelay=S.availabilityDelay},A(R,[{key:"hasProgramDateTime",get:function(){return this.fragments.length?Object(M.isFiniteNumber)(this.fragments[this.fragments.length-1].programDateTime):!1}},{key:"levelTargetDuration",get:function(){return this.averagetargetduration||this.targetduration||F}},{key:"drift",get:function(){var S=this.driftEndTime-this.driftStartTime;if(S>0){var T=this.driftEnd-this.driftStart;return T*1e3/S}return 1}},{key:"edge",get:function(){return this.partEnd||this.fragmentEnd}},{key:"partEnd",get:function(){var S;return(S=this.partList)!==null&&S!==void 0&&S.length?this.partList[this.partList.length-1].end:this.fragmentEnd}},{key:"fragmentEnd",get:function(){var S;return(S=this.fragments)!==null&&S!==void 0&&S.length?this.fragments[this.fragments.length-1].end:0}},{key:"age",get:function(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}},{key:"lastPartIndex",get:function(){var S;return(S=this.partList)!==null&&S!==void 0&&S.length?this.partList[this.partList.length-1].index:-1}},{key:"lastPartSn",get:function(){var S;return(S=this.partList)!==null&&S!==void 0&&S.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}}]),R}()},"./src/loader/level-key.ts":function(K,P,p){p.r(P),p.d(P,"LevelKey",function(){return F});var M=p("./node_modules/url-toolkit/src/url-toolkit.js");function O(D,R){for(var L=0;L<R.length;L++){var g=R[L];g.enumerable=g.enumerable||!1,g.configurable=!0,"value"in g&&(g.writable=!0),Object.defineProperty(D,g.key,g)}}function A(D,R,L){return R&&O(D.prototype,R),L&&O(D,L),D}var F=function(){D.fromURL=function(L,g){return new D(L,g)},D.fromURI=function(L){return new D(L)};function D(R,L){this._uri=null,this.method=null,this.keyFormat=null,this.keyFormatVersions=null,this.keyID=null,this.key=null,this.iv=null,L?this._uri=Object(M.buildAbsoluteURL)(R,L,{alwaysNormalize:!0}):this._uri=R}return A(D,[{key:"uri",get:function(){return this._uri}}]),D}()},"./src/loader/load-stats.ts":function(K,P,p){p.r(P),p.d(P,"LoadStats",function(){return M});var M=function(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}},"./src/loader/m3u8-parser.ts":function(K,P,p){p.r(P),p.d(P,"default",function(){return e});var M=p("./src/polyfills/number.ts"),O=p("./node_modules/url-toolkit/src/url-toolkit.js"),A=p("./src/loader/fragment.ts"),F=p("./src/loader/level-details.ts"),D=p("./src/loader/level-key.ts"),R=p("./src/utils/attr-list.ts"),L=p("./src/utils/logger.ts"),g=p("./src/utils/codecs.ts"),S=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-SESSION-DATA:([^\r\n]*)[\r\n]+/g,T=/#EXT-X-MEDIA:(.*)/g,x=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[\S ]*)/.source,/#EXT-X-BYTERANGE:*(.+)/.source,/#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/#.*/.source].join("|"),"g"),m=new RegExp([/#(EXTM3U)/.source,/#EXT-X-(PLAYLIST-TYPE):(.+)/.source,/#EXT-X-(MEDIA-SEQUENCE): *(\d+)/.source,/#EXT-X-(SKIP):(.+)/.source,/#EXT-X-(TARGETDURATION): *(\d+)/.source,/#EXT-X-(KEY):(.+)/.source,/#EXT-X-(START):(.+)/.source,/#EXT-X-(ENDLIST)/.source,/#EXT-X-(DISCONTINUITY-SEQ)UENCE: *(\d+)/.source,/#EXT-X-(DIS)CONTINUITY/.source,/#EXT-X-(VERSION):(\d+)/.source,/#EXT-X-(MAP):(.+)/.source,/#EXT-X-(SERVER-CONTROL):(.+)/.source,/#EXT-X-(PART-INF):(.+)/.source,/#EXT-X-(GAP)/.source,/#EXT-X-(BITRATE):\s*(\d+)/.source,/#EXT-X-(PART):(.+)/.source,/#EXT-X-(PRELOAD-HINT):(.+)/.source,/#EXT-X-(RENDITION-REPORT):(.+)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|")),h=/\.(mp4|m4s|m4v|m4a)$/i;function i(n){var o,c;return h.test((o=(c=O.parseURL(n))===null||c===void 0?void 0:c.path)!=null?o:"")}var e=function(){function n(){}return n.findGroup=function(c,v){for(var u=0;u<c.length;u++){var a=c[u];if(a.id===v)return a}},n.convertAVC1ToAVCOTI=function(c){var v=c.split(".");if(v.length>2){var u=v.shift()+".";return u+=parseInt(v.shift()).toString(16),u+=("000"+parseInt(v.shift()).toString(16)).substr(-4),u}return c},n.resolve=function(c,v){return O.buildAbsoluteURL(v,c,{alwaysNormalize:!0})},n.parseMasterPlaylist=function(c,v){var u=[],a={},l=!1;S.lastIndex=0;for(var d;(d=S.exec(c))!=null;)if(d[1]){var E=new R.AttrList(d[1]),y={attrs:E,bitrate:E.decimalInteger("AVERAGE-BANDWIDTH")||E.decimalInteger("BANDWIDTH"),name:E.NAME,url:n.resolve(d[2],v)},I=E.decimalResolution("RESOLUTION");I&&(y.width=I.width,y.height=I.height),r((E.CODECS||"").split(/[ ,]+/).filter(function(_){return _}),y),y.videoCodec&&y.videoCodec.indexOf("avc1")!==-1&&(y.videoCodec=n.convertAVC1ToAVCOTI(y.videoCodec)),u.push(y)}else if(d[3]){var C=new R.AttrList(d[3]);C["DATA-ID"]&&(l=!0,a[C["DATA-ID"]]=C)}return{levels:u,sessionData:l?a:null}},n.parseMasterPlaylistMedia=function(c,v,u,a){a===void 0&&(a=[]);var l,d=[],E=0;for(T.lastIndex=0;(l=T.exec(c))!==null;){var y=new R.AttrList(l[1]);if(y.TYPE===u){var I={attrs:y,bitrate:0,id:E++,groupId:y["GROUP-ID"],instreamId:y["INSTREAM-ID"],name:y.NAME||y.LANGUAGE||"",type:u,default:y.bool("DEFAULT"),autoselect:y.bool("AUTOSELECT"),forced:y.bool("FORCED"),lang:y.LANGUAGE,url:y.URI?n.resolve(y.URI,v):""};if(a.length){var C=n.findGroup(a,I.groupId)||a[0];t(I,C,"audioCodec"),t(I,C,"textCodec")}d.push(I)}}return d},n.parseLevelPlaylist=function(c,v,u,a,l){var d=new F.LevelDetails(v),E=d.fragments,y=null,I=0,C=0,_=0,B=0,U=null,N=new A.Fragment(a,v),k,w,G,W=-1,Y=!1;for(x.lastIndex=0,d.m3u8=c;(k=x.exec(c))!==null;){Y&&(Y=!1,N=new A.Fragment(a,v),N.start=_,N.sn=I,N.cc=B,N.level=u,y&&(N.initSegment=y,N.rawProgramDateTime=y.rawProgramDateTime));var H=k[1];if(H){N.duration=parseFloat(H);var z=(" "+k[2]).slice(1);N.title=z||null,N.tagList.push(z?["INF",H,z]:["INF",H])}else if(k[3])Object(M.isFiniteNumber)(N.duration)&&(N.start=_,G&&(N.levelkey=G),N.sn=I,N.level=u,N.cc=B,N.urlId=l,E.push(N),N.relurl=(" "+k[3]).slice(1),s(N,U),U=N,_+=N.duration,I++,C=0,Y=!0);else if(k[4]){var Q=(" "+k[4]).slice(1);U?N.setByteRange(Q,U):N.setByteRange(Q)}else if(k[5])N.rawProgramDateTime=(" "+k[5]).slice(1),N.tagList.push(["PROGRAM-DATE-TIME",N.rawProgramDateTime]),W===-1&&(W=E.length);else{if(k=k[0].match(m),!k){L.logger.warn("No matches on slow regex match for level playlist!");continue}for(w=1;w<k.length&&typeof k[w]=="undefined";w++);var $=(" "+k[w]).slice(1),X=(" "+k[w+1]).slice(1),J=k[w+2]?(" "+k[w+2]).slice(1):"";switch($){case"PLAYLIST-TYPE":d.type=X.toUpperCase();break;case"MEDIA-SEQUENCE":I=d.startSN=parseInt(X);break;case"SKIP":{var Z=new R.AttrList(X),q=Z.decimalInteger("SKIPPED-SEGMENTS");if(Object(M.isFiniteNumber)(q)){d.skippedSegments=q;for(var ee=q;ee--;)E.unshift(null);I+=q}var ae=Z.enumeratedString("RECENTLY-REMOVED-DATERANGES");ae&&(d.recentlyRemovedDateranges=ae.split("	"));break}case"TARGETDURATION":d.targetduration=parseFloat(X);break;case"VERSION":d.version=parseInt(X);break;case"EXTM3U":break;case"ENDLIST":d.live=!1;break;case"#":(X||J)&&N.tagList.push(J?[X,J]:[X]);break;case"DIS":B++;case"GAP":N.tagList.push([$]);break;case"BITRATE":N.tagList.push([$,X]);break;case"DISCONTINUITY-SEQ":B=parseInt(X);break;case"KEY":{var te,ie=new R.AttrList(X),fe=ie.enumeratedString("METHOD"),se=ie.URI,de=ie.hexadecimalInteger("IV"),oe=ie.enumeratedString("KEYFORMATVERSIONS"),ce=ie.enumeratedString("KEYID"),re=(te=ie.enumeratedString("KEYFORMAT"))!=null?te:"identity",De=["com.apple.streamingkeydelivery","com.microsoft.playready","urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed","com.widevine"];if(De.indexOf(re)>-1){L.logger.warn("Keyformat "+re+" is not supported from the manifest");continue}else if(re!=="identity")continue;fe&&(G=D.LevelKey.fromURL(v,se),se&&["AES-128","SAMPLE-AES","SAMPLE-AES-CENC"].indexOf(fe)>=0&&(G.method=fe,G.keyFormat=re,ce&&(G.keyID=ce),oe&&(G.keyFormatVersions=oe),G.iv=de));break}case"START":{var Re=new R.AttrList(X),xe=Re.decimalFloatingPoint("TIME-OFFSET");Object(M.isFiniteNumber)(xe)&&(d.startTimeOffset=xe);break}case"MAP":{var ve=new R.AttrList(X);N.relurl=ve.URI,ve.BYTERANGE&&N.setByteRange(ve.BYTERANGE),N.level=u,N.sn="initSegment",G&&(N.levelkey=G),N.initSegment=null,y=N,Y=!0;break}case"SERVER-CONTROL":{var ge=new R.AttrList(X);d.canBlockReload=ge.bool("CAN-BLOCK-RELOAD"),d.canSkipUntil=ge.optionalFloat("CAN-SKIP-UNTIL",0),d.canSkipDateRanges=d.canSkipUntil>0&&ge.bool("CAN-SKIP-DATERANGES"),d.partHoldBack=ge.optionalFloat("PART-HOLD-BACK",0),d.holdBack=ge.optionalFloat("HOLD-BACK",0);break}case"PART-INF":{var Te=new R.AttrList(X);d.partTarget=Te.decimalFloatingPoint("PART-TARGET");break}case"PART":{var me=d.partList;me||(me=d.partList=[]);var he=C>0?me[me.length-1]:void 0,Ee=C++,Ie=new A.Part(new R.AttrList(X),N,v,Ee,he);me.push(Ie),N.duration+=Ie.duration;break}case"PRELOAD-HINT":{var Ce=new R.AttrList(X);d.preloadHint=Ce;break}case"RENDITION-REPORT":{var Ae=new R.AttrList(X);d.renditionReports=d.renditionReports||[],d.renditionReports.push(Ae);break}default:L.logger.warn("line parsed but not handled: "+k);break}}}U&&!U.relurl?(E.pop(),_-=U.duration,d.partList&&(d.fragmentHint=U)):d.partList&&(s(N,U),N.cc=B,d.fragmentHint=N);var Pe=E.length,Se=E[0],pe=E[Pe-1];if(_+=d.skippedSegments*d.targetduration,_>0&&Pe&&pe){d.averagetargetduration=_/Pe;var Me=pe.sn;d.endSN=Me!=="initSegment"?Me:0,Se&&(d.startCC=Se.cc,Se.initSegment||d.fragments.every(function(Ue){return Ue.relurl&&i(Ue.relurl)})&&(L.logger.warn("MP4 fragments found but no init segment (probably no MAP, incomplete M3U8), trying to fetch SIDX"),N=new A.Fragment(a,v),N.relurl=pe.relurl,N.level=u,N.sn="initSegment",Se.initSegment=N,d.needSidxRanges=!0))}else d.endSN=0,d.startCC=0;return d.fragmentHint&&(_+=d.fragmentHint.duration),d.totalduration=_,d.endCC=B,W>0&&f(E,W),d},n}();function r(n,o){["video","audio","text"].forEach(function(c){var v=n.filter(function(a){return Object(g.isCodecType)(a,c)});if(v.length){var u=v.filter(function(a){return a.lastIndexOf("avc1",0)===0||a.lastIndexOf("mp4a",0)===0});o[c+"Codec"]=u.length>0?u[0]:v[0],n=n.filter(function(a){return v.indexOf(a)===-1})}}),o.unknownCodecs=n}function t(n,o,c){var v=o[c];v&&(n[c]=v)}function f(n,o){for(var c=n[o],v=o;v--;){var u=n[v];if(!u)return;u.programDateTime=c.programDateTime-u.duration*1e3,c=u}}function s(n,o){n.rawProgramDateTime?n.programDateTime=Date.parse(n.rawProgramDateTime):o!=null&&o.programDateTime&&(n.programDateTime=o.endProgramDateTime),Object(M.isFiniteNumber)(n.programDateTime)||(n.programDateTime=null,n.rawProgramDateTime=null)}},"./src/loader/playlist-loader.ts":function(K,P,p){p.r(P);var M=p("./src/polyfills/number.ts"),O=p("./src/events.ts"),A=p("./src/errors.ts"),F=p("./src/utils/logger.ts"),D=p("./src/utils/mp4-tools.ts"),R=p("./src/loader/m3u8-parser.ts"),L=p("./src/types/loader.ts"),g=p("./src/utils/attr-list.ts");function S(m){var h=m.type;switch(h){case L.PlaylistContextType.AUDIO_TRACK:return L.PlaylistLevelType.AUDIO;case L.PlaylistContextType.SUBTITLE_TRACK:return L.PlaylistLevelType.SUBTITLE;default:return L.PlaylistLevelType.MAIN}}function T(m,h){var i=m.url;return(i===void 0||i.indexOf("data:")===0)&&(i=h.url),i}var x=function(){function m(i){this.hls=void 0,this.loaders=Object.create(null),this.hls=i,this.registerListeners()}var h=m.prototype;return h.registerListeners=function(){var e=this.hls;e.on(O.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.on(O.Events.LEVEL_LOADING,this.onLevelLoading,this),e.on(O.Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.on(O.Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},h.unregisterListeners=function(){var e=this.hls;e.off(O.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.off(O.Events.LEVEL_LOADING,this.onLevelLoading,this),e.off(O.Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.off(O.Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},h.createInternalLoader=function(e){var r=this.hls.config,t=r.pLoader,f=r.loader,s=t||f,n=new s(r);return e.loader=n,this.loaders[e.type]=n,n},h.getInternalLoader=function(e){return this.loaders[e.type]},h.resetInternalLoader=function(e){this.loaders[e]&&delete this.loaders[e]},h.destroyInternalLoaders=function(){for(var e in this.loaders){var r=this.loaders[e];r&&r.destroy(),this.resetInternalLoader(e)}},h.destroy=function(){this.unregisterListeners(),this.destroyInternalLoaders()},h.onManifestLoading=function(e,r){var t=r.url;this.load({id:null,groupId:null,level:0,responseType:"text",type:L.PlaylistContextType.MANIFEST,url:t,deliveryDirectives:null})},h.onLevelLoading=function(e,r){var t=r.id,f=r.level,s=r.url,n=r.deliveryDirectives;this.load({id:t,groupId:null,level:f,responseType:"text",type:L.PlaylistContextType.LEVEL,url:s,deliveryDirectives:n})},h.onAudioTrackLoading=function(e,r){var t=r.id,f=r.groupId,s=r.url,n=r.deliveryDirectives;this.load({id:t,groupId:f,level:null,responseType:"text",type:L.PlaylistContextType.AUDIO_TRACK,url:s,deliveryDirectives:n})},h.onSubtitleTrackLoading=function(e,r){var t=r.id,f=r.groupId,s=r.url,n=r.deliveryDirectives;this.load({id:t,groupId:f,level:null,responseType:"text",type:L.PlaylistContextType.SUBTITLE_TRACK,url:s,deliveryDirectives:n})},h.load=function(e){var r,t=this.hls.config,f=this.getInternalLoader(e);if(f){var s=f.context;if(s&&s.url===e.url){F.logger.trace("[playlist-loader]: playlist request ongoing");return}F.logger.log("[playlist-loader]: aborting previous loader for type: "+e.type),f.abort()}var n,o,c,v;switch(e.type){case L.PlaylistContextType.MANIFEST:n=t.manifestLoadingMaxRetry,o=t.manifestLoadingTimeOut,c=t.manifestLoadingRetryDelay,v=t.manifestLoadingMaxRetryTimeout;break;case L.PlaylistContextType.LEVEL:case L.PlaylistContextType.AUDIO_TRACK:case L.PlaylistContextType.SUBTITLE_TRACK:n=0,o=t.levelLoadingTimeOut;break;default:n=t.levelLoadingMaxRetry,o=t.levelLoadingTimeOut,c=t.levelLoadingRetryDelay,v=t.levelLoadingMaxRetryTimeout;break}if(f=this.createInternalLoader(e),(r=e.deliveryDirectives)!==null&&r!==void 0&&r.part){var u;if(e.type===L.PlaylistContextType.LEVEL&&e.level!==null?u=this.hls.levels[e.level].details:e.type===L.PlaylistContextType.AUDIO_TRACK&&e.id!==null?u=this.hls.audioTracks[e.id].details:e.type===L.PlaylistContextType.SUBTITLE_TRACK&&e.id!==null&&(u=this.hls.subtitleTracks[e.id].details),u){var a=u.partTarget,l=u.targetduration;a&&l&&(o=Math.min(Math.max(a*3,l*.8)*1e3,o))}}var d={timeout:o,maxRetry:n,retryDelay:c,maxRetryDelay:v,highWaterMark:0},E={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};f.load(e,d,E)},h.loadsuccess=function(e,r,t,f){if(f===void 0&&(f=null),t.isSidxRequest){this.handleSidxRequest(e,t),this.handlePlaylistLoaded(e,r,t,f);return}this.resetInternalLoader(t.type);var s=e.data;if(s.indexOf("#EXTM3U")!==0){this.handleManifestParsingError(e,t,"no EXTM3U delimiter",f);return}r.parsing.start=performance.now(),s.indexOf("#EXTINF:")>0||s.indexOf("#EXT-X-TARGETDURATION:")>0?this.handleTrackOrLevelPlaylist(e,r,t,f):this.handleMasterPlaylist(e,r,t,f)},h.loaderror=function(e,r,t){t===void 0&&(t=null),this.handleNetworkError(r,t,!1,e)},h.loadtimeout=function(e,r,t){t===void 0&&(t=null),this.handleNetworkError(r,t,!0)},h.handleMasterPlaylist=function(e,r,t,f){var s=this.hls,n=e.data,o=T(e,t),c=R.default.parseMasterPlaylist(n,o),v=c.levels,u=c.sessionData;if(!v.length){this.handleManifestParsingError(e,t,"no level found in manifest",f);return}var a=v.map(function(C){return{id:C.attrs.AUDIO,audioCodec:C.audioCodec}}),l=v.map(function(C){return{id:C.attrs.SUBTITLES,textCodec:C.textCodec}}),d=R.default.parseMasterPlaylistMedia(n,o,"AUDIO",a),E=R.default.parseMasterPlaylistMedia(n,o,"SUBTITLES",l),y=R.default.parseMasterPlaylistMedia(n,o,"CLOSED-CAPTIONS");if(d.length){var I=d.some(function(C){return!C.url});!I&&v[0].audioCodec&&!v[0].attrs.AUDIO&&(F.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),d.unshift({type:"main",name:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new g.AttrList({}),bitrate:0,url:""}))}s.trigger(O.Events.MANIFEST_LOADED,{levels:v,audioTracks:d,subtitles:E,captions:y,url:o,stats:r,networkDetails:f,sessionData:u})},h.handleTrackOrLevelPlaylist=function(e,r,t,f){var s=this.hls,n=t.id,o=t.level,c=t.type,v=T(e,t),u=Object(M.isFiniteNumber)(n)?n:0,a=Object(M.isFiniteNumber)(o)?o:u,l=S(t),d=R.default.parseLevelPlaylist(e.data,v,a,l,u);if(!d.fragments.length){s.trigger(O.Events.ERROR,{type:A.ErrorTypes.NETWORK_ERROR,details:A.ErrorDetails.LEVEL_EMPTY_ERROR,fatal:!1,url:v,reason:"no fragments found in level",level:typeof t.level=="number"?t.level:void 0});return}if(c===L.PlaylistContextType.MANIFEST){var E={attrs:new g.AttrList({}),bitrate:0,details:d,name:"",url:v};s.trigger(O.Events.MANIFEST_LOADED,{levels:[E],audioTracks:[],url:v,stats:r,networkDetails:f,sessionData:null})}if(r.parsing.end=performance.now(),d.needSidxRanges){var y,I=(y=d.fragments[0].initSegment)===null||y===void 0?void 0:y.url;this.load({url:I,isSidxRequest:!0,type:c,level:o,levelDetails:d,id:n,groupId:null,rangeStart:0,rangeEnd:2048,responseType:"arraybuffer",deliveryDirectives:null});return}t.levelDetails=d,this.handlePlaylistLoaded(e,r,t,f)},h.handleSidxRequest=function(e,r){var t=Object(D.parseSegmentIndex)(new Uint8Array(e.data));if(!!t){var f=t.references,s=r.levelDetails;f.forEach(function(n,o){var c=n.info,v=s.fragments[o];v.byteRange.length===0&&v.setByteRange(String(1+c.end-c.start)+"@"+String(c.start)),v.initSegment&&v.initSegment.setByteRange(String(t.moovEndOffset)+"@0")})}},h.handleManifestParsingError=function(e,r,t,f){this.hls.trigger(O.Events.ERROR,{type:A.ErrorTypes.NETWORK_ERROR,details:A.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:r.type===L.PlaylistContextType.MANIFEST,url:e.url,reason:t,response:e,context:r,networkDetails:f})},h.handleNetworkError=function(e,r,t,f){t===void 0&&(t=!1),F.logger.warn("[playlist-loader]: A network "+(t?"timeout":"error")+" occurred while loading "+e.type+" level: "+e.level+" id: "+e.id+' group-id: "'+e.groupId+'"');var s=A.ErrorDetails.UNKNOWN,n=!1,o=this.getInternalLoader(e);switch(e.type){case L.PlaylistContextType.MANIFEST:s=t?A.ErrorDetails.MANIFEST_LOAD_TIMEOUT:A.ErrorDetails.MANIFEST_LOAD_ERROR,n=!0;break;case L.PlaylistContextType.LEVEL:s=t?A.ErrorDetails.LEVEL_LOAD_TIMEOUT:A.ErrorDetails.LEVEL_LOAD_ERROR,n=!1;break;case L.PlaylistContextType.AUDIO_TRACK:s=t?A.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:A.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,n=!1;break;case L.PlaylistContextType.SUBTITLE_TRACK:s=t?A.ErrorDetails.SUBTITLE_TRACK_LOAD_TIMEOUT:A.ErrorDetails.SUBTITLE_LOAD_ERROR,n=!1;break}o&&this.resetInternalLoader(e.type);var c={type:A.ErrorTypes.NETWORK_ERROR,details:s,fatal:n,url:e.url,loader:o,context:e,networkDetails:r};f&&(c.response=f),this.hls.trigger(O.Events.ERROR,c)},h.handlePlaylistLoaded=function(e,r,t,f){var s=t.type,n=t.level,o=t.id,c=t.groupId,v=t.loader,u=t.levelDetails,a=t.deliveryDirectives;if(!(u!=null&&u.targetduration)){this.handleManifestParsingError(e,t,"invalid target duration",f);return}if(!!v)switch(u.live&&(v.getCacheAge&&(u.ageHeader=v.getCacheAge()||0),(!v.getCacheAge||isNaN(u.ageHeader))&&(u.ageHeader=0)),s){case L.PlaylistContextType.MANIFEST:case L.PlaylistContextType.LEVEL:this.hls.trigger(O.Events.LEVEL_LOADED,{details:u,level:n||0,id:o||0,stats:r,networkDetails:f,deliveryDirectives:a});break;case L.PlaylistContextType.AUDIO_TRACK:this.hls.trigger(O.Events.AUDIO_TRACK_LOADED,{details:u,id:o||0,groupId:c||"",stats:r,networkDetails:f,deliveryDirectives:a});break;case L.PlaylistContextType.SUBTITLE_TRACK:this.hls.trigger(O.Events.SUBTITLE_TRACK_LOADED,{details:u,id:o||0,groupId:c||"",stats:r,networkDetails:f,deliveryDirectives:a});break}},m}();P.default=x},"./src/polyfills/number.ts":function(K,P,p){p.r(P),p.d(P,"isFiniteNumber",function(){return M}),p.d(P,"MAX_SAFE_INTEGER",function(){return O});var M=Number.isFinite||function(A){return typeof A=="number"&&isFinite(A)},O=Number.MAX_SAFE_INTEGER||9007199254740991},"./src/remux/aac-helper.ts":function(K,P,p){p.r(P);var M=function(){function O(){}return O.getSilentFrame=function(F,D){switch(F){case"mp4a.40.2":if(D===1)return new Uint8Array([0,200,0,128,35,128]);if(D===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(D===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(D===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(D===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(D===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(D===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(D===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(D===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);break}},O}();P.default=M},"./src/remux/mp4-generator.ts":function(K,P,p){p.r(P);var M=Math.pow(2,32)-1,O=function(){function A(){}return A.init=function(){A.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};var D;for(D in A.types)A.types.hasOwnProperty(D)&&(A.types[D]=[D.charCodeAt(0),D.charCodeAt(1),D.charCodeAt(2),D.charCodeAt(3)]);var R=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),L=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);A.HDLR_TYPES={video:R,audio:L};var g=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),S=new Uint8Array([0,0,0,0,0,0,0,0]);A.STTS=A.STSC=A.STCO=S,A.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),A.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),A.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),A.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var T=new Uint8Array([105,115,111,109]),x=new Uint8Array([97,118,99,49]),m=new Uint8Array([0,0,0,1]);A.FTYP=A.box(A.types.ftyp,T,m,T,x),A.DINF=A.box(A.types.dinf,A.box(A.types.dref,g))},A.box=function(D){for(var R=8,L=arguments.length,g=new Array(L>1?L-1:0),S=1;S<L;S++)g[S-1]=arguments[S];for(var T=g.length,x=T;T--;)R+=g[T].byteLength;var m=new Uint8Array(R);for(m[0]=R>>24&255,m[1]=R>>16&255,m[2]=R>>8&255,m[3]=R&255,m.set(D,4),T=0,R=8;T<x;T++)m.set(g[T],R),R+=g[T].byteLength;return m},A.hdlr=function(D){return A.box(A.types.hdlr,A.HDLR_TYPES[D])},A.mdat=function(D){return A.box(A.types.mdat,D)},A.mdhd=function(D,R){R*=D;var L=Math.floor(R/(M+1)),g=Math.floor(R%(M+1));return A.box(A.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,D>>24&255,D>>16&255,D>>8&255,D&255,L>>24,L>>16&255,L>>8&255,L&255,g>>24,g>>16&255,g>>8&255,g&255,85,196,0,0]))},A.mdia=function(D){return A.box(A.types.mdia,A.mdhd(D.timescale,D.duration),A.hdlr(D.type),A.minf(D))},A.mfhd=function(D){return A.box(A.types.mfhd,new Uint8Array([0,0,0,0,D>>24,D>>16&255,D>>8&255,D&255]))},A.minf=function(D){return D.type==="audio"?A.box(A.types.minf,A.box(A.types.smhd,A.SMHD),A.DINF,A.stbl(D)):A.box(A.types.minf,A.box(A.types.vmhd,A.VMHD),A.DINF,A.stbl(D))},A.moof=function(D,R,L){return A.box(A.types.moof,A.mfhd(D),A.traf(L,R))},A.moov=function(D){for(var R=D.length,L=[];R--;)L[R]=A.trak(D[R]);return A.box.apply(null,[A.types.moov,A.mvhd(D[0].timescale,D[0].duration)].concat(L).concat(A.mvex(D)))},A.mvex=function(D){for(var R=D.length,L=[];R--;)L[R]=A.trex(D[R]);return A.box.apply(null,[A.types.mvex].concat(L))},A.mvhd=function(D,R){R*=D;var L=Math.floor(R/(M+1)),g=Math.floor(R%(M+1)),S=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,D>>24&255,D>>16&255,D>>8&255,D&255,L>>24,L>>16&255,L>>8&255,L&255,g>>24,g>>16&255,g>>8&255,g&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return A.box(A.types.mvhd,S)},A.sdtp=function(D){var R=D.samples||[],L=new Uint8Array(4+R.length),g,S;for(g=0;g<R.length;g++)S=R[g].flags,L[g+4]=S.dependsOn<<4|S.isDependedOn<<2|S.hasRedundancy;return A.box(A.types.sdtp,L)},A.stbl=function(D){return A.box(A.types.stbl,A.stsd(D),A.box(A.types.stts,A.STTS),A.box(A.types.stsc,A.STSC),A.box(A.types.stsz,A.STSZ),A.box(A.types.stco,A.STCO))},A.avc1=function(D){var R=[],L=[],g,S,T;for(g=0;g<D.sps.length;g++)S=D.sps[g],T=S.byteLength,R.push(T>>>8&255),R.push(T&255),R=R.concat(Array.prototype.slice.call(S));for(g=0;g<D.pps.length;g++)S=D.pps[g],T=S.byteLength,L.push(T>>>8&255),L.push(T&255),L=L.concat(Array.prototype.slice.call(S));var x=A.box(A.types.avcC,new Uint8Array([1,R[3],R[4],R[5],252|3,224|D.sps.length].concat(R).concat([D.pps.length]).concat(L))),m=D.width,h=D.height,i=D.pixelRatio[0],e=D.pixelRatio[1];return A.box(A.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,m>>8&255,m&255,h>>8&255,h&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),x,A.box(A.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),A.box(A.types.pasp,new Uint8Array([i>>24,i>>16&255,i>>8&255,i&255,e>>24,e>>16&255,e>>8&255,e&255])))},A.esds=function(D){var R=D.config.length;return new Uint8Array([0,0,0,0,3,23+R,0,1,0,4,15+R,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([R]).concat(D.config).concat([6,1,2]))},A.mp4a=function(D){var R=D.samplerate;return A.box(A.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,D.channelCount,0,16,0,0,0,0,R>>8&255,R&255,0,0]),A.box(A.types.esds,A.esds(D)))},A.mp3=function(D){var R=D.samplerate;return A.box(A.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,D.channelCount,0,16,0,0,0,0,R>>8&255,R&255,0,0]))},A.stsd=function(D){return D.type==="audio"?!D.isAAC&&D.codec==="mp3"?A.box(A.types.stsd,A.STSD,A.mp3(D)):A.box(A.types.stsd,A.STSD,A.mp4a(D)):A.box(A.types.stsd,A.STSD,A.avc1(D))},A.tkhd=function(D){var R=D.id,L=D.duration*D.timescale,g=D.width,S=D.height,T=Math.floor(L/(M+1)),x=Math.floor(L%(M+1));return A.box(A.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,R>>24&255,R>>16&255,R>>8&255,R&255,0,0,0,0,T>>24,T>>16&255,T>>8&255,T&255,x>>24,x>>16&255,x>>8&255,x&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,g>>8&255,g&255,0,0,S>>8&255,S&255,0,0]))},A.traf=function(D,R){var L=A.sdtp(D),g=D.id,S=Math.floor(R/(M+1)),T=Math.floor(R%(M+1));return A.box(A.types.traf,A.box(A.types.tfhd,new Uint8Array([0,0,0,0,g>>24,g>>16&255,g>>8&255,g&255])),A.box(A.types.tfdt,new Uint8Array([1,0,0,0,S>>24,S>>16&255,S>>8&255,S&255,T>>24,T>>16&255,T>>8&255,T&255])),A.trun(D,L.length+16+20+8+16+8+8),L)},A.trak=function(D){return D.duration=D.duration||4294967295,A.box(A.types.trak,A.tkhd(D),A.mdia(D))},A.trex=function(D){var R=D.id;return A.box(A.types.trex,new Uint8Array([0,0,0,0,R>>24,R>>16&255,R>>8&255,R&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))},A.trun=function(D,R){var L=D.samples||[],g=L.length,S=12+16*g,T=new Uint8Array(S),x,m,h,i,e,r;for(R+=8+S,T.set([0,0,15,1,g>>>24&255,g>>>16&255,g>>>8&255,g&255,R>>>24&255,R>>>16&255,R>>>8&255,R&255],0),x=0;x<g;x++)m=L[x],h=m.duration,i=m.size,e=m.flags,r=m.cts,T.set([h>>>24&255,h>>>16&255,h>>>8&255,h&255,i>>>24&255,i>>>16&255,i>>>8&255,i&255,e.isLeading<<2|e.dependsOn,e.isDependedOn<<6|e.hasRedundancy<<4|e.paddingValue<<1|e.isNonSync,e.degradPrio&240<<8,e.degradPrio&15,r>>>24&255,r>>>16&255,r>>>8&255,r&255],12+16*x);return A.box(A.types.trun,T)},A.initSegment=function(D){A.types||A.init();var R=A.moov(D),L=new Uint8Array(A.FTYP.byteLength+R.byteLength);return L.set(A.FTYP),L.set(R,A.FTYP.byteLength),L},A}();O.types=void 0,O.HDLR_TYPES=void 0,O.STTS=void 0,O.STSC=void 0,O.STCO=void 0,O.STSZ=void 0,O.VMHD=void 0,O.SMHD=void 0,O.STSD=void 0,O.FTYP=void 0,O.DINF=void 0,P.default=O},"./src/remux/mp4-remuxer.ts":function(K,P,p){p.r(P),p.d(P,"default",function(){return r}),p.d(P,"normalizePts",function(){return t});var M=p("./src/polyfills/number.ts"),O=p("./src/remux/aac-helper.ts"),A=p("./src/remux/mp4-generator.ts"),F=p("./src/events.ts"),D=p("./src/errors.ts"),R=p("./src/utils/logger.ts"),L=p("./src/types/loader.ts"),g=p("./src/utils/timescale-conversion.ts");function S(){return S=Object.assign||function(o){for(var c=1;c<arguments.length;c++){var v=arguments[c];for(var u in v)Object.prototype.hasOwnProperty.call(v,u)&&(o[u]=v[u])}return o},S.apply(this,arguments)}var T=10*1e3,x=1024,m=1152,h=null,i=null,e=!1,r=function(){function o(v,u,a,l){if(this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=void 0,this._initDTS=void 0,this.nextAvcDts=null,this.nextAudioPts=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.observer=v,this.config=u,this.typeSupported=a,this.ISGenerated=!1,h===null){var d=navigator.userAgent||"",E=d.match(/Chrome\/(\d+)/i);h=E?parseInt(E[1]):0}if(i===null){var y=navigator.userAgent.match(/Safari\/(\d+)/i);i=y?parseInt(y[1]):0}e=!!h&&h<75||!!i&&i<600}var c=o.prototype;return c.destroy=function(){},c.resetTimeStamp=function(u){R.logger.log("[mp4-remuxer]: initPTS & initDTS reset"),this._initPTS=this._initDTS=u},c.resetNextTimestamp=function(){R.logger.log("[mp4-remuxer]: reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1},c.resetInitSegment=function(){R.logger.log("[mp4-remuxer]: ISGenerated flag reset"),this.ISGenerated=!1},c.getVideoStartPts=function(u){var a=!1,l=u.reduce(function(d,E){var y=E.pts-d;return y<-4294967296?(a=!0,t(d,E.pts)):y>0?d:E.pts},u[0].pts);return a&&R.logger.debug("PTS rollover detected"),l},c.remux=function(u,a,l,d,E,y,I,C){var _,B,U,N,k,w,G=E,W=E,Y=u.pid>-1,H=a.pid>-1,z=a.samples.length,Q=u.samples.length>0,$=z>1,X=(!Y||Q)&&(!H||$)||this.ISGenerated||I;if(X){this.ISGenerated||(U=this.generateIS(u,a,E));var J=this.isVideoContiguous,Z=-1;if($&&(Z=f(a.samples),!J&&this.config.forceKeyFrameOnDiscontinuity))if(w=!0,Z>0){R.logger.warn("[mp4-remuxer]: Dropped "+Z+" out of "+z+" video samples due to a missing keyframe");var q=this.getVideoStartPts(a.samples);a.samples=a.samples.slice(Z),a.dropped+=Z,W+=(a.samples[0].pts-q)/(a.timescale||9e4)}else Z===-1&&(R.logger.warn("[mp4-remuxer]: No keyframe found out of "+z+" video samples"),w=!1);if(this.ISGenerated){if(Q&&$){var ee=this.getVideoStartPts(a.samples),ae=t(u.samples[0].pts,ee)-ee,te=ae/a.inputTimeScale;G+=Math.max(0,te),W+=Math.max(0,-te)}if(Q){if(u.samplerate||(R.logger.warn("[mp4-remuxer]: regenerate InitSegment as audio detected"),U=this.generateIS(u,a,E)),B=this.remuxAudio(u,G,this.isAudioContiguous,y,H||$||C===L.PlaylistLevelType.AUDIO?W:void 0),$){var ie=B?B.endPTS-B.startPTS:0;a.inputTimeScale||(R.logger.warn("[mp4-remuxer]: regenerate InitSegment as video detected"),U=this.generateIS(u,a,E)),_=this.remuxVideo(a,W,J,ie)}}else $&&(_=this.remuxVideo(a,W,J,0));_&&(_.firstKeyFrame=Z,_.independent=Z!==-1)}}return this.ISGenerated&&(l.samples.length&&(k=this.remuxID3(l,E)),d.samples.length&&(N=this.remuxText(d,E))),{audio:B,video:_,initSegment:U,independent:w,text:N,id3:k}},c.generateIS=function(u,a,l){var d=u.samples,E=a.samples,y=this.typeSupported,I={},C=!Object(M.isFiniteNumber)(this._initPTS),_="audio/mp4",B,U,N;if(C&&(B=U=1/0),u.config&&d.length&&(u.timescale=u.samplerate,u.isAAC||(y.mpeg?(_="audio/mpeg",u.codec=""):y.mp3&&(u.codec="mp3")),I.audio={id:"audio",container:_,codec:u.codec,initSegment:!u.isAAC&&y.mpeg?new Uint8Array(0):A.default.initSegment([u]),metadata:{channelCount:u.channelCount}},C&&(N=u.inputTimeScale,B=U=d[0].pts-Math.round(N*l))),a.sps&&a.pps&&E.length&&(a.timescale=a.inputTimeScale,I.video={id:"main",container:"video/mp4",codec:a.codec,initSegment:A.default.initSegment([a]),metadata:{width:a.width,height:a.height}},C)){N=a.inputTimeScale;var k=this.getVideoStartPts(E),w=Math.round(N*l);U=Math.min(U,t(E[0].dts,k)-w),B=Math.min(B,k-w)}if(Object.keys(I).length)return this.ISGenerated=!0,C&&(this._initPTS=B,this._initDTS=U),{tracks:I,initPTS:B,timescale:N}},c.remuxVideo=function(u,a,l,d){var E=u.inputTimeScale,y=u.samples,I=[],C=y.length,_=this._initPTS,B=this.nextAvcDts,U=8,N,k,w,G=Number.POSITIVE_INFINITY,W=Number.NEGATIVE_INFINITY,Y=0,H=!1;if(!l||B===null){var z=a*E,Q=y[0].pts-t(y[0].dts,y[0].pts);B=z-Q}for(var $=0;$<C;$++){var X=y[$];if(X.pts=t(X.pts-_,B),X.dts=t(X.dts-_,B),X.dts>X.pts){var J=9e4*.2;Y=Math.max(Math.min(Y,X.pts-X.dts),-1*J)}X.dts<y[$>0?$-1:$].dts&&(H=!0)}H&&y.sort(function(Ye,Je){var Mr=Ye.dts-Je.dts,_r=Ye.pts-Je.pts;return Mr||_r}),k=y[0].dts,w=y[y.length-1].dts;var Z=Math.round((w-k)/(C-1));if(Y<0){if(Y<Z*-2){R.logger.warn("PTS < DTS detected in video samples, offsetting DTS from PTS by "+Object(g.toMsFromMpegTsClock)(-Z,!0)+" ms");for(var q=Y,ee=0;ee<C;ee++)y[ee].dts=q=Math.max(q,y[ee].pts-Z),y[ee].pts=Math.max(q,y[ee].pts)}else{R.logger.warn("PTS < DTS detected in video samples, shifting DTS by "+Object(g.toMsFromMpegTsClock)(Y,!0)+" ms to overcome this issue");for(var ae=0;ae<C;ae++)y[ae].dts=y[ae].dts+Y}k=y[0].dts}if(l){var te=k-B,ie=te>Z,fe=te<-1;if(ie||fe){ie?R.logger.warn("AVC: "+Object(g.toMsFromMpegTsClock)(te,!0)+" ms ("+te+"dts) hole between fragments detected, filling it"):R.logger.warn("AVC: "+Object(g.toMsFromMpegTsClock)(-te,!0)+" ms ("+te+"dts) overlapping between fragments detected"),k=B;var se=y[0].pts-te;y[0].dts=k,y[0].pts=se,R.logger.log("Video: First PTS/DTS adjusted: "+Object(g.toMsFromMpegTsClock)(se,!0)+"/"+Object(g.toMsFromMpegTsClock)(k,!0)+", delta: "+Object(g.toMsFromMpegTsClock)(te,!0)+" ms")}}e&&(k=Math.max(0,k));for(var de=0,oe=0,ce=0;ce<C;ce++){for(var re=y[ce],De=re.units,Re=De.length,xe=0,ve=0;ve<Re;ve++)xe+=De[ve].data.length;oe+=xe,de+=Re,re.length=xe,re.dts=Math.max(re.dts,k),re.pts=Math.max(re.pts,re.dts,0),G=Math.min(re.pts,G),W=Math.max(re.pts,W)}w=y[C-1].dts;var ge=oe+4*de+8,Te;try{Te=new Uint8Array(ge)}catch{this.observer.emit(F.Events.ERROR,F.Events.ERROR,{type:D.ErrorTypes.MUX_ERROR,details:D.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:ge,reason:"fail allocating video mdat "+ge});return}var me=new DataView(Te.buffer);me.setUint32(0,ge),Te.set(A.default.types.mdat,4);for(var he=0;he<C;he++){for(var Ee=y[he],Ie=Ee.units,Ce=0,Ae=0,Pe=Ie.length;Ae<Pe;Ae++){var Se=Ie[Ae],pe=Se.data,Me=Se.data.byteLength;me.setUint32(U,Me),U+=4,Te.set(pe,U),U+=Me,Ce+=4+Me}if(he<C-1)N=y[he+1].dts-Ee.dts;else{var Ue=this.config,ke=Ee.dts-y[he>0?he-1:he].dts;if(Ue.stretchShortVideoTrack&&this.nextAudioPts!==null){var Or=Math.floor(Ue.maxBufferHole*E),He=(d?G+d*E:this.nextAudioPts)-Ee.pts;He>Or?(N=He-ke,N<0&&(N=ke),R.logger.log("[mp4-remuxer]: It is approximately "+He/90+" ms to the next segment; using duration "+N/90+" ms for the last video frame.")):N=ke}else N=ke}var Rr=Math.round(Ee.pts-Ee.dts);I.push(new s(Ee.key,N,Ce,Rr))}if(I.length&&h&&h<70){var Ze=I[0].flags;Ze.dependsOn=2,Ze.isNonSync=0}console.assert(N!==void 0,"mp4SampleDuration must be computed"),this.nextAvcDts=B=w+N,this.isVideoContiguous=!0;var Ir=A.default.moof(u.sequenceNumber++,k,S({},u,{samples:I})),Cr="video",Pr={data1:Ir,data2:Te,startPTS:G/E,endPTS:(W+N)/E,startDTS:k/E,endDTS:B/E,type:Cr,hasAudio:!1,hasVideo:!0,nb:I.length,dropped:u.dropped};return u.samples=[],u.dropped=0,console.assert(Te.length,"MDAT length must not be zero"),Pr},c.remuxAudio=function(u,a,l,d,E){var y=u.inputTimeScale,I=u.samplerate?u.samplerate:y,C=y/I,_=u.isAAC?x:m,B=_*C,U=this._initPTS,N=!u.isAAC&&this.typeSupported.mpeg,k=[],w=u.samples,G=N?0:8,W=this.nextAudioPts||-1,Y=a*y;if(this.isAudioContiguous=l=l||w.length&&W>0&&(d&&Math.abs(Y-W)<9e3||Math.abs(t(w[0].pts-U,Y)-W)<20*B),w.forEach(function(pe){pe.pts=t(pe.pts-U,Y)}),!l||W<0){if(w=w.filter(function(pe){return pe.pts>=0}),!w.length)return;E===0?W=0:d?W=Math.max(0,Y):W=w[0].pts}if(u.isAAC)for(var H=E!==void 0,z=this.config.maxAudioFramesDrift,Q=0,$=W;Q<w.length;Q++){var X=w[Q],J=X.pts,Z=J-$,q=Math.abs(1e3*Z/y);if(Z<=-z*B&&H)Q===0&&(R.logger.warn("Audio frame @ "+(J/y).toFixed(3)+"s overlaps nextAudioPts by "+Math.round(1e3*Z/y)+" ms."),this.nextAudioPts=W=$=J);else if(Z>=z*B&&q<T&&H){var ee=Math.round(Z/B);$=J-ee*B,$<0&&(ee--,$+=B),Q===0&&(this.nextAudioPts=W=$),R.logger.warn("[mp4-remuxer]: Injecting "+ee+" audio frame @ "+($/y).toFixed(3)+"s due to "+Math.round(1e3*Z/y)+" ms gap.");for(var ae=0;ae<ee;ae++){var te=Math.max($,0),ie=O.default.getSilentFrame(u.manifestCodec||u.codec,u.channelCount);ie||(R.logger.log("[mp4-remuxer]: Unable to get silent frame for given audio codec; duplicating last frame instead."),ie=X.unit.subarray()),w.splice(Q,0,{unit:ie,pts:te}),$+=B,Q++}}X.pts=$,$+=B}for(var fe=null,se=null,de,oe=0,ce=w.length;ce--;)oe+=w[ce].unit.byteLength;for(var re=0,De=w.length;re<De;re++){var Re=w[re],xe=Re.unit,ve=Re.pts;if(se!==null){var ge=k[re-1];ge.duration=Math.round((ve-se)/C)}else if(l&&u.isAAC&&(ve=W),fe=ve,oe>0){oe+=G;try{de=new Uint8Array(oe)}catch{this.observer.emit(F.Events.ERROR,F.Events.ERROR,{type:D.ErrorTypes.MUX_ERROR,details:D.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:oe,reason:"fail allocating audio mdat "+oe});return}if(!N){var Te=new DataView(de.buffer);Te.setUint32(0,oe),de.set(A.default.types.mdat,4)}}else return;de.set(xe,G);var me=xe.byteLength;G+=me,k.push(new s(!0,_,me,0)),se=ve}var he=k.length;if(!!he){var Ee=k[k.length-1];this.nextAudioPts=W=se+C*Ee.duration;var Ie=N?new Uint8Array(0):A.default.moof(u.sequenceNumber++,fe/C,S({},u,{samples:k}));u.samples=[];var Ce=fe/y,Ae=W/y,Pe="audio",Se={data1:Ie,data2:de,startPTS:Ce,endPTS:Ae,startDTS:Ce,endDTS:Ae,type:Pe,hasAudio:!0,hasVideo:!1,nb:he};return this.isAudioContiguous=!0,console.assert(de.length,"MDAT length must not be zero"),Se}},c.remuxEmptyAudio=function(u,a,l,d){var E=u.inputTimeScale,y=u.samplerate?u.samplerate:E,I=E/y,C=this.nextAudioPts,_=(C!==null?C:d.startDTS*E)+this._initDTS,B=d.endDTS*E+this._initDTS,U=I*x,N=Math.ceil((B-_)/U),k=O.default.getSilentFrame(u.manifestCodec||u.codec,u.channelCount);if(R.logger.warn("[mp4-remuxer]: remux empty Audio"),!k){R.logger.trace("[mp4-remuxer]: Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec");return}for(var w=[],G=0;G<N;G++){var W=_+G*U;w.push({unit:k,pts:W,dts:W})}return u.samples=w,this.remuxAudio(u,a,l,!1)},c.remuxID3=function(u,a){var l=u.samples.length;if(!!l){for(var d=u.inputTimeScale,E=this._initPTS,y=this._initDTS,I=0;I<l;I++){var C=u.samples[I];C.pts=t(C.pts-E,a*d)/d,C.dts=t(C.dts-y,a*d)/d}var _=u.samples;return u.samples=[],{samples:_}}},c.remuxText=function(u,a){var l=u.samples.length;if(!!l){for(var d=u.inputTimeScale,E=this._initPTS,y=0;y<l;y++){var I=u.samples[y];I.pts=t(I.pts-E,a*d)/d}u.samples.sort(function(_,B){return _.pts-B.pts});var C=u.samples;return u.samples=[],{samples:C}}},o}();function t(o,c){var v;if(c===null)return o;for(c<o?v=-8589934592:v=8589934592;Math.abs(o-c)>4294967296;)o+=v;return o}function f(o){for(var c=0;c<o.length;c++)if(o[c].key)return c;return-1}var s=function(c,v,u,a){this.size=void 0,this.duration=void 0,this.cts=void 0,this.flags=void 0,this.duration=v,this.size=u,this.cts=a,this.flags=new n(c)},n=function(c){this.isLeading=0,this.isDependedOn=0,this.hasRedundancy=0,this.degradPrio=0,this.dependsOn=1,this.isNonSync=1,this.dependsOn=c?2:1,this.isNonSync=c?0:1}},"./src/remux/passthrough-remuxer.ts":function(K,P,p){p.r(P);var M=p("./src/polyfills/number.ts"),O=p("./src/utils/mp4-tools.ts"),A=p("./src/loader/fragment.ts"),F=p("./src/utils/logger.ts"),D=function(){function g(){this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=void 0,this.initTracks=void 0,this.lastEndDTS=null}var S=g.prototype;return S.destroy=function(){},S.resetTimeStamp=function(x){this.initPTS=x,this.lastEndDTS=null},S.resetNextTimestamp=function(){this.lastEndDTS=null},S.resetInitSegment=function(x,m,h){this.audioCodec=m,this.videoCodec=h,this.generateInitSegment(x),this.emitInitSegment=!0},S.generateInitSegment=function(x){var m=this.audioCodec,h=this.videoCodec;if(!x||!x.byteLength){this.initTracks=void 0,this.initData=void 0;return}var i=this.initData=Object(O.parseInitSegment)(x);m||(m=L(i.audio,A.ElementaryStreamTypes.AUDIO)),h||(h=L(i.video,A.ElementaryStreamTypes.VIDEO));var e={};i.audio&&i.video?e.audiovideo={container:"video/mp4",codec:m+","+h,initSegment:x,id:"main"}:i.audio?e.audio={container:"audio/mp4",codec:m,initSegment:x,id:"audio"}:i.video?e.video={container:"video/mp4",codec:h,initSegment:x,id:"main"}:F.logger.warn("[passthrough-remuxer.ts]: initSegment does not contain moov or trak boxes."),this.initTracks=e},S.remux=function(x,m,h,i,e){var r=this.initPTS,t=this.lastEndDTS,f={audio:void 0,video:void 0,text:i,id3:h,initSegment:void 0};Object(M.isFiniteNumber)(t)||(t=this.lastEndDTS=e||0);var s=m.samples;if(!s||!s.length)return f;var n={initPTS:void 0,timescale:1},o=this.initData;if((!o||!o.length)&&(this.generateInitSegment(s),o=this.initData),!o||!o.length)return F.logger.warn("[passthrough-remuxer.ts]: Failed to generate initSegment."),f;this.emitInitSegment&&(n.tracks=this.initTracks,this.emitInitSegment=!1),Object(M.isFiniteNumber)(r)||(this.initPTS=n.initPTS=r=R(o,s,t));var c=Object(O.getDuration)(s,o),v=t,u=c+v;Object(O.offsetStartDTS)(o,s,r),c>0?this.lastEndDTS=u:(F.logger.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());var a=!!o.audio,l=!!o.video,d="";a&&(d+="audio"),l&&(d+="video");var E={data1:s,startPTS:v,startDTS:v,endPTS:u,endDTS:u,type:d,hasAudio:a,hasVideo:l,nb:1,dropped:0};return f.audio=E.type==="audio"?E:void 0,f.video=E.type!=="audio"?E:void 0,f.text=i,f.id3=h,f.initSegment=n,f},g}(),R=function(S,T,x){return Object(O.getStartDTS)(S,T)-x};function L(g,S){var T=g==null?void 0:g.codec;return T&&T.length>4?T:T==="hvc1"?"hvc1.1.c.L120.90":T==="av01"?"av01.0.04M.08":T==="avc1"||S===A.ElementaryStreamTypes.VIDEO?"avc1.42e01e":"mp4a.40.5"}P.default=D},"./src/task-loop.ts":function(K,P,p){p.r(P),p.d(P,"default",function(){return M});var M=function(){function O(){this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}var A=O.prototype;return A.destroy=function(){this.onHandlerDestroying(),this.onHandlerDestroyed()},A.onHandlerDestroying=function(){this.clearNextTick(),this.clearInterval()},A.onHandlerDestroyed=function(){},A.hasInterval=function(){return!!this._tickInterval},A.hasNextTick=function(){return!!this._tickTimer},A.setInterval=function(D){return this._tickInterval?!1:(this._tickInterval=self.setInterval(this._boundTick,D),!0)},A.clearInterval=function(){return this._tickInterval?(self.clearInterval(this._tickInterval),this._tickInterval=null,!0):!1},A.clearNextTick=function(){return this._tickTimer?(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0):!1},A.tick=function(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)},A.tickImmediate=function(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)},A.doTick=function(){},O}()},"./src/types/cmcd.ts":function(K,P,p){p.r(P),p.d(P,"CMCDVersion",function(){return M}),p.d(P,"CMCDObjectType",function(){return O}),p.d(P,"CMCDStreamingFormat",function(){return A}),p.d(P,"CMCDStreamType",function(){return F});var M=1,O;(function(D){D.MANIFEST="m",D.AUDIO="a",D.VIDEO="v",D.MUXED="av",D.INIT="i",D.CAPTION="c",D.TIMED_TEXT="tt",D.KEY="k",D.OTHER="o"})(O||(O={}));var A;(function(D){D.DASH="d",D.HLS="h",D.SMOOTH="s",D.OTHER="o"})(A||(A={}));var F;(function(D){D.VOD="v",D.LIVE="l"})(F||(F={}))},"./src/types/level.ts":function(K,P,p){p.r(P),p.d(P,"HlsSkip",function(){return A}),p.d(P,"getSkipValue",function(){return F}),p.d(P,"HlsUrlParameters",function(){return D}),p.d(P,"Level",function(){return R});function M(L,g){for(var S=0;S<g.length;S++){var T=g[S];T.enumerable=T.enumerable||!1,T.configurable=!0,"value"in T&&(T.writable=!0),Object.defineProperty(L,T.key,T)}}function O(L,g,S){return g&&M(L.prototype,g),S&&M(L,S),L}var A;(function(L){L.No="",L.Yes="YES",L.v2="v2"})(A||(A={}));function F(L,g){var S=L.canSkipUntil,T=L.canSkipDateRanges,x=L.endSN,m=g!==void 0?g-x:0;return S&&m<S?T?A.v2:A.Yes:A.No}var D=function(){function L(S,T,x){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=S,this.part=T,this.skip=x}var g=L.prototype;return g.addDirectives=function(T){var x=new self.URL(T);return this.msn!==void 0&&x.searchParams.set("_HLS_msn",this.msn.toString()),this.part!==void 0&&x.searchParams.set("_HLS_part",this.part.toString()),this.skip&&x.searchParams.set("_HLS_skip",this.skip),x.toString()},L}(),R=function(){function L(g){this.attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.videoCodec=void 0,this.width=void 0,this.unknownCodecs=void 0,this.audioGroupIds=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.textGroupIds=void 0,this.url=void 0,this._urlId=0,this.url=[g.url],this.attrs=g.attrs,this.bitrate=g.bitrate,g.details&&(this.details=g.details),this.id=g.id||0,this.name=g.name,this.width=g.width||0,this.height=g.height||0,this.audioCodec=g.audioCodec,this.videoCodec=g.videoCodec,this.unknownCodecs=g.unknownCodecs,this.codecSet=[g.videoCodec,g.audioCodec].filter(function(S){return S}).join(",").replace(/\.[^.,]+/g,"")}return O(L,[{key:"maxBitrate",get:function(){return Math.max(this.realBitrate,this.bitrate)}},{key:"uri",get:function(){return this.url[this._urlId]||""}},{key:"urlId",get:function(){return this._urlId},set:function(S){var T=S%this.url.length;this._urlId!==T&&(this.details=void 0,this._urlId=T)}}]),L}()},"./src/types/loader.ts":function(K,P,p){p.r(P),p.d(P,"PlaylistContextType",function(){return M}),p.d(P,"PlaylistLevelType",function(){return O});var M;(function(A){A.MANIFEST="manifest",A.LEVEL="level",A.AUDIO_TRACK="audioTrack",A.SUBTITLE_TRACK="subtitleTrack"})(M||(M={}));var O;(function(A){A.MAIN="main",A.AUDIO="audio",A.SUBTITLE="subtitle"})(O||(O={}))},"./src/types/transmuxer.ts":function(K,P,p){p.r(P),p.d(P,"ChunkMetadata",function(){return M});var M=function(F,D,R,L,g,S){L===void 0&&(L=0),g===void 0&&(g=-1),S===void 0&&(S=!1),this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing=O(),this.buffering={audio:O(),video:O(),audiovideo:O()},this.level=F,this.sn=D,this.id=R,this.size=L,this.part=g,this.partial=S};function O(){return{start:0,executeStart:0,executeEnd:0,end:0}}},"./src/utils/attr-list.ts":function(K,P,p){p.r(P),p.d(P,"AttrList",function(){return A});var M=/^(\d+)x(\d+)$/,O=/\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g,A=function(){function F(R){typeof R=="string"&&(R=F.parseAttrList(R));for(var L in R)R.hasOwnProperty(L)&&(this[L]=R[L])}var D=F.prototype;return D.decimalInteger=function(L){var g=parseInt(this[L],10);return g>Number.MAX_SAFE_INTEGER?1/0:g},D.hexadecimalInteger=function(L){if(this[L]){var g=(this[L]||"0x").slice(2);g=(g.length&1?"0":"")+g;for(var S=new Uint8Array(g.length/2),T=0;T<g.length/2;T++)S[T]=parseInt(g.slice(T*2,T*2+2),16);return S}else return null},D.hexadecimalIntegerAsNumber=function(L){var g=parseInt(this[L],16);return g>Number.MAX_SAFE_INTEGER?1/0:g},D.decimalFloatingPoint=function(L){return parseFloat(this[L])},D.optionalFloat=function(L,g){var S=this[L];return S?parseFloat(S):g},D.enumeratedString=function(L){return this[L]},D.bool=function(L){return this[L]==="YES"},D.decimalResolution=function(L){var g=M.exec(this[L]);if(g!==null)return{width:parseInt(g[1],10),height:parseInt(g[2],10)}},F.parseAttrList=function(L){var g,S={},T='"';for(O.lastIndex=0;(g=O.exec(L))!==null;){var x=g[2];x.indexOf(T)===0&&x.lastIndexOf(T)===x.length-1&&(x=x.slice(1,-1)),S[g[1]]=x}return S},F}()},"./src/utils/binary-search.ts":function(K,P,p){p.r(P);var M={search:function(A,F){for(var D=0,R=A.length-1,L=null,g=null;D<=R;){L=(D+R)/2|0,g=A[L];var S=F(g);if(S>0)D=L+1;else if(S<0)R=L-1;else return g}return null}};P.default=M},"./src/utils/buffer-helper.ts":function(K,P,p){p.r(P),p.d(P,"BufferHelper",function(){return A});var M=p("./src/utils/logger.ts"),O={length:0,start:function(){return 0},end:function(){return 0}},A=function(){function F(){}return F.isBuffered=function(R,L){try{if(R){for(var g=F.getBuffered(R),S=0;S<g.length;S++)if(L>=g.start(S)&&L<=g.end(S))return!0}}catch{}return!1},F.bufferInfo=function(R,L,g){try{if(R){var S=F.getBuffered(R),T=[],x;for(x=0;x<S.length;x++)T.push({start:S.start(x),end:S.end(x)});return this.bufferedInfo(T,L,g)}}catch{}return{len:0,start:L,end:L,nextStart:void 0}},F.bufferedInfo=function(R,L,g){L=Math.max(0,L),R.sort(function(n,o){var c=n.start-o.start;return c||o.end-n.end});var S=[];if(g)for(var T=0;T<R.length;T++){var x=S.length;if(x){var m=S[x-1].end;R[T].start-m<g?R[T].end>m&&(S[x-1].end=R[T].end):S.push(R[T])}else S.push(R[T])}else S=R;for(var h=0,i,e=L,r=L,t=0;t<S.length;t++){var f=S[t].start,s=S[t].end;if(L+g>=f&&L<s)e=f,r=s,h=r-L;else if(L+g<f){i=f;break}}return{len:h,start:e||0,end:r||0,nextStart:i}},F.getBuffered=function(R){try{return R.buffered}catch(L){return M.logger.log("failed to get media.buffered",L),O}},F}()},"./src/utils/cea-608-parser.ts":function(K,P,p){p.r(P),p.d(P,"Row",function(){return r}),p.d(P,"CaptionScreen",function(){return t});var M=p("./src/utils/logger.ts"),O={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},A=function(u){var a=u;return O.hasOwnProperty(u)&&(a=O[u]),String.fromCharCode(a)},F=15,D=100,R={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},L={17:2,18:4,21:6,22:8,23:10,19:13,20:15},g={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},S={25:2,26:4,29:6,30:8,31:10,27:13,28:15},T=["white","green","blue","cyan","red","yellow","magenta","black","transparent"],x;(function(v){v[v.ERROR=0]="ERROR",v[v.TEXT=1]="TEXT",v[v.WARNING=2]="WARNING",v[v.INFO=2]="INFO",v[v.DEBUG=3]="DEBUG",v[v.DATA=3]="DATA"})(x||(x={}));var m=function(){function v(){this.time=null,this.verboseLevel=x.ERROR}var u=v.prototype;return u.log=function(l,d){this.verboseLevel>=l&&M.logger.log(this.time+" ["+l+"] "+d)},v}(),h=function(u){for(var a=[],l=0;l<u.length;l++)a.push(u[l].toString(16));return a},i=function(){function v(a,l,d,E,y){this.foreground=void 0,this.underline=void 0,this.italics=void 0,this.background=void 0,this.flash=void 0,this.foreground=a||"white",this.underline=l||!1,this.italics=d||!1,this.background=E||"black",this.flash=y||!1}var u=v.prototype;return u.reset=function(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1},u.setStyles=function(l){for(var d=["foreground","underline","italics","background","flash"],E=0;E<d.length;E++){var y=d[E];l.hasOwnProperty(y)&&(this[y]=l[y])}},u.isDefault=function(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash},u.equals=function(l){return this.foreground===l.foreground&&this.underline===l.underline&&this.italics===l.italics&&this.background===l.background&&this.flash===l.flash},u.copy=function(l){this.foreground=l.foreground,this.underline=l.underline,this.italics=l.italics,this.background=l.background,this.flash=l.flash},u.toString=function(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash},v}(),e=function(){function v(a,l,d,E,y,I){this.uchar=void 0,this.penState=void 0,this.uchar=a||" ",this.penState=new i(l,d,E,y,I)}var u=v.prototype;return u.reset=function(){this.uchar=" ",this.penState.reset()},u.setChar=function(l,d){this.uchar=l,this.penState.copy(d)},u.setPenState=function(l){this.penState.copy(l)},u.equals=function(l){return this.uchar===l.uchar&&this.penState.equals(l.penState)},u.copy=function(l){this.uchar=l.uchar,this.penState.copy(l.penState)},u.isEmpty=function(){return this.uchar===" "&&this.penState.isDefault()},v}(),r=function(){function v(a){this.chars=void 0,this.pos=void 0,this.currPenState=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chars=[];for(var l=0;l<D;l++)this.chars.push(new e);this.logger=a,this.pos=0,this.currPenState=new i}var u=v.prototype;return u.equals=function(l){for(var d=!0,E=0;E<D;E++)if(!this.chars[E].equals(l.chars[E])){d=!1;break}return d},u.copy=function(l){for(var d=0;d<D;d++)this.chars[d].copy(l.chars[d])},u.isEmpty=function(){for(var l=!0,d=0;d<D;d++)if(!this.chars[d].isEmpty()){l=!1;break}return l},u.setCursor=function(l){this.pos!==l&&(this.pos=l),this.pos<0?(this.logger.log(x.DEBUG,"Negative cursor position "+this.pos),this.pos=0):this.pos>D&&(this.logger.log(x.DEBUG,"Too large cursor position "+this.pos),this.pos=D)},u.moveCursor=function(l){var d=this.pos+l;if(l>1)for(var E=this.pos+1;E<d+1;E++)this.chars[E].setPenState(this.currPenState);this.setCursor(d)},u.backSpace=function(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)},u.insertChar=function(l){l>=144&&this.backSpace();var d=A(l);if(this.pos>=D){this.logger.log(x.ERROR,"Cannot insert "+l.toString(16)+" ("+d+") at position "+this.pos+". Skipping it!");return}this.chars[this.pos].setChar(d,this.currPenState),this.moveCursor(1)},u.clearFromPos=function(l){var d;for(d=l;d<D;d++)this.chars[d].reset()},u.clear=function(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()},u.clearToEndOfRow=function(){this.clearFromPos(this.pos)},u.getTextString=function(){for(var l=[],d=!0,E=0;E<D;E++){var y=this.chars[E].uchar;y!==" "&&(d=!1),l.push(y)}return d?"":l.join("")},u.setPenStyles=function(l){this.currPenState.setStyles(l);var d=this.chars[this.pos];d.setPenState(this.currPenState)},v}(),t=function(){function v(a){this.rows=void 0,this.currRow=void 0,this.nrRollUpRows=void 0,this.lastOutputScreen=void 0,this.logger=void 0,this.rows=[];for(var l=0;l<F;l++)this.rows.push(new r(a));this.logger=a,this.currRow=F-1,this.nrRollUpRows=null,this.lastOutputScreen=null,this.reset()}var u=v.prototype;return u.reset=function(){for(var l=0;l<F;l++)this.rows[l].clear();this.currRow=F-1},u.equals=function(l){for(var d=!0,E=0;E<F;E++)if(!this.rows[E].equals(l.rows[E])){d=!1;break}return d},u.copy=function(l){for(var d=0;d<F;d++)this.rows[d].copy(l.rows[d])},u.isEmpty=function(){for(var l=!0,d=0;d<F;d++)if(!this.rows[d].isEmpty()){l=!1;break}return l},u.backSpace=function(){var l=this.rows[this.currRow];l.backSpace()},u.clearToEndOfRow=function(){var l=this.rows[this.currRow];l.clearToEndOfRow()},u.insertChar=function(l){var d=this.rows[this.currRow];d.insertChar(l)},u.setPen=function(l){var d=this.rows[this.currRow];d.setPenStyles(l)},u.moveCursor=function(l){var d=this.rows[this.currRow];d.moveCursor(l)},u.setCursor=function(l){this.logger.log(x.INFO,"setCursor: "+l);var d=this.rows[this.currRow];d.setCursor(l)},u.setPAC=function(l){this.logger.log(x.INFO,"pacData = "+JSON.stringify(l));var d=l.row-1;if(this.nrRollUpRows&&d<this.nrRollUpRows-1&&(d=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==d){for(var E=0;E<F;E++)this.rows[E].clear();var y=this.currRow+1-this.nrRollUpRows,I=this.lastOutputScreen;if(I){var C=I.rows[y].cueStartTime,_=this.logger.time;if(C&&_!==null&&C<_)for(var B=0;B<this.nrRollUpRows;B++)this.rows[d-this.nrRollUpRows+B+1].copy(I.rows[y+B])}}this.currRow=d;var U=this.rows[this.currRow];if(l.indent!==null){var N=l.indent,k=Math.max(N-1,0);U.setCursor(l.indent),l.color=U.chars[k].penState.foreground}var w={foreground:l.color,underline:l.underline,italics:l.italics,background:"black",flash:!1};this.setPen(w)},u.setBkgData=function(l){this.logger.log(x.INFO,"bkgData = "+JSON.stringify(l)),this.backSpace(),this.setPen(l),this.insertChar(32)},u.setRollUpRows=function(l){this.nrRollUpRows=l},u.rollUp=function(){if(this.nrRollUpRows===null){this.logger.log(x.DEBUG,"roll_up but nrRollUpRows not set yet");return}this.logger.log(x.TEXT,this.getDisplayText());var l=this.currRow+1-this.nrRollUpRows,d=this.rows.splice(l,1)[0];d.clear(),this.rows.splice(this.currRow,0,d),this.logger.log(x.INFO,"Rolling up")},u.getDisplayText=function(l){l=l||!1;for(var d=[],E="",y=-1,I=0;I<F;I++){var C=this.rows[I].getTextString();C&&(y=I+1,l?d.push("Row "+y+": '"+C+"'"):d.push(C.trim()))}return d.length>0&&(l?E="["+d.join(" | ")+"]":E=d.join(`
`)),E},u.getTextAndFormat=function(){return this.rows},v}(),f=function(){function v(a,l,d){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=a,this.outputFilter=l,this.mode=null,this.verbose=0,this.displayedMemory=new t(d),this.nonDisplayedMemory=new t(d),this.lastOutputScreen=new t(d),this.currRollUpRow=this.displayedMemory.rows[F-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=d}var u=v.prototype;return u.reset=function(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[F-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null},u.getHandler=function(){return this.outputFilter},u.setHandler=function(l){this.outputFilter=l},u.setPAC=function(l){this.writeScreen.setPAC(l)},u.setBkgData=function(l){this.writeScreen.setBkgData(l)},u.setMode=function(l){l!==this.mode&&(this.mode=l,this.logger.log(x.INFO,"MODE="+l),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=l)},u.insertChars=function(l){for(var d=0;d<l.length;d++)this.writeScreen.insertChar(l[d]);var E=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(x.INFO,E+": "+this.writeScreen.getDisplayText(!0)),(this.mode==="MODE_PAINT-ON"||this.mode==="MODE_ROLL-UP")&&(this.logger.log(x.TEXT,"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())},u.ccRCL=function(){this.logger.log(x.INFO,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")},u.ccBS=function(){this.logger.log(x.INFO,"BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())},u.ccAOF=function(){},u.ccAON=function(){},u.ccDER=function(){this.logger.log(x.INFO,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()},u.ccRU=function(l){this.logger.log(x.INFO,"RU("+l+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(l)},u.ccFON=function(){this.logger.log(x.INFO,"FON - Flash On"),this.writeScreen.setPen({flash:!0})},u.ccRDC=function(){this.logger.log(x.INFO,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")},u.ccTR=function(){this.logger.log(x.INFO,"TR"),this.setMode("MODE_TEXT")},u.ccRTD=function(){this.logger.log(x.INFO,"RTD"),this.setMode("MODE_TEXT")},u.ccEDM=function(){this.logger.log(x.INFO,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)},u.ccCR=function(){this.logger.log(x.INFO,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)},u.ccENM=function(){this.logger.log(x.INFO,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()},u.ccEOC=function(){if(this.logger.log(x.INFO,"EOC - End Of Caption"),this.mode==="MODE_POP-ON"){var l=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=l,this.writeScreen=this.nonDisplayedMemory,this.logger.log(x.TEXT,"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)},u.ccTO=function(l){this.logger.log(x.INFO,"TO("+l+") - Tab Offset"),this.writeScreen.moveCursor(l)},u.ccMIDROW=function(l){var d={flash:!1};if(d.underline=l%2==1,d.italics=l>=46,d.italics)d.foreground="white";else{var E=Math.floor(l/2)-16,y=["white","green","blue","cyan","red","yellow","magenta"];d.foreground=y[E]}this.logger.log(x.INFO,"MIDROW: "+JSON.stringify(d)),this.writeScreen.setPen(d)},u.outputDataUpdate=function(l){l===void 0&&(l=!1);var d=this.logger.time;d!==null&&this.outputFilter&&(this.cueStartTime===null&&!this.displayedMemory.isEmpty()?this.cueStartTime=d:this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,d,this.lastOutputScreen),l&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:d),this.lastOutputScreen.copy(this.displayedMemory))},u.cueSplitAtTime=function(l){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,l,this.displayedMemory),this.cueStartTime=l))},v}(),s=function(){function v(a,l,d){this.channels=void 0,this.currentChannel=0,this.cmdHistory=void 0,this.logger=void 0;var E=new m;this.channels=[null,new f(a,l,E),new f(a+1,d,E)],this.cmdHistory=c(),this.logger=E}var u=v.prototype;return u.getHandler=function(l){return this.channels[l].getHandler()},u.setHandler=function(l,d){this.channels[l].setHandler(d)},u.addData=function(l,d){var E,y,I,C=!1;this.logger.time=l;for(var _=0;_<d.length;_+=2)if(y=d[_]&127,I=d[_+1]&127,!(y===0&&I===0)){if(this.logger.log(x.DATA,"["+h([d[_],d[_+1]])+"] -> ("+h([y,I])+")"),E=this.parseCmd(y,I),E||(E=this.parseMidrow(y,I)),E||(E=this.parsePAC(y,I)),E||(E=this.parseBackgroundAttributes(y,I)),!E&&(C=this.parseChars(y,I),C)){var B=this.currentChannel;if(B&&B>0){var U=this.channels[B];U.insertChars(C)}else this.logger.log(x.WARNING,"No channel found yet. TEXT-MODE?")}!E&&!C&&this.logger.log(x.WARNING,"Couldn't parse cleaned data "+h([y,I])+" orig: "+h([d[_],d[_+1]]))}},u.parseCmd=function(l,d){var E=this.cmdHistory,y=(l===20||l===28||l===21||l===29)&&d>=32&&d<=47,I=(l===23||l===31)&&d>=33&&d<=35;if(!(y||I))return!1;if(o(l,d,E))return n(null,null,E),this.logger.log(x.DEBUG,"Repeated command ("+h([l,d])+") is dropped"),!0;var C=l===20||l===21||l===23?1:2,_=this.channels[C];return l===20||l===21||l===28||l===29?d===32?_.ccRCL():d===33?_.ccBS():d===34?_.ccAOF():d===35?_.ccAON():d===36?_.ccDER():d===37?_.ccRU(2):d===38?_.ccRU(3):d===39?_.ccRU(4):d===40?_.ccFON():d===41?_.ccRDC():d===42?_.ccTR():d===43?_.ccRTD():d===44?_.ccEDM():d===45?_.ccCR():d===46?_.ccENM():d===47&&_.ccEOC():_.ccTO(d-32),n(l,d,E),this.currentChannel=C,!0},u.parseMidrow=function(l,d){var E=0;if((l===17||l===25)&&d>=32&&d<=47){if(l===17?E=1:E=2,E!==this.currentChannel)return this.logger.log(x.ERROR,"Mismatch channel in midrow parsing"),!1;var y=this.channels[E];return y?(y.ccMIDROW(d),this.logger.log(x.DEBUG,"MIDROW ("+h([l,d])+")"),!0):!1}return!1},u.parsePAC=function(l,d){var E,y=this.cmdHistory,I=(l>=17&&l<=23||l>=25&&l<=31)&&d>=64&&d<=127,C=(l===16||l===24)&&d>=64&&d<=95;if(!(I||C))return!1;if(o(l,d,y))return n(null,null,y),!0;var _=l<=23?1:2;d>=64&&d<=95?E=_===1?R[l]:g[l]:E=_===1?L[l]:S[l];var B=this.channels[_];return B?(B.setPAC(this.interpretPAC(E,d)),n(l,d,y),this.currentChannel=_,!0):!1},u.interpretPAC=function(l,d){var E,y={color:null,italics:!1,indent:null,underline:!1,row:l};return d>95?E=d-96:E=d-64,y.underline=(E&1)==1,E<=13?y.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(E/2)]:E<=15?(y.italics=!0,y.color="white"):y.indent=Math.floor((E-16)/2)*4,y},u.parseChars=function(l,d){var E,y=null,I=null;if(l>=25?(E=2,I=l-8):(E=1,I=l),I>=17&&I<=19){var C;I===17?C=d+80:I===18?C=d+112:C=d+144,this.logger.log(x.INFO,"Special char '"+A(C)+"' in channel "+E),y=[C]}else l>=32&&l<=127&&(y=d===0?[l]:[l,d]);if(y){var _=h(y);this.logger.log(x.DEBUG,"Char codes =  "+_.join(",")),n(l,d,this.cmdHistory)}return y},u.parseBackgroundAttributes=function(l,d){var E=(l===16||l===24)&&d>=32&&d<=47,y=(l===23||l===31)&&d>=45&&d<=47;if(!(E||y))return!1;var I,C={};l===16||l===24?(I=Math.floor((d-32)/2),C.background=T[I],d%2==1&&(C.background=C.background+"_semi")):d===45?C.background="transparent":(C.foreground="black",d===47&&(C.underline=!0));var _=l<=23?1:2,B=this.channels[_];return B.setBkgData(C),n(l,d,this.cmdHistory),!0},u.reset=function(){for(var l=0;l<Object.keys(this.channels).length;l++){var d=this.channels[l];d&&d.reset()}this.cmdHistory=c()},u.cueSplitAtTime=function(l){for(var d=0;d<this.channels.length;d++){var E=this.channels[d];E&&E.cueSplitAtTime(l)}},v}();function n(v,u,a){a.a=v,a.b=u}function o(v,u,a){return a.a===v&&a.b===u}function c(){return{a:null,b:null}}P.default=s},"./src/utils/codecs.ts":function(K,P,p){p.r(P),p.d(P,"isCodecType",function(){return O}),p.d(P,"isCodecSupportedInMp4",function(){return A});var M={audio:{a3ds:!0,"ac-3":!0,"ac-4":!0,alac:!0,alaw:!0,dra1:!0,"dts+":!0,"dts-":!0,dtsc:!0,dtse:!0,dtsh:!0,"ec-3":!0,enca:!0,g719:!0,g726:!0,m4ae:!0,mha1:!0,mha2:!0,mhm1:!0,mhm2:!0,mlpa:!0,mp4a:!0,"raw ":!0,Opus:!0,samr:!0,sawb:!0,sawp:!0,sevc:!0,sqcp:!0,ssmv:!0,twos:!0,ulaw:!0},video:{avc1:!0,avc2:!0,avc3:!0,avc4:!0,avcp:!0,av01:!0,drac:!0,dvav:!0,dvhe:!0,encv:!0,hev1:!0,hvc1:!0,mjp2:!0,mp4v:!0,mvc1:!0,mvc2:!0,mvc3:!0,mvc4:!0,resv:!0,rv60:!0,s263:!0,svc1:!0,svc2:!0,"vc-1":!0,vp08:!0,vp09:!0},text:{stpp:!0,wvtt:!0}};function O(F,D){var R=M[D];return!!R&&R[F.slice(0,4)]===!0}function A(F,D){return MediaSource.isTypeSupported((D||"video")+'/mp4;codecs="'+F+'"')}},"./src/utils/cues.ts":function(K,P,p){p.r(P);var M=p("./src/utils/vttparser.ts"),O=p("./src/utils/webvtt-parser.ts"),A=p("./src/utils/texttrack-utils.ts"),F=/\s/,D={newCue:function(L,g,S,T){for(var x=[],m,h,i,e,r,t=self.VTTCue||self.TextTrackCue,f=0;f<T.rows.length;f++)if(m=T.rows[f],i=!0,e=0,r="",!m.isEmpty()){for(var s=0;s<m.chars.length;s++)F.test(m.chars[s].uchar)&&i?e++:(r+=m.chars[s].uchar,i=!1);m.cueStartTime=g,g===S&&(S+=1e-4),e>=16?e--:e++;var n=Object(M.fixLineBreaks)(r.trim()),o=Object(O.generateCueId)(g,S,n);(!L||!L.cues||!L.cues.getCueById(o))&&(h=new t(g,S,n),h.id=o,h.line=f+1,h.align="left",h.position=10+Math.min(80,Math.floor(e*8/32)*10),x.push(h))}return L&&x.length&&(x.sort(function(c,v){return c.line==="auto"||v.line==="auto"?0:c.line>8&&v.line>8?v.line-c.line:c.line-v.line}),x.forEach(function(c){return Object(A.addCueToTrack)(L,c)})),x}};P.default=D},"./src/utils/discontinuities.ts":function(K,P,p){p.r(P),p.d(P,"findFirstFragWithCC",function(){return F}),p.d(P,"shouldAlignOnDiscontinuities",function(){return D}),p.d(P,"findDiscontinuousReferenceFrag",function(){return R}),p.d(P,"adjustSlidingStart",function(){return g}),p.d(P,"alignStream",function(){return S}),p.d(P,"alignPDT",function(){return x}),p.d(P,"alignFragmentByPDTDelta",function(){return m}),p.d(P,"alignMediaPlaylistByPDT",function(){return h});var M=p("./src/polyfills/number.ts"),O=p("./src/utils/logger.ts"),A=p("./src/controller/level-helper.ts");function F(i,e){for(var r=null,t=0,f=i.length;t<f;t++){var s=i[t];if(s&&s.cc===e){r=s;break}}return r}function D(i,e,r){return!!(e.details&&(r.endCC>r.startCC||i&&i.cc<r.startCC))}function R(i,e){var r=i.fragments,t=e.fragments;if(!t.length||!r.length){O.logger.log("No fragments to align");return}var f=F(r,t[0].cc);if(!f||f&&!f.startPTS){O.logger.log("No frag in previous level to align on");return}return f}function L(i,e){if(i){var r=i.start+e;i.start=i.startPTS=r,i.endPTS=r+i.duration}}function g(i,e){for(var r=e.fragments,t=0,f=r.length;t<f;t++)L(r[t],i);e.fragmentHint&&L(e.fragmentHint,i),e.alignedSliding=!0}function S(i,e,r){!e||(T(i,r,e),!r.alignedSliding&&e.details&&x(r,e.details),!r.alignedSliding&&e.details&&!r.skippedSegments&&Object(A.adjustSliding)(e.details,r))}function T(i,e,r){if(D(i,r,e)){var t=R(r.details,e);t&&Object(M.isFiniteNumber)(t.start)&&(O.logger.log("Adjusting PTS using last level due to CC increase within current level "+e.url),g(t.start,e))}}function x(i,e){if(!(!e.fragments.length||!i.hasProgramDateTime||!e.hasProgramDateTime)){var r=e.fragments[0].programDateTime,t=i.fragments[0].programDateTime,f=(t-r)/1e3+e.fragments[0].start;f&&Object(M.isFiniteNumber)(f)&&(O.logger.log("Adjusting PTS using programDateTime delta "+(t-r)+"ms, sliding:"+f.toFixed(3)+" "+i.url+" "),g(f,i))}}function m(i,e){var r=i.programDateTime;if(!!r){var t=(r-e)/1e3;i.start=i.startPTS=t,i.endPTS=t+i.duration}}function h(i,e){if(!(!e.fragments.length||!i.hasProgramDateTime||!e.hasProgramDateTime)){var r=e.fragments[0].programDateTime,t=e.fragments[0].start,f=r-t*1e3;i.fragments.forEach(function(s){m(s,f)}),i.fragmentHint&&m(i.fragmentHint,f),i.alignedSliding=!0}}},"./src/utils/ewma-bandwidth-estimator.ts":function(K,P,p){p.r(P);var M=p("./src/utils/ewma.ts"),O=function(){function A(D,R,L){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultEstimate_=L,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new M.default(D),this.fast_=new M.default(R)}var F=A.prototype;return F.update=function(R,L){var g=this.slow_,S=this.fast_;this.slow_.halfLife!==R&&(this.slow_=new M.default(R,g.getEstimate(),g.getTotalWeight())),this.fast_.halfLife!==L&&(this.fast_=new M.default(L,S.getEstimate(),S.getTotalWeight()))},F.sample=function(R,L){R=Math.max(R,this.minDelayMs_);var g=8*L,S=R/1e3,T=g/S;this.fast_.sample(S,T),this.slow_.sample(S,T)},F.canEstimate=function(){var R=this.fast_;return R&&R.getTotalWeight()>=this.minWeight_},F.getEstimate=function(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_},F.destroy=function(){},A}();P.default=O},"./src/utils/ewma.ts":function(K,P,p){p.r(P);var M=function(){function O(F,D,R){D===void 0&&(D=0),R===void 0&&(R=0),this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=F,this.alpha_=F?Math.exp(Math.log(.5)/F):0,this.estimate_=D,this.totalWeight_=R}var A=O.prototype;return A.sample=function(D,R){var L=Math.pow(this.alpha_,D);this.estimate_=R*(1-L)+L*this.estimate_,this.totalWeight_+=D},A.getTotalWeight=function(){return this.totalWeight_},A.getEstimate=function(){if(this.alpha_){var D=1-Math.pow(this.alpha_,this.totalWeight_);if(D)return this.estimate_/D}return this.estimate_},O}();P.default=M},"./src/utils/fetch-loader.ts":function(K,P,p){p.r(P),p.d(P,"fetchSupported",function(){return m});var M=p("./src/polyfills/number.ts"),O=p("./src/loader/load-stats.ts"),A=p("./src/demux/chunk-cache.ts");function F(t,f){t.prototype=Object.create(f.prototype),t.prototype.constructor=t,S(t,f)}function D(t){var f=typeof Map=="function"?new Map:void 0;return D=function(n){if(n===null||!g(n))return n;if(typeof n!="function")throw new TypeError("Super expression must either be null or a function");if(typeof f!="undefined"){if(f.has(n))return f.get(n);f.set(n,o)}function o(){return R(n,arguments,T(this).constructor)}return o.prototype=Object.create(n.prototype,{constructor:{value:o,enumerable:!1,writable:!0,configurable:!0}}),S(o,n)},D(t)}function R(t,f,s){return L()?R=Reflect.construct:R=function(o,c,v){var u=[null];u.push.apply(u,c);var a=Function.bind.apply(o,u),l=new a;return v&&S(l,v.prototype),l},R.apply(null,arguments)}function L(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function g(t){return Function.toString.call(t).indexOf("[native code]")!==-1}function S(t,f){return S=Object.setPrototypeOf||function(n,o){return n.__proto__=o,n},S(t,f)}function T(t){return T=Object.setPrototypeOf?Object.getPrototypeOf:function(s){return s.__proto__||Object.getPrototypeOf(s)},T(t)}function x(){return x=Object.assign||function(t){for(var f=1;f<arguments.length;f++){var s=arguments[f];for(var n in s)Object.prototype.hasOwnProperty.call(s,n)&&(t[n]=s[n])}return t},x.apply(this,arguments)}function m(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch{}return!1}var h=function(){function t(s){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=void 0,this.response=void 0,this.controller=void 0,this.context=void 0,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=s.fetchSetup||e,this.controller=new self.AbortController,this.stats=new O.LoadStats}var f=t.prototype;return f.destroy=function(){this.loader=this.callbacks=null,this.abortInternal()},f.abortInternal=function(){var n=this.response;(!n||!n.ok)&&(this.stats.aborted=!0,this.controller.abort())},f.abort=function(){var n;this.abortInternal(),(n=this.callbacks)!==null&&n!==void 0&&n.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)},f.load=function(n,o,c){var v=this,u=this.stats;if(u.loading.start)throw new Error("Loader can only be used once.");u.loading.start=self.performance.now();var a=i(n,this.controller.signal),l=c.onProgress,d=n.responseType==="arraybuffer",E=d?"byteLength":"length";this.context=n,this.config=o,this.callbacks=c,this.request=this.fetchSetup(n,a),self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(function(){v.abortInternal(),c.onTimeout(u,n,v.response)},o.timeout),self.fetch(this.request).then(function(y){if(v.response=v.loader=y,!y.ok){var I=y.status,C=y.statusText;throw new r(C||"fetch, bad network response",I,y)}return u.loading.first=Math.max(self.performance.now(),u.loading.start),u.total=parseInt(y.headers.get("Content-Length")||"0"),l&&Object(M.isFiniteNumber)(o.highWaterMark)?v.loadProgressively(y,u,n,o.highWaterMark,l):d?y.arrayBuffer():y.text()}).then(function(y){var I=v.response;self.clearTimeout(v.requestTimeout),u.loading.end=Math.max(self.performance.now(),u.loading.first),u.loaded=u.total=y[E];var C={url:I.url,data:y};l&&!Object(M.isFiniteNumber)(o.highWaterMark)&&l(u,n,y,I),c.onSuccess(C,u,n,I)}).catch(function(y){if(self.clearTimeout(v.requestTimeout),!u.aborted){var I=y.code||0;c.onError({code:I,text:y.message},n,y.details)}})},f.getCacheAge=function(){var n=null;if(this.response){var o=this.response.headers.get("age");n=o?parseFloat(o):null}return n},f.loadProgressively=function(n,o,c,v,u){v===void 0&&(v=0);var a=new A.default,l=n.body.getReader(),d=function E(){return l.read().then(function(y){if(y.done)return a.dataLength&&u(o,c,a.flush(),n),Promise.resolve(new ArrayBuffer(0));var I=y.value,C=I.length;return o.loaded+=C,C<v||a.dataLength?(a.push(I),a.dataLength>=v&&u(o,c,a.flush(),n)):u(o,c,I,n),E()}).catch(function(){return Promise.reject()})};return d()},t}();function i(t,f){var s={method:"GET",mode:"cors",credentials:"same-origin",signal:f,headers:new self.Headers(x({},t.headers))};return t.rangeEnd&&s.headers.set("Range","bytes="+t.rangeStart+"-"+String(t.rangeEnd-1)),s}function e(t,f){return new self.Request(t.url,f)}var r=function(t){F(f,t);function f(s,n,o){var c;return c=t.call(this,s)||this,c.code=void 0,c.details=void 0,c.code=n,c.details=o,c}return f}(D(Error));P.default=h},"./src/utils/imsc1-ttml-parser.ts":function(K,P,p){p.r(P),p.d(P,"IMSC1_CODEC",function(){return g}),p.d(P,"parseIMSC1",function(){return m});var M=p("./src/utils/mp4-tools.ts"),O=p("./src/utils/vttparser.ts"),A=p("./src/utils/vttcue.ts"),F=p("./src/demux/id3.ts"),D=p("./src/utils/timescale-conversion.ts"),R=p("./src/utils/webvtt-parser.ts");function L(){return L=Object.assign||function(v){for(var u=1;u<arguments.length;u++){var a=arguments[u];for(var l in a)Object.prototype.hasOwnProperty.call(a,l)&&(v[l]=a[l])}return v},L.apply(this,arguments)}var g="stpp.ttml.im1t",S=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,T=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,x={left:"start",center:"center",right:"end",start:"start",end:"end"};function m(v,u,a,l,d){var E=Object(M.findBox)(new Uint8Array(v),["mdat"]);if(E.length===0){d(new Error("Could not parse IMSC1 mdat"));return}var y=E[0],I=Object(F.utf8ArrayToStr)(new Uint8Array(v,y.start,y.end-y.start)),C=Object(D.toTimescaleFromScale)(u,1,a);try{l(h(I,C))}catch(_){d(_)}}function h(v,u){var a=new DOMParser,l=a.parseFromString(v,"text/xml"),d=l.getElementsByTagName("tt")[0];if(!d)throw new Error("Invalid ttml");var E={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},y=Object.keys(E).reduce(function(U,N){return U[N]=d.getAttribute("ttp:"+N)||E[N],U},{}),I=d.getAttribute("xml:space")!=="preserve",C=e(i(d,"styling","style")),_=e(i(d,"layout","region")),B=i(d,"body","[begin]");return[].map.call(B,function(U){var N=r(U,I);if(!N||!U.hasAttribute("begin"))return null;var k=n(U.getAttribute("begin"),y),w=n(U.getAttribute("dur"),y),G=n(U.getAttribute("end"),y);if(k===null)throw s(U);if(G===null){if(w===null)throw s(U);G=k+w}var W=new A.default(k-u,G-u,N);W.id=Object(R.generateCueId)(W.startTime,W.endTime,W.text);var Y=_[U.getAttribute("region")],H=C[U.getAttribute("style")];W.position=10,W.size=80;var z=t(Y,H),Q=z.textAlign;if(Q){var $=x[Q];$&&(W.lineAlign=$),W.align=Q}return L(W,z),W}).filter(function(U){return U!==null})}function i(v,u,a){var l=v.getElementsByTagName(u)[0];return l?[].slice.call(l.querySelectorAll(a)):[]}function e(v){return v.reduce(function(u,a){var l=a.getAttribute("xml:id");return l&&(u[l]=a),u},{})}function r(v,u){return[].slice.call(v.childNodes).reduce(function(a,l,d){var E;return l.nodeName==="br"&&d?a+`
`:(E=l.childNodes)!==null&&E!==void 0&&E.length?r(l,u):u?a+l.textContent.trim().replace(/\s+/g," "):a+l.textContent},"")}function t(v,u){var a="http://www.w3.org/ns/ttml#styling",l=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"];return l.reduce(function(d,E){var y=f(u,a,E)||f(v,a,E);return y&&(d[E]=y),d},{})}function f(v,u,a){return v.hasAttributeNS(u,a)?v.getAttributeNS(u,a):null}function s(v){return new Error("Could not parse ttml timestamp "+v)}function n(v,u){if(!v)return null;var a=Object(O.parseTimeStamp)(v);return a===null&&(S.test(v)?a=o(v,u):T.test(v)&&(a=c(v,u))),a}function o(v,u){var a=S.exec(v),l=(a[4]|0)+(a[5]|0)/u.subFrameRate;return(a[1]|0)*3600+(a[2]|0)*60+(a[3]|0)+l/u.frameRate}function c(v,u){var a=T.exec(v),l=Number(a[1]),d=a[2];switch(d){case"h":return l*3600;case"m":return l*60;case"ms":return l*1e3;case"f":return l/u.frameRate;case"t":return l/u.tickRate}return l}},"./src/utils/logger.ts":function(K,P,p){p.r(P),p.d(P,"enableLogs",function(){return R}),p.d(P,"logger",function(){return L});var M=function(){},O={trace:M,debug:M,log:M,warn:M,info:M,error:M},A=O;function F(g){var S=self.console[g];return S?S.bind(self.console,"["+g+"] >"):M}function D(g){for(var S=arguments.length,T=new Array(S>1?S-1:0),x=1;x<S;x++)T[x-1]=arguments[x];T.forEach(function(m){A[m]=g[m]?g[m].bind(g):F(m)})}function R(g){if(self.console&&g===!0||typeof g=="object"){D(g,"debug","log","info","warn","error");try{A.log()}catch{A=O}}else A=O}var L=A},"./src/utils/mediakeys-helper.ts":function(K,P,p){p.r(P),p.d(P,"KeySystems",function(){return M}),p.d(P,"requestMediaKeySystemAccess",function(){return O});var M;(function(A){A.WIDEVINE="com.widevine.alpha",A.PLAYREADY="com.microsoft.playready"})(M||(M={}));var O=function(){return typeof self!="undefined"&&self.navigator&&self.navigator.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null}()},"./src/utils/mediasource-helper.ts":function(K,P,p){p.r(P),p.d(P,"getMediaSource",function(){return M});function M(){return self.MediaSource||self.WebKitMediaSource}},"./src/utils/mp4-tools.ts":function(K,P,p){p.r(P),p.d(P,"bin2str",function(){return D}),p.d(P,"readUint16",function(){return R}),p.d(P,"readUint32",function(){return L}),p.d(P,"writeUint32",function(){return g}),p.d(P,"findBox",function(){return S}),p.d(P,"parseSegmentIndex",function(){return T}),p.d(P,"parseInitSegment",function(){return x}),p.d(P,"getStartDTS",function(){return m}),p.d(P,"getDuration",function(){return h}),p.d(P,"computeRawDurationFromSamples",function(){return i}),p.d(P,"offsetStartDTS",function(){return e}),p.d(P,"segmentValidRange",function(){return r}),p.d(P,"appendUint8Array",function(){return t});var M=p("./src/utils/typed-array.ts"),O=p("./src/loader/fragment.ts"),A=Math.pow(2,32)-1,F=[].push;function D(f){return String.fromCharCode.apply(null,f)}function R(f,s){"data"in f&&(s+=f.start,f=f.data);var n=f[s]<<8|f[s+1];return n<0?65536+n:n}function L(f,s){"data"in f&&(s+=f.start,f=f.data);var n=f[s]<<24|f[s+1]<<16|f[s+2]<<8|f[s+3];return n<0?4294967296+n:n}function g(f,s,n){"data"in f&&(s+=f.start,f=f.data),f[s]=n>>24,f[s+1]=n>>16&255,f[s+2]=n>>8&255,f[s+3]=n&255}function S(f,s){var n=[];if(!s.length)return n;var o,c,v;"data"in f?(o=f.data,c=f.start,v=f.end):(o=f,c=0,v=o.byteLength);for(var u=c;u<v;){var a=L(o,u),l=D(o.subarray(u+4,u+8)),d=a>1?u+a:v;if(l===s[0])if(s.length===1)n.push({data:o,start:u+8,end:d});else{var E=S({data:o,start:u+8,end:d},s.slice(1));E.length&&F.apply(n,E)}u=d}return n}function T(f){var s=S(f,["moov"]),n=s[0],o=n?n.end:null,c=S(f,["sidx"]);if(!c||!c[0])return null;var v=[],u=c[0],a=u.data[0],l=a===0?8:16,d=L(u,l);l+=4;var E=0,y=0;a===0?l+=8:l+=16,l+=2;var I=u.end+y,C=R(u,l);l+=2;for(var _=0;_<C;_++){var B=l,U=L(u,B);B+=4;var N=U&2147483647,k=(U&2147483648)>>>31;if(k===1)return console.warn("SIDX has hierarchical references (not supported)"),null;var w=L(u,B);B+=4,v.push({referenceSize:N,subsegmentDuration:w,info:{duration:w/d,start:I,end:I+N-1}}),I+=N,B+=4,l=B}return{earliestPresentationTime:E,timescale:d,version:a,referencesCount:C,references:v,moovEndOffset:o}}function x(f){for(var s=[],n=S(f,["moov","trak"]),o=0;o<n.length;o++){var c=n[o],v=S(c,["tkhd"])[0];if(v){var u=v.data[v.start],a=u===0?12:20,l=L(v,a),d=S(c,["mdia","mdhd"])[0];if(d){u=d.data[d.start],a=u===0?12:20;var E=L(d,a),y=S(c,["mdia","hdlr"])[0];if(y){var I=D(y.data.subarray(y.start+8,y.start+12)),C={soun:O.ElementaryStreamTypes.AUDIO,vide:O.ElementaryStreamTypes.VIDEO}[I];if(C){var _=S(c,["mdia","minf","stbl","stsd"])[0],B=void 0;_&&(B=D(_.data.subarray(_.start+12,_.start+16))),s[l]={timescale:E,type:C},s[C]={timescale:E,id:l,codec:B}}}}}}var U=S(f,["moov","mvex","trex"]);return U.forEach(function(N){var k=L(N,4),w=s[k];w&&(w.default={duration:L(N,12),flags:L(N,20)})}),s}function m(f,s){return S(s,["moof","traf"]).reduce(function(n,o){var c=S(o,["tfdt"])[0],v=c.data[c.start],u=S(o,["tfhd"]).reduce(function(a,l){var d=L(l,4),E=f[d];if(E){var y=L(c,4);v===1&&(y*=Math.pow(2,32),y+=L(c,8));var I=E.timescale||9e4,C=y/I;if(isFinite(C)&&(a===null||C<a))return C}return a},null);return u!==null&&isFinite(u)&&(n===null||u<n)?u:n},null)||0}function h(f,s){for(var n=0,o=0,c=0,v=S(f,["moof","traf"]),u=0;u<v.length;u++){var a=v[u],l=S(a,["tfhd"])[0],d=L(l,4),E=s[d];if(!!E){var y=E.default,I=L(l,0)|(y==null?void 0:y.flags),C=y==null?void 0:y.duration;I&8&&(I&2?C=L(l,12):C=L(l,8));for(var _=E.timescale||9e4,B=S(a,["trun"]),U=0;U<B.length;U++){if(C){var N=L(B[U],4);n=C*N}else n=i(B[U]);E.type===O.ElementaryStreamTypes.VIDEO?o+=n/_:E.type===O.ElementaryStreamTypes.AUDIO&&(c+=n/_)}}}if(o===0&&c===0){var k=T(f);if(k!=null&&k.references)return k.references.reduce(function(w,G){return w+G.info.duration||0},0)}return o||c}function i(f){var s=L(f,0),n=8;s&1&&(n+=4),s&4&&(n+=4);for(var o=0,c=L(f,4),v=0;v<c;v++){if(s&256){var u=L(f,n);o+=u,n+=4}s&512&&(n+=4),s&1024&&(n+=4),s&2048&&(n+=4)}return o}function e(f,s,n){S(s,["moof","traf"]).forEach(function(o){S(o,["tfhd"]).forEach(function(c){var v=L(c,4),u=f[v];if(!!u){var a=u.timescale||9e4;S(o,["tfdt"]).forEach(function(l){var d=l.data[l.start],E=L(l,4);if(d===0)g(l,4,E-n*a);else{E*=Math.pow(2,32),E+=L(l,8),E-=n*a,E=Math.max(E,0);var y=Math.floor(E/(A+1)),I=Math.floor(E%(A+1));g(l,4,y),g(l,8,I)}})}})})}function r(f){var s={valid:null,remainder:null},n=S(f,["moof"]);if(n){if(n.length<2)return s.remainder=f,s}else return s;var o=n[n.length-1];return s.valid=Object(M.sliceUint8)(f,0,o.start-8),s.remainder=Object(M.sliceUint8)(f,o.start-8),s}function t(f,s){var n=new Uint8Array(f.length+s.length);return n.set(f),n.set(s,f.length),n}},"./src/utils/output-filter.ts":function(K,P,p){p.r(P),p.d(P,"default",function(){return M});var M=function(){function O(F,D){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=F,this.trackName=D}var A=O.prototype;return A.dispatchCue=function(){this.startTime!==null&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)},A.newCue=function(D,R,L){(this.startTime===null||this.startTime>D)&&(this.startTime=D),this.endTime=R,this.screen=L,this.timelineController.createCaptionsTrack(this.trackName)},A.reset=function(){this.cueRanges=[]},O}()},"./src/utils/texttrack-utils.ts":function(K,P,p){p.r(P),p.d(P,"sendAddTrackEvent",function(){return O}),p.d(P,"addCueToTrack",function(){return A}),p.d(P,"clearCurrentCues",function(){return F}),p.d(P,"removeCuesInRange",function(){return D}),p.d(P,"getCuesInRange",function(){return L});var M=p("./src/utils/logger.ts");function O(g,S){var T;try{T=new Event("addtrack")}catch{T=document.createEvent("Event"),T.initEvent("addtrack",!1,!1)}T.track=g,S.dispatchEvent(T)}function A(g,S){var T=g.mode;if(T==="disabled"&&(g.mode="hidden"),g.cues&&!g.cues.getCueById(S.id))try{if(g.addCue(S),!g.cues.getCueById(S.id))throw new Error("addCue is failed for: "+S)}catch(m){M.logger.debug("[texttrack-utils]: "+m);var x=new self.TextTrackCue(S.startTime,S.endTime,S.text);x.id=S.id,g.addCue(x)}T==="disabled"&&(g.mode=T)}function F(g){var S=g.mode;if(S==="disabled"&&(g.mode="hidden"),g.cues)for(var T=g.cues.length;T--;)g.removeCue(g.cues[T]);S==="disabled"&&(g.mode=S)}function D(g,S,T){var x=g.mode;if(x==="disabled"&&(g.mode="hidden"),g.cues&&g.cues.length>0)for(var m=L(g.cues,S,T),h=0;h<m.length;h++)g.removeCue(m[h]);x==="disabled"&&(g.mode=x)}function R(g,S){if(S<g[0].startTime)return 0;var T=g.length-1;if(S>g[T].endTime)return-1;for(var x=0,m=T;x<=m;){var h=Math.floor((m+x)/2);if(S<g[h].startTime)m=h-1;else if(S>g[h].startTime&&x<T)x=h+1;else return h}return g[x].startTime-S<S-g[m].startTime?x:m}function L(g,S,T){var x=[],m=R(g,S);if(m>-1)for(var h=m,i=g.length;h<i;h++){var e=g[h];if(e.startTime>=S&&e.endTime<=T)x.push(e);else if(e.startTime>T)return x}return x}},"./src/utils/time-ranges.ts":function(K,P,p){p.r(P);var M={toString:function(A){for(var F="",D=A.length,R=0;R<D;R++)F+="["+A.start(R).toFixed(3)+","+A.end(R).toFixed(3)+"]";return F}};P.default=M},"./src/utils/timescale-conversion.ts":function(K,P,p){p.r(P),p.d(P,"toTimescaleFromBase",function(){return O}),p.d(P,"toTimescaleFromScale",function(){return A}),p.d(P,"toMsFromMpegTsClock",function(){return F}),p.d(P,"toMpegTsClockFromTimescale",function(){return D});var M=9e4;function O(R,L,g,S){g===void 0&&(g=1),S===void 0&&(S=!1);var T=R*L*g;return S?Math.round(T):T}function A(R,L,g,S){return g===void 0&&(g=1),S===void 0&&(S=!1),O(R,L,1/g,S)}function F(R,L){return L===void 0&&(L=!1),O(R,1e3,1/M,L)}function D(R,L){return L===void 0&&(L=1),O(R,M,1/L)}},"./src/utils/typed-array.ts":function(K,P,p){p.r(P),p.d(P,"sliceUint8",function(){return M});function M(O,A,F){return Uint8Array.prototype.slice?O.slice(A,F):new Uint8Array(Array.prototype.slice.call(O,A,F))}},"./src/utils/vttcue.ts":function(K,P,p){p.r(P),P.default=function(){if(typeof self!="undefined"&&self.VTTCue)return self.VTTCue;var M=["","lr","rl"],O=["start","middle","end","left","right"];function A(g,S){if(typeof S!="string"||!Array.isArray(g))return!1;var T=S.toLowerCase();return~g.indexOf(T)?T:!1}function F(g){return A(M,g)}function D(g){return A(O,g)}function R(g){for(var S=arguments.length,T=new Array(S>1?S-1:0),x=1;x<S;x++)T[x-1]=arguments[x];for(var m=1;m<arguments.length;m++){var h=arguments[m];for(var i in h)g[i]=h[i]}return g}function L(g,S,T){var x=this,m={enumerable:!0};x.hasBeenReset=!1;var h="",i=!1,e=g,r=S,t=T,f=null,s="",n=!0,o="auto",c="start",v=50,u="middle",a=50,l="middle";Object.defineProperty(x,"id",R({},m,{get:function(){return h},set:function(E){h=""+E}})),Object.defineProperty(x,"pauseOnExit",R({},m,{get:function(){return i},set:function(E){i=!!E}})),Object.defineProperty(x,"startTime",R({},m,{get:function(){return e},set:function(E){if(typeof E!="number")throw new TypeError("Start time must be set to a number.");e=E,this.hasBeenReset=!0}})),Object.defineProperty(x,"endTime",R({},m,{get:function(){return r},set:function(E){if(typeof E!="number")throw new TypeError("End time must be set to a number.");r=E,this.hasBeenReset=!0}})),Object.defineProperty(x,"text",R({},m,{get:function(){return t},set:function(E){t=""+E,this.hasBeenReset=!0}})),Object.defineProperty(x,"region",R({},m,{get:function(){return f},set:function(E){f=E,this.hasBeenReset=!0}})),Object.defineProperty(x,"vertical",R({},m,{get:function(){return s},set:function(E){var y=F(E);if(y===!1)throw new SyntaxError("An invalid or illegal string was specified.");s=y,this.hasBeenReset=!0}})),Object.defineProperty(x,"snapToLines",R({},m,{get:function(){return n},set:function(E){n=!!E,this.hasBeenReset=!0}})),Object.defineProperty(x,"line",R({},m,{get:function(){return o},set:function(E){if(typeof E!="number"&&E!=="auto")throw new SyntaxError("An invalid number or illegal string was specified.");o=E,this.hasBeenReset=!0}})),Object.defineProperty(x,"lineAlign",R({},m,{get:function(){return c},set:function(E){var y=D(E);if(!y)throw new SyntaxError("An invalid or illegal string was specified.");c=y,this.hasBeenReset=!0}})),Object.defineProperty(x,"position",R({},m,{get:function(){return v},set:function(E){if(E<0||E>100)throw new Error("Position must be between 0 and 100.");v=E,this.hasBeenReset=!0}})),Object.defineProperty(x,"positionAlign",R({},m,{get:function(){return u},set:function(E){var y=D(E);if(!y)throw new SyntaxError("An invalid or illegal string was specified.");u=y,this.hasBeenReset=!0}})),Object.defineProperty(x,"size",R({},m,{get:function(){return a},set:function(E){if(E<0||E>100)throw new Error("Size must be between 0 and 100.");a=E,this.hasBeenReset=!0}})),Object.defineProperty(x,"align",R({},m,{get:function(){return l},set:function(E){var y=D(E);if(!y)throw new SyntaxError("An invalid or illegal string was specified.");l=y,this.hasBeenReset=!0}})),x.displayState=void 0}return L.prototype.getCueAsHTML=function(){var g=self.WebVTT;return g.convertCueToDOMTree(self,this.text)},L}()},"./src/utils/vttparser.ts":function(K,P,p){p.r(P),p.d(P,"parseTimeStamp",function(){return A}),p.d(P,"fixLineBreaks",function(){return S}),p.d(P,"VTTParser",function(){return T});var M=p("./src/utils/vttcue.ts"),O=function(){function x(){}var m=x.prototype;return m.decode=function(i,e){if(!i)return"";if(typeof i!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(i))},x}();function A(x){function m(i,e,r,t){return(i|0)*3600+(e|0)*60+(r|0)+parseFloat(t||0)}var h=x.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return h?parseFloat(h[2])>59?m(h[2],h[3],0,h[4]):m(h[1],h[2],h[3],h[4]):null}var F=function(){function x(){this.values=Object.create(null)}var m=x.prototype;return m.set=function(i,e){!this.get(i)&&e!==""&&(this.values[i]=e)},m.get=function(i,e,r){return r?this.has(i)?this.values[i]:e[r]:this.has(i)?this.values[i]:e},m.has=function(i){return i in this.values},m.alt=function(i,e,r){for(var t=0;t<r.length;++t)if(e===r[t]){this.set(i,e);break}},m.integer=function(i,e){/^-?\d+$/.test(e)&&this.set(i,parseInt(e,10))},m.percent=function(i,e){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(e)){var r=parseFloat(e);if(r>=0&&r<=100)return this.set(i,r),!0}return!1},x}();function D(x,m,h,i){var e=i?x.split(i):[x];for(var r in e)if(typeof e[r]=="string"){var t=e[r].split(h);if(t.length===2){var f=t[0],s=t[1];m(f,s)}}}var R=new M.default(0,0,""),L=R.align==="middle"?"middle":"center";function g(x,m,h){var i=x;function e(){var f=A(x);if(f===null)throw new Error("Malformed timestamp: "+i);return x=x.replace(/^[^\sa-zA-Z-]+/,""),f}function r(f,s){var n=new F;D(f,function(v,u){var a;switch(v){case"region":for(var l=h.length-1;l>=0;l--)if(h[l].id===u){n.set(v,h[l].region);break}break;case"vertical":n.alt(v,u,["rl","lr"]);break;case"line":a=u.split(","),n.integer(v,a[0]),n.percent(v,a[0])&&n.set("snapToLines",!1),n.alt(v,a[0],["auto"]),a.length===2&&n.alt("lineAlign",a[1],["start",L,"end"]);break;case"position":a=u.split(","),n.percent(v,a[0]),a.length===2&&n.alt("positionAlign",a[1],["start",L,"end","line-left","line-right","auto"]);break;case"size":n.percent(v,u);break;case"align":n.alt(v,u,["start",L,"end","left","right"]);break}},/:/,/\s/),s.region=n.get("region",null),s.vertical=n.get("vertical","");var o=n.get("line","auto");o==="auto"&&R.line===-1&&(o=-1),s.line=o,s.lineAlign=n.get("lineAlign","start"),s.snapToLines=n.get("snapToLines",!0),s.size=n.get("size",100),s.align=n.get("align",L);var c=n.get("position","auto");c==="auto"&&R.position===50&&(c=s.align==="start"||s.align==="left"?0:s.align==="end"||s.align==="right"?100:50),s.position=c}function t(){x=x.replace(/^\s+/,"")}if(t(),m.startTime=e(),t(),x.substr(0,3)!=="-->")throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+i);x=x.substr(3),t(),m.endTime=e(),t(),r(x,m)}function S(x){return x.replace(/<br(?: \/)?>/gi,`
`)}var T=function(){function x(){this.state="INITIAL",this.buffer="",this.decoder=new O,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}var m=x.prototype;return m.parse=function(i){var e=this;i&&(e.buffer+=e.decoder.decode(i,{stream:!0}));function r(){var c=e.buffer,v=0;for(c=S(c);v<c.length&&c[v]!=="\r"&&c[v]!==`
`;)++v;var u=c.substr(0,v);return c[v]==="\r"&&++v,c[v]===`
`&&++v,e.buffer=c.substr(v),u}function t(c){D(c,function(v,u){},/:/)}try{var f="";if(e.state==="INITIAL"){if(!/\r\n|\n/.test(e.buffer))return this;f=r();var s=f.match(/^()?WEBVTT([ \t].*)?$/);if(!s||!s[0])throw new Error("Malformed WebVTT signature.");e.state="HEADER"}for(var n=!1;e.buffer;){if(!/\r\n|\n/.test(e.buffer))return this;switch(n?n=!1:f=r(),e.state){case"HEADER":/:/.test(f)?t(f):f||(e.state="ID");continue;case"NOTE":f||(e.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(f)){e.state="NOTE";break}if(!f)continue;if(e.cue=new M.default(0,0,""),e.state="CUE",f.indexOf("-->")===-1){e.cue.id=f;continue}case"CUE":if(!e.cue){e.state="BADCUE";continue}try{g(f,e.cue,e.regionList)}catch{e.cue=null,e.state="BADCUE";continue}e.state="CUETEXT";continue;case"CUETEXT":{var o=f.indexOf("-->")!==-1;if(!f||o&&(n=!0)){e.oncue&&e.cue&&e.oncue(e.cue),e.cue=null,e.state="ID";continue}if(e.cue===null)continue;e.cue.text&&(e.cue.text+=`
`),e.cue.text+=f}continue;case"BADCUE":f||(e.state="ID")}}}catch{e.state==="CUETEXT"&&e.cue&&e.oncue&&e.oncue(e.cue),e.cue=null,e.state=e.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this},m.flush=function(){var i=this;try{if((i.cue||i.state==="HEADER")&&(i.buffer+=`

`,i.parse()),i.state==="INITIAL"||i.state==="BADWEBVTT")throw new Error("Malformed WebVTT signature.")}catch(e){i.onparsingerror&&i.onparsingerror(e)}return i.onflush&&i.onflush(),this},x}()},"./src/utils/webvtt-parser.ts":function(K,P,p){p.r(P),p.d(P,"generateCueId",function(){return T}),p.d(P,"parseWebVTT",function(){return m});var M=p("./src/polyfills/number.ts"),O=p("./src/utils/vttparser.ts"),A=p("./src/demux/id3.ts"),F=p("./src/utils/timescale-conversion.ts"),D=p("./src/remux/mp4-remuxer.ts"),R=/\r\n|\n\r|\n|\r/g,L=function(i,e,r){return r===void 0&&(r=0),i.substr(r,e.length)===e},g=function(i){var e=parseInt(i.substr(-3)),r=parseInt(i.substr(-6,2)),t=parseInt(i.substr(-9,2)),f=i.length>9?parseInt(i.substr(0,i.indexOf(":"))):0;if(!Object(M.isFiniteNumber)(e)||!Object(M.isFiniteNumber)(r)||!Object(M.isFiniteNumber)(t)||!Object(M.isFiniteNumber)(f))throw Error("Malformed X-TIMESTAMP-MAP: Local:"+i);return e+=1e3*r,e+=60*1e3*t,e+=60*60*1e3*f,e},S=function(i){for(var e=5381,r=i.length;r;)e=e*33^i.charCodeAt(--r);return(e>>>0).toString()};function T(h,i,e){return S(h.toString())+S(i.toString())+S(e)}var x=function(i,e,r){var t=i[e],f=i[t.prevCC];if(!f||!f.new&&t.new){i.ccOffset=i.presentationOffset=t.start,t.new=!1;return}for(;(s=f)!==null&&s!==void 0&&s.new;){var s;i.ccOffset+=t.start-f.start,t.new=!1,t=f,f=i[t.prevCC]}i.presentationOffset=r};function m(h,i,e,r,t,f,s,n){var o=new O.VTTParser,c=Object(A.utf8ArrayToStr)(new Uint8Array(h)).trim().replace(R,`
`).split(`
`),v=[],u=Object(F.toMpegTsClockFromTimescale)(i,e),a="00:00.000",l=0,d=0,E,y=!0,I=!1;o.oncue=function(C){var _=r[t],B=r.ccOffset,U=(l-u)/9e4;if(_!=null&&_.new&&(d!==void 0?B=r.ccOffset=_.start:x(r,t,U)),U&&(B=U-r.presentationOffset),I){var N=C.endTime-C.startTime,k=Object(D.normalizePts)((C.startTime+B-d)*9e4,f*9e4)/9e4;C.startTime=k,C.endTime=k+N}var w=C.text.trim();C.text=decodeURIComponent(encodeURIComponent(w)),C.id||(C.id=T(C.startTime,C.endTime,w)),C.endTime>0&&v.push(C)},o.onparsingerror=function(C){E=C},o.onflush=function(){if(E){n(E);return}s(v)},c.forEach(function(C){if(y)if(L(C,"X-TIMESTAMP-MAP=")){y=!1,I=!0,C.substr(16).split(",").forEach(function(_){L(_,"LOCAL:")?a=_.substr(6):L(_,"MPEGTS:")&&(l=parseInt(_.substr(7)))});try{d=g(a)/1e3}catch(_){I=!1,E=_}return}else C===""&&(y=!1);o.parse(C+`
`)}),o.flush()}},"./src/utils/xhr-loader.ts":function(K,P,p){p.r(P);var M=p("./src/utils/logger.ts"),O=p("./src/loader/load-stats.ts"),A=/^age:\s*[\d.]+\s*$/m,F=function(){function D(L){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=void 0,this.loader=null,this.stats=void 0,this.xhrSetup=L?L.xhrSetup:null,this.stats=new O.LoadStats,this.retryDelay=0}var R=D.prototype;return R.destroy=function(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null},R.abortInternal=function(){var g=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),g&&(g.onreadystatechange=null,g.onprogress=null,g.readyState!==4&&(this.stats.aborted=!0,g.abort()))},R.abort=function(){var g;this.abortInternal(),(g=this.callbacks)!==null&&g!==void 0&&g.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)},R.load=function(g,S,T){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=g,this.config=S,this.callbacks=T,this.retryDelay=S.retryDelay,this.loadInternal()},R.loadInternal=function(){var g=this.config,S=this.context;if(!!g){var T=this.loader=new self.XMLHttpRequest,x=this.stats;x.loading.first=0,x.loaded=0;var m=this.xhrSetup;try{if(m)try{m(T,S.url)}catch{T.open("GET",S.url,!0),m(T,S.url)}T.readyState||T.open("GET",S.url,!0);var h=this.context.headers;if(h)for(var i in h)T.setRequestHeader(i,h[i])}catch(e){this.callbacks.onError({code:T.status,text:e.message},S,T);return}S.rangeEnd&&T.setRequestHeader("Range","bytes="+S.rangeStart+"-"+(S.rangeEnd-1)),T.onreadystatechange=this.readystatechange.bind(this),T.onprogress=this.loadprogress.bind(this),T.responseType=S.responseType,self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),g.timeout),T.send()}},R.readystatechange=function(){var g=this.context,S=this.loader,T=this.stats;if(!(!g||!S)){var x=S.readyState,m=this.config;if(!T.aborted&&x>=2)if(self.clearTimeout(this.requestTimeout),T.loading.first===0&&(T.loading.first=Math.max(self.performance.now(),T.loading.start)),x===4){S.onreadystatechange=null,S.onprogress=null;var h=S.status;if(h>=200&&h<300){T.loading.end=Math.max(self.performance.now(),T.loading.first);var i,e;if(g.responseType==="arraybuffer"?(i=S.response,e=i.byteLength):(i=S.responseText,e=i.length),T.loaded=T.total=e,!this.callbacks)return;var r=this.callbacks.onProgress;if(r&&r(T,g,i,S),!this.callbacks)return;var t={url:S.responseURL,data:i};this.callbacks.onSuccess(t,T,g,S)}else T.retry>=m.maxRetry||h>=400&&h<499?(M.logger.error(h+" while loading "+g.url),this.callbacks.onError({code:h,text:S.statusText},g,S)):(M.logger.warn(h+" while loading "+g.url+", retrying in "+this.retryDelay+"..."),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,m.maxRetryDelay),T.retry++)}else self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),m.timeout)}},R.loadtimeout=function(){M.logger.warn("timeout while loading "+this.context.url);var g=this.callbacks;g&&(this.abortInternal(),g.onTimeout(this.stats,this.context,this.loader))},R.loadprogress=function(g){var S=this.stats;S.loaded=g.loaded,g.lengthComputable&&(S.total=g.total)},R.getCacheAge=function(){var g=null;if(this.loader&&A.test(this.loader.getAllResponseHeaders())){var S=this.loader.getResponseHeader("age");g=S?parseFloat(S):null}return g},D}();P.default=F}}).default})})(ze);var We=rt(ze.exports),kr="",Le=(V,j)=>{const K=V.__vccOpts||V;for(const[P,p]of j)K[P]=p;return K};const it={name:"d-icon"};function nt(V){const j=V,K=b.computed(()=>({fontSize:/^\d+$/.test(j.size)?j.size+"px":j.size}));return(P,p)=>(b.openBlock(),b.createElementBlock("i",{class:b.normalizeClass(["d-icon iconfont",V.icon]),style:b.normalizeStyle(b.unref(K))},null,6))}var ye=Le(Object.assign(it,{props:{icon:String,size:[Number,String]},setup:nt}),[["__scopeId","data-v-0c690e66"]]),Kr="";const at={class:"d-player-top"},st={class:"top-title"},ot={class:"top-title"};var lt=Le({props:{title:{default:""}},setup(V){Date.prototype.format=function(P){let p={"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds()};for(var M in p)new RegExp("("+M+")").test(P)&&(P=P.replace(RegExp.$1,RegExp.$1.length==1?p[M]:("00"+p[M]).substr((""+p[M]).length)));return P};let j=b.ref("00:00:00");j.value=new Date().format("hh:mm:ss");let K=null;return K=setInterval(()=>{j.value=new Date().format("hh:mm:ss")},1e3),b.onUnmounted(()=>{clearInterval(K)}),(P,p)=>(b.openBlock(),b.createElementBlock("div",at,[b.createElementVNode("p",st,b.toDisplayString(V.title||""),1),b.createElementVNode("p",ot,b.toDisplayString(b.unref(j)),1)]))}},[["__scopeId","data-v-4cb76d59"]]),Gr="";const ut={class:"d-status"},ft={class:"d-flex-center"},dt={class:"d-flex-center"},ct=b.createTextVNode("5X\u901F\u64AD\u653E\u4E2D ");var ht=Le(b.defineComponent({props:["state"],setup(V){return(j,K)=>b.withDirectives((b.openBlock(),b.createElementBlock("div",ut,[b.withDirectives(b.createElementVNode("li",ft,[b.createVNode(ye,{size:"18",class:"d-status-icon",icon:`icon-volume-${V.state.volume==0?"mute":V.state.volume>.5?"up":"down"}`},null,8,["icon"]),b.createTextVNode(" "+b.toDisplayString(~~(V.state.volume*100))+"% ",1)],512),[[b.vShow,V.state.handleType=="volume"]]),b.withDirectives(b.createElementVNode("li",dt,[b.createVNode(ye,{size:"12",icon:"icon-play"}),b.createVNode(ye,{size:"12",icon:"icon-play",style:{"margin-right":"5px"}}),ct],512),[[b.vShow,V.state.handleType=="playbackRate"||V.state.isMultiplesPlay]])],512)),[[b.vShow,V.state.handleType||V.state.isMultiplesPlay]])}}),[["__scopeId","data-v-ac2469ec"]]),jr="";const vt=V=>(b.pushScopeId("data-v-385f7870"),V=V(),b.popScopeId(),V),gt=["checked","true-value","false-value"],mt=vt(()=>b.createElementVNode("span",{class:"d-switch_action"},null,-1));var Ge=Le(b.defineComponent({props:{modelValue:{type:[Number,String,Boolean]},width:{type:String,default:"40px"},trueValue:{type:[Number,String,Boolean],default:!0},falseValue:{type:[Number,String,Boolean],default:!0},activeColor:{type:[String],default:"#409EFF"}},emits:["update:modelValue","change"],setup(V,{emit:j}){const K=V;b.useCssVars(O=>({"014e5dc0":V.width,e4e32852:V.activeColor}));const P=b.ref(null),p=b.computed(()=>K.modelValue===K.trueValue),M=()=>{b.nextTick(()=>{const O=P.value.checked;j("update:modelValue",O),j("change",O)})};return(O,A)=>(b.openBlock(),b.createElementBlock("div",{class:b.normalizeClass(["d-switch",{"is-checked":b.unref(p)}])},[b.createElementVNode("input",{class:"d-switch__input",ref:(F,D)=>{D.input=F,P.value=F},type:"checkbox",checked:b.unref(p),onChange:M,"true-value":V.trueValue,"false-value":V.falseValue},null,40,gt),mt],2))}}),[["__scopeId","data-v-385f7870"]]),Yr="";const _e=V=>(b.pushScopeId("data-v-b2384226"),V=V(),b.popScopeId(),V),Et={key:0},pt=_e(()=>b.createElementVNode("i",{class:"rotating iconfont icon-loading f50"},null,-1)),yt=[_e(()=>b.createElementVNode("i",{class:"rotating iconfont icon-loading f50"},null,-1)),_e(()=>b.createElementVNode("p",null,"\u6B63\u5728\u7F13\u51B2...",-1))],Tt=[_e(()=>b.createElementVNode("i",{class:"iconfont icon-replay f24 mr5"},null,-1)),b.createTextVNode("\u91CD\u65B0\u64AD\u653E ")],xt=[_e(()=>b.createElementVNode("i",{class:"iconfont icon-replay f24 mr5"},null,-1)),b.createTextVNode("\u8BF7\u6C42\u9519\u8BEF ")];var St=Le(b.defineComponent({props:{loadType:String,text:{type:String,default:""}},setup(V){const j=V,{proxy:K}=b.getCurrentInstance(),P=["loadstart","waiting","ended","error","stalled"],p=()=>{K.$parent.play()},M=b.computed(()=>{let O="background: rgba(0, 0, 0, .1);z-index:1";return j.loadType=="loadstart"&&(O="background: rgba(0, 0, 0, 1);;z-index:3"),O});return(O,A)=>b.withDirectives((b.openBlock(),b.createElementBlock("div",{class:"d-loading",style:b.normalizeStyle(b.unref(M))},[b.createElementVNode("div",null,[V.loadType=="loadstart"?(b.openBlock(),b.createElementBlock("span",Et,[pt,b.createElementVNode("p",null,b.toDisplayString(V.text),1)])):b.createCommentVNode("",!0),b.withDirectives(b.createElementVNode("span",null,yt,512),[[b.vShow,V.loadType=="waiting"]]),b.withDirectives(b.createElementVNode("span",null,[b.createElementVNode("p",{onClick:p,class:"d-flex-x d-pointer"},Tt)],512),[[b.vShow,V.loadType=="ended"]]),b.withDirectives(b.createElementVNode("span",null,[b.createElementVNode("p",{onClick:p,class:"d-flex-x d-pointer"},xt)],512),[[b.vShow,V.loadType=="error"||V.loadType=="stalled"]])])],4)),[[b.vShow,P.includes(V.loadType)]])}}),[["__scopeId","data-v-b2384226"]]);const Oe=function(V,j,K,P=!1){V&&j&&K&&V.addEventListener(j,K,P)},ue=function(V,j,K,P=!1){V&&j&&K&&V.removeEventListener(j,K,P)};var ei="";const Lt=["onMousedown"],Dt={name:"DSlider"};function At(V,{emit:j}){const K=V;b.useCssVars(m=>({"1a7cd153":V.size}));const P=b.ref(null),p=b.ref(null),M=b.reactive({dragging:!1,hoverPosition:0,hoverTipsLeft:"50%"}),O=b.computed(()=>{let m=K.modelValue<0?0:K.modelValue>1?1:K.modelValue;return K.vertical?`height:${m*100}%`:`width:${m*100}%`}),A=b.computed(()=>{let m=K.preload<0?0:K.preload>1?1:K.preload;return K.vertical?`height:${m*100}%`:`width:${m*100}%`}),F=b.computed(()=>{let m=M.hoverPosition<0?0:M.hoverPosition>1?1:M.hoverPosition;return K.vertical?`bottom:${m*100}%`:`left:${m*100}%`}),D=m=>{m.preventDefault()},R=m=>{K.disabled||(m.preventDefault(),M.dragging=!0,g(m),Oe(window,"mousemove",T),Oe(window,"touchmove",T),Oe(window,"mouseup",x),Oe(window,"touchend",x))},L=m=>{if(!K.hover)return;let h=S(m);if(j("onMousemove",m,h),M.hoverPosition=h,K.vertical)return;let i=P.value,e=p.value.clientWidth/2,r=m.clientX-i.getBoundingClientRect().left;r<e?M.hoverTipsLeft=e-r+"px":i.clientWidth-r<e?M.hoverTipsLeft=i.clientWidth-r-e+"px":M.hoverTipsLeft="50%"},g=m=>{let h=S(m);j("update:modelValue",h),j("change",m,h)},S=m=>{let h=P.value,i=0;if(K.vertical){let e=h.clientHeight;i=(h.getBoundingClientRect().bottom-m.clientY)/e}else i=(m.clientX-h.getBoundingClientRect().left)/h.clientWidth;return i<0?0:i>1?1:i},T=m=>{g(m)},x=m=>{M.dragging&&(ue(window,"mousemove",T),ue(window,"touchmove",T),ue(window,"mouseup",x),ue(window,"touchend",x),ue(window,"contextmenu",x),setTimeout(()=>{M.dragging=!1},0))};return(m,h)=>(b.openBlock(),b.createElementBlock("div",{ref:(i,e)=>{e.refSlider=i,P.value=i},class:b.normalizeClass(["d-slider",{"is-vertical":K.vertical}]),onMousedown:b.withModifiers(R,["stop"]),onContextmenu:D},[b.createElementVNode("div",{class:"d-slider__runway",onMousemove:L},[b.withDirectives(b.createElementVNode("div",{class:"d-slider__cursor",style:b.normalizeStyle(b.unref(F))},[b.withDirectives(b.createElementVNode("div",{class:"d-slider__tips",ref:(i,e)=>{e.refTips=i,p.value=i},style:b.normalizeStyle({left:b.unref(M).hoverTipsLeft})},b.toDisplayString(K.hoverText),5),[[b.vShow,K.hoverText]])],4),[[b.vShow,K.hover]]),b.createElementVNode("div",{class:"d-slider__preload",style:b.normalizeStyle(b.unref(A))},null,4),b.createElementVNode("div",{class:"d-slider__bar",style:b.normalizeStyle(b.unref(O))},null,4)],32)],42,Lt))}const Ot=b.defineComponent(Ke(we({},Dt),{props:{modelValue:{required:!0,type:Number,default:0},disabled:{type:Boolean,default:!1},vertical:{type:Boolean,default:!1},hover:{type:Boolean,default:!0},hoverText:{type:String,default:""},preload:{type:Number,default:0},size:{type:String,default:"10px"}},emits:["update:modelValue","change","onMousemove"],setup:At}));var be=Le(Ot,[["__scopeId","data-v-23288052"]]);const Rt="1.3.1-beta.6";var ti="";const Ve=V=>(b.pushScopeId("data-v-1475e6f9"),V=V(),b.popScopeId(),V),It={key:0,class:"d-player-dialog"},Ct={class:"d-player-dialog-body"},Pt={class:"d-player-dialog-title"},Mt={class:"d-player-hotkey-panel"},_t={class:"d-player-filter-panel"},bt={class:"d-player-filter-panel-item"},Ft=Ve(()=>b.createElementVNode("span",null,"\u9971\u548C\u5EA6",-1)),Bt={class:"d-player-filter-panel-item"},Ut=Ve(()=>b.createElementVNode("span",null,"\u4EAE\u5EA6",-1)),Nt={class:"d-player-filter-panel-item"},kt=Ve(()=>b.createElementVNode("span",null,"\u5BF9\u6BD4\u5EA6",-1));var wt=Le(b.defineComponent({setup(V){const j=b.reactive({show:!1,dialogType:"",dialogTitle:"",version:Rt,mouseX:0,mouseY:0}),K=[{label:"\u89C6\u9891\u8272\u5F69\u8C03\u6574",key:"filter"},{label:"\u5FEB\u6377\u952E\u8BF4\u660E",key:"hotkey"},{label:"\u590D\u5236\u89C6\u9891\u7F51\u5740",key:"copy"}],P=[{key:"Space",label:"\u64AD\u653E/\u6682\u505C"},{key:"\u2192",label:"\u5355\u6B21\u5FEB\u8FDB10s\uFF0C\u957F\u63095\u500D\u901F\u64AD\u653E"},{key:"\u2190",label:"\u5FEB\u90005s"},{key:"\u2191",label:"\u97F3\u91CF\u589E\u52A010%"},{key:"\u2193",label:"\u97F3\u91CF\u589E\u52A0\u964D\u4F4E10%"},{key:"Esc",label:"\u9000\u51FA\u5168\u5C4F/\u9000\u51FA\u7F51\u9875\u5168\u5C4F"},{key:"F",label:"\u5168\u5C4F/\u9000\u51FA\u5168\u5C4F"}],p=b.reactive({saturate:.392,brightness:.392,contrast:.392});b.computed(()=>({left:j.mouseX+"px",top:j.mouseY+"px"})),b.watch(p,D=>{let R=document.querySelector("#dPlayerVideo"),L=(D.saturate*2.55).toFixed(2),g=(D.brightness*2.55).toFixed(2),S=(D.contrast*2.55).toFixed(2);R.style.filter=`saturate(${L}) brightness(${g}) contrast(${S})`});const M=()=>{p.saturate=.392,p.brightness=.392,p.contrast=.392},O=D=>{D.key=="Escape"&&F(0)},A=D=>{D.preventDefault(),Oe(window,"keydown",O),Oe(window,"click",F);let R=document.querySelector("#refPlayerWrap"),L=R.clientWidth;R.clientHeight,j.mouseX=D.clientX-R.getBoundingClientRect().left,L-j.mouseX<130&&(j.mouseX=j.mouseX+(L-j.mouseX-130)),j.mouseY=D.clientY-R.getBoundingClientRect().top,j.show=!0},F=D=>{let R=D.path[0].tagName=="LI",L=D.path[0].attributes.dplayerKeyCode&&D.path[0].attributes.dplayerKeyCode.value,g=K.map(S=>S.key);if(R&&g.includes(L))if(j.dialogTitle=D.path[0].innerText,j.dialogType=L,L=="copy"){let S=document.querySelector(".d-player-copyText");S.value=window.location.href,S.select(),document.execCommand("copy"),j.dialogType=""}else L=="version"&&(j.dialogType="");j.show=!1,ue(window,"keydown",O),ue(window,"click",F)};return b.onMounted(()=>{let D=document.querySelector("#refPlayerWrap");ue(window,"keydown",O),ue(window,"click",F),ue(D,"contextmenu",A),Oe(D,"contextmenu",A)}),b.onUnmounted(()=>{let D=document.querySelector("#refPlayerWrap");ue(window,"keydown",O),ue(window,"click",F),ue(D,"contextmenu",A)}),(D,R)=>(b.openBlock(),b.createElementBlock("div",null,[b.createVNode(b.Transition,{name:"d-fade-in"},{default:b.withCtx(()=>[b.unref(j).dialogType?(b.openBlock(),b.createElementBlock("div",It,[b.createElementVNode("div",Ct,[b.createElementVNode("h5",Pt,[b.createTextVNode(b.toDisplayString(b.unref(j).dialogTitle)+" ",1),b.createElementVNode("i",{onClick:R[0]||(R[0]=L=>b.unref(j).dialogType=!1),class:"icon icon-close"},"X")]),b.withDirectives(b.createElementVNode("ul",Mt,[(b.openBlock(),b.createElementBlock(b.Fragment,null,b.renderList(P,L=>b.createElementVNode("li",{class:"d-player-hotkey-panel-item",key:L.key},[b.createElementVNode("span",null,b.toDisplayString(L.key),1),b.createElementVNode("span",null,b.toDisplayString(L.label),1)])),64))],512),[[b.vShow,b.unref(j).dialogType=="hotkey"]]),b.withDirectives(b.createElementVNode("ul",_t,[b.createElementVNode("li",bt,[Ft,b.createVNode(be,{class:"filter-panel-slider",size:"5px",modelValue:b.unref(p).saturate,"onUpdate:modelValue":R[1]||(R[1]=L=>b.unref(p).saturate=L)},null,8,["modelValue"]),b.createElementVNode("span",null,b.toDisplayString(Math.round(b.unref(p).saturate*255)),1)]),b.createElementVNode("li",Bt,[Ut,b.createVNode(be,{class:"filter-panel-slider",size:"5px",modelValue:b.unref(p).brightness,"onUpdate:modelValue":R[2]||(R[2]=L=>b.unref(p).brightness=L)},null,8,["modelValue"]),b.createElementVNode("span",null,b.toDisplayString(Math.round(b.unref(p).brightness*255)),1)]),b.createElementVNode("li",Nt,[kt,b.createVNode(be,{class:"filter-panel-slider",size:"5px",modelValue:b.unref(p).contrast,"onUpdate:modelValue":R[3]||(R[3]=L=>b.unref(p).contrast=L)},null,8,["modelValue"]),b.createElementVNode("span",null,b.toDisplayString(Math.round(b.unref(p).contrast*255)),1)]),b.createElementVNode("span",{onClick:M,title:"\u91CD\u7F6E","aria-label":"\u91CD\u7F6E",class:"d-player-filter-reset"},"\u91CD\u7F6E")],512),[[b.vShow,b.unref(j).dialogType=="filter"]])])])):b.createCommentVNode("",!0)]),_:1})]))}}),[["__scopeId","data-v-1475e6f9"]]);const Kt=V=>`${parseInt("0x"+V.slice(1,3))},${parseInt("0x"+V.slice(3,5))},${parseInt("0x"+V.slice(5,7))}`,Wt=V=>V.charAt(0).toUpperCase()+V.slice(1),je=V=>{let j=~~(V/3600),K=~~(V%3600/60),P=~~(V%60);return j=j<10?"0"+j:j,K=K<10?"0"+K:K,P=P<10?"0"+P:P,`${j}:${K}:${P}`},Fe="ontouchstart"in window,Gt=V=>{let j=document,K=j.webkitIsFullScreen||j.fullscreen;return K?(document.exitFullscreen||j.webkitExitFullScreen).call(j):(V.requestFullscreen||V.webkitRequestFullScreen).call(V),!K},Vt=V=>{document.pictureInPictureElement?document.exitPictureInPicture().catch(j=>{console.log(j,"Video failed to leave Picture-in-Picture mode.")}):V.requestPictureInPicture().catch(j=>{console.log(j,"Video failed to enter Picture-in-Picture mode.")})},$e=["loadstart","play","pause","playing","seeking","seeked","waiting","durationchange","progress","canplay","timeupdate","ended","error","stalled"],jt={width:{type:String,default:"800px"},height:{type:String,default:"350px"},color:{type:String,default:"#409eff"},src:{required:!0,type:String,default:""},title:{type:String,default:""},type:{type:String,default:"video/mp4"},poster:{type:String,default:""},webFullScreen:{type:Boolean,default:!1},speed:{type:Boolean,default:!0},currentTime:{type:Number,default:0},playsinline:{type:Boolean,default:!1},muted:{type:Boolean,default:!1},speedRate:{type:Array,default:()=>["2.0","1.5","1.25","1.0","0.75"]},autoPlay:{type:Boolean,default:!1},loop:{type:Boolean,default:!1},mirror:{type:Boolean,default:!1},ligthOff:{type:Boolean,default:!1},volume:{type:[String,Number],default:.3},control:{type:Boolean,default:!0},controlBtns:{type:Array,default:["audioTrack","quality","speedRate","volume","setting","pip","pageFullScreen","fullScreen"]},preload:{type:String,default:"auto"}};var ii="";const Ne=V=>(b.pushScopeId("data-v-325ed447"),V=V(),b.popScopeId(),V),Ht={class:"d-player-video",id:"dPlayerVideo"},Yt=["controls","webkit-playsinline","playsinline","volume","muted","loop","preload","src","poster"],Xt={class:"d-player-lightoff"},zt={key:1,class:"d-player-state"},$t={class:"d-play-btn"},Qt=["onKeyup","onKeydown"],Zt={class:"d-control-progress"},Jt={class:"d-tool-bar"},qt={key:0,class:"d-tool-item d-tool-time audioTrack-btn"},er=Ne(()=>b.createElementVNode("span",{style:{margin:"0 3px"}},"/",-1)),tr={class:"total-time"},rr={class:"d-tool-bar"},ir={key:0,class:"d-tool-item quality-btn"},nr={class:"d-tool-item-main"},ar={class:"speed-main",style:{"text-align":"center"}},sr=["onClick"],or={key:1,class:"d-tool-item speedRate-btn"},lr={class:"d-tool-item-main"},ur={class:"speed-main"},fr=["onClick"],dr={key:2,class:"d-tool-item volume-btn"},cr={class:"d-tool-item-main volume-box",style:{width:"52px"}},hr={class:"volume-text-size"},vr={key:3,class:"d-tool-item setting-btn"},gr={class:"d-tool-item-main"},mr={class:"speed-main"},Er=b.createTextVNode(" \u955C\u50CF\u753B\u9762 "),pr=b.createTextVNode(" \u5FAA\u73AF\u64AD\u653E "),yr=b.createTextVNode(" \u5173\u706F\u6A21\u5F0F "),Tr=Ne(()=>b.createElementVNode("div",{class:"d-tool-item-main"},"\u753B\u4E2D\u753B",-1)),xr=Ne(()=>b.createElementVNode("div",{class:"d-tool-item-main"},"\u7F51\u9875\u5168\u5C4F",-1)),Sr=Ne(()=>b.createElementVNode("div",{class:"d-tool-item-main"},"\u5168\u5C4F",-1)),Lr={name:"vue3VideoPlay",inheritAttrs:!1};function Dr(V,{expose:j,emit:K}){const P=V;b.useCssVars(C=>({"2c8b44f1":b.unref(S),"8ab0ebe4":C.width,ff0a8442:C.height}));const p=new We({fragLoadingTimeOut:2e3}),M=b.ref(null),O=b.ref(null),A=b.ref(null),F=b.ref(null),D=b.reactive(Ke(we({dVideo:null},P),{muted:P.muted,playBtnState:P.autoPlay?"pause":"play",loadStateType:"loadstart",fullScreen:!1,handleType:"",currentTime:"00:00:00",preloadBar:0,totalTime:"00:00:00",isVideoHovering:!0,speedActive:"1.0",playProgress:0,isMultiplesPlay:!1,longPressTimeout:null,progressCursorTime:"00:00:00",qualityLevels:[],currentLevel:0})),R=(...C)=>_=>C.reverse().reduce((B,U)=>U(B),_),L=$e.reduce((C,_)=>{let B=`on${Wt(_)}`;return C[B]=U=>{D.loadStateType=_,K(_,U)},C},{});L.onCanplay=R(L.onCanplay,()=>{D.playBtnState!="play"&&D.dVideo.play(),D.autoPlay&&(D.dVideo.play(),D.playBtnState="pause")}),L.onEnded=R(L.onEnded,()=>{D.playBtnState="replay"}),L.onDurationchange=C=>{K("durationchange",C),P.currentTime!=0&&(D.dVideo.currentTime=P.currentTime),L.onTimeupdate(C)},L.onProgress=C=>{K("progress",C);let _=C.target.duration,B=C.target.buffered,U=C.target.buffered.length&&C.target.buffered.end(B-1);D.preloadBar=U/_},L.onTimeupdate=C=>{K("timeupdate",C);let _=C.duration||C.target.duration||0,B=C.currentTime||C.target.currentTime;D.playProgress=B/_,D.currentTime=je(B),D.totalTime=je(_)},L.onError=R(L.onError,()=>{D.playBtnState="replay"});let g=b.useAttrs();for(let C in g)L[C]=g[C];const S=Kt(D.color),T=Xe(500,()=>{D.handleType=""}),x=C=>{C.preventDefault(),C.code=="ArrowUp"?D.volume=D.volume+.1>1?1:D.volume+.1:D.volume=D.volume-.1<0?0:D.volume-.1,D.muted=!1,D.handleType="volume",T()},m=C=>{!P.speed||(D.dVideo.currentTime=D.dVideo.currentTime<10?.1:D.dVideo.currentTime-10,L.onTimeupdate(D.dVideo),e())},h=C=>{C.preventDefault();let _=C.type;if(C.key=="ArrowRight"){if(e(),_=="keyup"){if(clearTimeout(D.longPressTimeout),!P.speed&&!D.longPressTimeout)return;D.isMultiplesPlay?(D.dVideo.playbackRate=D.speedActive,D.isMultiplesPlay=!1):(D.dVideo.currentTime=D.dVideo.currentTime+10,L.onTimeupdate(D.dVideo))}else if(_=="keydown"){if(!P.speed)return;D.isMultiplesPlay&&clearTimeout(D.longPressTimeout),D.longPressTimeout=setTimeout(()=>{D.isMultiplesPlay=!0,D.dVideo.playbackRate=5,D.handleType="playbackRate",T()},500)}}},i=()=>{Fe||F.value.focus()},e=()=>{D.loadStateType="play",D.dVideo.play().catch(()=>{setTimeout(()=>{D.playBtnState="replay",D.loadStateType="error"},500)}),D.playBtnState="pause"},r=()=>{D.dVideo.pause(),D.playBtnState="play"},t=C=>{C&&C.preventDefault(),D.playBtnState=="play"||D.playBtnState=="replay"?e():D.playBtnState=="pause"&&r()},f=()=>{D.muted=!D.muted,D.volume==0&&(D.volume=.05)},s=(C,_)=>{let B=D.dVideo.duration||D.dVideo.target.duration;D.dVideo.currentTime=B*_,D.playBtnState=="play"&&(D.dVideo.play(),D.playBtnState="pause")},n=(C,_)=>{D.progressCursorTime=je(D.dVideo.duration*_)},o=Xe(2500,()=>{D.isVideoHovering=!1}),c=C=>{D.isVideoHovering=!0,o()},v=(C,_)=>{p.currentLevel=_,D.currentLevel=_},u=C=>{D.speedActive=C,D.dVideo.playbackRate=C},a=C=>{K("mirrorChange",C,D.dVideo)},l=C=>{K("loopChange",C,D.dVideo)},d=C=>{K("lightOffChange",C,D.dVideo)},E=()=>{Vt(D.dVideo)},y=()=>{D.fullScreen=Gt(M.value)},I=()=>{D.dVideo.canPlayType(P.type)||D.dVideo.canPlayType("application/vnd.apple.mpegurl")?D.muted=P.autoPlay:We.isSupported()&&(p.detachMedia(),p.attachMedia(D.dVideo),p.on(We.Events.MEDIA_ATTACHED,()=>{p.loadSource(P.src),p.on("hlsManifestParsed",(C,_)=>{D.currentLevel=_.level,D.qualityLevels=_.levels||[]})}),p.on("hlsLevelSwitching",(C,_)=>{}),p.on("hlsLevelSwitched",(C,_)=>{D.currentLevel=_.level}))};return b.watch(()=>P.src,()=>{b.nextTick(()=>{I()})},{immediate:!0}),b.onMounted(()=>{D.dVideo=O,i()}),j({play:e,pause:r,togglePlay:t}),(C,_)=>(b.openBlock(),b.createElementBlock("div",{ref:(B,U)=>{U.refPlayerWrap=B,M.value=B},id:"refPlayerWrap",class:b.normalizeClass(["d-player-wrap",{"web-full-screen":b.unref(D).webFullScreen,"is-lightoff":b.unref(D).lightOff,"d-player-wrap-hover":b.unref(D).playBtnState=="play"||b.unref(D).isVideoHovering}]),onMousemove:c},[b.createElementVNode("div",Ht,[b.createElementVNode("video",b.mergeProps({ref:(B,U)=>{U.refdVideo=B,O.value=B},class:["d-player-video-main",{"video-mirror":b.unref(D).mirror}],id:"dPlayerVideoMain",controls:!!(b.unref(Fe)&&b.unref(D).speed),"webkit-playsinline":P.playsinline,playsinline:P.playsinline},b.unref(L),{volume:b.unref(D).volume,muted:b.unref(D).muted,loop:b.unref(D).loop,preload:C.preload,width:"100%",height:"100%",src:P.src,poster:P.poster}),"\u60A8\u7684\u6D4F\u89C8\u5668\u4E0D\u652F\u6301Video\u6807\u7B7E\u3002",16,Yt)]),b.createVNode(b.Transition,{name:"d-fade-in"},{default:b.withCtx(()=>[b.withDirectives(b.createElementVNode("div",Xt,null,512),[[b.vShow,b.unref(D).lightOff]])]),_:1}),b.unref(D).fullScreen?(b.openBlock(),b.createBlock(lt,{key:0,title:P.title},null,8,["title"])):b.createCommentVNode("",!0),b.unref(Fe)?b.createCommentVNode("",!0):(b.openBlock(),b.createElementBlock("div",zt,[b.createVNode(b.Transition,{name:"d-scale-out"},{default:b.withCtx(()=>[b.withDirectives(b.createElementVNode("div",$t,[b.createVNode(ye,{icon:"icon-play",size:40})],512),[[b.vShow,b.unref(D).playBtnState=="play"]])]),_:1}),b.createVNode(ht,{state:b.unref(D)},null,8,["state"])])),b.unref(Fe)?b.createCommentVNode("",!0):(b.openBlock(),b.createElementBlock("input",{key:2,type:"input",readonly:"readonly",ref:(B,U)=>{U.refInput=B,F.value=B},onDblclick:y,onKeyup:[b.withKeys(y,["f"]),_[0]||(_[0]=b.withKeys(B=>b.unref(D).webFullScreen=!1,["esc"])),h],onClick:t,onKeydown:[b.withKeys(t,["space"]),b.withKeys(m,["arrow-left"]),b.withKeys(x,["arrow-up","arrow-down"]),h],class:"d-player-input",maxlength:"0"},null,40,Qt)),b.createVNode(St,{loadType:b.unref(D).loadStateType},null,8,["loadType"]),b.createVNode(wt),!b.unref(Fe)&&b.unref(D).control?(b.openBlock(),b.createElementBlock("div",{key:3,class:"d-player-control",ref:(B,U)=>{U.refPlayerControl=B,A.value=B}},[b.createElementVNode("div",Zt,[b.createVNode(be,{class:"d-progress-bar",onOnMousemove:n,onChange:s,disabled:!b.unref(D).speed,hoverText:b.unref(D).progressCursorTime,modelValue:b.unref(D).playProgress,"onUpdate:modelValue":_[1]||(_[1]=B=>b.unref(D).playProgress=B),preload:b.unref(D).preloadBar},null,8,["disabled","hoverText","modelValue","preload"])]),b.createElementVNode("div",{class:"d-control-tool",onClick:i},[b.createElementVNode("div",Jt,[b.createElementVNode("div",{class:"d-tool-item",onClick:t},[b.createVNode(ye,{size:"24",icon:`icon-${b.unref(D).playBtnState}`},null,8,["icon"])]),P.controlBtns.includes("audioTrack")?(b.openBlock(),b.createElementBlock("div",qt,[b.createElementVNode("span",null,b.toDisplayString(b.unref(D).currentTime),1),er,b.createElementVNode("span",tr,b.toDisplayString(b.unref(D).totalTime),1)])):b.createCommentVNode("",!0)]),b.createElementVNode("div",rr,[b.unref(D).qualityLevels.length&&P.controlBtns.includes("quality")?(b.openBlock(),b.createElementBlock("div",ir,[b.createTextVNode(b.toDisplayString(b.unref(D).qualityLevels.length&&(b.unref(D).qualityLevels[b.unref(D).currentLevel]||{}).name)+" ",1),b.createElementVNode("div",nr,[b.createElementVNode("ul",ar,[(b.openBlock(!0),b.createElementBlock(b.Fragment,null,b.renderList(b.unref(D).qualityLevels,(B,U)=>(b.openBlock(),b.createElementBlock("li",{class:b.normalizeClass({"speed-active":b.unref(D).currentLevel==U}),onClick:N=>v(B,U),key:B},b.toDisplayString(B.name),11,sr))),128))])])])):b.createCommentVNode("",!0),P.controlBtns.includes("speedRate")?(b.openBlock(),b.createElementBlock("div",or,[b.createTextVNode(b.toDisplayString(b.unref(D).speedActive=="1.0"?"\u500D\u901F":b.unref(D).speedActive+"x")+" ",1),b.createElementVNode("div",lr,[b.createElementVNode("ul",ur,[(b.openBlock(!0),b.createElementBlock(b.Fragment,null,b.renderList(b.unref(D).speedRate,B=>(b.openBlock(),b.createElementBlock("li",{class:b.normalizeClass({"speed-active":b.unref(D).speedActive==B}),onClick:U=>u(B),key:B},b.toDisplayString(B)+"x",11,fr))),128))])])])):b.createCommentVNode("",!0),P.controlBtns.includes("volume")?(b.openBlock(),b.createElementBlock("div",dr,[b.createElementVNode("div",cr,[b.createElementVNode("div",{class:b.normalizeClass(["volume-main",{"is-muted":b.unref(D).muted}])},[b.createElementVNode("span",hr,b.toDisplayString(b.unref(D).muted?0:~~(b.unref(D).volume*100))+"%",1),b.createVNode(be,{onChange:_[2]||(_[2]=B=>b.unref(D).muted=!1),hover:!1,size:"5px",vertical:!0,modelValue:b.unref(D).volume,"onUpdate:modelValue":_[3]||(_[3]=B=>b.unref(D).volume=B)},null,8,["modelValue"])],2)]),b.createElementVNode("span",{onClick:f,style:{display:"flex"}},[b.createVNode(ye,{size:"20",icon:`icon-volume-${b.unref(D).volume==0||b.unref(D).muted?"mute":b.unref(D).volume>.5?"up":"down"}`},null,8,["icon"])])])):b.createCommentVNode("",!0),P.controlBtns.includes("setting")?(b.openBlock(),b.createElementBlock("div",vr,[b.createVNode(ye,{size:"20",class:"rotateHover",icon:"icon-settings"}),b.createElementVNode("div",gr,[b.createElementVNode("ul",mr,[b.createElementVNode("li",null,[Er,b.createVNode(Ge,{onChange:a,modelValue:b.unref(D).mirror,"onUpdate:modelValue":_[4]||(_[4]=B=>b.unref(D).mirror=B)},null,8,["modelValue"])]),b.createElementVNode("li",null,[pr,b.createVNode(Ge,{onChange:l,modelValue:b.unref(D).loop,"onUpdate:modelValue":_[5]||(_[5]=B=>b.unref(D).loop=B)},null,8,["modelValue"])]),b.createElementVNode("li",null,[yr,b.createVNode(Ge,{onChange:d,modelValue:b.unref(D).lightOff,"onUpdate:modelValue":_[6]||(_[6]=B=>b.unref(D).lightOff=B)},null,8,["modelValue"])])])])])):b.createCommentVNode("",!0),P.controlBtns.includes("pip")?(b.openBlock(),b.createElementBlock("div",{key:4,class:"d-tool-item pip-btn",onClick:E},[b.createVNode(ye,{size:"20",icon:"icon-pip"}),Tr])):b.createCommentVNode("",!0),P.controlBtns.includes("pageFullScreen")?(b.openBlock(),b.createElementBlock("div",{key:5,class:"d-tool-item pip-btn",onClick:_[7]||(_[7]=B=>b.unref(D).webFullScreen=!b.unref(D).webFullScreen)},[b.createVNode(ye,{size:"20",icon:"icon-web-screen"}),xr])):b.createCommentVNode("",!0),P.controlBtns.includes("fullScreen")?(b.openBlock(),b.createElementBlock("div",{key:6,class:"d-tool-item fullScreen-btn",onClick:y},[Sr,b.createVNode(ye,{size:"20",icon:"icon-screen"})])):b.createCommentVNode("",!0)])])],512)):b.createCommentVNode("",!0)],34))}const Ar=b.defineComponent(Ke(we({},Lr),{props:jt,emits:[...$e,"mirrorChange","loopChange","lightOffChange"],setup:Dr}));var Be=Le(Ar,[["__scopeId","data-v-325ed447"]]);function Qe(V){V.component(Be.name,Be)}Be.install=Qe,ne.default=Be,ne.install=Qe,ne.videoPlay=Be,Object.defineProperty(ne,"__esModule",{value:!0}),ne[Symbol.toStringTag]="Module"});
